//-------------Mission 16---------------
// Название: Потерянная любовь

const
MISSION14_BANDIT_CAR1 = 200@
MISSION14_BANDIT_CAR2 = 201@
MISSION14_BANDIT_CAR3 = 202@
MISSION14_BANDIT_CAR4 = 203@    
MISSION14_BANDIT_CAR1_EXPLODED = 204@
MISSION14_BANDIT_CAR2_EXPLODED = 205@
MISSION14_BANDIT_CAR3_EXPLODED = 206@
MISSION14_BANDIT_CAR4_EXPLODED = 207@
MISSION14_MISSION_CAR_EXPLODED = 208@
end

:MISS16
thread 'MISS16'
gosub @KOD_MISSII14 
if 
wasted_or_busted
Jf @PROPUSK_KODA14 
gosub @KOD_PROVALA14 

:PROPUSK_KODA14 
gosub @UDALENIE_KODA14

HARDCORE_DANGER_FLAG_SCRIPTED = 0
if
GAME_OVER_FLAG == 1
then
HARDCORE_DANGER_ANTIFLAG_SCRIPTED = 1
end

if
GAME_OVER_FLAG == 1
then
repeat
wait 0
until BLACK_POLOSKI_ON == 1
end

{$INCLUDE checkpoints_write.txt}

end_thread

:KOD_MISSII14 
increment_mission_attempts

cinema.Widescreen(1)
BLACK_POLOSKI_ON = 1
0A48: enable_menu_access_in_widescreen_mode 0  
$SOUND_OFF_1 = 1
0629: change_integer_stat 258 to 16
04B8: get_weapon_data_from_actor PLAYER_ACTOR slot 5 weapon 300@ ammo 301@ model 302@

MAIN_QUEST_MUSIC_FLAG = 1
MAIN_QUEST_TEAMMATES_REMOVE_FLAG = 1

if and
$CHEATS_ON == 1
0AB0:   key_pressed 49
then
0AF1: write_int 1 to_ini_file "data\survival.set" section "SCR" key "M14RC"
end

create_thread @MCS_ASS_CREATE 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 7

32@ = 0

repeat
wait 0
fade 0 0
03F0: enable_text_draw 1
038E: draw_box_position 320.0 224.0 size 640.0 448.0 RGBA 0 0 0 255
until 32@ > 1000

while true
wait 0
$END_FADING_MUSIC_FAST = 1

if and
$MUSIC_FADE_ENDED[0] == 1
$MUSIC_FADE_ENDED[1] == 1
$MUSIC_FADE_ENDED[2] == 1
$MUSIC_FADE_ENDED[3] == 1
$MUSIC_FADE_ENDED[4] == 1
then
$END_FADING_MUSIC_FAST = 0
break
end

end

$ONMISSION = 1  
fade 0 0

01B9: set_actor PLAYER_ACTOR armed_weapon_to 0  

$HEAL = 1   

$SPECIAL_INFECTED_NOT_SPAWN_FLAG = 1

$NOTSPAWN_ETC = 0 
                
00C0: set_current_time 12 0
$WEATHER_SYNC_FLAG = 1

0AF0: 0@ = get_int_from_ini_file "data\survival.set" section "SCR" key "M14RC"
if
0@ == 0
then
PLAYER_DONT_HAVE_BACKPACK = 1
end

$WEATHER_LOCK_NUMBER = 8
create_thread @WTH_LCK

04B8: get_weapon_data_from_actor PLAYER_ACTOR slot 4 weapon 100@ ammo 101@ model 102@
ENEX_OFF = 1
actor.PutAt(PLAYER_ACTOR,-1455.8793, 1491.9393, 7.1092)
actor.Angle(PLAYER_ACTOR) = 144.3875
camera.Restore_WithJumpCut()
04E4: unknown_refresh_game_renderer_at -1455.8793 1491.9393 
03CB: set_rendering_origin_at -1455.8793 1491.9393 7.1092

32@ = 0

repeat
wait 0
fade 0 0
$SAVESTATUS = 1
03F0: enable_text_draw 1
038E: draw_box_position 320.0 224.0 size 640.0 448.0 RGBA 0 0 0 255
until 32@ > 100 

fade 0 0

0AF0: 0@ = get_int_from_ini_file "data\survival.set" section "SCR" key "M14RC"

32@ = 0
repeat
wait 0
fade 0 0
$SAVESTATUS = 1
03F0: enable_text_draw 1
038E: draw_box_position 320.0 224.0 size 640.0 448.0 RGBA 0 0 0 255
until 32@ > 3100

fade 0 0
wait 1

if and
MIKE_SHIZA_FLAG == 1
MIKE_CLASSIC_STORY_VOICES_ON == 1
then

///////////////////////////////////////////////

{$INCLUDE noise2_on.txt}

VOICE_SKIP_LONG_SET = 0          

for $ACHIV_NUMBER = 270 to 286

create_thread @VOI_SHO
          
repeat
wait 0

if
VOICE_SKIP_LONG_SET > VOICE_SKIP_LONG_SKIP_SET
    then
    break
    end

until $ACHIV_SHOW_ENDED == 1

end

{$INCLUDE noise2_off.txt} 

///////////////////////////////////////////////

end 

0AF0: 0@ = get_int_from_ini_file "data\survival.set" section "SCR" key "M14RC"

if
0@ == 0
    then
    
    if
    CLASSIC_MUSIC == 0
    then
    $MUSIC_MISSION = Audiostream.Load(MUSIC_18A)
    else
    $MUSIC_MISSION = Audiostream.Load(CLASSIC_MUSIC_18A)
    end
    
    Audiostream.PerformAction($MUSIC_MISSION, PLAY)
    Audiostream.Loop($MUSIC_MISSION, 1)
    Audiostream.Volume($MUSIC_MISSION) = 0.0
    
    /////////////////////Плавное нарастание/////////////////////

    $MUSIC_FADE_NUMBER += 1
    if
    $MUSIC_FADE_NUMBER > 4
        then
        $MUSIC_FADE_NUMBER = 0 
        end    
    
    0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_MISSION // (int) 
    0086: $MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = $MUSIC_VOLUME // (float) 
    
    $MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 1000
    $MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 1  
    $MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
    create_thread @MUS_FAD
    
    wait 1
    
    
    //////////////////////////////////////////////////////////
     
    else
    $PREPARING_CHECKPOINT = 1
    create_thread @PTL_TXT  
    103@ = 1
    end       

0AF0: 0@ = get_int_from_ini_file "data\survival.set" section "SCR" key "M14RC"

if
0@ == 0
jf @MISSION14_CHECKPOINT   

fade 0 0         

$SAVESTATUS = 1
Player.CanMove(PLAYER_CHAR) = False
02A3: enable_widescreen 1
BLACK_POLOSKI_ON = 1 
$HUD_REMOVE = 1 
Model.Load(#SOMYRI)
Model.Load(54)
Model.Load(20)
mload
Actor.PutAt(PLAYER_ACTOR, -1384.3539, 1479.5303, 8.5625)
Actor.Angle(PLAYER_ACTOR) = 171.6736
Camera.Restore_WithJumpCut

while not model.Available(#SOMYRI)
wait 0
model.Load(#SOMYRI)
mload
end

$SURVIVER[0] = Actor.Create(CivMale, #SOMYRI, -1383.1814, 1479.5309, 8.5625)
Actor.Angle($SURVIVER[0]) = 154.7926

camera.SetPosition(-1383.074463 1480.357178 9.288983,0.0,0.0,0.0)
camera.PointAt(-1383.656250 1479.544922 9.246897,2)

wait 1000

0A48: enable_menu_access_in_widescreen_mode 1  
$SOUND_OFF_1 = 0
wait 0
Cinema.Widescreen(1)
BLACK_POLOSKI_ON = 1

wait 500
fade 1 1000    
wait 1000   
v$ST_DIALOG[0] = "MSN887"
v$ST_DIALOG[1] = "MSN888"
v$ST_DIALOG[2] = "MSN889"
v$ST_DIALOG[3] = "MSN890"
v$ST_DIALOG[4] = "MSN891"
v$ST_DIALOG[5] = "MSN892"
v$ST_DIALOG[6] = "MSN893"
v$ST_DIALOG[7] = "MSN894"
v$ST_DIALOG[8] = "MSN895"
$DIALOG_COUNT = 8
create_thread @DG_SYS2

repeat
wait 0
until $DIALOG_END == 1

fade 0 1000
wait 1000 
camera.Restore_WithJumpCut()

actor.DestroyInstantly($SURVIVER[0])
Actor.PutAt(PLAYER_ACTOR, -1371.7244, 1494.097, 1.8516)
Actor.Angle(PLAYER_ACTOR) = 37.1422

while not model.Available(54)
wait 0
model.Load(54)
mload
end

$SURVIVER[0] = actor.Create(26,54,-1373.0428, 1495.7567, 0.8516)
actor.Angle($SURVIVER[0]) = 200.7079
wait 1                  

camera.SetPosition(-1371.850952 1493.134155 2.599323,0.0,0.0,0.0)
camera.PointAt(-1372.134033 1494.077148 2.423980,2)

wait 1000
0A1D: AS_actor PLAYER_ACTOR rotate_to_and_look_at_actor $SURVIVER[0]
0A1D: AS_actor $SURVIVER[0] rotate_to_and_look_at_actor PLAYER_ACTOR
wait 500
fade 1 1000 
wait 1000   
05BF: AS_actor PLAYER_ACTOR look_at_actor $SURVIVER[0] -1 ms
05BF: AS_actor $SURVIVER[0] look_at_actor PLAYER_ACTOR -1 ms    
0084: $DIALOG_ACTOR[0] = PLAYER_ACTOR // (int)
0084: $DIALOG_ACTOR[1] = $SURVIVER[0] // (int)
0084: $DIALOG_ACTOR[2] = PLAYER_ACTOR // (int)
0084: $DIALOG_ACTOR[3] = $SURVIVER[0] // (int)
0084: $DIALOG_ACTOR[4] = PLAYER_ACTOR // (int)
0084: $DIALOG_ACTOR[5] = $SURVIVER[0] // (int)
0084: $DIALOG_ACTOR[6] = PLAYER_ACTOR // (int)
0084: $DIALOG_ACTOR[7] = $SURVIVER[0] // (int)
0084: $DIALOG_ACTOR[8] = $SURVIVER[0] // (int)
0084: $DIALOG_ACTOR[9] = PLAYER_ACTOR // (int)
v$ST_DIALOG[0] = "MSN901"
v$ST_DIALOG[1] = "MSN902"
v$ST_DIALOG[2] = "MSN903"
v$ST_DIALOG[3] = "MSN904"
v$ST_DIALOG[4] = "MSN905"
v$ST_DIALOG[5] = "MSN906"
v$ST_DIALOG[6] = "MSN907"
v$ST_DIALOG[7] = "MSN908"
v$ST_DIALOG[8] = "MSN909"
v$ST_DIALOG[9] = "MSN910"    
$DIALOG_COUNT = 9
create_thread @DG_SYS

repeat
wait 0
until $DIALOG_END == 1

05BF: AS_actor PLAYER_ACTOR look_at_actor $SURVIVER[0] 1000 ms
05BF: AS_actor $SURVIVER[0] look_at_actor PLAYER_ACTOR 1000 ms 

fade 0 1000
wait 1000
$SAVESTATUS = 0
camera.Restore_WithJumpCut()
actor.DestroyInstantly($SURVIVER[0])
actor.RemoveReferences($SURVIVER[0])
02A3: enable_widescreen 0
BLACK_POLOSKI_ON = 0
Player.CanMove(PLAYER_CHAR) = true
04E4: unknown_refresh_game_renderer_at -1613.3937 1284.3802
03CB: set_rendering_origin_at -1682.3297 1409.7527 7.178
Actor.PutAt(PLAYER_ACTOR, -1682.3297, 1409.7527, 7.178)
Actor.Angle(PLAYER_ACTOR) = 136.231
Camera.Restore_WithJumpCut

$SAVE_PREPARE_OFF = 0
PLAYER_DONT_HAVE_BACKPACK = 0
create_thread @PED_BKP PLAYER_ACTOR 371
$FP_BACKPACK_HAD = 1

if
MIKE_SHIZA_FLAG == 1
then
048F: actor PLAYER_ACTOR remove_weapons
end 

////////////////////////////////////////////// 

04B8: get_weapon_data_from_actor PLAYER_ACTOR slot 3 weapon 1@ ammo 2@ model 3@
if
2@ < 1
then

0781: get_weapon_with_ID 22 model_to 0@

while not model.Available(0@)
wait 0
model.Load(0@)
mload
end

if
MIKE_SHIZA_FLAG == 1
then 
Actor.GiveWeaponAndAmmo(PLAYER_ACTOR, 22, 120)
else
Actor.GiveWeaponAndAmmo(PLAYER_ACTOR, 22, 40)
end

else

if
MIKE_SHIZA_FLAG == 1
then
2@ += 120
else
2@ += 40
end

017B: set_actor PLAYER_ACTOR weapon 1@ ammo_to 2@
01B9: set_actor PLAYER_ACTOR armed_weapon_to 1@
end

//////////////////////////////////////////////

0506: set_car_model 15401 next_variation -1 2 // first param is useless

:CAR_CREATE_MISSION16_1
if
model.Available(15401)
then

SUPPLY_QUEST_TRUCK = Car.Create(15401, -1613.3937, 1284.3802, 6.9652)

if
model.Available(15401)
then
//model.Destroy(15401)
end

else
model.Load(15401)
mload
wait 0
jump to @CAR_CREATE_MISSION16_1
end

Car.Angle(SUPPLY_QUEST_TRUCK) = 86.78 
car.Health(SUPPLY_QUEST_TRUCK) = CAR_HEALTH_MAX 

0229: set_car SUPPLY_QUEST_TRUCK primary_color_to 20 secondary_color_to 20  

0A97: 11@ = car SUPPLY_QUEST_TRUCK struct 
11@ += 9
0A8D: 12@ = read_memory 11@ size 1 virtual_protect 0
08BD: set 12@ bit 2
0A8C: write_memory 11@ size 1 value 12@ virtual_protect 0 
/////////////////////
0A97: 11@ = car SUPPLY_QUEST_TRUCK struct 
11@ += 4 
0A8D: 12@ = read_memory 11@ size 1 virtual_protect 0
08BD: set 12@ bit 1 
0A8C: write_memory 11@ size 1 value 12@ virtual_protect 0
random_float 24@ 30.0 50.0 
0A97: 22@ = car SUPPLY_QUEST_TRUCK struct 
0A8E: 23@ = 22@ + 5 // int 
0A8C: write_memory 23@ size 4 value 24@ virtual_protect 0 
08C3: clear 12@ bit 1
08C3: clear 12@ bit 2
0A97: 11@ = car SUPPLY_QUEST_TRUCK struct 
11@ += 18
0A8D: 12@ = read_memory 11@ size 1 virtual_protect 0
08BD: set 12@ bit 2
0A8C: write_memory 11@ size 1 value 12@ virtual_protect 0 
08C3: clear 12@ bit 2  

036A: put_actor PLAYER_ACTOR in_car SUPPLY_QUEST_TRUCK

car.RemoveReferences(SUPPLY_QUEST_TRUCK)
    
wait 1000

fade 1 1000
$HUD_REMOVE = 0  
wait 1000

018A: MISSION_CHECKPOINT = create_checkpoint_at -2511.9304 1053.9329 64.8772
03BC: MISSION_SPHERE = create_sphere_at -2511.9304 1053.9329 64.8772 radius 2.0
v$OBJECTIVE = "MSN80"

repeat
wait 0

if
not actor.InCar(PLAYER_ACTOR,SUPPLY_QUEST_TRUCK)    
    then 
       
    marker.Disable(MISSION_CHECKPOINT)
    $DIALOG_PAUSE = 1
    
    MISSION_MARKER = marker.CreateAboveCar(SUPPLY_QUEST_TRUCK)
    07E0: set_marker MISSION_MARKER type_to 1
    
    v$OBJECTIVE = "MSN49"
    
    while not actor.InCar(PLAYER_ACTOR,SUPPLY_QUEST_TRUCK)   
    wait 0
    
    if 
    not Actor.Dead(PLAYER_ACTOR)
    jf @KOD_PROVALA14 
    
    if
    car.Wrecked(SUPPLY_QUEST_TRUCK)
        then
        jump to @KOD_PROVALA14_CAR
        end        
        
    end
    
    marker.Disable(MISSION_MARKER)
    
    018A: MISSION_CHECKPOINT = create_checkpoint_at -2511.9304 1053.9329 64.8772
    
    v$OBJECTIVE = "MSN80" 
    $DIALOG_PAUSE = 0
       
    end 

until 00EC:   actor PLAYER_ACTOR sphere 0 near_point -2511.9304 1053.9329 radius 40.0 40.0

text.ClearAll()
text.ShowH('MSN912',2500,1)  
$NOTSPAWN_CARS = 1  

repeat
wait 0  

if 
not car.Wrecked(SUPPLY_QUEST_TRUCK)
jf @KOD_PROVALA14_CAR

if 
not Actor.Dead(PLAYER_ACTOR)
jf @KOD_PROVALA14 

until 00ED:   actor PLAYER_ACTOR sphere 0 near_point -2511.9304 1053.9329 radius 2.0 2.0 on_foot

0AF1: write_int 1 to_ini_file "data\survival.set" section "SCR" key "M14RC"
0AF1: write_int $SECOND_PLAYED to_ini_file "data\survival.set" section "SCR" key "M14RCSP"
0AF1: write_int $MINUTES_PLAYED to_ini_file "data\survival.set" section "SCR" key "M14RCMP"
0AF1: write_int $HOURS_PLAYED to_ini_file "data\survival.set" section "SCR" key "M14RCHP"
00BF: CURRENT_TIME_HOURS = current_time_hours, CURRENT_TIME_MINUTES = current_time_minutes
0AF1: write_int CURRENT_TIME_HOURS to_ini_file "data\survival.set" section "SCR" key "M14RCTM1"
0AF1: write_int CURRENT_TIME_MINUTES to_ini_file "data\survival.set" section "SCR" key "M14RCTM2"

Player.CanMove(PLAYER_CHAR) = false
v$OBJECTIVE = "DUMMY"
marker.Disable(MISSION_CHECKPOINT)
03BD: destroy_sphere MISSION_SPHERE

$HUD_REMOVE = 1
fade 0 1000
wait 1000

$SAVESTATUS = 1
02A3: enable_widescreen 1
BLACK_POLOSKI_ON = 1

actor.PutAtNoOffset(PLAYER_ACTOR,-2511.5937, 1054.0172, 64.9801)
actor.Angle(PLAYER_ACTOR) = 270.8279

0E09: mark_car_as_needed SUPPLY_QUEST_TRUCK

if
$FP_ACTIVATED == 1
then
repeat
wait 0
until $FP_ACTIVATED == 0
end

0936: set_camera -2514.056641 1056.107910 64.908630 position_to -2513.348877 1055.685059 64.929497 time 50000 smooth_transition 1
0920: point_camera -2513.213135 1055.578735 65.001450 transverse_to -2512.501709 1055.155396 64.970024 time 50000 smooth_transition 1

wait 1000
fade 1 1000
wait 1000
0084: $DIALOG_ACTOR[0] = PLAYER_ACTOR // (int)
v$ST_DIALOG[0] = "MSN941"
v$ST_DIALOG[1] = "MSN942"
v$ST_DIALOG[2] = "MSN943"
v$ST_DIALOG[3] = "MSN944"
$DIALOG_COUNT = 3
create_thread @DG_SYS

repeat
wait 0
until $DIALOG_END == 1

fade 0 1000
wait 1000      

0936: set_camera -2518.0264 1057.8042 67.0759 position_to -2513.2231 1056.8002 65.9137 time 1 smooth_transition 1
0920: point_camera -2510.9219 1054.0985 65.1854 transverse_to -2510.9229 1053.7739 65.1851 time 1 smooth_transition 1  

INT_ZOMBIE_OFF_FADING_AND_SHIT_FLAG = 1
$INT_ZMB_NOT = 1
wait 1000
select_interior 6
0860: link_actor PLAYER_ACTOR to_interior 6

while not model.Available(20)
wait 0
model.Load(20)
mload
end

$SURVIVER[0] = actor.Create(26,20,2315.2222, -1210.0813, 1049.0234)
actor.Angle($SURVIVER[0]) = 88.6941
actor.Health($SURVIVER[0]) = $FRIEND_HEALTH
060B: set_actor $SURVIVER[0] decision_maker_to $DEC_PEOPLE
0860: link_actor $SURVIVER[0] to_interior 6

actor.PutAtNoOffset(PLAYER_ACTOR,2313.1506, -1210.1345, 1049.0234)
actor.Angle(PLAYER_ACTOR) = 271.24

04E4: unknown_refresh_game_renderer_at 2313.1506 -1210.1345
03CB: set_rendering_origin_at 2313.1506 -1210.1345 1049.0234

0936: set_camera 2311.617920 -1208.386597 1049.647949 position_to 2311.986084 -1208.557495 1049.524048 time 90000 smooth_transition 1
0920: point_camera 2312.375732 -1208.974487 1049.364502 transverse_to 2312.734863 -1209.174194 1049.281250 time 90000 smooth_transition 1

wait 1000

0A1D: AS_actor PLAYER_ACTOR rotate_to_and_look_at_actor $SURVIVER[0]
0A1D: AS_actor $SURVIVER[0] rotate_to_and_look_at_actor PLAYER_ACTOR

wait 500
fade 1 1000 
wait 1000   

05BF: AS_actor PLAYER_ACTOR look_at_actor $SURVIVER[0] -1 ms
05BF: AS_actor $SURVIVER[0] look_at_actor PLAYER_ACTOR -1 ms   
 
0084: $DIALOG_ACTOR[0] = $SURVIVER[0] // (int)
0084: $DIALOG_ACTOR[1] = PLAYER_ACTOR // (int)
0084: $DIALOG_ACTOR[2] = $SURVIVER[0] // (int)
0084: $DIALOG_ACTOR[3] = PLAYER_ACTOR // (int)
0084: $DIALOG_ACTOR[4] = $SURVIVER[0] // (int)
0084: $DIALOG_ACTOR[5] = PLAYER_ACTOR // (int)
0084: $DIALOG_ACTOR[6] = $SURVIVER[0] // (int)
0084: $DIALOG_ACTOR[7] = PLAYER_ACTOR // (int)
0084: $DIALOG_ACTOR[8] = $SURVIVER[0] // (int)
0084: $DIALOG_ACTOR[9] = PLAYER_ACTOR // (int)
0084: $DIALOG_ACTOR[10] = $SURVIVER[0] // (int)
0084: $DIALOG_ACTOR[11] = $SURVIVER[0] // (int)
0084: $DIALOG_ACTOR[12] = $SURVIVER[0] // (int)
0084: $DIALOG_ACTOR[13] = $SURVIVER[0] // (int)
0084: $DIALOG_ACTOR[14] = $SURVIVER[0] // (int)
0084: $DIALOG_ACTOR[15] = $SURVIVER[0] // (int)
0084: $DIALOG_ACTOR[16] = $SURVIVER[0] // (int)
0084: $DIALOG_ACTOR[17] = $SURVIVER[0] // (int)
v$ST_DIALOG[0] = "MSN945"
v$ST_DIALOG[1] = "MSN946"
v$ST_DIALOG[2] = "MSN947"
v$ST_DIALOG[3] = "MSN948"
v$ST_DIALOG[4] = "MSN949"
v$ST_DIALOG[5] = "MSN950"
v$ST_DIALOG[6] = "MSN951"
v$ST_DIALOG[7] = "MSN952"
v$ST_DIALOG[8] = "MSN953"
v$ST_DIALOG[9] = "MSN954"
v$ST_DIALOG[10] = "MSN955"
v$ST_DIALOG[11] = "MSN956"
v$ST_DIALOG[12] = "MSN957"
v$ST_DIALOG[13] = "MSN958"
v$ST_DIALOG[14] = "MSN959"
v$ST_DIALOG[15] = "MSN960"
v$ST_DIALOG[16] = "MSN961"
v$ST_DIALOG[17] = "MSN962"
$DIALOG_COUNT = 17
create_thread @DG_SYS

repeat
wait 0
until $DIALOG_END == 1

0@ = Audiostream.Load("AUDIO\SOUNDS\knock.wav")
Audiostream.Volume(0@) = $MUSIC_VOLUME
Audiostream.Loop(0@, 0)
Audiostream.PerformAction(0@, PLAY)

gosub @MUSIC14_OFF

if
CLASSIC_MUSIC == 0
then
$MUSIC_MISSION = Audiostream.Load(MUSIC_18B)
else
$MUSIC_MISSION = Audiostream.Load(CLASSIC_MUSIC_18B)
end

Audiostream.PerformAction($MUSIC_MISSION, PLAY)
Audiostream.Loop($MUSIC_MISSION, 1)
Audiostream.Volume($MUSIC_MISSION) = 0.0

/////////////////////Плавное нарастание/////////////////////

$MUSIC_FADE_NUMBER += 1
if
$MUSIC_FADE_NUMBER > 4
    then
    $MUSIC_FADE_NUMBER = 0 
    end    

0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_MISSION // (int) 
0086: $MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = $MUSIC_VOLUME // (float) 

$MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 200
$MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 1  
$MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
create_thread @MUS_FAD

wait 1

//////////////////////////////////////////////////////////

0084: $DIALOG_ACTOR[0] = PLAYER_ACTOR // (int)
0084: $DIALOG_ACTOR[1] = $SURVIVER[0] // (int)
0084: $DIALOG_ACTOR[2] = PLAYER_ACTOR // (int)
0084: $DIALOG_ACTOR[3] = $SURVIVER[0] // (int)
v$ST_DIALOG[0] = "MSN963"
v$ST_DIALOG[1] = "MSN964"
v$ST_DIALOG[2] = "MSN965"
v$ST_DIALOG[3] = "MSN966"
$DIALOG_COUNT = 3
create_thread @DG_SYS

repeat
wait 0
if
until $DIALOG_END == 1

05BF: AS_actor PLAYER_ACTOR look_at_actor $SURVIVER[0] 1000 ms
05BF: AS_actor $SURVIVER[0] look_at_actor PLAYER_ACTOR 1000 ms

fade 0 1000
wait 1000

select_interior 0
0860: link_actor PLAYER_ACTOR to_interior 0
0860: link_actor $SURVIVER[0] to_interior 0

audiostream.Release(0@)

0936: set_camera 2311.4753 -1208.6932 1049.0234 position_to 2313.8623 -1208.7864 1049.0234 time 1 smooth_transition 1
0920: point_camera 2315.1799 -1210.0704 1049.0234 transverse_to 2315.1799 -1210.0704 1049.0234 time 1 smooth_transition 1

02A3: enable_widescreen 0
BLACK_POLOSKI_ON = 0

:MISSION14_CHECKPOINT_JUMP
$SAVESTATUS = 1
041E: set_radio_station 12

fade 0 0

Player.CanMove(PLAYER_CHAR) = true
camera.Restore_WithJumpCut()

053F: set_car SUPPLY_QUEST_TRUCK tires_vulnerability 0

if
COOP_ACTIVE_FLAG == 1
then
0631: put_actor $SURVIVER[0] in_group PLAYER_GROUP
0EA0: set_actor_second_player $SURVIVER[0] enable_camera 1 separate_cars 0
0084: COOP_ACTOR = $SURVIVER[0] // (int)
07CC: set_player 1 can_enter_exit_vehicles 0
else
036A: put_actor $SURVIVER[0] in_car SUPPLY_QUEST_TRUCK
end

036A: put_actor $SURVIVER[0] in_car SUPPLY_QUEST_TRUCK

actor.SetImmunities($SURVIVER[0],1,1,1,1,1)

if or
COOP_ACTIVE_FLAG == 1
0A4B:   controls_set_to_joystick
then
06A7: put_actor PLAYER_ACTOR into_turret_on_car SUPPLY_QUEST_TRUCK at_car_offset 0.0 -1.5 0.7 position 1 shooting_angle 360.0 70.0 with_weapon 29
04EB: AS_actor PLAYER_ACTOR crouch 1
else
06A7: put_actor PLAYER_ACTOR into_turret_on_car SUPPLY_QUEST_TRUCK at_car_offset 1.0 0.0 0.6 position 1 shooting_angle 360.0 70.0 with_weapon 29
end

STORY_DRIVEBY_NO_RETURN_FLAG = 1
HARDCORE_DANGER_FLAG_SCRIPTED = 1
wait 1

if or
COOP_ACTIVE_FLAG == 1
0A4B:   controls_set_to_joystick
then
DRAW_NOTURRET_CROSSHAIR_FLAG = 1
player.CanMove(PLAYER_CHAR,false)
wait 0
player.CanMove(PLAYER_CHAR,true)
end
 
actor.SetImmunities(PLAYER_ACTOR,1,0,0,0,0)

if
COOP_ACTIVE_FLAG == 1
then
16@ = car.Angle(SUPPLY_QUEST_TRUCK)
16@ -= 90.0 
0858: set_player PLAYER_CHAR scan_horizon_to_angle 16@ rotation_speed 16@
end

car.Health(SUPPLY_QUEST_TRUCK) = 2500
DELITEL2 = 20                
MIKE_CAR = car.Health(SUPPLY_QUEST_TRUCK)
MIKE_CAR -= 250
0070: MIKE_CAR /= DELITEL2  // (int)
0084: STATUS_TEXT = MIKE_CAR  

04F7: vagina_text STATUS_TEXT type 1 line 1 GXT 'MSN362' // global_variable  // Score

:CAR_CREATE_MISSION16_2
if
model.Available(15422)
then

MISSION14_BANDIT_CAR1 = car.Create(15422,-2600.6553, 1072.9231, 62.0944)

if
model.Available(15422)
then
//model.Destroy(15422)
end

else
model.Load(15422)
mload
wait 0
jump to @CAR_CREATE_MISSION16_2
end

:CAR_CREATE_MISSION16_3
if
model.Available(15422)
then

MISSION14_BANDIT_CAR2 = car.Create(15422,-2600.6553, 1072.9231, 65.0944)

if
model.Available(15422)
then
//model.Destroy(15422)
end

else
model.Load(15422)
mload
wait 0
jump to @CAR_CREATE_MISSION16_3
end

:CAR_CREATE_MISSION16_4
if
model.Available(15422)
then

MISSION14_BANDIT_CAR3 = car.Create(15422,-2600.6553, 1072.9231, 69.0944)

if
model.Available(15422)
then
//model.Destroy(15422)
end

else
model.Load(15422)
mload
wait 0
jump to @CAR_CREATE_MISSION16_4
end

:CAR_CREATE_MISSION16_5
if
model.Available(15422)
then

MISSION14_BANDIT_CAR4 = car.Create(15422,-2600.6553, 1072.9231, 72.0944)

if
model.Available(15422)
then
//model.Destroy(15422)
end

else
model.Load(15422)
mload
wait 0
jump to @CAR_CREATE_MISSION16_5
end
  
car.Health(MISSION14_BANDIT_CAR1) = 1000
car.Health(MISSION14_BANDIT_CAR2) = 1000
car.Health(MISSION14_BANDIT_CAR3) = 1000
car.Health(MISSION14_BANDIT_CAR4) = 1000       
0229: set_car MISSION14_BANDIT_CAR1 primary_color_to $BANDITS_CAR_COLOR1 secondary_color_to $BANDITS_CAR_COLOR2
0229: set_car MISSION14_BANDIT_CAR2 primary_color_to $BANDITS_CAR_COLOR1 secondary_color_to $BANDITS_CAR_COLOR2
0229: set_car MISSION14_BANDIT_CAR3 primary_color_to $BANDITS_CAR_COLOR1 secondary_color_to $BANDITS_CAR_COLOR2
0229: set_car MISSION14_BANDIT_CAR4 primary_color_to $BANDITS_CAR_COLOR1 secondary_color_to $BANDITS_CAR_COLOR2

while not model.Available(#BANDIT1)
wait 0
model.Load(#BANDIT1)
mload
end

$ARMY69_2[0] = Actor.CreateAsDriver(25, #BANDIT1, MISSION14_BANDIT_CAR1)

while not model.Available(#BANDIT2)
wait 0
model.Load(#BANDIT2)
mload
end

$ARMY69_2[1] = Actor.CreateAsDriver(25, #BANDIT2, MISSION14_BANDIT_CAR2)

while not model.Available(#BANDIT3)
wait 0
model.Load(#BANDIT3)
mload
end

$ARMY69_2[2] = Actor.CreateAsDriver(25, #BANDIT3, MISSION14_BANDIT_CAR3)

while not model.Available(#BANDIT4)
wait 0
model.Load(#BANDIT4)
mload
end

$ARMY69_2[3] = Actor.CreateAsDriver(25, #BANDIT4, MISSION14_BANDIT_CAR4)

while not model.Available(#BANDIT5)
wait 0
model.Load(#BANDIT5)
mload
end

$ARMY69_2[4] = Actor.CreateAsPassenger(25, #BANDIT5, MISSION14_BANDIT_CAR1,0)

while not model.Available(#BANDIT6)
wait 0
model.Load(#BANDIT6)
mload
end

$ARMY69_2[5] = Actor.CreateAsPassenger(25, #BANDIT6, MISSION14_BANDIT_CAR2,0)

while not model.Available(#BANDIT7)
wait 0
model.Load(#BANDIT7)
mload
end

$ARMY69_2[6] = Actor.CreateAsPassenger(25, #BANDIT7, MISSION14_BANDIT_CAR3,0)

while not model.Available(#BANDIT8)
wait 0
model.Load(#BANDIT8)
mload
end

$ARMY69_2[7] = Actor.CreateAsPassenger(25, #BANDIT8, MISSION14_BANDIT_CAR4,0)

create_thread @PED_BKP $ARMY69_2[0] 371
create_thread @PED_BKP $ARMY69_2[1] 371
create_thread @PED_BKP $ARMY69_2[2] 371
create_thread @PED_BKP $ARMY69_2[3] 371
create_thread @PED_BKP $ARMY69_2[4] 371
create_thread @PED_BKP $ARMY69_2[5] 371
create_thread @PED_BKP $ARMY69_2[6] 371
create_thread @PED_BKP $ARMY69_2[7] 371

0781: get_weapon_with_ID 28 model_to 0@

while not model.Available(0@)
wait 0
model.Load(0@)
mload
end

actor.GiveWeaponAndAmmo($ARMY69_2[4],28,99999)

0781: get_weapon_with_ID 28 model_to 0@

while not model.Available(0@)
wait 0
model.Load(0@)
mload
end

actor.GiveWeaponAndAmmo($ARMY69_2[5],28,99999)

0781: get_weapon_with_ID 28 model_to 0@

while not model.Available(0@)
wait 0
model.Load(0@)
mload
end

actor.GiveWeaponAndAmmo($ARMY69_2[6],28,99999)

0781: get_weapon_with_ID 28 model_to 0@

while not model.Available(0@)
wait 0
model.Load(0@)
mload
end

actor.GiveWeaponAndAmmo($ARMY69_2[7],28,99999)
actor.WeaponAccuracy($ARMY69_2[4]) = $MISSION14_BANDITS_ACCURACY
actor.WeaponAccuracy($ARMY69_2[5]) = $MISSION14_BANDITS_ACCURACY
actor.WeaponAccuracy($ARMY69_2[6]) = $MISSION14_BANDITS_ACCURACY
actor.WeaponAccuracy($ARMY69_2[7]) = $MISSION14_BANDITS_ACCURACY
0713: actor $ARMY69_2[4] driveby_actor -1 car SUPPLY_QUEST_TRUCK point 0.0 0.0 0.0 radius 5000.0 8 1 firing_rate 360
0713: actor $ARMY69_2[5] driveby_actor -1 car SUPPLY_QUEST_TRUCK point 0.0 0.0 0.0 radius 5000.0 8 1 firing_rate 360
0713: actor $ARMY69_2[6] driveby_actor -1 car SUPPLY_QUEST_TRUCK point 0.0 0.0 0.0 radius 5000.0 8 1 firing_rate 360
0713: actor $ARMY69_2[7] driveby_actor -1 car SUPPLY_QUEST_TRUCK point 0.0 0.0 0.0 radius 5000.0 8 1 firing_rate 360
actor.Health($ARMY69_2[0]) = $MISSION9_BANDITS_HP
actor.Health($ARMY69_2[1]) = $MISSION9_BANDITS_HP
actor.Health($ARMY69_2[2]) = $MISSION9_BANDITS_HP
actor.Health($ARMY69_2[3]) = $MISSION9_BANDITS_HP
actor.Health($ARMY69_2[4]) = $MISSION9_BANDITS_HP
actor.Health($ARMY69_2[5]) = $MISSION9_BANDITS_HP
actor.Health($ARMY69_2[6]) = $MISSION9_BANDITS_HP
actor.Health($ARMY69_2[7]) = $MISSION9_BANDITS_HP
060B: set_actor $ARMY69_2[0] decision_maker_to $DEC_PEOPLE
060B: set_actor $ARMY69_2[1] decision_maker_to $DEC_PEOPLE
060B: set_actor $ARMY69_2[2] decision_maker_to $DEC_PEOPLE
060B: set_actor $ARMY69_2[3] decision_maker_to $DEC_PEOPLE
060B: set_actor $ARMY69_2[4] decision_maker_to $DEC_PEOPLE
060B: set_actor $ARMY69_2[5] decision_maker_to $DEC_PEOPLE
060B: set_actor $ARMY69_2[6] decision_maker_to $DEC_PEOPLE
060B: set_actor $ARMY69_2[7] decision_maker_to $DEC_PEOPLE  

0446: set_actor $ARMY69_2[0] dismemberment_possible 0
0446: set_actor $ARMY69_2[1] dismemberment_possible 0
0446: set_actor $ARMY69_2[2] dismemberment_possible 0
0446: set_actor $ARMY69_2[3] dismemberment_possible 0
0446: set_actor $ARMY69_2[4] dismemberment_possible 0
0446: set_actor $ARMY69_2[5] dismemberment_possible 0
0446: set_actor $ARMY69_2[6] dismemberment_possible 0
0446: set_actor $ARMY69_2[7] dismemberment_possible 0

while not model.Available(#BANDIT1)
wait 0
model.Load(#BANDIT1)
mload
end

$ARMY69_2[8] = Actor.Create(25, #BANDIT1, -1690.349, 1110.1718, 54.7031)
actor.Angle($ARMY69_2[8]) = 98.7074

while not model.Available(#BANDIT4)
wait 0
model.Load(#BANDIT4)
mload
end

$ARMY69_2[9] = Actor.Create(25, #BANDIT4, -1991.3262, 1042.5316, 68.0078)
actor.Angle($ARMY69_2[9]) = 67.2886

while not model.Available(#BANDIT2)
wait 0
model.Load(#BANDIT2)
mload
end

$ARMY69_2[10] = Actor.Create(25, #BANDIT2, -1867.4137, 1088.7302, 47.0693)
actor.Angle($ARMY69_2[10]) = 74.1979

while not model.Available(#BANDIT3)
wait 0
model.Load(#BANDIT3)
mload
end

$ARMY69_2[11] = Actor.Create(25, #BANDIT3, -1783.0651, 1113.494, 45.4453)
actor.Angle($ARMY69_2[11]) = 107.7006

create_thread @PED_BKP $ARMY69_2[8] 371
create_thread @PED_BKP $ARMY69_2[9] 371
create_thread @PED_BKP $ARMY69_2[10] 371
create_thread @PED_BKP $ARMY69_2[11] 371

0781: get_weapon_with_ID 35 model_to 0@

while not model.Available(0@)
wait 0
model.Load(0@)
mload
end

actor.GiveWeaponAndAmmo($ARMY69_2[8],35,99999)

0781: get_weapon_with_ID 28 model_to 0@

while not model.Available(0@)
wait 0
model.Load(0@)
mload
end

actor.GiveWeaponAndAmmo($ARMY69_2[9],28,99999)

0781: get_weapon_with_ID 28 model_to 0@

while not model.Available(0@)
wait 0
model.Load(0@)
mload
end

actor.GiveWeaponAndAmmo($ARMY69_2[10],28,99999)

0781: get_weapon_with_ID 28 model_to 0@

while not model.Available(0@)
wait 0
model.Load(0@)
mload
end

actor.GiveWeaponAndAmmo($ARMY69_2[11],28,99999)
actor.WeaponAccuracy($ARMY69_2[8]) = $MISSION14_BANDITS_ACCURACY
actor.WeaponAccuracy($ARMY69_2[9]) = $MISSION14_BANDITS_ACCURACY
actor.WeaponAccuracy($ARMY69_2[10]) = $MISSION14_BANDITS_ACCURACY
actor.WeaponAccuracy($ARMY69_2[11]) = $MISSION14_BANDITS_ACCURACY
actor.Health($ARMY69_2[8]) = $MISSION9_BANDITS_HP
actor.Health($ARMY69_2[9]) = $MISSION9_BANDITS_HP
actor.Health($ARMY69_2[10]) = $MISSION9_BANDITS_HP
actor.Health($ARMY69_2[11]) = $MISSION9_BANDITS_HP
060B: set_actor $ARMY69_2[8] decision_maker_to $DEC_PEOPLE
060B: set_actor $ARMY69_2[9] decision_maker_to $DEC_PEOPLE
060B: set_actor $ARMY69_2[10] decision_maker_to $DEC_PEOPLE
060B: set_actor $ARMY69_2[11] decision_maker_to $DEC_PEOPLE
0446: set_actor $ARMY69_2[8] dismemberment_possible 0
0446: set_actor $ARMY69_2[9] dismemberment_possible 0
0446: set_actor $ARMY69_2[10] dismemberment_possible 0
0446: set_actor $ARMY69_2[11] dismemberment_possible 0
0350: set_actor $ARMY69_2[8] maintain_position_when_attacked 1
0350: set_actor $ARMY69_2[9] maintain_position_when_attacked 1
0350: set_actor $ARMY69_2[10] maintain_position_when_attacked 1
0350: set_actor $ARMY69_2[11] maintain_position_when_attacked 1
087E: set_actor $ARMY69_2[8] weapon_droppable 0
087E: set_actor $ARMY69_2[9] weapon_droppable 0
087E: set_actor $ARMY69_2[10] weapon_droppable 0
087E: set_actor $ARMY69_2[11] weapon_droppable 0
099F: AS_actor $ARMY69_2[8] ignore_weapon_range 0
099F: AS_actor $ARMY69_2[9] ignore_weapon_range 1
099F: AS_actor $ARMY69_2[10] ignore_weapon_range 1
099F: AS_actor $ARMY69_2[11] ignore_weapon_range 1
0672: AS_actor $ARMY69_2[8] attack_car SUPPLY_QUEST_TRUCK
0672: AS_actor $ARMY69_2[9] attack_car SUPPLY_QUEST_TRUCK
0672: AS_actor $ARMY69_2[10] attack_car SUPPLY_QUEST_TRUCK
0672: AS_actor $ARMY69_2[11] attack_car SUPPLY_QUEST_TRUCK
07DD: set_actor $ARMY69_2[8] attack_rate 100 // previously known as temper_to
   
repeat
wait 0
07C0: load_path 926
07C0: load_path 927
07C0: load_path 928
07C0: load_path 929
07C0: load_path 930   

if and
07C1:   path 926 available
07C1:   path 927 available
07C1:   path 928 available
07C1:   path 929 available
07C1:   path 930 available
    then
    break
    end

until false

05EB: assign_car SUPPLY_QUEST_TRUCK to_path 926
0706: advance_car SUPPLY_QUEST_TRUCK further_along_path 22.5

05EB: assign_car MISSION14_BANDIT_CAR1 to_path 927  

32@ = 0

while 32@ < 829
wait 0
end

05EB: assign_car MISSION14_BANDIT_CAR3 to_path 929 
05EB: assign_car MISSION14_BANDIT_CAR4 to_path 930

while 32@ < 1299
wait 0
end 

05EB: assign_car MISSION14_BANDIT_CAR2 to_path 928

wait 0

if
COOP_ACTIVE_FLAG == 1
then

05EC: release_car SUPPLY_QUEST_TRUCK from_path
05EC: release_car MISSION14_BANDIT_CAR1 from_path
05EC: release_car MISSION14_BANDIT_CAR2 from_path
05EC: release_car MISSION14_BANDIT_CAR3 from_path
05EC: release_car MISSION14_BANDIT_CAR4 from_path

car.SetMaxSpeed(MISSION14_BANDIT_CAR1,100.0)
car.SetMaxSpeed(MISSION14_BANDIT_CAR2,100.0)
car.SetMaxSpeed(MISSION14_BANDIT_CAR3,100.0)
car.SetMaxSpeed(MISSION14_BANDIT_CAR4,100.0)

0423: set_car MISSION14_BANDIT_CAR1 improved_handling_to 4.0 // (float) 
03AB: set_car MISSION14_BANDIT_CAR1 strong 1  
0423: set_car MISSION14_BANDIT_CAR3 improved_handling_to 4.0 // (float) 
03AB: set_car MISSION14_BANDIT_CAR3 strong 1 
0423: set_car MISSION14_BANDIT_CAR4 improved_handling_to 4.0 // (float) 
03AB: set_car MISSION14_BANDIT_CAR4 strong 1

car.SetToPsychoDriver(MISSION14_BANDIT_CAR1)
car.SetToPsychoDriver(MISSION14_BANDIT_CAR2)
car.SetToPsychoDriver(MISSION14_BANDIT_CAR3)
car.SetToPsychoDriver(MISSION14_BANDIT_CAR4)

0423: set_car MISSION14_BANDIT_CAR1 improved_handling_to 1.0 // (float)
0423: set_car MISSION14_BANDIT_CAR2 improved_handling_to 1.0 // (float)
0423: set_car MISSION14_BANDIT_CAR3 improved_handling_to 1.0 // (float)
0423: set_car MISSION14_BANDIT_CAR4 improved_handling_to 1.0 // (float)
 
03AB: set_car MISSION14_BANDIT_CAR1 strong 1
03AB: set_car MISSION14_BANDIT_CAR2 strong 1
03AB: set_car MISSION14_BANDIT_CAR3 strong 1
03AB: set_car MISSION14_BANDIT_CAR4 strong 1

07F8: car MISSION14_BANDIT_CAR1 follow_car SUPPLY_QUEST_TRUCK radius 10.0
07F8: car MISSION14_BANDIT_CAR2 follow_car SUPPLY_QUEST_TRUCK radius 10.0
07F8: car MISSION14_BANDIT_CAR3 follow_car SUPPLY_QUEST_TRUCK radius 10.0
07F8: car MISSION14_BANDIT_CAR4 follow_car SUPPLY_QUEST_TRUCK radius 10.0

end

if   
103@ == 1
then

cinema.Widescreen(0)
BLACK_POLOSKI_ON = 0
0A48: enable_menu_access_in_widescreen_mode 1  
$SOUND_OFF_1 = 0

$SOUND_OFF_1 = 0

wait 1

$SOUND_OFF_1 = 0

wait 1

cinema.Widescreen(0)
BLACK_POLOSKI_ON = 0

end

$PREPARING_CHECKPOINT_OFF = 1

if
103@ == 1
    then
    
    if
    CLASSIC_MUSIC == 0
    then
    $MUSIC_MISSION = Audiostream.Load(MUSIC_18B)
    else
    $MUSIC_MISSION = Audiostream.Load(CLASSIC_MUSIC_18B)
    end    
    
    Audiostream.PerformAction($MUSIC_MISSION, PLAY)
    Audiostream.Loop($MUSIC_MISSION, 1)
    Audiostream.Volume($MUSIC_MISSION) = 0.0
    
    /////////////////////Плавное нарастание/////////////////////

    $MUSIC_FADE_NUMBER += 1
    if
    $MUSIC_FADE_NUMBER > 4
        then
        $MUSIC_FADE_NUMBER = 0 
        end    
    
    0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_MISSION // (int) 
    0086: $MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = $MUSIC_VOLUME // (float) 
    
    $MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 1000
    $MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 1  
    $MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
    create_thread @MUS_FAD
    
    wait 1
    
    //////////////////////////////////////////////////////////
    
    end
    
0459: end_thread_named 'F_PERS'    

wait 500

if
COOP_ACTIVE_FLAG == 1
then
036A: put_actor $SURVIVER[0] in_car SUPPLY_QUEST_TRUCK
car.SetSpeedInstantly(SUPPLY_QUEST_TRUCK,15.0)
CAN_2P_TARGET_VEHICLES = 1
CAN_2P_TARGET_VEHICLES_SWITCH = 1
end
 
fade 1 1000
create_thread @REFR_3D 
$HUD_REMOVE = 0   
wait 1000
text.ShowH('MSN939',3500,1)

if
COOP_ACTIVE_FLAG == 1
then
v$OBJECTIVE = "MSN66B"
else
v$OBJECTIVE = "MSN66"
end

if
COOP_ACTIVE_FLAG == 1
then
marker.Disable(MISSION_MARKER)
06D6: disable_racing_checkpoint MISSION_CHECKPOINT
018A: MISSION_MARKER = create_checkpoint_at -1703.1898 1109.4694 45.4453
06D5: MISSION_CHECKPOINT = create_racing_checkpoint_at -1703.1898 1109.4694 45.4453 point_to -1678.1741 1110.2324 55.7031 type 0 radius 6.0
end 

repeat
wait 0
gosub @MISSION14_CARS_CHECK

MIKE_CAR = car.Health(SUPPLY_QUEST_TRUCK)
MIKE_CAR -= 250
0070: MIKE_CAR /= DELITEL2  // (int)
0084: STATUS_TEXT = MIKE_CAR

if
not actor.Dead($SURVIVER[0])
jf @KOD_PROVALA14_GENRY

if
not car.Wrecked(SUPPLY_QUEST_TRUCK)
jf @KOD_PROVALA14_CAR2

if 
not Actor.Dead(PLAYER_ACTOR)
jf @KOD_PROVALA14

if and
01AD:   car SUPPLY_QUEST_TRUCK sphere 0 near_point -1703.1898 1109.4694 radius 3.0 3.0
COOP_ACTIVE_FLAG == 1
    then
    break
    end
    
$FP_ON = 0     

until 01AE:   car SUPPLY_QUEST_TRUCK sphere 0 near_point -1703.1898 1109.4694 radius 3.0 3.0 stopped

text.RemoveTextBox()

player.CanMove(PLAYER_CHAR) = false
0465: remove_actor PLAYER_ACTOR from_turret_mode
DRAW_NOTURRET_CROSSHAIR_FLAG = 0
STORY_DRIVEBY_NO_RETURN_FLAG = 0
HARDCORE_DANGER_FLAG_SCRIPTED = 0
actor.SetImmunities(PLAYER_ACTOR,0,0,0,0,0)
0430: put_actor PLAYER_ACTOR into_car SUPPLY_QUEST_TRUCK passenger_seat 0

cinema.Widescreen(1)
BLACK_POLOSKI_ON = 1
$HUD_REMOVE = 1
$HUD_OFF_INST = 1

if
$FP_ACTIVATED == 1
then
repeat
wait 0
until $FP_ACTIVATED == 0
end

camera.SetPosition(-1604.351807 1104.920166 21.373280,0.0,0.0,0.0)
camera.PointAt(-1605.207397 1105.224731 21.791767,2)

if
COOP_ACTIVE_FLAG == 1
then

marker.Disable(MISSION_MARKER)
06D6: disable_racing_checkpoint MISSION_CHECKPOINT

while 87C1: not  path 926 available
wait 0
07C0: load_path 926
end

05EB: assign_car SUPPLY_QUEST_TRUCK to_path 926
0706: advance_car SUPPLY_QUEST_TRUCK further_along_path 940.0
end

wait 1000
text.ShowH('MSN799',5000,1)
$SPEED_05_FLAG = 1 
015D: set_gamespeed 0.5
wait 4500
$SPEED_05_FLAG = 0
015D: set_gamespeed 1.0
text.ShowH('MSN800',3000,1)

cinema.Widescreen(0)
BLACK_POLOSKI_ON = 0

$HUD_REMOVE = 0

camera.Restore_WithJumpCut()
actor.StorePos(PLAYER_ACTOR,1@,2@,3@)
0362: remove_actor PLAYER_ACTOR from_car_and_place_at 1@ 2@ 3@    

if or
COOP_ACTIVE_FLAG == 1
0A4B:   controls_set_to_joystick
then
06A7: put_actor PLAYER_ACTOR into_turret_on_car SUPPLY_QUEST_TRUCK at_car_offset 0.0 -1.5 0.7 position 1 shooting_angle 360.0 70.0 with_weapon 29
04EB: AS_actor PLAYER_ACTOR crouch 1
else
06A7: put_actor PLAYER_ACTOR into_turret_on_car SUPPLY_QUEST_TRUCK at_car_offset 1.0 0.0 0.6 position 1 shooting_angle 360.0 70.0 with_weapon 29
end

STORY_DRIVEBY_NO_RETURN_FLAG = 1
actor.SetImmunities(PLAYER_ACTOR,1,0,0,0,0)
player.CanMove(PLAYER_CHAR) = true

if or
COOP_ACTIVE_FLAG == 1
0A4B:   controls_set_to_joystick
then
DRAW_NOTURRET_CROSSHAIR_FLAG = 1
player.CanMove(PLAYER_CHAR,false)
wait 0
player.CanMove(PLAYER_CHAR,true)
end

if
COOP_ACTIVE_FLAG == 1
then
05EC: release_car SUPPLY_QUEST_TRUCK from_path
018A: MISSION_MARKER = create_checkpoint_at -1631.3751 1371.5658 7.183
06D5: MISSION_CHECKPOINT = create_racing_checkpoint_at -1631.3751 1371.5658 7.183 point_to 0.0 0.0 0.0 type 1 radius 6.0
end
 
repeat
wait 0       
gosub @MISSION14_CARS_CHECK

MIKE_CAR = car.Health(SUPPLY_QUEST_TRUCK)
MIKE_CAR -= 250
0070: MIKE_CAR /= DELITEL2  // (int)
0084: STATUS_TEXT = MIKE_CAR

if
not actor.Dead($SURVIVER[0])
jf @KOD_PROVALA14_GENRY

if
not car.Wrecked(SUPPLY_QUEST_TRUCK)
jf @KOD_PROVALA14_CAR2

if 
not Actor.Dead(PLAYER_ACTOR)
jf @KOD_PROVALA14

if
COOP_ACTIVE_FLAG == 1
    then
    if
    01AD:   car SUPPLY_QUEST_TRUCK sphere 0 near_point -1631.3751 1371.5658 radius 3.0 3.0
        then
        break
        end
    end 

until 01AE:   car SUPPLY_QUEST_TRUCK sphere 0 near_point -1631.3751 1371.5658 radius 3.0 3.0 stopped

if
COOP_ACTIVE_FLAG == 1
then
marker.Disable(MISSION_MARKER)
06D6: disable_racing_checkpoint MISSION_CHECKPOINT
CAN_2P_TARGET_VEHICLES = 0
CAN_2P_TARGET_VEHICLES_SWITCH = 1
end

text.RemoveTextBox()

v$OBJECTIVE = "DUMMY"
$HUD_REMOVE = 1

fade 0 1000
wait 1100

0465: remove_actor PLAYER_ACTOR from_turret_mode
STORY_DRIVEBY_NO_RETURN_FLAG = 0
actor.SetImmunities(PLAYER_ACTOR,0,0,0,0,0)

0555: remove_weapon 29 from_actor PLAYER_ACTOR
if
301@ > 0
then
model.Load(302@)
mload
actor.GiveWeaponAndAmmo(PLAYER_ACTOR,300@,301@)
end

0430: put_actor PLAYER_ACTOR into_car SUPPLY_QUEST_TRUCK passenger_seat 0

Player.CanMove(PLAYER_CHAR) = False

02A3: enable_widescreen 1
BLACK_POLOSKI_ON = 1

0151: remove_status_text STATUS_TEXT
0151: remove_status_text STATUS_TEXT

05EC: release_car SUPPLY_QUEST_TRUCK from_path
05EC: release_car MISSION14_BANDIT_CAR1 from_path
05EC: release_car MISSION14_BANDIT_CAR2 from_path
05EC: release_car MISSION14_BANDIT_CAR3 from_path
05EC: release_car MISSION14_BANDIT_CAR4 from_path

0873: release_path 926
0873: release_path 927
0873: release_path 928
0873: release_path 929
0873: release_path 930

actor.DestroyInstantly($ARMY69_2[0])
actor.DestroyInstantly($ARMY69_2[1])
actor.DestroyInstantly($ARMY69_2[2])
actor.DestroyInstantly($ARMY69_2[3])
actor.DestroyInstantly($ARMY69_2[4])
actor.DestroyInstantly($ARMY69_2[5])
actor.DestroyInstantly($ARMY69_2[6])
actor.DestroyInstantly($ARMY69_2[7])

car.Destroy(MISSION14_BANDIT_CAR1)
car.Destroy(MISSION14_BANDIT_CAR2)
car.Destroy(MISSION14_BANDIT_CAR3)
car.Destroy(MISSION14_BANDIT_CAR4)

camera.SetPosition(-1630.986450 1376.599854 7.816356,0.0,0.0,0.0)    
camera.PointAt(-1631.152344 1375.618652 7.717594,2)

if
COOP_ACTIVE_FLAG == 1
then
0EB4: set_car_coordinates_simple SUPPLY_QUEST_TRUCK position -1632.18591 1372.14025 7.3912
car.Angle(SUPPLY_QUEST_TRUCK) = 324.6744
end

gosub @MUSIC14_OFF
wait 1000  

text.RemoveTextBox()

fade 1 1000
wait 1000

gosub @DIALOG_IN_CAR2

fade 0 1000
wait 1000

text.ClearAll()
$NOTSPAWN_CARS = 0

0362: remove_actor PLAYER_ACTOR from_car_and_place_at -1446.3103 1503.7294 0.7366

model.Load(102@)
mload
actor.GiveWeaponAndAmmo(PLAYER_ACTOR,100@,101@)
Player.CanMove(PLAYER_CHAR) = true

02A3: enable_widescreen 0
BLACK_POLOSKI_ON = 0

actor.Angle(PLAYER_ACTOR) = 117.0941
camera.Restore_WithJumpCut()

03CB: set_rendering_origin_at -1446.3103 1503.7294 1.7366
wait 1

if
COOP_ACTIVE_FLAG == 1
then
0EA1: disable_second_player_restore_camera 1
COOP_ACTOR = -69
end

actor.DestroyInstantly($SURVIVER[0])
car.Destroy(SUPPLY_QUEST_TRUCK)

$FP_ON = 1
create_thread @F_PERS
$SAVESTATUS = 0
wait 1000
jump @UDACHNO14

:MISSION14_CARS_CHECK

if and
8185: not  car MISSION14_BANDIT_CAR1 health >= 250
MISSION14_BANDIT_CAR1_EXPLODED == 0
then
020B: explode_car MISSION14_BANDIT_CAR1
MISSION14_BANDIT_CAR1_EXPLODED = 1
end

if and
8185: not  car MISSION14_BANDIT_CAR2 health >= 250
MISSION14_BANDIT_CAR2_EXPLODED == 0
then
020B: explode_car MISSION14_BANDIT_CAR2
MISSION14_BANDIT_CAR2_EXPLODED = 1
end

if and
8185: not  car MISSION14_BANDIT_CAR3 health >= 250
MISSION14_BANDIT_CAR3_EXPLODED == 0
then
020B: explode_car MISSION14_BANDIT_CAR3
MISSION14_BANDIT_CAR3_EXPLODED = 1
end

if and
8185: not  car MISSION14_BANDIT_CAR4 health >= 250
MISSION14_BANDIT_CAR4_EXPLODED == 0
then
020B: explode_car MISSION14_BANDIT_CAR4
MISSION14_BANDIT_CAR4_EXPLODED = 1   
end

if and
8185: not  car SUPPLY_QUEST_TRUCK health >= 250
MISSION14_MISSION_CAR_EXPLODED == 0
then
020B: explode_car SUPPLY_QUEST_TRUCK
MISSION14_MISSION_CAR_EXPLODED = 1
end

return

:MISSION14_CHECKPOINT

0AF0: $SECOND_PLAYED = get_int_from_ini_file "data\survival.set" section "SCR" key "M14RCSP"
0AF0: $MINUTES_PLAYED = get_int_from_ini_file "data\survival.set" section "SCR" key "M14RCMP"
0AF0: $HOURS_PLAYED = get_int_from_ini_file "data\survival.set" section "SCR" key "M14RCHP"
0AF0: CURRENT_TIME_HOURS = get_int_from_ini_file "data\survival.set" section "SCR" key "M14RCTM1"
0AF0: CURRENT_TIME_MINUTES = get_int_from_ini_file "data\survival.set" section "SCR" key "M14RCTM2"
00C0: set_current_time CURRENT_TIME_HOURS CURRENT_TIME_MINUTES
$WEATHER_SYNC_FLAG = 1

0506: set_car_model 15401 next_variation -1 2 // first param is useless

:CAR_CREATE_MISSION16_6
if
model.Available(15401)
then

SUPPLY_QUEST_TRUCK = Car.Create(15401, -1686.5516, 1400.6777, 6.9616)
Car.Angle(SUPPLY_QUEST_TRUCK) = 135.7173

if
model.Available(15401)
then
//model.Destroy(15401)
end

else
model.Load(15401)
mload
wait 0
jump to @CAR_CREATE_MISSION16_6
end  

0229: set_car SUPPLY_QUEST_TRUCK primary_color_to 20 secondary_color_to 20 

0A97: 11@ = car SUPPLY_QUEST_TRUCK struct 
11@ += 9
0A8D: 12@ = read_memory 11@ size 1 virtual_protect 0
08BD: set 12@ bit 2
0A8C: write_memory 11@ size 1 value 12@ virtual_protect 0 
/////////////////////
0A97: 11@ = car SUPPLY_QUEST_TRUCK struct 
11@ += 4 
0A8D: 12@ = read_memory 11@ size 1 virtual_protect 0
08BD: set 12@ bit 1 
0A8C: write_memory 11@ size 1 value 12@ virtual_protect 0
random_float 24@ 30.0 50.0 
0A97: 22@ = car SUPPLY_QUEST_TRUCK struct 
0A8E: 23@ = 22@ + 5 // int 
0A8C: write_memory 23@ size 4 value 24@ virtual_protect 0 
08C3: clear 12@ bit 1
08C3: clear 12@ bit 2
0A97: 11@ = car SUPPLY_QUEST_TRUCK struct 
11@ += 18
0A8D: 12@ = read_memory 11@ size 1 virtual_protect 0
08BD: set 12@ bit 2
0A8C: write_memory 11@ size 1 value 12@ virtual_protect 0 
08C3: clear 12@ bit 2  
 
set_weather 8

00C0: set_current_time 12 0
$WEATHER_SYNC_FLAG = 1

model.Load(20)
mload

while not model.Available(20)
wait 0
model.Load(20)
mload
end

$SURVIVER[0] = actor.Create(26,20,2315.2222, -1210.0813, 1049.0234)
actor.Angle($SURVIVER[0]) = 88.6941
actor.Health($SURVIVER[0]) = $FRIEND_HEALTH
060B: set_actor $SURVIVER[0] decision_maker_to $DEC_PEOPLE

04E4: unknown_refresh_game_renderer_at -2511.9304 1053.9329
03CB: set_rendering_origin_at -2511.9304 1053.9329 26.0

wait 3000

jump @MISSION14_CHECKPOINT_JUMP

:KOD_PROVALA14_GENRY
0465: remove_actor PLAYER_ACTOR from_turret_mode
actor.SetImmunities(PLAYER_ACTOR,0,0,0,0,0)

model.Load(102@)
mload
actor.GiveWeaponAndAmmo(PLAYER_ACTOR,100@,101@)

0430: put_actor PLAYER_ACTOR into_car SUPPLY_QUEST_TRUCK passenger_seat 0

text.ClearAll()   
v$FAILED_TEXT = "MS_FL28"          
jump @KOD_PROVALA14


:KOD_PROVALA14_CAR
text.ClearAll()  
v$FAILED_TEXT = "MS_FL4"      
jump @KOD_PROVALA14

:KOD_PROVALA14_CAR2
0151: remove_status_text STATUS_TEXT
0151: remove_status_text STATUS_TEXT

text.ClearAll()
v$FAILED_TEXT = "MS_FL4"      

0465: remove_actor PLAYER_ACTOR from_turret_mode
actor.SetImmunities(PLAYER_ACTOR,0,0,0,0,0)

model.Load(102@)
mload
actor.GiveWeaponAndAmmo(PLAYER_ACTOR,100@,101@)

0430: put_actor PLAYER_ACTOR into_car SUPPLY_QUEST_TRUCK passenger_seat 0

05BE: AS_actor PLAYER_ACTOR die
jump @KOD_PROVALA14

:UDACHNO14       
$ONMISSION = 0 
marker.Disable($MISSION_CHECKPONT)
marker.Disable(MISSION_MARKER)
03BD: destroy_sphere MISSION_SPHERE
0AF1: write_int 0 to_ini_file "data\survival.set" section "SCR" key "M16RC"
if
MIKE_SHIZA_FLAG == 1
then
0318: set_latest_mission_passed 'GME1208'
else 
0318: set_latest_mission_passed 'MSN883B'
end 
ENEX_OFF = 0
$GENRY_ON_BOAT = 1

if
not MIKE_SHIZA_FLAG == 1
then      
$X_START = -1391.074 
$Y_START = 1484.505 
$Z_START = 1.8672 
$MISSION_ICON = 59 
$MISSION_START = 17 
06D1: v$MISSION_NAME = "MSN683" // v$ = string 
//create_thread @MSN_ST2
create_thread @MSN_STR
else
0AF1: write_int 0 to_ini_file "saves\ZACM.set" section "SCR" key "VOICE_SHOWED" 
08E7: disable_entrance_markers 0
$GENRY_ON_BOAT = 1      
$MISSION_START_NUMBER = 17 
create_thread @MS_STAR
gosub @PROPUSK_KODA14
return
end

INT_ZOMBIE_OFF_FADING_AND_SHIT_FLAG = 0
$INT_ZMB_NOT = 0
BLACK_POLOSKI_ON = 0
Camera.Restore_WithJumpCut
Player.CanMove(PLAYER_CHAR) = True
wait 1000 
$SAVESTATUS = 0 
fade 1 1000
$HUD_REMOVE = 0 
wait 1000

MAIN_QUEST_MUSIC_FLAG = 0

$TEMP_XP = 6000
008D: $TEMP_XP = integer $TEMP_XP to_float
0069: $TEMP_XP *= $XP_COEFF // (float)
if
PERK_CHARISMA == 2
then
$TEMP_XP *= CHARISMA_LEVEL2_XP_COEFF
end
008C: $TEMP_XP = float $TEMP_XP to_integer
0058: $PLAYER_XP += $TEMP_XP // (int)

0629: change_integer_stat 258 to 0
MAIN_QUEST_TEAMMATES_REMOVE_FLAG = 2
COOP_TP_TEAMMATES_FLAG = 1

gosub @PROPUSK_KODA14
return

:KOD_PROVALA14    
mission_cleanup
marker.Disable(MISSION_CHECKPOINT)
marker.Disable(MISSION_MARKER)
03BD: destroy_sphere MISSION_SPHERE
GAME_OVER_FLAG = 1
create_thread @GMV_OVR
$ONMISSION = 0
$SAVESTATUS = 0 
$HUD_REMOVE = 0
$NOTSPAWN_CARS = 0     
06D0: enable_emergency_traffic 0 
06D7: enable_train_traffic 0 
096A: enable_flying_helis 0 
099E: enable_police_patrols 0  
0923: enable_air_traffic 0 
ENEX_OFF = 0
$WEATHER_LOCK_OFF_FLAG = 1    
return

:UDALENIE_KODA14 
mission_cleanup
$NOTSPAWN_CARS = 0
06D0: enable_emergency_traffic 0 
06D7: enable_train_traffic 0 
096A: enable_flying_helis 0 
099E: enable_police_patrols 0  
0923: enable_air_traffic 0 
ENEX_OFF = 0    
$ONMISSION = 0
return

:MUSIC14_OFF

/////////////////////Плавное затухание/////////////////////

$MUSIC_FADE_NUMBER += 1
if
$MUSIC_FADE_NUMBER > 4
    then
    $MUSIC_FADE_NUMBER = 0 
    end    

0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_MISSION // (int)
$MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = 0.0

$MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 700
$MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 0  
$MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
create_thread @MUS_FAD

wait 1

while $MUSIC_FADE_ENDED[$MUSIC_FADE_NUMBER] == 0
wait 0
end

//////////////////////////////////////////////////////////

return

:DIALOG_IN_CAR2

05BF: AS_actor $SURVIVER[0] look_at_actor PLAYER_ACTOR 99999999 ms
05BF: AS_actor PLAYER_ACTOR look_at_actor $SURVIVER[0] 99999999 ms

v$ST_DIALOG[0] = "MSN968"
v$ST_DIALOG[1] = "MSN969"
v$ST_DIALOG[2] = "MSN970"
v$ST_DIALOG[3] = "MSN971"
$DIALOG_COUNT = 2       
$DIALOG_NOT_ANIMS_FLAG = 1          
create_thread @DG_SYS

:MISSION14_CHECK111
wait 0
if
$DIALOG_END == 1
jf @MISSION14_CHECK111
$DIALOG_END = 0
  
return      