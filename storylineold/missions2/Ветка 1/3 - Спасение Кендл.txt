//-------------Mission 3---------------
// Название: Спасение Кендл

:DLC_M3
thread 'DLC_M3' 
gosub @DLC_M3_KOD_MISSII 
if 
wasted_or_busted 
jf @DLC_M3_PROPUSK_KODA 
gosub @DLC_M3_KOD_PROVALA 

:DLC_M3_PROPUSK_KODA
gosub @DLC_M3_UDALENIE_KODA

HARDCORE_DANGER_FLAG_SCRIPTED = 0
if
GAME_OVER_FLAG == 1
then
HARDCORE_DANGER_ANTIFLAG_SCRIPTED = 1
end

if
GAME_OVER_FLAG == 1
then
repeat
wait 0
until BLACK_POLOSKI_ON == 1
end

{$INCLUDE checkpoints_write.txt}
 
end_thread 

:DLC_M3_KOD_MISSII 
increment_mission_attempts
0629: change_integer_stat 258 to 45

MAIN_QUEST_MUSIC_FLAG = 1
MAIN_QUEST_TEAMMATES_REMOVE_FLAG = 1

if and
$CHEATS_ON == 1
0AB0:   key_pressed 49
then
0AF1: write_int 1 to_ini_file "data\survival.set" section "SCR" key "DLC_M3_CHECKPOINT1"
end

if and
$CHEATS_ON == 1
0AB0:   key_pressed 50
then
0AF1: write_int 1 to_ini_file "data\survival.set" section "SCR" key "DLC_M3_CHECKPOINT1"
0AF1: write_int 1 to_ini_file "data\survival.set" section "SCR" key "DLC_M3_CHECKPOINT2"
end

wait 1000

while true
wait 0
$END_FADING_MUSIC_FAST = 1

if and
$MUSIC_FADE_ENDED[0] == 1
$MUSIC_FADE_ENDED[1] == 1
$MUSIC_FADE_ENDED[2] == 1
$MUSIC_FADE_ENDED[3] == 1
$MUSIC_FADE_ENDED[4] == 1
then
$END_FADING_MUSIC_FAST = 0
break
end

end
 
$ONMISSION = 1 
$SAVESTATUS = 1  
$HUD_REMOVE = 1  
Cinema.Widescreen(1)
BLACK_POLOSKI_ON = 1
v$OBJECTIVE = "DUMMY" 
Actor.PutAtNoOffset(PLAYER_ACTOR, 1804.608, -2115.623, 12.8017)
Actor.Angle(PLAYER_ACTOR) = 271.489
Camera.SetAtPos(1804.608, -2115.623, 12.8017)

if
not actor.Driving(PLAYER_ACTOR)
then
////////////////////////////////////////////////////////////////////////////////////////
04C4: store_coords_to 0@ 1@ 2@ from_actor PLAYER_ACTOR with_offset 0.0 5.0 0.0 
2@ = -100.0

while not model.Available(#GREENWOO)
wait 0
model.Load(#GREENWOO)
mload
end
    
3@ = Car.Create(#GREENWOO, 0@, 1@, 2@)    

0A97: 11@ = car 3@ struct 
11@ += 9 
0A8D: 12@ = read_memory 11@ size 1 virtual_protect 0 
08BD: set 12@ bit 2 
0A8C: write_memory 11@ size 1 value 12@ virtual_protect 0 
0A97: 11@ = car 3@ struct 
11@ += 4 
0A8D: 12@ = read_memory 11@ size 1 virtual_protect 0 
08BD: set 12@ bit 1 
0A8C: write_memory 11@ size 1 value 12@ virtual_protect 0 
24@ = 50.0 
0A97: 22@ = car 3@ struct 
0A8E: 23@ = 22@ + 5 // int 
0A8C: write_memory 23@ size 4 value 24@ virtual_protect 0 
08C3: clear 12@ bit 1 
08C3: clear 12@ bit 2 
0A97: 11@ = car 3@ struct 
11@ += 18 
0A8D: 12@ = read_memory 11@ size 1 virtual_protect 0 
08BD: set 12@ bit 2 
0A8C: write_memory 11@ size 1 value 12@ virtual_protect 0 
08C3: clear 12@ bit 2
036A: put_actor PLAYER_ACTOR in_car 3@ 
Car.RemoveReferences(3@)
////////////////////////////////////////////////////////////////////////////////////////
end  

300@ = Actor.CurrentCar(PLAYER_ACTOR)
car.PutAt(300@,1803.7744, -2119.9526, 13.1823)
car.Angle(300@) = 269.3886
0407: store_coords_to 102@ 103@ 104@ from_car 300@ with_offset 0.0 6.0 1.0 
Camera.SetPosition(102@, 103@, 104@, 0.0, 0.0, 0.0)
Camera.OnPed(PLAYER_ACTOR, 15, 2)

repeat
wait 0
023C: load_special_actor 'CESAR' as 1 // models 290-299
until 023D:   special_actor 1 loaded

$SURVIVER[0] = Actor.CreateAsPassenger(26, #SPECIAL01, 300@, 0)
$SURVIVOR_MELEE_ID[0] = -1
0296: unload_special_actor 1
Actor.SetWalkStyle($SURVIVER[0], "GANG1")
0446: set_actor $SURVIVER[0] dismemberment_possible 0 
060B: set_actor $SURVIVER[0] decision_maker_to $DEC_PEOPLE 
Actor.Health($SURVIVER[0]) = $FRIEND_HEALTH
Actor.WeaponAccuracy($SURVIVER[0]) = 100
07DD: set_actor $SURVIVER[0] attack_rate -1 // previously known as temper_to 
077A: set_actor $SURVIVER[0] acquaintance 0 to_actors_pedtype 0 // see ped.dat

create_thread @PED_BKP $SURVIVER[0] 371

0781: get_weapon_with_ID 32 model_to 0@

while not model.Available(0@)
wait 0
model.Load(0@)
mload
end
 
Actor.GiveWeaponAndAmmo($SURVIVER[0], 32, 9999)
wait 1 
0407: store_coords_to 102@ 103@ 104@ from_car 300@ with_offset 2.0 4.0 1.0 
Camera.SetPosition(102@, 103@, 104@, 0.0, 0.0, 0.0)
0460: set_camera_transverse_delay 1.0 time 90000 
Camera.OnPed($SURVIVER[0], 15, 1)

0AF0: 0@ = get_int_from_ini_file "data\survival.set" section "SCR" key "DLC_M3_CHECKPOINT1" 

if
0@ == 1
    then
    $PREPARING_CHECKPOINT = 1
    create_thread @PTL_TXT          
    103@ = 1
    
    32@ = 0
    repeat
    wait 0
    fade 0 0
    $SAVESTATUS = 1
    03F0: enable_text_draw 1
    038E: draw_box_position 320.0 224.0 size 640.0 448.0 RGBA 0 0 0 255
    until 32@ > 3100
    
    end
    
0AF0: 1@ = get_int_from_ini_file "data\survival.set" section "SCR" key "DLC_M3_CHECKPOINT2"
if 
1@ == 0 
jf @DLC_M3_CHECKPOINT_SKIP1    
if 
0@ == 0 
jf @DLC_M3_CHECKPOINT_SKIP1

wait 1000

$MUSIC_MISSION = Audiostream.Load("modloader\ZAOLDSTORYFILES\m2\39.mp3")
Audiostream.PerformAction($MUSIC_MISSION, PLAY)
Audiostream.Loop($MUSIC_MISSION, 1)
Audiostream.Volume($MUSIC_MISSION) = $MUSIC_VOLUME
 
fade 1 1000 
wait 1000 
 
05BF: AS_actor $SURVIVER[0] look_at_actor PLAYER_ACTOR 99999999 ms 
05BF: AS_actor PLAYER_ACTOR look_at_actor $SURVIVER[0] 99999999 ms
 
v$ST_DIALOG[0] = "DLC185"
$DIALOG_COUNT = 0       
$DIALOG_NOT_ANIMS_FLAG = 1          
create_thread @DG_SYS

repeat
wait 0
until $DIALOG_END == 1 
 
Text.ClearAll
fade 0 1000 
wait 1000  
05BF: AS_actor $SURVIVER[0] look_at_actor PLAYER_ACTOR 1 ms 
05BF: AS_actor PLAYER_ACTOR look_at_actor $SURVIVER[0] 1 ms
:DLC_M3_CHECKPOINT_SKIP1 
Cinema.Widescreen(0)
BLACK_POLOSKI_ON = 0
Camera.Restore_WithJumpCut
Player.CanMove(PLAYER_CHAR) = True
wait 1000 
$SAVESTATUS = 0 
0AF0: 0@ = get_int_from_ini_file "data\survival.set" section "SCR" key "DLC_M3_CHECKPOINT1"
0AF0: 1@ = get_int_from_ini_file "data\survival.set" section "SCR" key "DLC_M3_CHECKPOINT2"
if 
1@ == 0 
jf @DLC_M3_CHECKPOINT2 
if 
0@ == 0 
jf @DLC_M3_CHECKPOINT 
fade 1 1000
$HUD_REMOVE = 0 
wait 1000   
018A: MISSION_CHECKPOINT = create_checkpoint_at 1726.241 -1597.611 12.7611 
03BC: MISSION_SPHERE = create_sphere_at 1726.241 -1597.611 12.7611 radius 3.0 
v$OBJECTIVE = "DLC188"

repeat
wait 0
 
if 
not Actor.Dead($SURVIVER[0])
jf @DLC_M3_FAILED_CESAR_DEAD
 
if 
not Actor.InCar(PLAYER_ACTOR, 300@)
    then
    
    Marker.Disable(MISSION_CHECKPOINT)
    03BD: destroy_sphere MISSION_SPHERE 
    v$OBJECTIVE = "DLC971"
    MISSION_MARKER = Marker.CreateAboveCar(300@)
    07E0: set_marker MISSION_MARKER type_to 1
    
    repeat
    wait 0
    
    if 
    not Actor.Dead($SURVIVER[0])
    jf @DLC_M3_FAILED_CESAR_DEAD
     
    if 
    not Car.Wrecked(300@)
    jf @DLC_M3_FAILED_CAR_WRECKED
    
    until Actor.InCar(PLAYER_ACTOR, 300@)
    
    Marker.Disable(MISSION_MARKER)
    018A: MISSION_CHECKPOINT = create_checkpoint_at 1726.241 -1597.611 12.7611 
    03BC: MISSION_SPHERE = create_sphere_at 1726.241 -1597.611 12.7611 radius 3.0 
    v$OBJECTIVE = "DLC188"
    
    end
 
if 
not Car.Wrecked(300@)
jf @DLC_M3_FAILED_CAR_WRECKED
  
until 00EF:   actor PLAYER_ACTOR sphere 0 near_point 1726.241 -1597.611 radius 3.0 3.0 stopped

v$OBJECTIVE = "DUMMY"
  
Marker.Disable(MISSION_CHECKPOINT)
03BD: destroy_sphere MISSION_SPHERE 
Player.CanMove(PLAYER_CHAR) = False

Text.ShowH('DLC189', 3300, 1) 
wait 3300
  
fade 0 1000
$HUD_REMOVE = 1 
wait 1000
0362: remove_actor $SURVIVER[0] from_car_and_place_at 1726.241 -1597.611 12.7611
wait 5
$INT_ZMB_NOT = 1 
$SAVESTATUS = 1

gosub @DLC_M3_MUSIC_FADE_OUT
 
0362: remove_actor PLAYER_ACTOR from_car_and_place_at 1726.241 -1597.611 12.7611 
select_interior 18 
0860: link_actor PLAYER_ACTOR to_interior 18
04F9: set_sky_color 1 fade 0 
Actor.PutAtNoOffset(PLAYER_ACTOR, 1726.258, -1644.51, 20.2262)
Actor.Angle(PLAYER_ACTOR) = 165.0644
Camera.SetAtPos(1726.258, -1644.51, 20.2262)
Player.CanMove(PLAYER_CHAR) = True
Camera.Restore_WithJumpCut

$MUSIC_MISSION = Audiostream.Load("modloader\ZAOLDSTORYFILES\m2\12.mp3")
Audiostream.PerformAction($MUSIC_MISSION, PLAY)
Audiostream.Loop($MUSIC_MISSION, 1)
Audiostream.Volume($MUSIC_MISSION) = $MUSIC_VOLUME

repeat
wait 0
023C: load_special_actor 'KENDL' as 2 // models 290-299
until 023D:   special_actor 2 loaded
 
$SURVIVER[1] = Actor.Create(26, #SPECIAL02, 1734.182, -1639.599, 27.2507)
$SURVIVOR_MELEE_ID[1] = -1
0296: unload_special_actor 2
Actor.Angle($SURVIVER[1]) = 3.5686
Actor.SetWalkStyle($SURVIVER[1], "GANG1")
0446: set_actor $SURVIVER[1] dismemberment_possible 0 
060B: set_actor $SURVIVER[1] decision_maker_to $DEC_PEOPLE 
Actor.Health($SURVIVER[1]) = $FRIEND_HEALTH
Actor.WeaponAccuracy($SURVIVER[1]) = 100
07DD: set_actor $SURVIVER[1] attack_rate -1 // previously known as temper_to 
077A: set_actor $SURVIVER[1] acquaintance 0 to_actors_pedtype 0 // see ped.dat 
0860: link_actor $SURVIVER[1] to_interior 18
0568: set_actor $SURVIVER[1] untargetable 1

$SAVE_CAR_CREATED[LATEST_CAR_SLOT_USED] = 0
$SAVE_CAR_MODEL[LATEST_CAR_SLOT_USED] = 0
if
056E:   car $USED_CAR[LATEST_CAR_SLOT_USED] defined
then
car.Destroy($USED_CAR[LATEST_CAR_SLOT_USED])
end
 
wait 1000 
fade 1 1000
$HUD_REMOVE = 0 
wait 1000   
v$OBJECTIVE = "DLC190"

repeat
wait 0
 
05C5: AS_actor $SURVIVER[1] cower -1 ms 
if 
not Actor.Dead($SURVIVER[1])
jf @DLC_M3_FAILED_KENDL_DEAD
  
until 00FE:   actor PLAYER_ACTOR sphere 0 in_sphere 1732.847 -1640.461 27.2621 radius 5.0 5.0 2.0

v$OBJECTIVE = "DUMMY"  
Player.CanMove(PLAYER_CHAR) = False 
fade 0 1000
$HUD_REMOVE = 1 
wait 1000 
Cinema.Widescreen(1)
BLACK_POLOSKI_ON = 1

05C5: AS_actor $SURVIVER[1] cower 1 ms 
Actor.PutAtNoOffset(PLAYER_ACTOR, 1733.974, -1642.042, 27.2438)
Actor.Angle(PLAYER_ACTOR) = 0.652
Actor.Angle($SURVIVER[1]) = 178.6676

0936: set_camera 1732.645508 -1644.913452 27.224655 position_to 1732.744995 -1643.770630 27.181664 time 90000 smooth_transition 1
0920: point_camera 1732.980957 -1643.971924 27.192717 transverse_to 1733.164063 -1642.864868 27.117592 time 90000 smooth_transition 1

0639: AS_actor $SURVIVER[1] rotate_to_actor PLAYER_ACTOR 
0639: AS_actor PLAYER_ACTOR rotate_to_actor $SURVIVER[1] 
06AB: set_actor PLAYER_ACTOR all_weapons_hidden 1
 
wait 1000 
fade 1 1000 
05BF: AS_actor $SURVIVER[1] look_at_actor PLAYER_ACTOR 999999 ms 
05BF: AS_actor PLAYER_ACTOR look_at_actor $SURVIVER[1] 999999 ms 
0084: $DIALOG_ACTOR[0] = PLAYER_ACTOR // (int) 
0084: $DIALOG_ACTOR[1] = $SURVIVER[1] // (int) 
0084: $DIALOG_ACTOR[2] = PLAYER_ACTOR // (int) 
0084: $DIALOG_ACTOR[3] = $SURVIVER[1] // (int) 
0084: $DIALOG_ACTOR[4] = $SURVIVER[1] // (int) 
0084: $DIALOG_ACTOR[5] = PLAYER_ACTOR // (int)  
v$ST_DIALOG[0] = "DLC191" // v$ = string 
v$ST_DIALOG[1] = "DLC192" // v$ = string 
v$ST_DIALOG[2] = "DLC193" // v$ = string 
v$ST_DIALOG[3] = "DLC194" // v$ = string 
v$ST_DIALOG[4] = "DLC195" // v$ = string 
v$ST_DIALOG[5] = "DLC196" // v$ = string  
$DIALOG_COUNT = 5  
create_thread @DG_SYS 

repeat
wait 0  
until $DIALOG_END == 1
  
$DIALOG_END = 0 
fade 0 1000 
wait 1000

0936: set_camera 1732.645508 -1644.913452 27.224655 position_to 1732.744995 -1643.770630 27.181664 time 1 smooth_transition 1
0920: point_camera 1732.980957 -1643.971924 27.192717 transverse_to 1733.164063 -1642.864868 27.117592 time 1 smooth_transition 1
 
06AB: set_actor PLAYER_ACTOR all_weapons_hidden 0 
05BF: AS_actor $SURVIVER[1] look_at_actor PLAYER_ACTOR 1 ms 
05BF: AS_actor PLAYER_ACTOR look_at_actor $SURVIVER[1] 1 ms 
Player.CanMove(PLAYER_CHAR) = True
Camera.Restore_WithJumpCut
0631: put_actor $SURVIVER[1] in_group PLAYER_GROUP

if
COOP_ACTIVE_FLAG == 1
then
0EA0: set_actor_second_player $SURVIVER[1] enable_camera 1 separate_cars 0
0084: COOP_ACTOR = $SURVIVER[1] // (int)
end
 
Cinema.Widescreen(0)
BLACK_POLOSKI_ON = 0
wait 1000 
fade 1 1000
$HUD_REMOVE = 0 
wait 1000  
v$OBJECTIVE = "DLC212"
018A: MISSION_CHECKPOINT = create_checkpoint_at 1701.19 -1667.818 20.2187 
03BC: MISSION_SPHERE = create_sphere_at 1701.19 -1667.818 20.2187 radius 2.0 

repeat
wait 0
 
if 
not Actor.Dead($SURVIVER[1])
jf @DLC_M3_FAILED_KENDL_DEAD
 
if and
Actor.Stopped(PLAYER_ACTOR)
00FE:   actor PLAYER_ACTOR sphere 0 in_sphere 1701.19 -1667.818 20.2187 radius 2.0 2.0 2.0 
0104:   actor PLAYER_ACTOR near_actor $SURVIVER[1] radius 5.0 5.0 2.0 sphere 0 
    then
    break
    end

until false

v$OBJECTIVE = "DUMMY" 
Marker.Disable(MISSION_CHECKPOINT)
03BD: destroy_sphere MISSION_SPHERE 
Player.CanMove(PLAYER_CHAR) = False
0AF1: write_int 1 to_ini_file "data\survival.set" section "SCR" key "DLC_M3_CHECKPOINT1"  
fade 0 1000
$HUD_REMOVE = 1 
wait 1000 
gosub @DLC_M3_MUSIC_FADE_OUT 
select_interior 0
04FA: reset_sky_colors_with_fade 0  

:DLC_M3_CHECKPOINT_JUMP
$PREPARING_CHECKPOINT_OFF = 1
$INT_ZMB_NOT = 0

Camera.SetAtPos(1697.062, -1667.223, 20.1956)
0860: link_actor PLAYER_ACTOR to_interior 0 
0860: link_actor $SURVIVER[1] to_interior 0 
Actor.PutAtNoOffset(PLAYER_ACTOR, 1697.062, -1667.223, 20.1956)
Actor.Angle(PLAYER_ACTOR) = 91.0751
Actor.PutAtNoOffset($SURVIVER[1], 1697.101, -1669.076, 20.1955)
Actor.Angle(PLAYER_ACTOR) = 90.5529
Player.CanMove(PLAYER_CHAR) = True
Camera.Restore_WithJumpCut

0362: remove_actor $SURVIVER[0] from_car_and_place_at 1676.273 -1668.104 21.4375 
Actor.PutAtNoOffset($SURVIVER[0], 1676.273, -1668.104, 21.4375)
Actor.Angle($SURVIVER[0]) = 117.1383
06C9: remove_actor $SURVIVER[1] from_group

if
COOP_ACTIVE_FLAG == 1
then
0EA1: disable_second_player_restore_camera 1
COOP_ACTOR = -69
actor.DestroyInstantly($SURVIVER[1])

repeat
wait 0
023C: load_special_actor 'KENDL' as 2 // models 290-299
until 023D:   special_actor 2 loaded
 
$SURVIVER[1] = Actor.Create(26, #SPECIAL02, 1697.101, -1669.076, 20.1955)
$SURVIVOR_MELEE_ID[1] = -1
0296: unload_special_actor 2
Actor.Angle($SURVIVER[1]) = 90.5529
Actor.SetWalkStyle($SURVIVER[1], "GANG1")
0446: set_actor $SURVIVER[1] dismemberment_possible 0 
060B: set_actor $SURVIVER[1] decision_maker_to $DEC_PEOPLE 
Actor.Health($SURVIVER[1]) = $FRIEND_HEALTH
Actor.WeaponAccuracy($SURVIVER[1]) = 100
07DD: set_actor $SURVIVER[1] attack_rate -1 // previously known as temper_to 
077A: set_actor $SURVIVER[1] acquaintance 0 to_actors_pedtype 0 // see ped.dat 
0860: link_actor $SURVIVER[1] to_interior 0
0568: set_actor $SURVIVER[1] untargetable 1

end

wait 1
0792: disembark_instantly_actor $SURVIVER[1] 
05C5: AS_actor $SURVIVER[1] cower 999999 ms

gosub @DLC_M3_ADDITIONAL_ZOMBIES_CREATE
 
0084: $HUNTER_HEALTH2 = $HUNTER_HEALTH // (int) 
$HUNTER_HEALTH /= 5
0084: $WITCH_HEALTH2 = $WITCH_HEALTH // (int) 
$WITCH_HEALTH /= 5
0084: $TANK_HEALTH2 = $TANK_HEALTH // (int) 
$TANK_HEALTH /= 10

SPEC_INF_ONLY_ONE_INSTANSE_SPAWN_FLAG = 1  
$SPAWN_TANK_ON_COORD = 1 
$ZOMBIE_SPAWN_ON_COORD = 1 
$ZOMBIES_COUNT = 20 
$ZOMBIES_HORDE = 1 
$ZOMBIE_X[0] = 1659.595 
$ZOMBIE_Y[0] = -1681.704 
$ZOMBIE_Z[0] = 21.4306 
$SPAWN_HUNTER_ON_COORD = 1 
$SPAWN_HUNTER_FLAG = 1
 
$HUNTER_X = 1653.614 
$HUNTER_Y = -1649.42 
$HUNTER_Z = 28.1641
  
$SPAWN_WITCH_ON_COORD = 1 
$SPAWN_WITCH_FLAG = 1     
$WITCH_X = 1668.5618 
$WITCH_Y = -1711.7664 
$WITCH_Z = 20.4772 
$SAVESTATUS = 0
  
wait 500  
$ZOMBIE_SPAWN_ON_COORD = 0
HARDCORE_DANGER_FLAG_SCRIPTED = 1 
 
wait 1000 
fade 1 1000
$HUD_REMOVE = 0 
wait 1000

Player.CanMove(PLAYER_CHAR) = true
   
$SPAWN_HUNTER_ON_COORD = 0  
$SPAWN_WITCH_ON_COORD = 0
  
$MUSIC_MISSION = Audiostream.Load("modloader\ZAOLDSTORYFILES\m2\17.mp3")
Audiostream.PerformAction($MUSIC_MISSION, PLAY)
Audiostream.Loop($MUSIC_MISSION, 1)
Audiostream.Volume($MUSIC_MISSION) = $MUSIC_VOLUME

Text.ShowH('DLC199', 3000, 1)
077A: set_actor $SURVIVER[1] acquaintance 0 to_actors_pedtype $ZOMBIE_SET_PEDTYPE // see ped.dat  
0631: put_actor $SURVIVER[0] in_group PLAYER_GROUP

if
COOP_ACTIVE_FLAG == 1
then
0EA0: set_actor_second_player $SURVIVER[0] enable_camera 1 separate_cars 0
0084: COOP_ACTOR = $SURVIVER[0] // (int)
else
0781: get_weapon_with_ID 5 model_to 0@

while not model.Available(0@)
wait 0
model.Load(0@)
mload
end
 
Actor.GiveWeaponAndAmmo($SURVIVER[0], 5, 1)
01B9: set_actor $SURVIVER[0] armed_weapon_to 32

$SURVIVOR_MELEE_ID[0] = 5
$SURVIVOR_WEP_ID[0] = 32
create_thread @MEL_SRV $SURVIVER[0] 0

end
 
//wait 3000 
32@ = 0
repeat
wait 0
if 
not Actor.Dead($SURVIVER[0])
jf @DLC_M3_FAILED_CESAR_DEAD 
if 
not Actor.Dead($SURVIVER[1])
jf @DLC_M3_FAILED_KENDL_DEAD
until 32@ > 3000
Text.ShowH('DLC200', 1500, 1)
//wait 1500   
32@ = 0
repeat
wait 0
if 
not Actor.Dead($SURVIVER[0])
jf @DLC_M3_FAILED_CESAR_DEAD 
if 
not Actor.Dead($SURVIVER[1])
jf @DLC_M3_FAILED_KENDL_DEAD
until 32@ > 1500
v$OBJECTIVE = "DLC203"
MISSION_MARKER = Marker.CreateAboveActor($SURVIVER[0])
07E0: set_marker MISSION_MARKER type_to 1 

repeat
wait 0

$WITCH_INSTANT_AGR = 1  
if 
not Actor.Dead($SURVIVER[0])
jf @DLC_M3_FAILED_CESAR_DEAD
 
if 
not Actor.Dead($SURVIVER[1])
jf @DLC_M3_FAILED_KENDL_DEAD
 
if and
Actor.Dead(200@)
Actor.Dead(201@)
Actor.Dead(202@)
Actor.Dead(203@)
Actor.Dead(204@)
Actor.Dead(205@)
Actor.Dead(206@)
    then
    break
    end
    
until false

v$OBJECTIVE = "DUMMY"

$WITCH_INSTANT_AGR = 0 
0084: $HUNTER_HEALTH = $HUNTER_HEALTH2 // (int)
0084: $WITCH_HEALTH = $WITCH_HEALTH2 // (int)
0084: $TANK_HEALTH = $TANK_HEALTH2 // (int)
 
Marker.Disable(MISSION_MARKER)
$TANK_REMOVE = 1 
wait 200 
$TANK_REMOVE = 0   
$SPAWN_TANK_ON_COORD = 1 
$SPAWN_TANK_FLAG = 1 
$TANK_X = 1702.439 
$TANK_Y = -1673.413 
$TANK_Z = 34.4541 

repeat
wait 0 
$SPAWN_TANK_FLAG = 1  
until 0AE1: 70@ = random_actor_near_point 1702.439 -1673.413 34.4541 in_radius 10.0 find_next 0 pass_deads 1 //IF and SET
  
$SPAWN_TANK_FLAG = 0
if
not COOP_ACTIVE_FLAG == 1
then 
05E2: AS_actor $SURVIVER[0] kill_actor 70@
end 
$SPAWN_TANK_ON_COORD = 0 
$TANK_X = 0.0 
$TANK_Y = 0.0 
$TANK_Z = 0.0 
//wait 1000 
32@ = 0
repeat
wait 0
if 
not Actor.Dead($SURVIVER[0])
jf @DLC_M3_FAILED_CESAR_DEAD 
if 
not Actor.Dead($SURVIVER[1])
jf @DLC_M3_FAILED_KENDL_DEAD
until 32@ > 1000
Text.ShowH('DLC208', 1800, 1)
//wait 1800  
32@ = 0
repeat
wait 0
if 
not Actor.Dead($SURVIVER[0])
jf @DLC_M3_FAILED_CESAR_DEAD 
if 
not Actor.Dead($SURVIVER[1])
jf @DLC_M3_FAILED_KENDL_DEAD
until 32@ > 1800
Text.ShowH('DLC210', 2000, 1)
//wait 2000
32@ = 0
repeat
wait 0
if 
not Actor.Dead($SURVIVER[0])
jf @DLC_M3_FAILED_CESAR_DEAD 
if 
not Actor.Dead($SURVIVER[1])
jf @DLC_M3_FAILED_KENDL_DEAD
until 32@ > 2000
Text.ShowH('DLC210A', 1500, 1)
//wait 1500 
32@ = 0
repeat
wait 0
if 
not Actor.Dead($SURVIVER[0])
jf @DLC_M3_FAILED_CESAR_DEAD 
if 
not Actor.Dead($SURVIVER[1])
jf @DLC_M3_FAILED_KENDL_DEAD
until 32@ > 1500
v$OBJECTIVE = "DLC211"
MISSION_MARKER = Marker.CreateAboveActor(70@)

repeat
wait 0
 
05C5: AS_actor $SURVIVER[1] cower -1 ms 
if 
not Actor.Dead($SURVIVER[0])
jf @DLC_M3_FAILED_CESAR_DEAD
 
if 
not Actor.Dead($SURVIVER[1])
jf @DLC_M3_FAILED_KENDL_DEAD
  
until Actor.Dead(70@)

v$OBJECTIVE = "DUMMY"

SPEC_INF_ONLY_ONE_INSTANSE_SPAWN_FLAG = 0

Text.ShowH('DLC213', 1500, 1)
//wait 1500
32@ = 0
repeat
wait 0
if 
not Actor.Dead($SURVIVER[0])
jf @DLC_M3_FAILED_CESAR_DEAD 
if 
not Actor.Dead($SURVIVER[1])
jf @DLC_M3_FAILED_KENDL_DEAD
until 32@ > 1500
 
Player.CanMove(PLAYER_CHAR) = False
05C5: AS_actor $SURVIVER[1] cower 1 ms 
06C9: remove_actor $SURVIVER[0] from_group

if
COOP_ACTIVE_FLAG == 1
then
0EA1: disable_second_player_restore_camera 1
COOP_ACTOR = -69
end
 
Marker.Disable(MISSION_MARKER) 
fade 0 1000
$HUD_REMOVE = 1 
wait 1000 
$SAVESTATUS = 1 
Cinema.Widescreen(1)
BLACK_POLOSKI_ON = 1

if
$FP_ACTIVATED == 1
then
repeat
wait 0
until $FP_ACTIVATED == 0
end

HARDCORE_DANGER_FLAG_SCRIPTED = 0
Actor.PutAtNoOffset(PLAYER_ACTOR, 1692.257, -1666.695, 20.1991)
Actor.Angle(PLAYER_ACTOR) = 90.9482
Actor.PutAtNoOffset($SURVIVER[1], 1692.473, -1668.526, 20.1989)
Actor.Angle($SURVIVER[1]) = 77.2659
Actor.PutAtNoOffset($SURVIVER[0], 1689.162, -1667.29, 20.2014)
Actor.Angle($SURVIVER[0]) = 261.5481

0936: set_camera 1694.557373 -1670.972412 20.039780 position_to 1693.757935 -1670.421997 20.024385 time 180000 smooth_transition 1 
0920: point_camera 1693.807739 -1670.310791 20.053379 transverse_to 1693.023804 -1669.742920 20.021841 time 180000 smooth_transition 1

0639: AS_actor $SURVIVER[0] rotate_to_actor PLAYER_ACTOR 
0639: AS_actor PLAYER_ACTOR rotate_to_actor $SURVIVER[0] 
0639: AS_actor $SURVIVER[1] rotate_to_actor $SURVIVER[0] 
06AB: set_actor PLAYER_ACTOR all_weapons_hidden 1 

wait 1000 
fade 1 1000 
wait 1000 
05BF: AS_actor $SURVIVER[0] look_at_actor $SURVIVER[1] 999999 ms 
05BF: AS_actor PLAYER_ACTOR look_at_actor $SURVIVER[0] 999999 ms 
05BF: AS_actor $SURVIVER[1] look_at_actor $SURVIVER[0] 999999 ms 
0084: $DIALOG_ACTOR[0] = $SURVIVER[0] // (int) 
0084: $DIALOG_ACTOR[1] = PLAYER_ACTOR // (int) 
0084: $DIALOG_ACTOR[2] = $SURVIVER[0] // (int) 
v$ST_DIALOG[0] = "DLC214" // v$ = string 
v$ST_DIALOG[1] = "DLC215" // v$ = string 
v$ST_DIALOG[2] = "DLC216" // v$ = string 
$DIALOG_COUNT = 2  
create_thread @DG_SYS 

repeat
wait 0  
until $DIALOG_END == 1
  
$DIALOG_END = 0 
$SAVESTATUS = 0

0AF1: write_int 1 to_ini_file "data\survival.set" section "SCR" key "DLC_M3_CHECKPOINT2"
 
fade 0 1000 
wait 1000

0936: set_camera 1694.557373 -1670.972412 20.039780 position_to 1693.757935 -1670.421997 20.024385 time 1 smooth_transition 1 
0920: point_camera 1693.807739 -1670.310791 20.053379 transverse_to 1693.023804 -1669.742920 20.021841 time 1 smooth_transition 1

:DLC_M3_CHECKPOINT2_JUMP
$PREPARING_CHECKPOINT_OFF = 1
 
06AB: set_actor PLAYER_ACTOR all_weapons_hidden 0 
Car.Destroy(300@)
05BF: AS_actor $SURVIVER[0] look_at_actor PLAYER_ACTOR 1 ms 
05BF: AS_actor PLAYER_ACTOR look_at_actor $SURVIVER[0] 1 ms 
05BF: AS_actor $SURVIVER[1] look_at_actor $SURVIVER[0] 1 ms 
Actor.PutAtNoOffset(PLAYER_ACTOR, 1726.972, -1609.41, 13.5469)
Actor.Angle(PLAYER_ACTOR) = 358.882
Actor.PutAtNoOffset($SURVIVER[1], 1725.064, -1609.286, 13.5469)
Actor.Angle($SURVIVER[1]) = 355.4915
Actor.PutAtNoOffset($SURVIVER[0], 1723.736, -1609.021, 13.5469)
Actor.Angle($SURVIVER[0]) = 3.0116
Player.CanMove(PLAYER_CHAR) = True
Camera.Restore_WithJumpCut
Cinema.Widescreen(0)
BLACK_POLOSKI_ON = 0

0781: get_weapon_with_ID 22 model_to 0@

while not model.Available(0@)
wait 0
model.Load(0@)
mload
end
 
Actor.GiveWeaponAndAmmo($SURVIVER[1], 22, 9999)

:CAR_CREATE_DLC_M3_1
if
model.Available(#ADMIRAL)
then
 
301@ = Car.Create(#ADMIRAL, 1788.058, -1621.54, 13.251)
Car.Angle(301@) = 332.0138

if
model.Available(#ADMIRAL)
then
//model.Destroy(#ADMIRAL)
end

else
model.Load(#ADMIRAL)
mload
wait 0
jump to @CAR_CREATE_DLC_M3_1
end

0229: set_car 301@ primary_color_to 18 secondary_color_to 0 
0A97: 11@ = car 301@ struct 
11@ += 9 
0A8D: 12@ = read_memory 11@ size 1 virtual_protect 0 
08BD: set 12@ bit 2 
0A8C: write_memory 11@ size 1 value 12@ virtual_protect 0 
0A97: 11@ = car 301@ struct 
11@ += 4 
0A8D: 12@ = read_memory 11@ size 1 virtual_protect 0 
08BD: set 12@ bit 1 
0A8C: write_memory 11@ size 1 value 12@ virtual_protect 0 
random_float 100@ 15.0 20.0 
0A97: 22@ = car 301@ struct 
0A8E: 23@ = 22@ + 5 // int 
0A8C: write_memory 23@ size 4 value 100@ virtual_protect 0 
08C3: clear 12@ bit 1 
08C3: clear 12@ bit 2 
0A97: 11@ = car 301@ struct 
11@ += 18 
0A8D: 12@ = read_memory 11@ size 1 virtual_protect 0 
08BD: set 12@ bit 2 
0A8C: write_memory 11@ size 1 value 12@ virtual_protect 0 
08C3: clear 12@ bit 2 
actor.LockInCurrentPosition($SURVIVER[0],false)
actor.LockInCurrentPosition($SURVIVER[1],false) 
wait 1000 
fade 1 1000
create_thread @REFR_3D
$HUD_REMOVE = 0   
0631: put_actor $SURVIVER[0] in_group PLAYER_GROUP 
0631: put_actor $SURVIVER[1] in_group PLAYER_GROUP

if
COOP_ACTIVE_FLAG == 1
then
0EA0: set_actor_second_player $SURVIVER[0] enable_camera 1 separate_cars 0
0084: COOP_ACTOR = $SURVIVER[0] // (int)
end
 
wait 1000  
Text.ShowH('DLC217', 2000, 1)
wait 2000 
Text.ShowH('DLC218', 2000, 1)
wait 2000 
v$OBJECTIVE = "DLC219"

repeat
wait 0
 
if 
not Actor.Dead($SURVIVER[0])
jf @DLC_M3_FAILED_CESAR_DEAD
 
if 
not Actor.Dead($SURVIVER[1])
jf @DLC_M3_FAILED_KENDL_DEAD

if
Actor.Driving(PLAYER_ACTOR)
    then
    0@ = Actor.CurrentCar(PLAYER_ACTOR)
    0441: 11@ = car 0@ model
    if
    0A01:   model 11@ car
        then
        01EA: 11@ = car 0@ max_passengers
        if
        11@ > 1
            then
            0A97: 11@ = car 0@ struct 
            11@ += 17 
            0A8D: 12@ = read_memory 11@ size 1 virtual_protect 0
            if 
            88B4: not  test 12@ bit 4      
                then
                0A97: 11@ = car 0@ struct 
                11@ += 9 
                0A8D: 12@ = read_memory 11@ size 1 virtual_protect 0 
                08BD: set 12@ bit 2 
                0A8C: write_memory 11@ size 1 value 12@ virtual_protect 0 
                0A97: 11@ = car 0@ struct 
                11@ += 4 
                0A8D: 12@ = read_memory 11@ size 1 virtual_protect 0 
                08BD: set 12@ bit 1 
                0A8C: write_memory 11@ size 1 value 12@ virtual_protect 0 
                random_float 100@ 30.0 40.0 
                0A97: 22@ = car 0@ struct 
                0A8E: 23@ = 22@ + 5 // int 
                0A8C: write_memory 23@ size 4 value 100@ virtual_protect 0 
                08C3: clear 12@ bit 1 
                08C3: clear 12@ bit 2 
                0A97: 11@ = car 0@ struct 
                11@ += 18 
                0A8D: 12@ = read_memory 11@ size 1 virtual_protect 0 
                08BD: set 12@ bit 2 
                0A8C: write_memory 11@ size 1 value 12@ virtual_protect 0 
                08C3: clear 12@ bit 2
                break
                end
            end
        end
    end

until false

v$OBJECTIVE = "DUMMY"
  
Text.ShowH('DLC220', 1500, 1)
wait 1500 
Text.ShowH('DLC221', 2000, 1)
wait 2000
 
v$OBJECTIVE = "DLC222"
Text.ShowTextBox('DLC282')
MISSION_MARKER = Marker.CreateAboveActor($SURVIVER[0])
07E0: set_marker MISSION_MARKER type_to 1 
101@ = Marker.CreateAboveActor($SURVIVER[1])
07E0: set_marker 101@ type_to 1  

repeat
wait 0
 
if 
not Actor.Dead($SURVIVER[0])
jf @DLC_M3_FAILED_CESAR_DEAD
 
if 
not Actor.Dead($SURVIVER[1])
jf @DLC_M3_FAILED_KENDL_DEAD
 
if 
not Car.Wrecked(0@)
jf @DLC_M3_FAILED_CAR_WRECKED
 
if and
Actor.InCar($SURVIVER[0], 0@)
Actor.InCar($SURVIVER[1], 0@)
    then
    break
    end

until false
 
Marker.Disable(MISSION_MARKER)
Marker.Disable(101@)
018A: MISSION_CHECKPOINT = create_checkpoint_at 1804.12 -2115.572 13.3828
v$OBJECTIVE = "DLC170"

if
COOP_ACTIVE_FLAG == 1
then
06C9: remove_actor $SURVIVER[1] from_group
else
06C9: remove_actor $SURVIVER[0] from_group 
06C9: remove_actor $SURVIVER[1] from_group
end
  
v$ST_DIALOG[0] = "DLC223" // v$ = string 
v$ST_DIALOG[1] = "DUMMY" // v$ = string 
v$ST_DIALOG[2] = "DLC225" // v$ = string 
v$ST_DIALOG[3] = "DLC226" // v$ = string 
v$ST_DIALOG[4] = "DLC227" // v$ = string 
v$ST_DIALOG[5] = "DLC228" // v$ = string 
v$ST_DIALOG[6] = "DLC229" // v$ = string 
v$ST_DIALOG[7] = "DLC230" // v$ = string 
v$ST_DIALOG[8] = "DLC231" // v$ = string 
v$ST_DIALOG[9] = "DLC232" // v$ = string 
v$ST_DIALOG[10] = "DUMMY" // v$ = string 
v$ST_DIALOG[11] = "DLC234" // v$ = string 
v$ST_DIALOG[12] = "DLC235" // v$ = string 
v$ST_DIALOG[13] = "DLC236" // v$ = string 
v$ST_DIALOG[14] = "DLC237" // v$ = string 
v$ST_DIALOG[15] = "DLC238" // v$ = string 
v$ST_DIALOG[16] = "DLC239" // v$ = string 
v$ST_DIALOG[17] = "DLC240" // v$ = string 
v$ST_DIALOG[18] = "DLC241" // v$ = string 
v$ST_DIALOG[19] = "DLC242" // v$ = string 
v$ST_DIALOG[20] = "DLC243" // v$ = string 
v$ST_DIALOG[21] = "DLC244" // v$ = string 
v$ST_DIALOG[22] = "DUMMY" // v$ = string 
v$ST_DIALOG[23] = "DLC246" // v$ = string 
v$ST_DIALOG[24] = "DLC247" // v$ = string 
v$ST_DIALOG[25] = "DLC248" // v$ = string 
v$ST_DIALOG[26] = "DLC249" // v$ = string 
v$ST_DIALOG[27] = "DLC250" // v$ = string 
v$ST_DIALOG[28] = "DLC251" // v$ = string 
v$ST_DIALOG[29] = "DLC252" // v$ = string 
v$ST_DIALOG[30] = "DLC253" // v$ = string 
v$ST_DIALOG[31] = "DLC254" // v$ = string 
v$ST_DIALOG[32] = "DLC255" // v$ = string 
v$ST_DIALOG[33] = "DUMMY" // v$ = string
v$ST_DIALOG[34] = "DLC257" // v$ = string 
$DIALOG_COUNT = 34 
$DIALOG_NOT_SKIP = 1 
create_thread @DG_SYS2 

repeat
wait 0
 
if 
not Actor.InCar(PLAYER_ACTOR, 0@)
    then
    
    Marker.Disable(MISSION_CHECKPOINT)
    03BD: destroy_sphere MISSION_SPHERE 
    v$OBJECTIVE = "DLC971"
    MISSION_MARKER = Marker.CreateAboveCar(0@)
    07E0: set_marker MISSION_MARKER type_to 1
    
    repeat
    wait 0
    
    if 
    not Actor.Dead($SURVIVER[0])
    jf @DLC_M3_FAILED_CESAR_DEAD
    
    if 
    not Actor.Dead($SURVIVER[1])
    jf @DLC_M3_FAILED_KENDL_DEAD
     
    if 
    not Car.Wrecked(0@)
    jf @DLC_M3_FAILED_CAR_WRECKED
    
    until Actor.InCar(PLAYER_ACTOR, 0@)
    
    Marker.Disable(MISSION_MARKER)
    018A: MISSION_CHECKPOINT = create_checkpoint_at 1804.12 -2115.572 13.3828  
    v$OBJECTIVE = "DLC170"
    
    end
 
if 
not Actor.Dead($SURVIVER[0])
jf @DLC_M3_FAILED_CESAR_DEAD
 
if 
not Actor.Dead($SURVIVER[1])
jf @DLC_M3_FAILED_KENDL_DEAD
 
if 
not Car.Wrecked(0@)
jf @DLC_M3_FAILED_CAR_WRECKED
  
until 00EF:   actor PLAYER_ACTOR sphere 1 near_point 1804.12 -2115.572 radius 3.0 3.0 stopped

v$OBJECTIVE = "DUMMY"
  
$DIALOG_NOT_SKIP = 0 
$ZOMBIES_HORDE = 0  
Marker.Disable(MISSION_CHECKPOINT)
Player.CanMove(PLAYER_CHAR) = False
gosub @DLC_M3_MUSIC_FADE_OUT
$DIALOG_PAUSE = 1

fade 0 1000
$HUD_REMOVE = 1
wait 1000

if
COOP_ACTIVE_FLAG == 1
then
0EA1: disable_second_player_restore_camera 1
COOP_ACTOR = -69
06C9: remove_actor $SURVIVER[0] from_group
actor.DestroyInstantly($SURVIVER[0])

repeat
wait 0
023C: load_special_actor 'CESAR' as 1 // models 290-299
until 023D:   special_actor 1 loaded

$SURVIVER[0] = Actor.CreateAsPassenger(26, #SPECIAL01, 0@, 0)
$SURVIVOR_MELEE_ID[0] = -1
0296: unload_special_actor 1
Actor.SetWalkStyle($SURVIVER[0], "GANG1")
0446: set_actor $SURVIVER[0] dismemberment_possible 0 
060B: set_actor $SURVIVER[0] decision_maker_to $DEC_PEOPLE 
Actor.Health($SURVIVER[0]) = $FRIEND_HEALTH
Actor.WeaponAccuracy($SURVIVER[0]) = 100
07DD: set_actor $SURVIVER[0] attack_rate -1 // previously known as temper_to 
077A: set_actor $SURVIVER[0] acquaintance 0 to_actors_pedtype 0 // see ped.dat
0568: set_actor $SURVIVER[0] untargetable 1

create_thread @PED_BKP $SURVIVER[0] 371

0781: get_weapon_with_ID 32 model_to 0@

while not model.Available(0@)
wait 0
model.Load(0@)
mload
end
 
Actor.GiveWeaponAndAmmo($SURVIVER[0], 32, 9999)
end

$SAVESTATUS = 1

Cinema.Widescreen(1)
BLACK_POLOSKI_ON = 1

300@ = actor.CurrentCar(PLAYER_ACTOR)
0407: store_coords_to 102@ 103@ 104@ from_car 300@ with_offset 0.0 6.0 1.0 
Camera.SetPosition(102@, 103@, 104@, 0.0, 0.0, 0.0)
Camera.OnPed(PLAYER_ACTOR, 15, 2)
wait 1 
0407: store_coords_to 102@ 103@ 104@ from_car 300@ with_offset 2.0 4.0 1.0 
Camera.SetPosition(102@, 103@, 104@, 0.0, 0.0, 0.0)
0460: set_camera_transverse_delay 1.0 time 190000 
Camera.OnPed($SURVIVER[0], 15, 1)

wait 1000

05BF: AS_actor $SURVIVER[0] look_at_actor PLAYER_ACTOR 999999 ms 
05BF: AS_actor PLAYER_ACTOR look_at_actor $SURVIVER[0] 999999 ms
$DIALOG_PAUSE = 0

fade 1 1000
$HUD_REMOVE = 1
wait 1000  

repeat
wait 0  
until $DIALOG_END == 1
      
fade 0 1000
$HUD_REMOVE = 1 
wait 1000

camera.Restore_WithJumpCut()

05BF: AS_actor $SURVIVER[0] look_at_actor PLAYER_ACTOR 1 ms 
05BF: AS_actor PLAYER_ACTOR look_at_actor $SURVIVER[0] 1 ms
 
0362: remove_actor PLAYER_ACTOR from_car_and_place_at 1802.495 -2120.438 13.5543 
0362: remove_actor $SURVIVER[0] from_car_and_place_at 1803.495 -2120.438 13.5543 
0362: remove_actor $SURVIVER[1] from_car_and_place_at 1804.495 -2120.438 13.5543 
Actor.PutAtNoOffset(PLAYER_ACTOR, 1802.495, -2120.438, 13.5543)
Actor.Angle(PLAYER_ACTOR) = 198.0341
Actor.PutAtNoOffset($SURVIVER[1], 1806.284, -2121.125, 13.5543)
Actor.Angle($SURVIVER[1]) = 154.5848
Actor.PutAtNoOffset($SURVIVER[0], 1804.531, -2120.878, 13.5543)
Actor.Angle($SURVIVER[0]) = 179.9651

while not model.Available(#CWMOFR)
wait 0
model.Load(#CWMOFR)
mload
end
 
$SURVIVER[2] = Actor.Create(26, #CWMOFR, 1804.139, -2124.513, 13.9424) 
Actor.Angle($SURVIVER[2]) = 355.6503
Cinema.Widescreen(1)
BLACK_POLOSKI_ON = 1

0936: set_camera 1812.464844 -2107.925049 16.148319 position_to 1806.259033 -2113.859619 15.113922 time 180000 smooth_transition 1
0920: point_camera 1811.863403 -2108.710449 16.002371 transverse_to 1806.016968 -2114.822021 14.990469 time 180000 smooth_transition 1
 
0639: AS_actor PLAYER_ACTOR rotate_to_actor $SURVIVER[2] 
0639: AS_actor $SURVIVER[0] rotate_to_actor $SURVIVER[2] 
0639: AS_actor $SURVIVER[1] rotate_to_actor $SURVIVER[2] 
0639: AS_actor $SURVIVER[2] rotate_to_actor $SURVIVER[0] 
0635: AS_actor $SURVIVER[0] aim_at_actor $SURVIVER[2] -1 ms
05C4: AS_actor $SURVIVER[2] hands_up 9999999 ms
 
wait 1000 
fade 1 1000 
 
05BF: AS_actor PLAYER_ACTOR look_at_actor $SURVIVER[2] 999999 ms 
05BF: AS_actor $SURVIVER[0] look_at_actor $SURVIVER[2] 999999 ms 
05BF: AS_actor $SURVIVER[1] look_at_actor $SURVIVER[2] 999999 ms 
05BF: AS_actor $SURVIVER[2] look_at_actor $SURVIVER[0] 999999 ms 
0084: $DIALOG_ACTOR[0] = $SURVIVER[3] // (int) 
0084: $DIALOG_ACTOR[1] = $SURVIVER[3] // (int)
0084: $DIALOG_ACTOR[2] = $SURVIVER[3] // (int) 
0084: $DIALOG_ACTOR[3] = $SURVIVER[3] // (int) 
0084: $DIALOG_ACTOR[4] = $SURVIVER[3] // (int) 
0084: $DIALOG_ACTOR[5] = $SURVIVER[3] // (int) 
0084: $DIALOG_ACTOR[6] = $SURVIVER[3] // (int) 
0084: $DIALOG_ACTOR[7] = $SURVIVER[3] // (int) 
0084: $DIALOG_ACTOR[8] = $SURVIVER[3] // (int) 
0084: $DIALOG_ACTOR[9] = $SURVIVER[3] // (int) 
0084: $DIALOG_ACTOR[10] = $SURVIVER[3] // (int) 
0084: $DIALOG_ACTOR[11] = $SURVIVER[3] // (int) 
0084: $DIALOG_ACTOR[12] = $SURVIVER[3] // (int) 
0084: $DIALOG_ACTOR[13] = $SURVIVER[2] // (int) 
0084: $DIALOG_ACTOR[14] = $SURVIVER[0] // (int)   
v$ST_DIALOG[0] = "DLC258" // v$ = string 
v$ST_DIALOG[1] = "DLC259" // v$ = string
v$ST_DIALOG[2] = "DLCA259" // v$ = string 
v$ST_DIALOG[3] = "DLC260" // v$ = string 
v$ST_DIALOG[4] = "DLC261" // v$ = string 
v$ST_DIALOG[5] = "DLC262" // v$ = string 
v$ST_DIALOG[6] = "DLC263" // v$ = string 
v$ST_DIALOG[7] = "DLC264" // v$ = string 
v$ST_DIALOG[8] = "DLC265" // v$ = string 
v$ST_DIALOG[9] = "DLC266" // v$ = string 
v$ST_DIALOG[10] = "DLC267" // v$ = string 
v$ST_DIALOG[11] = "DLC268" // v$ = string 
v$ST_DIALOG[12] = "DLC269" // v$ = string 
v$ST_DIALOG[13] = "DLC270" // v$ = string 
v$ST_DIALOG[14] = "DLC271" // v$ = string  
$DIALOG_COUNT = 14  
create_thread @DG_SYS

100@ = 0 

repeat
wait 0

if and
100@ == 0
$DIALOG_CURRENT_INT == 12
    then
    100@ = 1
    0687: clear_actor $SURVIVER[0] task
    wait 1000
    0687: clear_actor $SURVIVER[2] task
    end
  
until $DIALOG_END == 1
  
$DIALOG_END = 0 
fade 0 1000 
wait 1000

0936: set_camera 1812.464844 -2107.925049 16.148319 position_to 1806.259033 -2113.859619 15.113922 time 1 smooth_transition 1
0920: point_camera 1811.863403 -2108.710449 16.002371 transverse_to 1806.016968 -2114.822021 14.990469 time 1 smooth_transition 1
 
05BF: AS_actor PLAYER_ACTOR look_at_actor $SURVIVER[2] 1 ms 
05BF: AS_actor $SURVIVER[0] look_at_actor $SURVIVER[2] 1 ms 
05BF: AS_actor $SURVIVER[1] look_at_actor $SURVIVER[2] 1 ms 
05BF: AS_actor $SURVIVER[2] look_at_actor $SURVIVER[0] 1 ms 
Actor.DestroyInstantly($SURVIVER[0])
Actor.DestroyInstantly($SURVIVER[1])
Actor.DestroyInstantly($SURVIVER[2])
Actor.PutAtNoOffset(PLAYER_ACTOR, 1799.29, -2120.647, 13.5543)
Actor.Angle(PLAYER_ACTOR) = 269.98
Cinema.Widescreen(0)
BLACK_POLOSKI_ON = 0
Player.CanMove(PLAYER_CHAR) = True
Camera.Restore_WithJumpCut
wait 1000 
$SAVESTATUS = 0 
fade 1 1000
$HUD_REMOVE = 0 
wait 1000

$TEMP_XP = 2500
008D: $TEMP_XP = integer $TEMP_XP to_float
0069: $TEMP_XP *= $XP_COEFF // (float)
if
PERK_CHARISMA == 2
then
$TEMP_XP *= CHARISMA_LEVEL2_XP_COEFF
end
008C: $TEMP_XP = float $TEMP_XP to_integer
0058: $PLAYER_XP += $TEMP_XP // (int)

0629: change_integer_stat 258 to 0
SKIP_6HOURS_AFTER_SAVE = 0
MAIN_QUEST_TEAMMATES_REMOVE_FLAG = 2
create_thread @MQTMBK
COOP_TP_TEAMMATES_FLAG = 1
  
jump @DLC_M3_UDACHNO

:DLC_M3_CHECKPOINT2
$ZOMBIES_HORDE = 1

0362: remove_actor PLAYER_ACTOR from_car_and_place_at 1726.241 -1597.611 12.7611 
0362: remove_actor $SURVIVER[0] from_car_and_place_at 1726.241 -1597.611 12.7611

wait 5

$SAVE_CAR_CREATED[LATEST_CAR_SLOT_USED] = 0
$SAVE_CAR_MODEL[LATEST_CAR_SLOT_USED] = 0
if
056E:   car $USED_CAR[LATEST_CAR_SLOT_USED] defined
then
car.Destroy($USED_CAR[LATEST_CAR_SLOT_USED])
end

repeat
wait 0
023C: load_special_actor 'KENDL' as 2 // models 290-299
until 023D:   special_actor 2 loaded
 
$SURVIVER[1] = Actor.Create(26, #SPECIAL02, 1734.182, -1639.599, 27.2507)
$SURVIVOR_MELEE_ID[1] = -1
0296: unload_special_actor 2
Actor.Angle($SURVIVER[1]) = 3.5686
Actor.SetWalkStyle($SURVIVER[1], "GANG1")
0446: set_actor $SURVIVER[1] dismemberment_possible 0 
060B: set_actor $SURVIVER[1] decision_maker_to $DEC_PEOPLE 
Actor.Health($SURVIVER[1]) = $FRIEND_HEALTH
Actor.WeaponAccuracy($SURVIVER[1]) = 100
07DD: set_actor $SURVIVER[1] attack_rate -1 // previously known as temper_to 
077A: set_actor $SURVIVER[1] acquaintance 0 to_actors_pedtype 0 // see ped.dat 
0860: link_actor $SURVIVER[1] to_interior 0
0568: set_actor $SURVIVER[1] untargetable 1

$MUSIC_MISSION = Audiostream.Load("modloader\ZAOLDSTORYFILES\m2\17.mp3")
Audiostream.PerformAction($MUSIC_MISSION, PLAY)
Audiostream.Loop($MUSIC_MISSION, 1)
Audiostream.Volume($MUSIC_MISSION) = $MUSIC_VOLUME

jump to @DLC_M3_CHECKPOINT2_JUMP 

:DLC_M3_CHECKPOINT
$HUD_REMOVE = 1  
0362: remove_actor PLAYER_ACTOR from_car_and_place_at 1726.241 -1597.611 12.7611 
0362: remove_actor $SURVIVER[0] from_car_and_place_at 1726.241 -1597.611 12.7611

wait 5

$SAVE_CAR_CREATED[LATEST_CAR_SLOT_USED] = 0
$SAVE_CAR_MODEL[LATEST_CAR_SLOT_USED] = 0
if
056E:   car $USED_CAR[LATEST_CAR_SLOT_USED] defined
then
car.Destroy($USED_CAR[LATEST_CAR_SLOT_USED])
end

repeat
wait 0
023C: load_special_actor 'KENDL' as 2 // models 290-299
until 023D:   special_actor 2 loaded
 
$SURVIVER[1] = Actor.Create(26, #SPECIAL02, 1734.182, -1639.599, 27.2507)
$SURVIVOR_MELEE_ID[1] = -1
0296: unload_special_actor 2
Actor.Angle($SURVIVER[1]) = 3.5686
Actor.SetWalkStyle($SURVIVER[1], "GANG1")
0446: set_actor $SURVIVER[1] dismemberment_possible 0 
060B: set_actor $SURVIVER[1] decision_maker_to $DEC_PEOPLE 
Actor.Health($SURVIVER[1]) = $FRIEND_HEALTH
Actor.WeaponAccuracy($SURVIVER[1]) = 100
07DD: set_actor $SURVIVER[1] attack_rate -1 // previously known as temper_to 
077A: set_actor $SURVIVER[1] acquaintance 0 to_actors_pedtype 0 // see ped.dat 
0860: link_actor $SURVIVER[1] to_interior 18
0568: set_actor $SURVIVER[1] untargetable 1 
0631: put_actor $SURVIVER[1] in_group PLAYER_GROUP 
jump @DLC_M3_CHECKPOINT_JUMP 

:DLC_M3_FAILED_CESAR_DEAD
Text.ClearAll
v$FAILED_TEXT = "DLC129"
jump @DLC_M3_KOD_PROVALA 

:DLC_M3_FAILED_KENDL_DEAD
Text.ClearAll
v$FAILED_TEXT = "DLC280"
jump @DLC_M3_KOD_PROVALA 

:DLC_M3_FAILED_CAR_WRECKED
Text.ClearAll
v$FAILED_TEXT = "DLC153"
jump @DLC_M3_KOD_PROVALA   

:DLC_M3_UDACHNO
$ONMISSION = 0  
03DE: set_pedestrians_density_multiplier_to 0.0 
01EB: set_traffic_density_multiplier_to 0.0 
0318: set_latest_mission_passed 'DLC183B' 
08E7: disable_entrance_markers 0
$X_START = 1803.9836 
$Y_START = -2119.6296 
$Z_START = 13.2307 
$MISSION_ICON = 13 
06D1: v$MISSION_NAME = "DLC281" // v$ = string 
$MISSION_START = 46
JS_DLC_MISSION_TIMER2 = 25200 
create_thread @MSN_ST2
MAIN_QUEST_MUSIC_FLAG = 0 
gosub @DLC_M3_PROPUSK_KODA 
return 

:DLC_M3_KOD_PROVALA
$GAME_OVER = 1 
create_thread @GMV_OVR 
$ONMISSION = 0 
mission_cleanup 
$ZOMBIES_HORDE = 0 
Marker.Disable(MISSION_CHECKPOINT)
Marker.Disable(MISSION_MARKER)
Marker.Disable(101@)
03BD: destroy_sphere MISSION_SPHERE 
06D0: enable_emergency_traffic 0 
06D7: enable_train_traffic 0 
096A: enable_flying_helis 0 
099E: enable_police_patrols 0 
0923: enable_air_traffic 0 
08E7: disable_entrance_markers 0 
03DE: set_pedestrians_density_multiplier_to 0.0 
01EB: set_traffic_density_multiplier_to 0.0 
gosub @DLC_M3_MUSIC_FADE_OUT 
return 

:DLC_M3_MUSIC_FADE_OUT

/////////////////////Плавное затухание/////////////////////
//
//$MUSIC_FADE_NUMBER += 1
//if
//$MUSIC_FADE_NUMBER > 4
//    then
//    $MUSIC_FADE_NUMBER = 0 
//    end    
//
//0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_MISSION // (int)
//$MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = 0.0
//
//$MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 1000
//$MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 0  
//$MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
//create_thread @MUS_FAD
//
//wait 1
//
//while $MUSIC_FADE_ENDED[$MUSIC_FADE_NUMBER] == 0
//wait 0
//end
2504: SET_AUDIO_STREAM_VOLUME_WITH_TRANSITION $MUSIC_MISSION volume 0.0 time 1000
wait 1000
audiostream.Release($MUSIC_MISSION)

//////////////////////////////////////////////////////////

return 

:DLC_M3_UDALENIE_KODA
$ONMISSION = 0 
mission_cleanup 
06D0: enable_emergency_traffic 0 
06D7: enable_train_traffic 0 
096A: enable_flying_helis 0 
099E: enable_police_patrols 0 
0923: enable_air_traffic 0 
08E7: disable_entrance_markers 0 
03DE: set_pedestrians_density_multiplier_to 0.0 
01EB: set_traffic_density_multiplier_to 0.0 
return 

:DLC_M3_ADDITIONAL_ZOMBIES_CREATE

while not model.Available(#ZMB1)
wait 0
model.Load(#ZMB1)
mload
end
 
200@ = Actor.Create($ZOMBIE_SET_PEDTYPE, #ZMB1, 1648.733, -1667.625, 21.4375)

while not model.Available(#ZMB2)
wait 0
model.Load(#ZMB2)
mload
end

201@ = Actor.Create($ZOMBIE_SET_PEDTYPE, #ZMB2, 1648.848, -1668.282, 21.4311)

while not model.Available(#ZMB3)
wait 0
model.Load(#ZMB3)
mload
end

202@ = Actor.Create($ZOMBIE_SET_PEDTYPE, #ZMB3, 1648.848, -1669.282, 21.4311)

while not model.Available(#ZMB4)
wait 0
model.Load(#ZMB4)
mload
end

203@ = Actor.Create($ZOMBIE_SET_PEDTYPE, #ZMB4, 1648.848, -1670.282, 21.4311)

while not model.Available(#ZMB8)
wait 0
model.Load(#ZMB8)
mload
end

204@ = Actor.Create($ZOMBIE_SET_PEDTYPE, #ZMB8, 1648.848, -1671.282, 21.4311)

while not model.Available(#ZMB6)
wait 0
model.Load(#ZMB6)
mload
end

205@ = Actor.Create($ZOMBIE_SET_PEDTYPE, #ZMB6, 1648.848, -1672.282, 21.4311)

while not model.Available(#ZMB7)
wait 0
model.Load(#ZMB7)
mload
end

206@ = Actor.Create($ZOMBIE_SET_PEDTYPE, #ZMB7, 1648.848, -1673.282, 21.4311)

Actor.SetWalkStyle(200@, "zombie1")
Actor.SetWalkStyle(201@, "zombie2")
Actor.SetWalkStyle(202@, "zombie3")
Actor.SetWalkStyle(203@, "zombie1")
Actor.SetWalkStyle(204@, "zombie2")
Actor.SetWalkStyle(205@, "zombie3")
Actor.SetWalkStyle(206@, "zombie1")

060F: set_actor 200@ melee_accuracy_to 150.0 
060F: set_actor 201@ melee_accuracy_to 150.0 
060F: set_actor 202@ melee_accuracy_to 150.0 
060F: set_actor 203@ melee_accuracy_to 150.0 
060F: set_actor 204@ melee_accuracy_to 150.0 
060F: set_actor 205@ melee_accuracy_to 150.0 
060F: set_actor 206@ melee_accuracy_to 150.0
 
07FE: set_actor 200@ fighting_style_to 5 moves 6 
07FE: set_actor 201@ fighting_style_to 5 moves 6 
07FE: set_actor 202@ fighting_style_to 5 moves 6 
07FE: set_actor 203@ fighting_style_to 5 moves 6 
07FE: set_actor 204@ fighting_style_to 5 moves 6 
07FE: set_actor 205@ fighting_style_to 5 moves 6 
07FE: set_actor 206@ fighting_style_to 5 moves 6
 
07DD: set_actor 200@ attack_rate $ZOMBIE_ATTACK_RATE // previously known as temper_to 
07DD: set_actor 201@ attack_rate $ZOMBIE_ATTACK_RATE // previously known as temper_to 
07DD: set_actor 202@ attack_rate $ZOMBIE_ATTACK_RATE // previously known as temper_to 
07DD: set_actor 203@ attack_rate $ZOMBIE_ATTACK_RATE // previously known as temper_to 
07DD: set_actor 204@ attack_rate $ZOMBIE_ATTACK_RATE // previously known as temper_to 
07DD: set_actor 205@ attack_rate $ZOMBIE_ATTACK_RATE // previously known as temper_to 
07DD: set_actor 206@ attack_rate $ZOMBIE_ATTACK_RATE // previously known as temper_to
 
060B: set_actor 200@ decision_maker_to $DEC_ZOMBIE 
060B: set_actor 201@ decision_maker_to $DEC_ZOMBIE 
060B: set_actor 202@ decision_maker_to $DEC_ZOMBIE 
060B: set_actor 203@ decision_maker_to $DEC_ZOMBIE 
060B: set_actor 204@ decision_maker_to $DEC_ZOMBIE 
060B: set_actor 205@ decision_maker_to $DEC_ZOMBIE 
060B: set_actor 206@ decision_maker_to $DEC_ZOMBIE
 
0A09: set_actor 200@ muted 1 // versionB 
0A09: set_actor 201@ muted 1 // versionB 
0A09: set_actor 202@ muted 1 // versionB 
0A09: set_actor 203@ muted 1 // versionB 
0A09: set_actor 204@ muted 1 // versionB 
0A09: set_actor 205@ muted 1 // versionB 
0A09: set_actor 206@ muted 1 // versionB
 
05E2: AS_actor 200@ kill_actor $SURVIVER[0] 
05E2: AS_actor 201@ kill_actor $SURVIVER[0] 
05E2: AS_actor 202@ kill_actor $SURVIVER[0] 
05E2: AS_actor 203@ kill_actor $SURVIVER[0] 
05E2: AS_actor 204@ kill_actor $SURVIVER[0] 
05E2: AS_actor 205@ kill_actor $SURVIVER[0] 
05E2: AS_actor 206@ kill_actor $SURVIVER[0] 
return 