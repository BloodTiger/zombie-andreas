const
USHER4_VICTORIA = 299@  
USHER4_NIKOLS = $ARMY69_2[28]
USHER4_SAVE_PICKUP = 310@
USHER4_SAVE_PICKUP_MARKER = 311@
USHER4_MISS_CHECKPOINT_NUM = 313@
USHER4_VICTORIA_GOT_BACK_FLAG = 314@
USHER4_MARJORI = $SURVIVER[1]
USHER4_ANGIE = $SURVIVER[2]
USHER4_3D_ZMB_SND1 = 315@
USHER4_3D_ZMB_SND2 = 316@
USHER4_3D_ZMB_SND3 = 317@
USHER4_3D_ZMB_SND4 = 318@
USHER4_ERNIE = $SURVIVER[1]
USHER4_BOXUS = $SURVIVER[2]
USHER4_CLETUS = $SURVIVER[3]
USHER4_BRODY = $SURVIVER[4]
USHER4_BOXUS_MARKER = 319@
USHER4_CLETUS_MARKER = 320@
USHER4_BRODY_MARKER = 321@
USHER4_CLETUS_DIED_FLAG = 322@
USHER4_VERONICA = $SURVIVER[1]
USHER4_GLENSHIT = $SUPPLY_QUEST_TRUCK
USHER4_MISHKA_OBJECT = 323@
USHER4_TERRY = $SURVIVER[1]
USHER4_GLENSHIT_ACTOR = 324@
ZOMBIE_RUN_SPEED_PRE = 325@
CHARGER_RUN_SPEED_PRE = 326@
CHARGER_HEALTH_PRE = 327@
CHARGER_DAMAGE_PRE = 328@
WITCH_RUN_SPEED_PRE = 326@
WITCH_HEALTH_PRE = 327@
PLAYER_XP_PREV = 328@
USHER4_NEED_TO_RETURN_PICKUPS = 329@
end                  
                          
:USHS4
thread 'USHS4'
gosub @UKOD_MISSII4 
if 
wasted_or_busted 
jf @UPROPUSK_KODA4 
gosub @UKOD_PROVALA4 

:UPROPUSK_KODA4        
gosub @UUDALENIE_KODA4
end_thread

:UKOD_MISSII4
increment_mission_attempts 

cinema.Radar(1)
0A48: enable_menu_access_in_widescreen_mode 0
0629: change_integer_stat 258 to 113
0776: create_objects_in_object_group "usher_h"
0459: end_thread_named 'ARMY_SP'
0459: end_thread_named 'BNDT_SP'
0459: end_thread_named 'FRMR_SP'
0459: end_thread_named 'SWAT_SP'
0459: end_thread_named 'C_MENU'

MAIN_QUEST_MUSIC_FLAG = 1
057E: set_radar_grey 0
SURVIVAL_STARTED_FULLY_FLAG = 1
CAMP_DONT_SAY_HELLO_FLAG = 1
USHER_STORY_FEATRUES_LOCKED = 2
USHER_STORY_CREATE_NICOLS_FLAG = 2
$TIME_LOCK_OFF = 1
$WEATHER_LOCK_OFF_FLAG = 1
0459: end_thread_named 'WTH_LCK'
0459: end_thread_named 'TIM_LCK'
BLACK_POLOSKI_ON = 0
$WEATHER_CYCLE_OFF = 1

actor.PutAtNoOffset(PLAYER_ACTOR,2178.51, -2254.9922, 14.77)
actor.Angle(PLAYER_ACTOR) = 225.6905
camera.Restore_WithJumpCut()
create_thread @3D_REFR
gosub @USHER4_HIDE_WEPS

CAMP_DONT_SAY_HELLO_FLAG = 0
$CAMP_SPOTTED_FLAG = 1
$CAMP_SPOTTED_FLAG_SAVE = 0

32@ = 0
repeat
wait 0
00C0: set_current_time 6 0
fade 0 0
$SAVESTATUS = 1
03F0: enable_text_draw 1
038E: draw_box_position 320.0 224.0 size 640.0 448.0 RGBA 0 0 0 255
until 32@ > 3100

while true
wait 0
$END_FADING_MUSIC_FAST = 1

if and
$MUSIC_FADE_ENDED[0] == 1
$MUSIC_FADE_ENDED[1] == 1
$MUSIC_FADE_ENDED[2] == 1
$MUSIC_FADE_ENDED[3] == 1
$MUSIC_FADE_ENDED[4] == 1
then
$END_FADING_MUSIC_FAST = 0
break
end

end     

$SOUND_OFF_1 = 0  
$ONMISSION = 1 
$HUD_REMOVE = 1
$SAVESTATUS = 1   
$INT_ZMB_NOT = 1
$NOTSPAWN_ETC = 1
$SPECIAL_INFECTED_NOT_SPAWN_FLAG = 1
ZOMBIES_NOTSPAWN = 1
$ZOMBIES_COUNT = 20
$QUEST_CAMP_NUMBER = 6

ENEX_OFF = 1

$SPECIAL_INFECTED_NOT_SPAWN_FLAG = 1
INT_ZOMBIE_OFF_FADING_AND_SHIT_FLAG = 1

$SATIETY_LEVEL = 200.0

$DONT_CHANGE_MONTH_FLAG = 1
wait 100
0A8C: write_memory 0x00B70154 size 1 value 18 virtual_protect 0 //Day
0A8C: write_memory 0x00B70155 size 1 value 9 virtual_protect 0 //Month
wait 100
$DONT_CHANGE_MONTH_FLAG = 0

if
LATEST_CAR_SLOT_USED == -1
then
gosub @USHER4_CREATE_VICTORIA
create_thread @C_MENU 1
SUPPLY_QUEST_TRUCK = -1

0781: get_weapon_with_ID 88 model_to 1@

while not model.Available(1@)
wait 0
model.Load(1@)
mload
end
    
actor.GiveWeaponAndAmmo(PLAYER_ACTOR,88,300)
01B9: set_actor PLAYER_ACTOR armed_weapon_to 0

$HEAL = 3
$BINT = 2
$BANKA = 3

end

$SAVESTATUS = 0
BASE_TEAMMATES_DESTORY_FLAG = 0

repeat
wait 0
until 056D:   actor USHER4_NIKOLS defined

repeat
wait 0
gosub @USHER4_HIDE_WEPS

if
8EEA: not locate_char_distance_to_coordinates PLAYER_ACTOR pos $SAVE_CAR_X[SAVE_CAR_CURRENT_NUMBER] $SAVE_CAR_Y[SAVE_CAR_CURRENT_NUMBER] $SAVE_CAR_Z[SAVE_CAR_CURRENT_NUMBER] radius 150.0
then
$SAVE_CAR_X[SAVE_CAR_CURRENT_NUMBER] = 2174.415527 
$SAVE_CAR_Y[SAVE_CAR_CURRENT_NUMBER] = -2265.320313 
$SAVE_CAR_Z[SAVE_CAR_CURRENT_NUMBER] = 13.308066
end

until 056E:   car $USED_CAR[LATEST_CAR_SLOT_USED] defined

$PREPARING_TEXT_OFF = 0
PLAYER_NO_ITEMS_FLAG = 0
PLAYER_DONT_HAVE_BACKPACK = 0
create_thread @PED_BKP PLAYER_ACTOR 371

if
8491: not  actor PLAYER_ACTOR has_weapon 151
then

0781: get_weapon_with_ID 151 model_to 0@

while not model.Available(0@)
wait 0
model.Load(0@)
mload
end

actor.GiveWeaponAndAmmo(PLAYER_ACTOR,151,1)
01B9: set_actor PLAYER_ACTOR armed_weapon_to 0

end

06AB: set_actor PLAYER_ACTOR all_weapons_hidden 0
0992: set_player PLAYER_CHAR weapons_scrollable 1

0AF0: USHER4_MISS_CHECKPOINT_NUM = get_int_from_ini_file "saves\ZACM.set" section "SCR" key "USHER_MISS4_CHECKPOINT"

if and
not $CHEATS_ON == 1
USHER4_MISS_CHECKPOINT_NUM < 1
then

06D1: v$BNS_TXT = "STRB1F" // v$ = string
$PORTRAIT_RELOAD_FLAG = 0
create_thread @DLC_TXT

repeat
wait 0
until $PORTRAIT_RELOAD_FLAG == 1

end

if and
$CHEATS_ON == 1
0AB0:   key_pressed 48
then //Удаление всех скипов
0AF1: write_int -1 to_ini_file "saves\ZACM.set" section "SCR" key "USHER_MISS4_CHECKPOINT" 
end

if and
$CHEATS_ON == 1
0AB0:   key_pressed 49
then
0AF1: write_int 1 to_ini_file "saves\ZACM.set" section "SCR" key "USHER_MISS4_CHECKPOINT" 
end

if and
$CHEATS_ON == 1
0AB0:   key_pressed 50
then
0AF1: write_int 2 to_ini_file "saves\ZACM.set" section "SCR" key "USHER_MISS4_CHECKPOINT" 
end

if and
$CHEATS_ON == 1
0AB0:   key_pressed 51
then
0AF1: write_int 3 to_ini_file "saves\ZACM.set" section "SCR" key "USHER_MISS4_CHECKPOINT"
0AF0: USHER4_CLETUS_DIED_FLAG = get_int_from_ini_file "saves\ZACM.set" section "SCR" key "USHER_MISS4_CLETUS_DIED"
end

if and
$CHEATS_ON == 1
0AB0:   key_pressed 52
then
0AF1: write_int 4 to_ini_file "saves\ZACM.set" section "SCR" key "USHER_MISS4_CHECKPOINT" 
end

if and
$CHEATS_ON == 1
0AB0:   key_pressed 53
then
0AF1: write_int 5 to_ini_file "saves\ZACM.set" section "SCR" key "USHER_MISS4_CHECKPOINT" 
end

0AF0: USHER4_MISS_CHECKPOINT_NUM = get_int_from_ini_file "saves\ZACM.set" section "SCR" key "USHER_MISS4_CHECKPOINT"

if 
USHER4_MISS_CHECKPOINT_NUM > 0
then

:MISHA_VSE_HUINYA_DAVAI_PO_NOVOI

///////////////////////////////////////////

for 0@ = 0 to 4

if
$SAVE_CAR_CREATED[0@] == 1
then
actor.StorePos(PLAYER_ACTOR,$SAVE_CAR_X[0@], $SAVE_CAR_Y[0@], $SAVE_CAR_Z[0@])
end

end

///////////////////////////////////////////

wait 200

$SAVE_CAR_X[LATEST_CAR_SLOT_USED] = 259.5947
$SAVE_CAR_Y[LATEST_CAR_SLOT_USED] = -65.6069
$SAVE_CAR_Z[LATEST_CAR_SLOT_USED] = 1.1567
$SAVE_CAR_MODEL[LATEST_CAR_SLOT_USED] = 15593  

wait 50

SAVED_CARS_MARK_REDO = 1

///////////////////////////////////////////

for 0@ = 0 to 4

if
056E:   car $USED_CAR[0@] defined
then
car.Destroy($USED_CAR[0@])
end

end

///////////////////////////////////////////

wait 250

SAVED_CARS_MARK_REDO = 0

while not model.Available(#MALE01)
wait 0
model.Load(#MALE01)
mload
end

0@ = actor.Create(5,#MALE01,$SAVE_CAR_X[LATEST_CAR_SLOT_USED],$SAVE_CAR_Y[LATEST_CAR_SLOT_USED],$SAVE_CAR_Z[LATEST_CAR_SLOT_USED])

if
8EEA: not locate_char_distance_to_coordinates 0@ pos 259.5947 -65.6069 1.1567 radius 50.0
then
actor.DestroyInstantly(0@)
//fade 1 1
//0AD1: show_formatted_text_highpriority "MISHA_VSE_HUINYA_DAVAI_PO_NOVOI!" time 500
//wait 500
//fade 0 0
jump to @MISHA_VSE_HUINYA_DAVAI_PO_NOVOI
end

actor.DestroyInstantly(0@)

end

if
USHER4_MISS_CHECKPOINT_NUM == 1
then
//Скип на начало бойни в кошмаре
0992: set_player PLAYER_CHAR weapons_scrollable 0
0169: set_fade_color_RGB 255 0 0
jump to @USHSER4_INSTAJUMP_TO_NIGHTMARE_PART
end        

if
USHER4_MISS_CHECKPOINT_NUM == 2
then
//Скип после кошмара
0992: set_player PLAYER_CHAR weapons_scrollable 0
jump to @USHSER4_INSTAJUMP_AFTER_NIGHTMARE
end

if
USHER4_MISS_CHECKPOINT_NUM == 3
then

00C0: set_current_time 18 0
0E6A: make_nop 0x052CF53 size 6 //Выключаем обновление часов
0E6A: make_nop 0x053BFC2 size 5 //Выключаем обновление погоды
HIDE_HUD_CLOCK = 1

//Скип после пиздинга в квартире
0992: set_player PLAYER_CHAR weapons_scrollable 1
jump to @USHER4_INSTAJUMP_TO_OUTHOUSE_PART
end

if
USHER4_MISS_CHECKPOINT_NUM == 4  
then

00C0: set_current_time 20 0
0E6A: make_nop 0x052CF53 size 6 //Выключаем обновление часов
0E6A: make_nop 0x053BFC2 size 5 //Выключаем обновление погоды
HIDE_HUD_CLOCK = 1

actor.PutAtNoOffset(PLAYER_ACTOR,263.2946, -67.2675, -2.9766)

//Скип перед ебнутой марджроди

///////////////////////////////////////////////////////////

while not model.Available(1199)
wait 0
model.Load(1199)
mload
end

USHER4_ANGIE = actor.Create(26,1199,2679.235596, 205.898773, 53.723888)
actor.Angle(USHER4_ANGIE) = 180.0

actor.SetImmunities(USHER4_ANGIE,1,1,1,1,1) //только попробуй это убрать, грязный ублюдок!!!
 
0D10: set_actor USHER4_ANGIE alpha 255 // IF and SET

//create_thread @PED_BKP USHER4_ANGIE 371
//create_thread @ANT_PRE USHER4_ANGIE

actor.Health(USHER4_ANGIE) = 100

0D10: set_actor USHER4_ANGIE alpha 255 // IF and SET
09F4: set_actor USHER4_ANGIE ignore_height_difference_following_nodes $Z_IGNORE_HEIGHT 
Actor.SetWalkStyle(USHER4_ANGIE, "SURV1")
0446: set_actor USHER4_ANGIE dismemberment_possible 0
060B: set_actor USHER4_ANGIE decision_maker_to $DEC_PEOPLE
07DD: set_actor USHER4_ANGIE attack_rate 50 // previously known as temper_to
081A: set_actor USHER4_ANGIE weapon_skill_to 2  
060F: set_actor USHER4_ANGIE melee_accuracy_to 999.0
0946: set_actor USHER4_ANGIE actions_uninterupted_by_weapon_fire 1

if
UNITED_MAP == 0
then
04D8: set_actor USHER4_ANGIE drowns_in_water 0 
end

09B5: set_actor USHER4_ANGIE signal_after_kill 0  
0A96: 0@ = actor USHER4_ANGIE struct
0A8E: 0@ = 0@ + 1376
0A8C: write_memory 0@ size 4 value $SURVIVORS_ROTATE_SPEED virtual_protect 1

08AF: set_actor USHER4_ANGIE max_health_to 100
Actor.WeaponAccuracy(USHER4_ANGIE) = $SURV_ACCURACY

repeat
wait 0
until 056E:   car $USED_CAR[LATEST_CAR_SLOT_USED] defined

0430: put_actor USHER4_ANGIE into_car $USED_CAR[LATEST_CAR_SLOT_USED] passenger_seat 2

jump to @USHER4_INSTAJUMP_TO_MARJFIGHT_PART
end    

if
USHER4_MISS_CHECKPOINT_NUM == 5
then

00C0: set_current_time 20 0
0E6A: make_nop 0x052CF53 size 6 //Выключаем обновление часов
0E6A: make_nop 0x053BFC2 size 5 //Выключаем обновление погоды
HIDE_HUD_CLOCK = 1

actor.PutAtNoOffset(PLAYER_ACTOR,263.2946, -67.2675, -2.9766)

//Скип перед ебнутой марджроди

///////////////////////////////////////////////////////////

while not model.Available(1199)
wait 0
model.Load(1199)
mload
end

USHER4_ANGIE = actor.Create(26,1199,2679.235596, 205.898773, 53.723888)
actor.Angle(USHER4_ANGIE) = 180.0

actor.SetImmunities(USHER4_ANGIE,1,1,1,1,1) //только попробуй это убрать, грязный ублюдок!!!
 
0D10: set_actor USHER4_ANGIE alpha 255 // IF and SET

//create_thread @PED_BKP USHER4_ANGIE 371
//create_thread @ANT_PRE USHER4_ANGIE

actor.Health(USHER4_ANGIE) = 100

0D10: set_actor USHER4_ANGIE alpha 255 // IF and SET
09F4: set_actor USHER4_ANGIE ignore_height_difference_following_nodes $Z_IGNORE_HEIGHT 
Actor.SetWalkStyle(USHER4_ANGIE, "SURV1")
0446: set_actor USHER4_ANGIE dismemberment_possible 0
060B: set_actor USHER4_ANGIE decision_maker_to $DEC_PEOPLE
07DD: set_actor USHER4_ANGIE attack_rate 50 // previously known as temper_to
081A: set_actor USHER4_ANGIE weapon_skill_to 2  
060F: set_actor USHER4_ANGIE melee_accuracy_to 999.0
0946: set_actor USHER4_ANGIE actions_uninterupted_by_weapon_fire 1

if
UNITED_MAP == 0
then
04D8: set_actor USHER4_ANGIE drowns_in_water 0 
end

09B5: set_actor USHER4_ANGIE signal_after_kill 0  
0A96: 0@ = actor USHER4_ANGIE struct
0A8E: 0@ = 0@ + 1376
0A8C: write_memory 0@ size 4 value $SURVIVORS_ROTATE_SPEED virtual_protect 1

08AF: set_actor USHER4_ANGIE max_health_to 100
Actor.WeaponAccuracy(USHER4_ANGIE) = $SURV_ACCURACY

repeat
wait 0
until 056E:   car $USED_CAR[LATEST_CAR_SLOT_USED] defined

0430: put_actor USHER4_ANGIE into_car $USED_CAR[LATEST_CAR_SLOT_USED] passenger_seat 2

jump to @USHER4_INSTAJUMP_TO_AFTERFIGHT_PART
end    

$MUSIC_MISSION = Audiostream.Load("audio\sounds\music\usher_music\MISS4\theme1.mp3")
Audiostream.PerformAction($MUSIC_MISSION, PLAY)
Audiostream.Loop($MUSIC_MISSION, 1)
Audiostream.Volume($MUSIC_MISSION) = VERO_TIPA_VOLUME

/////////////////////Плавное нарастание/////////////////////
//
//$MUSIC_FADE_NUMBER += 1
//if
//$MUSIC_FADE_NUMBER > 4
//    then
//    $MUSIC_FADE_NUMBER = 0 
//    end    
//
//0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_MISSION // (int) 
//0086: $MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = $MUSIC_VOLUME // (float) 
//
//$MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 1000
//$MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 1  
//$MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
//create_thread @MUS_FAD
//
//wait 1 
250A: SET_AUDIO_STREAM_TYPE $MUSIC_MISSION type 2 
2504: SET_AUDIO_STREAM_VOLUME_WITH_TRANSITION $MUSIC_MISSION volume $MUSIC_VOLUME time 1000

////////////////////////////////////////////////////////

Text.ShowStyled('STB95', 3000, 2)
v$OBJECTIVE = "STRB10"

player.CanMove(PLAYER_CHAR,true)
camera.Restore_WithJumpCut()
fade 1 1000
create_thread @3D_REFR
$HUD_REMOVE = 0
wait 1000

32@ = 0        

MISSION_MARKER = marker.CreateAboveCar($USED_CAR[LATEST_CAR_SLOT_USED])
07E0: set_marker MISSION_MARKER type_to 1

//////////////////////////////////////////////////////////////////////////////////

repeat
wait 0

if
not actor.Dead(PLAYER_ACTOR)
jf @USHER4_FAILED_PLAYER_DIED
if and
$CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
not BASE_TEAMMATE_AGRED == 1
jf @USHER4_FAILED_AGRO
if
803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
jf @USHER4_FAILED_LDEAD
if
$SAVE_CAR_CREATED[LATEST_CAR_SLOT_USED] == 1
jf @USHER4_FAILED_CAR_WRECKED

if and
0E3E: is_button_just_pressed 0 button 17
$CHEATS_ON == 1
then
$END_DIALOG_INST = 1
wait 0
036A: put_actor PLAYER_ACTOR in_car $USED_CAR[LATEST_CAR_SLOT_USED]
camera.Restore_WithJumpCut() 
break
end

if
actor.InCar(PLAYER_ACTOR,$USED_CAR[LATEST_CAR_SLOT_USED])
    then
    break
    end

until false

v$OBJECTIVE = "STRB95"
marker.Disable(MISSION_MARKER)
018A: MISSION_CHECKPOINT = create_checkpoint_at 267.804291 -54.703377 2.777212
03BC: MISSION_SPHERE = create_sphere_at 267.804291 -54.703377 2.777212 radius 1.0

//////////////////////////////////////////////////////////////////////////////////

111@ = 0

repeat
wait 0

if
not actor.Dead(PLAYER_ACTOR)
jf @USHER4_FAILED_PLAYER_DIED
if and
$CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
not BASE_TEAMMATE_AGRED == 1
jf @USHER4_FAILED_AGRO
if
803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
jf @USHER4_FAILED_LDEAD
if
$SAVE_CAR_CREATED[LATEST_CAR_SLOT_USED] == 1
jf @USHER4_FAILED_CAR_WRECKED 

if and
0E3E: is_button_just_pressed 0 button 17
$CHEATS_ON == 1
then
actor.PutAtNoOffset(PLAYER_ACTOR,259.5947, -65.6069, 1.1567)
camera.Restore_WithJumpCut()
create_thread @3D_REFR
$END_DIALOG_INST = 1
wait 0
end          

///////////////////////////////////////////////////

if and
056E:   car $USED_CAR[LATEST_CAR_SLOT_USED] defined
not USHER4_VICTORIA_GOT_BACK_FLAG == 1
then
        
if
not car.Wrecked($USED_CAR[LATEST_CAR_SLOT_USED])
jf @USHER4_FAILED_CAR_WRECKED
        
if
not actor.InCar(PLAYER_ACTOR,$USED_CAR[LATEST_CAR_SLOT_USED])
    then
    03BD: destroy_sphere MISSION_SPHERE
    marker.Disable(MISSION_CHECKPOINT)         
    gosub @USHER4_GET_BACK_IN_CAR
    v$OBJECTIVE = "STRB95"        
    018A: MISSION_CHECKPOINT = create_checkpoint_at 267.804291 -54.703377 2.777212
    03BC: MISSION_SPHERE = create_sphere_at 267.804291 -54.703377 2.777212 radius 1.0    
    end
else
jump to @USHER4_FAILED_CAR_WRECKED
end
        
///////////////////////////////////////////////////

if
not actor.Dead(PLAYER_ACTOR)
jf @USHER4_FAILED_PLAYER_DIED
if and
$CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
not BASE_TEAMMATE_AGRED == 1
jf @USHER4_FAILED_AGRO
if
803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
jf @USHER4_FAILED_LDEAD
if
$SAVE_CAR_CREATED[LATEST_CAR_SLOT_USED] == 1
jf @USHER4_FAILED_CAR_WRECKED

if
0EEA: locate_char_distance_to_coordinates PLAYER_ACTOR pos 267.804291 -54.703377 2.777212 radius 30.0
    then            
    break
    end

until false

v$OBJECTIVE = "STRB96"
v$ST_DIALOG[0] = "STRY440"
$DIALOG_COUNT = 0
$DIALOG_NOT_SKIP = 1
create_thread @DG_SYS2

repeat
wait 0

if
not actor.Dead(PLAYER_ACTOR)
jf @USHER4_FAILED_PLAYER_DIED
if and
$CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
not BASE_TEAMMATE_AGRED == 1
jf @USHER4_FAILED_AGRO
if
803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
jf @USHER4_FAILED_LDEAD
if
$SAVE_CAR_CREATED[LATEST_CAR_SLOT_USED] == 1
jf @USHER4_FAILED_CAR_WRECKED

if and
0E3E: is_button_just_pressed 0 button 17
$CHEATS_ON == 1
then
0362: remove_actor PLAYER_ACTOR from_car_and_place_at 267.804291 -54.703377 2.777212
camera.Restore_WithJumpCut()
create_thread @3D_REFR
$END_DIALOG_INST = 1
wait 0
end

until 0EEA: locate_char_distance_to_coordinates PLAYER_ACTOR pos 267.804291 -54.703377 2.777212 radius 1.0

03BD: destroy_sphere MISSION_SPHERE
marker.Disable(MISSION_CHECKPOINT)

v$OBJECTIVE = "DUMMY"

player.CanMove(PLAYER_CHAR,false) 
fade 0 500
wait 500
$HUD_REMOVE = 1   
$SAVESTATUS = 1 
cinema.Widescreen(1)
BLACK_POLOSKI_ON = 1

if
$FP_ACTIVATED == 1
then
repeat
wait 0
until $FP_ACTIVATED == 0
end

actor.PutAtNoOffset(PLAYER_ACTOR,267.7281, -55.4161, 2.7772)
actor.Angle(PLAYER_ACTOR) = 0.8891
06AB: set_actor PLAYER_ACTOR all_weapons_hidden 1     

0936: set_camera 269.992462 -57.517986 3.291906 position_to 269.992462 -57.517986 3.291906 time 30000 smooth_transition 1
0920: point_camera 269.438751 -56.685337 3.282290 transverse_to 269.438751 -56.685337 3.282290 time 30000 smooth_transition 1

repeat
wait 0  
Animation.Load("MISC") 
until Animation.Available("MISC")

Animation.PerfromA(PLAYER_ACTOR, "bng_wndw_02", "MISC", 4.0, 0, 0, 0, 0, -1)

$SHIT_FUCK = Audiostream.Load("audio\sounds\music\usher_music\MISS4\knock.mp3")
Audiostream.Loop($SHIT_FUCK, 0)
Audiostream.Volume($SHIT_FUCK) = $SOUNDS_VOLUME

fade 1 500
wait 500

v$ST_DIALOG[0] = "STRY441"
v$ST_DIALOG[1] = "STRY442"
$DIALOG_COUNT = 1
create_thread @DG_SYS2

32@ = 0

repeat
wait 0
until 32@ >= 1600

Audiostream.PerformAction($SHIT_FUCK, PLAY)

32@ = 0

repeat
wait 0
until 32@ >= 1340

0687: clear_actor PLAYER_ACTOR task 

repeat
wait 0                 
until $DIALOG_END == 1

audiostream.Release($SHIT_FUCK)

$END_DIALOG_INST = 1
wait 0
v$ST_DIALOG[0] = "STRY443"
v$ST_DIALOG[1] = "STRY444"
v$ST_DIALOG[2] = "STRY445"
v$ST_DIALOG[3] = "STRY446"
$DIALOG_COUNT = 3
create_thread @DG_SYS2

repeat
wait 0                 
until $DIALOG_END == 1

fade 0 500
wait 500  
cinema.Widescreen(0)
BLACK_POLOSKI_ON = 0
06AB: set_actor PLAYER_ACTOR all_weapons_hidden 0 
0936: set_camera 269.992462 -57.517986 3.291906 position_to 269.992462 -57.517986 3.291906 time 1 smooth_transition 1
0920: point_camera 269.438751 -56.685337 3.282290 transverse_to 269.438751 -56.685337 3.282290 time 1 smooth_transition 1
wait 250
player.CanMove(PLAYER_CHAR,true)
camera.Restore_WithJumpCut() 
fade 1 500
$HUD_REMOVE = 0

v$OBJECTIVE = "STB96"

for 0@ = 0 to 19
if
09D1:   pickup $DROP_PICKUP[0@] created
    then
    pickup.Destroy($DROP_PICKUP[0@])
    end
end

USHER4_NEED_TO_RETURN_PICKUPS = 1
$WEAPON2 = -1

0459: end_thread_named 'PIC_GRB'

repeat
wait 0

if
SHOW_HINTS_FLAG == 1
then
if
0A4B:   controls_set_to_joystick
    then
    text.ShowH('HINT2B',10,1)
    else
    text.ShowH('HINT2',10,1)
    end
end

4@ = 0
for 0@ = 3 to 10
04B8: get_weapon_data_from_actor PLAYER_ACTOR slot 0@ weapon 1@ ammo 2@ model 3@
if
not 3@ == -1
    then
    0E7F: get_model_type 3@ store_to 5@
    if and
    5@ == 4
    not 2@ == 0
        then
        4@ += 1
        end
    end
end

until 4@ == 0

v$OBJECTIVE = "DUMMY"

$END_DIALOG_INST = 1
wait 0
v$ST_DIALOG[0] = "STR447"
v$ST_DIALOG[1] = "STR448"
v$ST_DIALOG[2] = "STR449"
v$ST_DIALOG[3] = "STR450" 
$DIALOG_COUNT = 3
create_thread @DG_SYS2

repeat
wait 0                 
until $DIALOG_END == 1 

player.CanMove(PLAYER_CHAR,false)
fade 0 500
$HUD_REMOVE = 1
wait 500

gosub @UMUSIC_MISSION4_OFF

create_thread @PIC_GRB
   
$SAVESTATUS = 1 
cinema.Widescreen(1)
BLACK_POLOSKI_ON = 1

if
$FP_ACTIVATED == 1
then
repeat
wait 0
until $FP_ACTIVATED == 0
end

0776: create_objects_in_object_group "marjlam0"
select_interior 1
0860: link_actor PLAYER_ACTOR to_interior 1
04F9: set_sky_color 1 fade 0 

actor.PutAtNoOffset(PLAYER_ACTOR,263.326935, -67.732323, -2.976563)
actor.Angle(PLAYER_ACTOR) = 351.947021
06AB: set_actor PLAYER_ACTOR all_weapons_hidden 1     

////////////////////////////////////////////////////////////////////////////////////////////////////////////

while not model.Available(1198)
wait 0
model.Load(1198)
mload
end

USHER4_MARJORI = actor.Create(26,1198,264.051178, -65.764496, -3.976563)
actor.Angle(USHER4_MARJORI) = 157.378189
0860: link_actor USHER4_MARJORI to_interior 1
     
0D10: set_actor USHER4_MARJORI alpha 255 // IF and SET
    
//create_thread @PED_BKP USHER4_MARJORI 371
//create_thread @ANT_PRE USHER4_MARJORI

actor.Health(USHER4_MARJORI) = 1000

0D10: set_actor USHER4_MARJORI alpha 255 // IF and SET
09F4: set_actor USHER4_MARJORI ignore_height_difference_following_nodes $Z_IGNORE_HEIGHT     
Actor.SetWalkStyle(USHER4_MARJORI, "SURV1")
0446: set_actor USHER4_MARJORI dismemberment_possible 0
060B: set_actor USHER4_MARJORI decision_maker_to $DEC_PEOPLE
07DD: set_actor USHER4_MARJORI attack_rate 50 // previously known as temper_to
081A: set_actor USHER4_MARJORI weapon_skill_to 2  
060F: set_actor USHER4_MARJORI melee_accuracy_to 999.0
0946: set_actor USHER4_MARJORI actions_uninterupted_by_weapon_fire 1

if
UNITED_MAP == 0
then
04D8: set_actor USHER4_MARJORI drowns_in_water 0 
end

09B5: set_actor USHER4_MARJORI signal_after_kill 0  
0A96: 0@ = actor USHER4_MARJORI struct
0A8E: 0@ = 0@ + 1376
0A8C: write_memory 0@ size 4 value $SURVIVORS_ROTATE_SPEED virtual_protect 1

08AF: set_actor USHER4_MARJORI max_health_to $SURVIVER_MAX_HEALTH
Actor.WeaponAccuracy(USHER4_MARJORI) = $SURV_ACCURACY

////////////////////////////////////////////////////////////////////////////////////////////////////////////

while not animation.Available("CAR_CHECKS")
wait 0 
animation.Load("CAR_CHECKS")
end

////////////////////////////////////////////////////////////////////////////////////////////////////////////

camera.SetPosition(261.716461 -62.317623 -1.467999,0.0,0.0,0.0)
camera.PointAt(262.201935 -63.161938 -1.694796,2)

//jump to @USHSER4_INSTAJUMP_TO_NIGHTMARE_PART

fade 1 500 

$END_DIALOG_INST = 1
wait 0

v$ST_DIALOG[0] = "STRY447"
v$ST_DIALOG[1] = "STRY448"
0084: $DIALOG_ACTOR[0] = USHER4_MARJORI // (int)
$DIALOG_ACTOR[1] = -69
$DIALOG_COUNT = 1
create_thread @DG_SYS

$MUSIC_MISSION = Audiostream.Load("audio\sounds\music\usher_music\MISS4\theme2.mp3")
Audiostream.PerformAction($MUSIC_MISSION, PLAY)
Audiostream.Loop($MUSIC_MISSION, 1)
Audiostream.Volume($MUSIC_MISSION) = VERO_TIPA_VOLUME

/////////////////////Плавное нарастание/////////////////////
//
//$MUSIC_FADE_NUMBER += 1
//if
//$MUSIC_FADE_NUMBER > 4
//    then
//    $MUSIC_FADE_NUMBER = 0 
//    end    
//
//0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_MISSION // (int) 
//0086: $MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = $MUSIC_VOLUME // (float) 
//
//$MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 1000
//$MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 1  
//$MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
//create_thread @MUS_FAD
//
//wait 1 
250A: SET_AUDIO_STREAM_TYPE $MUSIC_MISSION type 2 
2504: SET_AUDIO_STREAM_VOLUME_WITH_TRANSITION $MUSIC_MISSION volume $MUSIC_VOLUME time 1000

////////////////////////////////////////////////////////

0@ = 0

repeat
wait 0

if and
0@ == 0
$DIALOG_CURRENT_INT == 1
    then
    0@ = 1
    
    05BF: AS_actor USHER4_MARJORI look_at_actor PLAYER_ACTOR 1170 ms
    05BF: AS_actor PLAYER_ACTOR look_at_actor USHER4_MARJORI 1170 ms
    0605: actor PLAYER_ACTOR perform_animation "habargive" IFP "CAMERA" framedelta 4.0 loop 0 lockX 0 lockY 0 lockF 0 time -1
    wait 585    
    PLAYER_DONT_HAVE_BACKPACK = 1
    0605: actor USHER4_MARJORI perform_animation "habargive" IFP "CAMERA" framedelta 4.0 loop 0 lockX 0 lockY 0 lockF 0 time -1
    wait 585
    PLAYER_DONT_HAVE_BACKPACK = 0    
    Audiostream.Volume($DROP_ITEM_SOUND) = $SOUNDS_VOLUME 
    Audiostream.Loop($DROP_ITEM_SOUND, 0)
    Audiostream.PerformAction($DROP_ITEM_SOUND, PLAY)   
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY449"
    $DIALOG_COUNT = 0
    create_thread @DG_SYS2
     
    0605: actor USHER4_MARJORI perform_animation "car_check" IFP "CAR_CHECKS" framedelta 4.0 loop 0 lockX 0 lockY 0 lockF 0 time 2839 
    Audiostream.LinkToActor($CAR_SEARCH_COOP_SOUND,COOP_ACTOR)
    Audiostream.Volume($CAR_SEARCH_COOP_SOUND) = $SOUNDS_VOLUME 
    Audiostream.Loop($CAR_SEARCH_COOP_SOUND, 0)
    Audiostream.PerformAction($CAR_SEARCH_COOP_SOUND, PLAY)
    wait 2839
    
    repeat
    wait 0
    until $DIALOG_END == 1
    
    0781: get_weapon_with_ID 71 model_to 1@

    while not model.Available(1@)
    wait 0
    model.Load(1@)
    mload
    end
    
    actor.GiveWeaponAndAmmo(USHER4_MARJORI,71,99999)
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY450"
    v$ST_DIALOG[1] = "STRY451"
    v$ST_DIALOG[2] = "STRY452"
    $DIALOG_COUNT = 2
    create_thread @DG_SYS2
    
    0667: AS_actor USHER4_MARJORI aim_at 267.484650 -66.702896 -3.215311 3000 ms
    wait 500
    05C4: AS_actor PLAYER_ACTOR hands_up 9999999 ms
    
    32@ = 0
    0@ = 0
    
    repeat
    wait 0
    
    if and
    32@ > 2500
    0@ == 0
        then
        0A1D: AS_actor USHER4_MARJORI rotate_to_and_look_at_actor PLAYER_ACTOR
        0@ = 1 
        end
    
    until $DIALOG_END == 1
    
    0687: clear_actor USHER4_MARJORI task
    wait 1000        
    06AB: set_actor USHER4_MARJORI all_weapons_hidden 1
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STR452"
    v$ST_DIALOG[1] = "STR453"
    v$ST_DIALOG[2] = "STR454"
    v$ST_DIALOG[3] = "STR455"
    v$ST_DIALOG[4] = "STR456"
    v$ST_DIALOG[5] = "STRY453"
    v$ST_DIALOG[6] = "STR457"
    0084: $DIALOG_ACTOR[0] = USHER4_MARJORI // (int)
    $DIALOG_ACTOR[1] = -69
    0084: $DIALOG_ACTOR[2] = USHER4_MARJORI // (int)
    $DIALOG_ACTOR[3] = -69
    0084: $DIALOG_ACTOR[4] = USHER4_MARJORI // (int)
    $DIALOG_ACTOR[5] = -69
    0084: $DIALOG_ACTOR[6] = USHER4_MARJORI // (int)    
    $DIALOG_COUNT = 6
    create_thread @DG_SYS
    
    repeat
    wait 0
    until $DIALOG_END == 1
    
    0687: clear_actor PLAYER_ACTOR task
    
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////

    while not model.Available(1199)
    wait 0
    model.Load(1199)
    mload
    end
    
    USHER4_ANGIE = actor.Create(26,1199,263.279907, -60.739471, -2.976563)
    actor.Angle(USHER4_ANGIE) = 176.604584
    0860: link_actor USHER4_ANGIE to_interior 1
         
    0D10: set_actor USHER4_ANGIE alpha 255 // IF and SET
        
    //create_thread @PED_BKP USHER4_ANGIE 371
    //create_thread @ANT_PRE USHER4_ANGIE
    
    actor.Health(USHER4_ANGIE) = 1000
    
    0D10: set_actor USHER4_ANGIE alpha 255 // IF and SET
    09F4: set_actor USHER4_ANGIE ignore_height_difference_following_nodes $Z_IGNORE_HEIGHT     
    Actor.SetWalkStyle(USHER4_ANGIE, "SURV1")
    0446: set_actor USHER4_ANGIE dismemberment_possible 0
    060B: set_actor USHER4_ANGIE decision_maker_to $DEC_PEOPLE
    07DD: set_actor USHER4_ANGIE attack_rate 50 // previously known as temper_to
    081A: set_actor USHER4_ANGIE weapon_skill_to 2  
    060F: set_actor USHER4_ANGIE melee_accuracy_to 999.0
    0946: set_actor USHER4_ANGIE actions_uninterupted_by_weapon_fire 1
    
    if
    UNITED_MAP == 0
    then
    04D8: set_actor USHER4_ANGIE drowns_in_water 0 
    end
    
    09B5: set_actor USHER4_ANGIE signal_after_kill 0  
    0A96: 0@ = actor USHER4_ANGIE struct
    0A8E: 0@ = 0@ + 1376
    0A8C: write_memory 0@ size 4 value $SURVIVORS_ROTATE_SPEED virtual_protect 1
    
    08AF: set_actor USHER4_ANGIE max_health_to $SURVIVER_MAX_HEALTH
    Actor.WeaponAccuracy(USHER4_ANGIE) = $SURV_ACCURACY
    
    0615: define_AS_pack_begin 0@
    05D3: AS_actor -1 goto_point 262.479462 -65.457489 -2.976563 mode 4 time 10000 ms // versionA
    05D4: AS_actor -1 rotate_angle 194.423935
    0616: define_AS_pack_end 0@
    0618: assign_actor USHER4_ANGIE to_AS_pack 0@
    061B: remove_references_to_AS_pack 0@
    
    05BF: AS_actor PLAYER_ACTOR look_at_actor USHER4_ANGIE 30000 ms
    
    repeat
    wait 0
    
    if
    0E45: frame_mod 5
        then
        0A1D: AS_actor USHER4_MARJORI rotate_to_and_look_at_actor USHER4_ANGIE
        end
    
    until 02A0:   actor USHER4_ANGIE stopped
    
    0A1D: AS_actor USHER4_MARJORI rotate_to_and_look_at_actor PLAYER_ACTOR
    0A1D: AS_actor USHER4_ANGIE rotate_to_and_look_at_actor PLAYER_ACTOR
    wait 500
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY454"
    v$ST_DIALOG[1] = "STRY455"
    v$ST_DIALOG[2] = "STRY456"
    v$ST_DIALOG[3] = "STRY457"
    v$ST_DIALOG[4] = "STRY458"
    v$ST_DIALOG[5] = "STRY459"
    v$ST_DIALOG[6] = "STRY460"
    0084: $DIALOG_ACTOR[0] = USHER4_MARJORI // (int)
    0084: $DIALOG_ACTOR[0] = USHER4_MARJORI // (int)
    0084: $DIALOG_ACTOR[2] = USHER4_ANGIE // (int)
    0084: $DIALOG_ACTOR[3] = PLAYER_ACTOR // (int)
    0084: $DIALOG_ACTOR[4] = USHER4_MARJORI // (int)
    0084: $DIALOG_ACTOR[5] = PLAYER_ACTOR // (int)
    0084: $DIALOG_ACTOR[6] = USHER4_MARJORI // (int)
    $DIALOG_COUNT = 6
    create_thread @DG_SYS
    
    repeat
    wait 0
    until $DIALOG_END == 1
    
    //camera.OnPed(USHER4_MARJORI,15,1)
    camera.SetPosition(264.782227 -56.004101 -2.420271,0.0,0.0,0.0)
    camera.PointAt(265.614929 -56.555889 -2.466307,1)
    0460: set_camera_transverse_delay 1.0 time 10000
    
    0615: define_AS_pack_begin 0@
    05D3: AS_actor -1 goto_point 263.319122 -59.919319 -2.976563 mode 4 time 10000 ms // versionA
    05D3: AS_actor -1 goto_point 268.015594 -57.497597 -2.976563 mode 4 time 10000 ms // versionA
    05D4: AS_actor -1 rotate_angle 274.951538
    0605: actor -1 perform_animation "car_check" IFP "CAR_CHECKS" framedelta 4.0 loop 0 lockX 0 lockY 0 lockF 0 time 2839
    0616: define_AS_pack_end 0@
    0618: assign_actor USHER4_MARJORI to_AS_pack 0@
    061B: remove_references_to_AS_pack 0@
    
    0A1D: AS_actor USHER4_ANGIE rotate_to_and_look_at_actor USHER4_MARJORI
    wait 1000
    0850: AS_actor USHER4_ANGIE follow_actor USHER4_MARJORI     
    
    0615: define_AS_pack_begin 0@
    05D3: AS_actor -1 goto_point 263.403290 -55.443954 -2.976563 mode 4 time 10000 ms // versionA
    05D4: AS_actor -1 rotate_angle 7.572805
    0616: define_AS_pack_end 0@
    0618: assign_actor PLAYER_ACTOR to_AS_pack 0@
    061B: remove_references_to_AS_pack 0@
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STR460"
    v$ST_DIALOG[1] = "STRY461"
    $DIALOG_COUNT = 1
    create_thread @DG_SYS2
    wait 1000
    
    repeat
    wait 0     
    
    if and
    02A0:   actor USHER4_ANGIE stopped
    02A0:   actor USHER4_MARJORI stopped
    02A0:   actor PLAYER_ACTOR stopped
        then
        break
        end
       
    until false
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY462"
    v$ST_DIALOG[1] = "STRY463"
    $DIALOG_COUNT = 1
    create_thread @DG_SYS2
    
    repeat
    wait 0
    until $DIALOG_END == 1
                 
    fade 0 250
    wait 250
    
    0E32: set_char_coordinates_simple PLAYER_ACTOR coord 262.790649 -55.233051 -2.976563
    actor.Angle(PLAYER_ACTOR) = 359.550262
    0E32: set_char_coordinates_simple USHER4_MARJORI coord 262.776825 -53.158024 -2.976563
    actor.Angle(USHER4_MARJORI) = 177.553497
    0E32: set_char_coordinates_simple USHER4_ANGIE coord 264.0896 -53.4041 -2.5711
    actor.Angle(USHER4_ANGIE) = 180.0
    
    06B0: AS_actor PLAYER_ACTOR sit_down 990000 ms
    06B0: AS_actor USHER4_MARJORI sit_down 990000 ms
    06B0: AS_actor USHER4_ANGIE sit_down 990000 ms    
    
    camera.SetPosition(259.852173 -54.217064 -2.781872,0.0,0.0,0.0)
    camera.PointAt(260.851715 -54.203178 -2.809056,2)        
    
    fade 1 500
    
    camera.SetPosition(267.923584 -57.162281 -2.500349,0.0,0.0,0.0)
    camera.PointAt(268.835052 -57.349518 -2.866631,1)
    0460: set_camera_transverse_delay 1.0 time 3000
    wait 1000               

    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY464"
    v$ST_DIALOG[1] = "STRY465"
    0084: $DIALOG_ACTOR[0] = PLAYER_ACTOR // (int)
    0084: $DIALOG_ACTOR[1] = USHER4_MARJORI // (int)
    $DIALOG_COUNT = 1
    $DIALOG_NOT_ANIMS_FLAG = 1
    create_thread @DG_SYS
    
    repeat
    wait 0
    until $DIALOG_END == 1 
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY468"
    v$ST_DIALOG[1] = "STRY469"
    v$ST_DIALOG[2] = "STRY470"
    v$ST_DIALOG[3] = "STRY471"
    v$ST_DIALOG[4] = "STRY472"
    0084: $DIALOG_ACTOR[0] = USHER4_MARJORI // (int)
    0084: $DIALOG_ACTOR[1] = PLAYER_ACTOR // (int)
    0084: $DIALOG_ACTOR[2] = USHER4_MARJORI // (int)
    0084: $DIALOG_ACTOR[3] = PLAYER_ACTOR // (int)
    0084: $DIALOG_ACTOR[4] = USHER4_MARJORI // (int)
    $DIALOG_COUNT = 4
    $DIALOG_NOT_ANIMS_FLAG = 1
    create_thread @DG_SYS
    
    camera.SetPosition(260.329437 -57.428570 -2.379540,0.0,0.0,0.0)
    camera.PointAt(261.011200 -56.705364 -2.489898,1)
    0460: set_camera_transverse_delay 1.0 time 3000
    
    repeat
    wait 0
    until $DIALOG_END == 1
    
    camera.SetPosition(266.552429 -53.525581 -2.985087,0.0,0.0,0.0)
    camera.PointAt(267.055939 -52.729630 -3.321142,1)
    0460: set_camera_transverse_delay 1.0 time 3000
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY473"
    v$ST_DIALOG[1] = "STRY474"
    0084: $DIALOG_ACTOR[0] = PLAYER_ACTOR // (int)
    0084: $DIALOG_ACTOR[1] = PLAYER_ACTOR // (int)
    $DIALOG_COUNT = 1
    $DIALOG_NOT_ANIMS_FLAG = 1
    create_thread @DG_SYS
    
    repeat
    wait 0
    until $DIALOG_END == 1
    
    camera.SetPosition(262.797058 -55.470566 -2.619069,0.0,0.0,0.0)
    camera.PointAt(262.786194 -54.472607 -2.681971,1)
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY475"
    v$ST_DIALOG[1] = "STR475"
    0084: $DIALOG_ACTOR[0] = PLAYER_ACTOR // (int)
    0084: $DIALOG_ACTOR[1] = PLAYER_ACTOR // (int)
    $DIALOG_COUNT = 1
    $DIALOG_NOT_ANIMS_FLAG = 1
    create_thread @DG_SYS      
    
    0@ = 0
    
    repeat
    wait 0    
    
    if
    0@ < 25
    then
    0@ += 1
    player.SetDrunkVisuals(0,0@)
    end
    
    until $DIALOG_END == 1 
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY476"
    v$ST_DIALOG[1] = "STRY477"
    v$ST_DIALOG[2] = "STRY478"
    v$ST_DIALOG[3] = "STR478"
    v$ST_DIALOG[4] = "STRY479"
    v$ST_DIALOG[5] = "STRY480"
    v$ST_DIALOG[6] = "STRY481"
    0084: $DIALOG_ACTOR[0] = PLAYER_ACTOR // (int)
    0084: $DIALOG_ACTOR[1] = USHER4_MARJORI // (int)
    0084: $DIALOG_ACTOR[2] = PLAYER_ACTOR // (int)
    0084: $DIALOG_ACTOR[3] = PLAYER_ACTOR // (int)
    0084: $DIALOG_ACTOR[4] = USHER4_MARJORI // (int)
    0084: $DIALOG_ACTOR[5] = USHER4_MARJORI // (int)
    0084: $DIALOG_ACTOR[6] = USHER4_ANGIE // (int)
    $DIALOG_COUNT = 6
    $DIALOG_NOT_ANIMS_FLAG = 1
    create_thread @DG_SYS
    
    repeat
    wait 0
    until $DIALOG_END == 1 
    
    0687: clear_actor USHER4_ANGIE task
    0615: define_AS_pack_begin 0@
    07CD: AS_actor -1 walk_to 271.067505 -55.965252 -2.969053 stop_with_angle 245.015045 within_radius 1.0
    07CD: AS_actor -1 walk_to 270.762390 -59.347885 -2.859715 stop_with_angle 180.187698 within_radius 1.0
    0616: define_AS_pack_end 0@
    0618: assign_actor USHER4_ANGIE to_AS_pack 0@
    061B: remove_references_to_AS_pack 0@ 
    
    repeat
    wait 0
    until 02A0:   actor USHER4_ANGIE stopped
    
    $SHIT_FUCK = Audiostream.Load3d("audio\sounds\music\usher_music\MISS4\shelf_sound.mp3")
    Audiostream.SetPosition($SHIT_FUCK,270.762390, -59.347885, -2.859715) //ZXY (old, XYZ new)
    Audiostream.Loop($SHIT_FUCK, 0)
    Audiostream.Volume($SHIT_FUCK) = $SOUNDS_VOLUME
    Audiostream.PerformAction($SHIT_FUCK,PLAY)
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY482"
    v$ST_DIALOG[1] = "STRY483"
    v$ST_DIALOG[2] = "STRY484"
    v$ST_DIALOG[3] = "STRY485"
    v$ST_DIALOG[4] = "STRY486"
    v$ST_DIALOG[5] = "STRY487"
    0084: $DIALOG_ACTOR[0] = USHER4_MARJORI // (int)
    0084: $DIALOG_ACTOR[1] = PLAYER_ACTOR // (int)
    0084: $DIALOG_ACTOR[2] = USHER4_MARJORI // (int)
    0084: $DIALOG_ACTOR[3] = USHER4_MARJORI // (int)
    0084: $DIALOG_ACTOR[4] = USHER4_MARJORI // (int)
    0084: $DIALOG_ACTOR[5] = PLAYER_ACTOR // (int)
    $DIALOG_COUNT = 5
    $DIALOG_NOT_ANIMS_FLAG = 1
    create_thread @DG_SYS
    
    0@ = 24
    
    repeat
    wait 0    
    
    TEMPVAR_INT = 5
    008D: TEMPVAR_INT = integer TEMPVAR_INT to_float
    0069: TEMPVAR_INT *= GENERAL_FPS_TIMER_DIVIDER2 // (float)
    008C: TEMPVAR_INT = float TEMPVAR_INT to_integer
    if and
    0@ < 75
    0E45: frame_mod TEMPVAR_INT
    then
    0@ += 1
    player.SetDrunkVisuals(0,0@)
    end
    
    until $DIALOG_END == 1     
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY488"
    v$ST_DIALOG[1] = "STRY489"
    v$ST_DIALOG[2] = "STR489"
    v$ST_DIALOG[3] = "STR490"
    v$ST_DIALOG[4] = "STRY490"
    0084: $DIALOG_ACTOR[0] = USHER4_MARJORI // (int)
    0084: $DIALOG_ACTOR[1] = USHER4_MARJORI // (int)
    0084: $DIALOG_ACTOR[2] = USHER4_MARJORI // (int)
    0084: $DIALOG_ACTOR[3] = USHER4_MARJORI // (int)
    0084: $DIALOG_ACTOR[4] = USHER4_MARJORI // (int)
    $DIALOG_COUNT = 4
    $DIALOG_NOT_ANIMS_FLAG = 1
    create_thread @DG_SYS 
    
    0@ = 74
    
    repeat
    wait 0    
    
    TEMPVAR_INT = 5
    008D: TEMPVAR_INT = integer TEMPVAR_INT to_float
    0069: TEMPVAR_INT *= GENERAL_FPS_TIMER_DIVIDER2 // (float)
    008C: TEMPVAR_INT = float TEMPVAR_INT to_integer
    if and
    0@ < 125
    0E45: frame_mod TEMPVAR_INT
    then
    0@ += 1
    player.SetDrunkVisuals(0,0@)
    end
    
    until $DIALOG_END == 1 
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY491"
    $DIALOG_COUNT = 0
    create_thread @DG_SYS2
    
    0169: set_fade_color_RGB 255 0 0
    
    /////////////////////Плавное затухание/////////////////////
//
//    $MUSIC_FADE_NUMBER += 1
//    if
//    $MUSIC_FADE_NUMBER > 4
//        then
//        $MUSIC_FADE_NUMBER = 0 
//        end    
//            
//    0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_MISSION // (int)
//    $MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = 0.0
//            
//    $MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 2000
//    $MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 0  
//    $MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
//    create_thread @MUS_FAD
//    
    /////////////////////////////////////////////////////////
    2504: SET_AUDIO_STREAM_VOLUME_WITH_TRANSITION $MUSIC_MISSION volume 0.0 time 2000
    wait 2000
    audiostream.Release($MUSIC_MISSION)
    
    camera.PointAt(262.786194 -54.472607 -3.681971,1)
    0460: set_camera_transverse_delay 0.0 time 2000
    
    fade 0 2000
    wait 2000
    
    audiostream.Release($SHIT_FUCK)
    $SHIT_FUCK = Audiostream.Load("audio\sounds\music\usher_music\MISS4\tableface.mp3")
    Audiostream.Loop($SHIT_FUCK, 0)
    Audiostream.Volume($SHIT_FUCK) = $SOUNDS_VOLUME
    Audiostream.PerformAction($SHIT_FUCK,PLAY)
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY492"
    v$ST_DIALOG[1] = "STRY493"
    v$ST_DIALOG[2] = "STRY494"
    $DIALOG_COUNT = 2
    create_thread @DG_SYS2
    
    repeat
    wait 0
    0924: enable_screen_darkness 1 with_value 255
    fade 1 1
    until $DIALOG_END == 1
    
    actor.DestroyInstantly(USHER4_MARJORI)
    actor.DestroyInstantly(USHER4_ANGIE)
    player.SetDrunkVisuals(0,0)
    
    0777: delete_objects_in_object_group "marjlam0"
    
    0A8C: write_memory 0x0C402C6 size 1 value 1 virtual_protect 0
    0A8C: write_memory 0x07042A9 size 1 value 64 virtual_protect 0
    0A8C: write_memory 0x0704348 size 1 value 64 virtual_protect 0
    0AC6: 1@ = label @CFOG_R offset
    0AC6: 2@ = label @CFOG_G offset
    0AC6: 3@ = label @CFOG_B offset
    0A8C: write_memory 1@ size 1 value 255 virtual_protect 0
    0A8C: write_memory 2@ size 1 value 0 virtual_protect 0
    0A8C: write_memory 3@ size 1 value 0 virtual_protect 0
    
    :USHSER4_INSTAJUMP_TO_NIGHTMARE_PART
    
    0924: enable_screen_darkness 1 with_value 255
    fade 0 0
    wait 500
    0924: enable_screen_darkness 0 with_value -1         
    
    audiostream.Release($SHIT_FUCK)
    $SHIT_FUCK = Audiostream.Load("audio\sounds\music\usher_music\MISS4\open_keys.mp3")
    Audiostream.Loop($SHIT_FUCK, 0)
    Audiostream.Volume($SHIT_FUCK) = $SOUNDS_VOLUME
    Audiostream.PerformAction($SHIT_FUCK,PLAY) 
    
    0792: disembark_instantly_actor PLAYER_ACTOR
    
    $HUD_REMOVE = 1   
    $SAVESTATUS = 1 
    cinema.Widescreen(1)
    BLACK_POLOSKI_ON = 1
    
    if
    $FP_ACTIVATED == 1
    then
    repeat
    wait 0
    until $FP_ACTIVATED == 0
    end
    
    0776: create_objects_in_object_group "marjo1"
    select_interior 1
    0860: link_actor PLAYER_ACTOR to_interior 1
    04F9: set_sky_color 1 fade 0 
    
    actor.PutAtNoOffset(PLAYER_ACTOR,268.269226, -60.280903, 1042.000000)
    actor.Angle(PLAYER_ACTOR) = 10.078126
    
    if
    USHER4_MISS_CHECKPOINT_NUM == 1
    then
    jump to @USHSER4_INSTAJUMP_TO_NIGHTMARE_PART2
    end
    
    $MUSIC_MISSION = Audiostream.Load("audio\sounds\music\usher_music\MISS4\theme3.mp3")
    Audiostream.PerformAction($MUSIC_MISSION, PLAY)
    Audiostream.Loop($MUSIC_MISSION, 1)
    Audiostream.Volume($MUSIC_MISSION) = VERO_TIPA_VOLUME
    
    /////////////////////Плавное нарастание/////////////////////
//    
//    $MUSIC_FADE_NUMBER += 1
//    if
//    $MUSIC_FADE_NUMBER > 4
//        then
//        $MUSIC_FADE_NUMBER = 0 
//        end    
//    
//    0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_MISSION // (int) 
//    0086: $MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = $MUSIC_VOLUME // (float) 
//    
//    $MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 1000
//    $MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 1  
//    $MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
//    create_thread @MUS_FAD
//    
//    wait 1 
    250A: SET_AUDIO_STREAM_TYPE $MUSIC_MISSION type 2 
    2504: SET_AUDIO_STREAM_VOLUME_WITH_TRANSITION $MUSIC_MISSION volume $MUSIC_VOLUME time 1000
    
    ////////////////////////////////////////////////////////
    
    camera.SetPosition(242.318695 -72.812225 1105.429321,0.0,0.0,0.0)
    camera.PointAt(242.272507 -71.837128 1105.212402,2)
    
    fade 1 2000
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY495"
    $DIALOG_COUNT = 0
    create_thread @DG_SYS2
    
    repeat
    wait 0
    until $DIALOG_END == 1              
    
    ////////////////////////////////////////////////////////
    
    camera.SetPosition(257.617676 -47.350567 1106.292114,0.0,0.0,0.0)
    camera.PointAt(257.815521 -46.370701 1106.318970,1)    
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STR495"
    $DIALOG_COUNT = 0
    create_thread @DG_SYS2
    
    repeat
    wait 0
    until $DIALOG_END == 1
    
    ////////////////////////////////////////////////////////
    
    camera.SetPosition(238.456055 -50.107491 1106.376343,0.0,0.0,0.0)
    camera.PointAt(238.366272 -49.113194 1106.318726,1)    
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY496"
    $DIALOG_COUNT = 0
    create_thread @DG_SYS2
    
    repeat
    wait 0
    until $DIALOG_END == 1
    
    ////////////////////////////////////////////////////////
    
    camera.SetPosition(294.063934 -38.580402 1099.981567,0.0,0.0,0.0)
    camera.PointAt(293.965576 -39.569973 1099.876343,1)    
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY497"
    $DIALOG_COUNT = 0
    create_thread @DG_SYS2
    
    repeat
    wait 0
    until $DIALOG_END == 1
    
    ////////////////////////////////////////////////////////
    
    camera.SetPosition(286.762146 -75.813507 1107.513672,0.0,0.0,0.0)
    camera.PointAt(286.162750 -75.032875 1107.336548,1)    
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY498"
    v$ST_DIALOG[1] = "STRY499"
    $DIALOG_COUNT = 1
    create_thread @DG_SYS2
    
    repeat
    wait 0
    until $DIALOG_END == 1
    
    ////////////////////////////////////////////////////////
    
    /////////////////////Плавное затухание/////////////////////
//
//    $MUSIC_FADE_NUMBER += 1
//    if
//    $MUSIC_FADE_NUMBER > 4
//        then
//        $MUSIC_FADE_NUMBER = 0 
//        end    
//            
//    0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_MISSION // (int)
//    $MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = 0.0
//            
//    $MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 250
//    $MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 0  
//    $MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
//    create_thread @MUS_FAD
//    
    /////////////////////////////////////////////////////////
//    
//    while true
//    wait 0
//    $END_FADING_MUSIC_FAST = 1
//    
//    if and
//    $MUSIC_FADE_ENDED[0] == 1
//    $MUSIC_FADE_ENDED[1] == 1
//    $MUSIC_FADE_ENDED[2] == 1
//    $MUSIC_FADE_ENDED[3] == 1
//    $MUSIC_FADE_ENDED[4] == 1
//    then
//    $END_FADING_MUSIC_FAST = 0
//    break
//    end
//    
//    end
    2504: SET_AUDIO_STREAM_VOLUME_WITH_TRANSITION $MUSIC_MISSION volume 0.0 time 250
    wait 250
    audiostream.Release($MUSIC_MISSION)
    
    $MUSIC_MISSION = Audiostream.Load("audio\sounds\music\usher_music\MISS4\theme4.mp3")
    Audiostream.PerformAction($MUSIC_MISSION, PLAY)
    Audiostream.Loop($MUSIC_MISSION, 1)
    Audiostream.Volume($MUSIC_MISSION) = VERO_TIPA_VOLUME
    
    /////////////////////Плавное нарастание/////////////////////
//    
//    $MUSIC_FADE_NUMBER += 1
//    if
//    $MUSIC_FADE_NUMBER > 4
//        then
//        $MUSIC_FADE_NUMBER = 0 
//        end    
//    
//    0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_MISSION // (int) 
//    0086: $MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = $MUSIC_VOLUME // (float) 
//    
//    $MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 1000
//    $MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 1  
//    $MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
//    create_thread @MUS_FAD
//    
//    wait 1 
    250A: SET_AUDIO_STREAM_TYPE $MUSIC_MISSION type 2 
    2504: SET_AUDIO_STREAM_VOLUME_WITH_TRANSITION $MUSIC_MISSION volume $MUSIC_VOLUME time 1000
    
    ////////////////////////////////////////////////////////
    
    camera.SetPosition(322.950043 -64.959892 1113.072388,0.0,0.0,0.0)
    camera.PointAt(321.977631 -64.875114 1112.855103,2)    
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY500"
    v$ST_DIALOG[1] = "STRY501"
    v$ST_DIALOG[2] = "STRY502"
    $DIALOG_COUNT = 2
    create_thread @DG_SYS2
    
    repeat
    wait 0
    until $DIALOG_END == 1 
    
    ////////////////////////////////////////////////////////
    
    camera.SetPosition(274.014954 -47.288391 1107.547363,0.0,0.0,0.0)
    camera.PointAt(273.607391 -46.376816 1107.493408,1)    
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY503"
    $DIALOG_COUNT = 0
    create_thread @DG_SYS2
    
    repeat
    wait 0
    until $DIALOG_END == 1
    
    ////////////////////////////////////////////////////////
    
    camera.SetPosition(238.900391 -37.968987 1108.780518,0.0,0.0,0.0)
    camera.PointAt(238.178558 -37.277637 1108.749146,1)    
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STR503"
    $DIALOG_COUNT = 0
    create_thread @DG_SYS2
    
    repeat
    wait 0
    until $DIALOG_END == 1
    
    ///////////////////////////////////////////////////////////
    
    /////////////////////Плавное затухание/////////////////////
//
//    $MUSIC_FADE_NUMBER += 1
//    if
//    $MUSIC_FADE_NUMBER > 4
//        then
//        $MUSIC_FADE_NUMBER = 0 
//        end    
//            
//    0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_MISSION // (int)
//    $MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = 0.0
//            
//    $MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 2000
//    $MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 0  
//    $MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
//    create_thread @MUS_FAD
    2504: SET_AUDIO_STREAM_VOLUME_WITH_TRANSITION $MUSIC_MISSION volume 0.0 time 2000    
    
    ///////////////////////////////////////////////////////////
    
    fade 0 2000
    wait 2000
    audiostream.Release($MUSIC_MISSION)    
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY504"
    $DIALOG_COUNT = 0
    create_thread @DG_SYS2
    
    repeat
    wait 0
    0924: enable_screen_darkness 1 with_value 255
    fade 1 1
    until $DIALOG_END == 1
    
    0924: enable_screen_darkness 1 with_value 255
    fade 0 0
    wait 500
    0924: enable_screen_darkness 0 with_value -1
    
    :USHSER4_INSTAJUMP_TO_NIGHTMARE_PART2
    
    035F: actor PLAYER_ACTOR armour += -200
    
    0AF0: 0@ = get_int_from_ini_file "saves\ZACM.set" section "SCR" key "USHER_MISS4_CHECKPOINT"
    if 
    0@ < 1
    then
    0AF1: write_int 1 to_ini_file "saves\ZACM.set" section "SCR" key "USHER_MISS4_CHECKPOINT"
    end
    
    ////////////////////////////////////////////////////////        
    
    0781: get_weapon_with_ID 38 model_to 0@

    while not model.Available(0@)
    wait 0
    model.Load(0@)
    mload
    end
    
    Actor.GiveWeaponAndAmmo(PLAYER_ACTOR, 38, 99999)
    0992: set_player PLAYER_CHAR weapons_scrollable 0
    0A8C: write_memory 0x969178 size 1 value 1 virtual_protect 0
    create_thread @RGN_HP5
    
    CURRENT_USHER_TUTORIAL_NUM = -444666       
    $SAVESTATUS = 0
    ZOMBIE_INTERIOR_ALLOW_SPAWN = 1
    ZOMBIES_NOTSPAWN = 0
    $ZOMBIES_ALWAYS_VISIBLE = 1    
    $ZOMBIES_COUNT = 20
    $ZOMBIES_HORDE = 1
    0089: ZOMBIE_RUN_SPEED_PRE = $ZOMBIE_RUN_SPEED // (float)
    
    if
    not $EASY_MODE == 1
    then
    $ZOMBIE_RUN_SPEED = 0.45 
    else
    $ZOMBIE_RUN_SPEED = 0.175
    end
       
    $ALLOW_PLAYER_SLOWMOTION = 0
    $ALLOW_AMMO_LIMIT = 0
    $ALLOW_HUNGER = 0
    $ALLOW_BLEEDING = 0
    $FEATHERBPCK_FLAG = 1
    008B: PLAYER_XP_PREV = $PLAYER_XP // (int) 
    cinema.Widescreen(0)
    BLACK_POLOSKI_ON = 0
    SURVIVAL_STARTED_FULLY_FLAG = 0    
    create_thread @ZAM_ARD 0 0 0 2
    
    0A8C: write_memory 0x0C402C6 size 1 value 1 virtual_protect 0
    0A8C: write_memory 0x07042A9 size 1 value 64 virtual_protect 0
    0A8C: write_memory 0x0704348 size 1 value 64 virtual_protect 0
    0AC6: 1@ = label @CFOG_R offset
    0AC6: 2@ = label @CFOG_G offset
    0AC6: 3@ = label @CFOG_B offset
    0A8C: write_memory 1@ size 1 value 255 virtual_protect 0
    0A8C: write_memory 2@ size 1 value 0 virtual_protect 0
    0A8C: write_memory 3@ size 1 value 0 virtual_protect 0

    :CAR_CREATE_TURRET_USHER4
    if
    model.Available(#RCCAM)
    then
    
    SUPPLY_QUEST_TRUCK = car.Create(#RCCAM,268.269226, -60.280903, 1040.00000)
    car.LockInCurrentPosition(SUPPLY_QUEST_TRUCK,true)
    
    if
    model.Available(#RCCAM)
    then
    //model.Destroy(#RCCAM)
    end
    
    else
    model.Load(#RCCAM)
    mload
    wait 0
    jump to @CAR_CREATE_TURRET_USHER4
    end    
    
    fade 1 250
    $HUD_REMOVE = 0
    wait 250
    camera.Restore_WithJumpCut()
    cinema.Radar(0)
    06A7: put_actor PLAYER_ACTOR into_turret_on_car SUPPLY_QUEST_TRUCK at_car_offset 0.0 0.0 1.5 position 1 shooting_angle 360.0 70.0 with_weapon 38
    STORY_DRIVEBY_NO_RETURN_FLAG = 1
    
    $MUSIC_MISSION = Audiostream.Load("audio\sounds\music\usher_music\MISS4\theme5.mp3")
    Audiostream.PerformAction($MUSIC_MISSION, PLAY)
    Audiostream.Loop($MUSIC_MISSION, 1)
    Audiostream.Volume($MUSIC_MISSION) = VERO_TIPA_VOLUME
    
    /////////////////////Плавное нарастание/////////////////////
//    
//    $MUSIC_FADE_NUMBER += 1
//    if
//    $MUSIC_FADE_NUMBER > 4
//        then
//        $MUSIC_FADE_NUMBER = 0 
//        end    
//    
//    0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_MISSION // (int) 
//    0086: $MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = $MUSIC_VOLUME // (float) 
//    
//    $MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 1000
//    $MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 1  
//    $MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
//    create_thread @MUS_FAD
//    
//    wait 1 
    250A: SET_AUDIO_STREAM_TYPE $MUSIC_MISSION type 2 
    2504: SET_AUDIO_STREAM_VOLUME_WITH_TRANSITION $MUSIC_MISSION volume $MUSIC_VOLUME time 1000
    
    ////////////////////////////////////////////////////////
    
    32@ = 0
    
    $NEAR_X = 1.0
    $NEAR_Y = 1.0
    $NEAR_Z = 2.0
    
    repeat
    wait 0
    
    008A: $PLAYER_XP = PLAYER_XP_PREV // (int)
    
    if
    not actor.Dead(PLAYER_ACTOR)
    jf @USHER4_FAILED_PLAYER_DIED
    if and
    $CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
    not BASE_TEAMMATE_AGRED == 1
    jf @USHER4_FAILED_AGRO
    if
    803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
    jf @USHER4_FAILED_LDEAD
    
    $ZOMBIES_NEAR_TOTAL = 0

    for 0@ = 0 to 19
    
    if
    $ZOMBIE_NEAR[0@] == 1
    then
    $ZOMBIES_NEAR_TOTAL += 1
    end
    
    end
    
    for 0@ = 0 to $ZOMBIES_NEAR_TOTAL
    if
    0@ > 0
        then
        0851: set_actor PLAYER_ACTOR decrease_health_by 1 affect_armour 1        
        camera.Shake(25)
        end
    end
    
    if and
    0AB0:   key_pressed $KEY_USE
    $CHEATS_ON == 1
    then
    break
    end
    
    until 32@ > 30000
    
    ZOMBIES_NOTSPAWN = 1
    
    32@ = 0
    
    repeat
    wait 0
    
    008A: $PLAYER_XP = PLAYER_XP_PREV // (int)
    
    if
    not actor.Dead(PLAYER_ACTOR)
    jf @USHER4_FAILED_PLAYER_DIED
    if and
    $CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
    not BASE_TEAMMATE_AGRED == 1
    jf @USHER4_FAILED_AGRO
    if
    803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
    jf @USHER4_FAILED_LDEAD
    
    if and
    0AB0:   key_pressed $KEY_USE
    $CHEATS_ON == 1
    then 
    break
    end
    
    if
    32@ > 10000
    then
    break
    end
    
    until $ZOMBIE_SPAWNED_COUNT == 0
    
    $SAVESTATUS = 1
        
    0ABB: 0@ = audiostream $MUSIC_MISSION volume
    0@ *= 0.3
    Audiostream.Volume($MUSIC_MISSION) = 0@
    
    fade 0 2000
    $HUD_REMOVE = 1
    wait 2000            
    
    player.CanMove(PLAYER_CHAR,false)
    ZOMBIE_INTERIOR_ALLOW_SPAWN = 0        
    $ZOMBIES_ALWAYS_VISIBLE = 0
    0088: $ZOMBIE_RUN_SPEED = ZOMBIE_RUN_SPEED_PRE // (float)
    $NEAR_X = 30.0
    $NEAR_Y = 30.0
    $NEAR_Z = 5.0
    
    $SPECIAL_INFECTED_NOT_SPAWN_FLAG = 0 
    
    0777: delete_objects_in_object_group "marjo1"
    0776: create_objects_in_object_group "marjo2"
    
    0465: remove_actor PLAYER_ACTOR from_turret_mode
    STORY_DRIVEBY_NO_RETURN_FLAG = 0
    car.Destroy(100@)
    actor.PutAtNoOffset(PLAYER_ACTOR,287.712860, -82.246941, 1042.000000)
    actor.Angle(PLAYER_ACTOR) = 65.120209
            
    cinema.Widescreen(1)
    BLACK_POLOSKI_ON = 1
    
    if
    $FP_ACTIVATED == 1
    then
    repeat
    wait 0
    until $FP_ACTIVATED == 0
    end
    
    ////////////////////////////////////////////////////////
    
    camera.SetPosition(297.496704 -85.232315 1102.981567,0.0,0.0,0.0)
    camera.PointAt(296.670471 -84.835655 1102.581543,2)    
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY509"
    v$ST_DIALOG[1] = "STRY510"
    $DIALOG_COUNT = 1
    create_thread @DG_SYS2
    
    fade 1 2000
    
    audiostream.Release($SHIT_FUCK)
    $SHIT_FUCK = Audiostream.Load("audio\sounds\music\usher_music\MISS4\shelf_open.mp3")
    Audiostream.Loop($SHIT_FUCK, 0)
    Audiostream.Volume($SHIT_FUCK) = $SOUNDS_VOLUME
    Audiostream.PerformAction($SHIT_FUCK,PLAY)
    
    repeat
    wait 0
    until $DIALOG_END == 1
    
    ///////////////////////////////////////////////////////////    
    
    camera.SetPosition(296.681885 -10.728578 1120.811279,0.0,0.0,0.0)
    camera.PointAt(296.664551 -11.646699 1120.415405,1)
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STR510"
    $DIALOG_COUNT = 0
    create_thread @DG_SYS2
        
    repeat
    wait 0
    until $DIALOG_END == 1
    
    ///////////////////////////////////////////////////////////
    
    camera.SetPosition(261.627655 -47.941261 1100.502563,0.0,0.0,0.0)
    camera.PointAt(262.036316 -48.849266 1100.410156,1)
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STR511"
    $DIALOG_COUNT = 0
    create_thread @DG_SYS2
        
    repeat
    wait 0
    until $DIALOG_END == 1
    
    /////////////////////Плавное затухание/////////////////////
//
//    $MUSIC_FADE_NUMBER += 1
//    if
//    $MUSIC_FADE_NUMBER > 4
//        then
//        $MUSIC_FADE_NUMBER = 0 
//        end    
//            
//    0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_MISSION // (int)
//    $MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = 0.0
//            
//    $MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 2000
//    $MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 0  
//    $MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
//    create_thread @MUS_FAD
    2504: SET_AUDIO_STREAM_VOLUME_WITH_TRANSITION $MUSIC_MISSION volume 0.0 time 2000    
    
    ///////////////////////////////////////////////////////////
    
    fade 0 2000
    wait 2000
    audiostream.Release($MUSIC_MISSION)
    
    $MUSIC_MISSION = Audiostream.Load("audio\sounds\music\usher_music\MISS4\theme6.mp3")
    Audiostream.PerformAction($MUSIC_MISSION, PLAY)
    Audiostream.Loop($MUSIC_MISSION, 1)
    Audiostream.Volume($MUSIC_MISSION) = VERO_TIPA_VOLUME
    
    /////////////////////Плавное нарастание/////////////////////
//    
//    $MUSIC_FADE_NUMBER += 1
//    if
//    $MUSIC_FADE_NUMBER > 4
//        then
//        $MUSIC_FADE_NUMBER = 0 
//        end    
//    
//    0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_MISSION // (int) 
//    0086: $MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = $MUSIC_VOLUME // (float) 
//    
//    $MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 1000
//    $MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 1  
//    $MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
//    create_thread @MUS_FAD
//    
//    wait 1 
    250A: SET_AUDIO_STREAM_TYPE $MUSIC_MISSION type 2 
    2504: SET_AUDIO_STREAM_VOLUME_WITH_TRANSITION $MUSIC_MISSION volume $MUSIC_VOLUME time 1000
    
    ////////////////////////////////////////////////////////
    
    0089: CHARGER_RUN_SPEED_PRE = $CHARGER_RUN_SPEED // (float)
    008B: CHARGER_HEALTH_PRE = $CHARGER_HEALTH // (int)
    008B: CHARGER_DAMAGE_PRE = $CHARGER_DAMAGE // (int)
    
    if
    not $EASY_MODE == 1
    then
    $CHARGER_RUN_SPEED = 0.81
    else
    $CHARGER_RUN_SPEED = 0.405
    end
    
    $CHARGER_HEALTH = 400 
    $CHARGER_DAMAGE = 10      
    cinema.Widescreen(0)
    BLACK_POLOSKI_ON = 0
    $SAVESTATUS = 0
    $ALLOW_PLAYER_SLOWMOTION = 1    
    
    0781: get_weapon_with_ID 38 model_to 0@

    while not model.Available(0@)
    wait 0
    model.Load(0@)
    mload
    end
    
    Actor.GiveWeaponAndAmmo(PLAYER_ACTOR, 38, 99999)
    
    actor.PutAtNoOffset(PLAYER_ACTOR,268.269226, -60.280903, 1042.000000)
    actor.Angle(PLAYER_ACTOR) = 10.078126
    
    FP_ACTIVATE_SCRIPTED = 1
    $MUTATION_ACTIVE = 3
        
    player.CanMove(PLAYER_CHAR,true)
    fade 1 250
    $HUD_REMOVE = 0
    camera.Restore_WithJumpCut()
    cinema.Radar(0)
    
    ////////////////////////////////////////////////////////
    
    32@ = 0    
    
    repeat
    wait 0
    
    008A: $PLAYER_XP = PLAYER_XP_PREV // (int)
    
    if
    not actor.Dead(PLAYER_ACTOR)
    jf @USHER4_FAILED_PLAYER_DIED
    if and
    $CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
    not BASE_TEAMMATE_AGRED == 1
    jf @USHER4_FAILED_AGRO
    if
    803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
    jf @USHER4_FAILED_LDEAD
    
    $SPAWN_CHARGER_FLAG = 1 
    $CHARGER_INTERIOR_SPAWN = 1       
    
    if and
    0AB0:   key_pressed $KEY_USE
    $CHEATS_ON == 1
    then
    break
    end
    
    until 32@ > 45000
    
    32@ = 0
    
    repeat
    wait 0
    
    008A: $PLAYER_XP = PLAYER_XP_PREV // (int)
    
    if
    not actor.Dead(PLAYER_ACTOR)
    jf @USHER4_FAILED_PLAYER_DIED
    if and
    $CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
    not BASE_TEAMMATE_AGRED == 1
    jf @USHER4_FAILED_AGRO
    if
    803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
    jf @USHER4_FAILED_LDEAD
    
    if and
    0AB0:   key_pressed $KEY_USE
    $CHEATS_ON == 1
    then 
    break
    end
    
    if
    32@ > 10000
    then
    break
    end
    
    until $CHARGER_SPAWNED == 0
    
    $SAVESTATUS = 1
    $SPAWN_CHARGER_FLAG = 0
    $CHARGER_INTERIOR_SPAWN = 0
    0088: $CHARGER_RUN_SPEED = CHARGER_RUN_SPEED_PRE // (float)
    008A: $CHARGER_HEALTH = CHARGER_HEALTH_PRE // (int)
    008A: $CHARGER_DAMAGE = CHARGER_DAMAGE_PRE  // (int)
        
    0ABB: 0@ = audiostream $MUSIC_MISSION volume
    0@ *= 0.3
    Audiostream.Volume($MUSIC_MISSION) = 0@
    
    fade 0 2000
    $HUD_REMOVE = 1
    wait 2000            
    
    player.CanMove(PLAYER_CHAR,false)    
    $SPECIAL_INFECTED_NOT_SPAWN_FLAG = 1
    
    0777: delete_objects_in_object_group "marjo2"
    0776: create_objects_in_object_group "marjo3"
    
    actor.PutAtNoOffset(PLAYER_ACTOR,229.992966 -92.251534 1042.000000)
    actor.Angle(PLAYER_ACTOR) = 317.563843
            
    cinema.Widescreen(1)
    BLACK_POLOSKI_ON = 1
    
    $FP_ON = 0    
    repeat
    wait 0
    until $FP_ACTIVATED == 0        
    
    ////////////////////////////////////////////////////////        
    
    audiostream.Release($SHIT_FUCK)
    $SHIT_FUCK = Audiostream.Load("audio\sounds\music\usher_music\MISS4\bottlekick.mp3")
    Audiostream.Loop($SHIT_FUCK, 0)
    Audiostream.Volume($SHIT_FUCK) = $SOUNDS_VOLUME
    Audiostream.PerformAction($SHIT_FUCK,PLAY)
    
    ///////////////////////////////////////////////////////////    
    
    camera.SetPosition(236.717484 -91.064468 1097.603271,0.0,0.0,0.0)
    camera.PointAt(236.475601 -90.097313 1097.525146,2)
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY511"
    $DIALOG_COUNT = 0
    create_thread @DG_SYS2
    
    fade 1 2000
        
    repeat
    wait 0
    until $DIALOG_END == 1
    
    ///////////////////////////////////////////////////////////
    
    camera.SetPosition(223.304214 -99.716423 1048.785522,0.0,0.0,0.0)
    camera.PointAt(224.216171 -99.369110 1049.003906,1)
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY512"
    v$ST_DIALOG[1] = "STRY513"
    v$ST_DIALOG[2] = "STR513"
    $DIALOG_COUNT = 2
    create_thread @DG_SYS2
        
    repeat
    wait 0
    until $DIALOG_END == 1
    
    /////////////////////Плавное затухание/////////////////////
//
//    $MUSIC_FADE_NUMBER += 1
//    if
//    $MUSIC_FADE_NUMBER > 4
//        then
//        $MUSIC_FADE_NUMBER = 0 
//        end    
//            
//    0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_MISSION // (int)
//    $MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = 0.0
//            
//    $MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 2000
//    $MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 0  
//    $MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
//    create_thread @MUS_FAD
    2504: SET_AUDIO_STREAM_VOLUME_WITH_TRANSITION $MUSIC_MISSION volume 0.0 time 2000
    
    ///////////////////////////////////////////////////////////
    
    fade 0 2000
    wait 2000
    audiostream.Release($MUSIC_MISSION)
    
    $MUSIC_MISSION = Audiostream.Load("audio\sounds\music\usher_music\MISS4\theme7.mp3")
    Audiostream.PerformAction($MUSIC_MISSION, PLAY)
    Audiostream.Loop($MUSIC_MISSION, 1)
    Audiostream.Volume($MUSIC_MISSION) = VERO_TIPA_VOLUME
    
    /////////////////////Плавное нарастание/////////////////////
//    
//    $MUSIC_FADE_NUMBER += 1
//    if
//    $MUSIC_FADE_NUMBER > 4
//        then
//        $MUSIC_FADE_NUMBER = 0 
//        end    
//    
//    0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_MISSION // (int) 
//    0086: $MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = $MUSIC_VOLUME // (float) 
//    
//    $MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 1000
//    $MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 1  
//    $MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
//    create_thread @MUS_FAD
//    
//    wait 1 
    250A: SET_AUDIO_STREAM_TYPE $MUSIC_MISSION type 2 
    2504: SET_AUDIO_STREAM_VOLUME_WITH_TRANSITION $MUSIC_MISSION volume $MUSIC_VOLUME time 1000
    
    ////////////////////////////////////////////////////////
    
    $SPECIAL_INFECTED_NOT_SPAWN_FLAG = 0
    0089: WITCH_RUN_SPEED_PRE = $WITCH_RUN_SPEED // (float)
    008B: WITCH_HEALTH_PRE = $WITCH_HEALTH // (int)
    
    if
    not $EASY_MODE == 1
    then
    $WITCH_RUN_SPEED = 1.0
    else
    $WITCH_RUN_SPEED = 0.5
    end
    
    $WITCH_HEALTH = 400 
    $WITCH_INSTANT_AGR = 1   
    cinema.Widescreen(0)
    BLACK_POLOSKI_ON = 0
    $SAVESTATUS = 0
    
    0781: get_weapon_with_ID 38 model_to 0@

    while not model.Available(0@)
    wait 0
    model.Load(0@)
    mload
    end
    
    Actor.GiveWeaponAndAmmo(PLAYER_ACTOR, 38, 99999)
    
    actor.PutAtNoOffset(PLAYER_ACTOR,309.9779, -69.0611, 1042.0)
    actor.Angle(PLAYER_ACTOR) = 91.5234  
    camera.Restore_WithJumpCut()
    
    wait 500
    
    FP_ACTIVATE_SCRIPTED = 1
    $FP_ON = 1
        
    player.CanMove(PLAYER_CHAR,true)
    fade 1 250
    $HUD_REMOVE = 0
    camera.Restore_WithJumpCut()
    cinema.Radar(0)
    
    ////////////////////////////////////////////////////////
    
    32@ = 0    
    
    repeat
    wait 0
    
    008A: $PLAYER_XP = PLAYER_XP_PREV // (int)
    
    if
    not actor.Dead(PLAYER_ACTOR)
    jf @USHER4_FAILED_PLAYER_DIED
    if and
    $CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
    not BASE_TEAMMATE_AGRED == 1
    jf @USHER4_FAILED_AGRO
    if
    803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
    jf @USHER4_FAILED_LDEAD
    
    $SPAWN_WITCH_FLAG = 1 
    $WITCH_INTERIOR_SPAWN = 1       
    
    if and
    0AB0:   key_pressed $KEY_USE
    $CHEATS_ON == 1
    then
    break
    end
    
    until 32@ > 60000
    
    32@ = 0
    
    repeat
    wait 0
    
    008A: $PLAYER_XP = PLAYER_XP_PREV // (int)
    
    if
    not actor.Dead(PLAYER_ACTOR)
    jf @USHER4_FAILED_PLAYER_DIED
    if and
    $CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
    not BASE_TEAMMATE_AGRED == 1
    jf @USHER4_FAILED_AGRO
    if
    803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
    jf @USHER4_FAILED_LDEAD
    
    if and
    0AB0:   key_pressed $KEY_USE
    $CHEATS_ON == 1
    then 
    break
    end
    
    if
    32@ > 10000
    then
    break
    end
    
    until $WITCH_SPAWNED == 0
    
    $SAVESTATUS = 1
    $SPAWN_WITCH_FLAG = 0
    $WITCH_INTERIOR_SPAWN = 0
    0088: $WITCH_RUN_SPEED = WITCH_RUN_SPEED_PRE // (float)
    008A: $WITCH_HEALTH = WITCH_HEALTH_PRE // (int)
        
    0ABB: 0@ = audiostream $MUSIC_MISSION volume
    0@ *= 0.3
    Audiostream.Volume($MUSIC_MISSION) = 0@
    
    fade 0 2000
    $HUD_REMOVE = 1
    wait 2000     
    
    player.CanMove(PLAYER_CHAR,false)    
    $SPECIAL_INFECTED_NOT_SPAWN_FLAG = 1
    
    0777: delete_objects_in_object_group "marjo3"
    0776: create_objects_in_object_group "marjo4"
    
    actor.PutAtNoOffset(PLAYER_ACTOR,253.785675 -16.359921 1042.000000)
    actor.Angle(PLAYER_ACTOR) = 188.907257
            
    cinema.Widescreen(1)
    BLACK_POLOSKI_ON = 1
    
    $FP_ON = 0    
    repeat
    wait 0
    until $FP_ACTIVATED == 0
    
    ////////////////////////////////////////////////////////
    
    camera.SetPosition(299.097565 -24.534916 1100.608398,0.0,0.0,0.0)
    camera.PointAt(298.489929 -23.768208 1100.815552,2)  
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY514"
    $DIALOG_COUNT = 0
    create_thread @DG_SYS2
    
    fade 1 2000
        
    repeat
    wait 0
    until $DIALOG_END == 1
    
    ///////////////////////////////////////////////////////////    
    
    camera.SetPosition(282.858551 -74.586845 1062.457031,0.0,0.0,0.0)
    camera.PointAt(282.480804 -75.497002 1062.286987,1)
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY515"
    $DIALOG_COUNT = 0
    create_thread @DG_SYS2
        
    repeat
    wait 0
    until $DIALOG_END == 1
    
    ///////////////////////////////////////////////////////////
    
    camera.SetPosition(246.813950 -62.860771 1081.427368,0.0,0.0,0.0)
    camera.PointAt(246.386749 -61.971016 1081.266602,1)
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY516"
    $DIALOG_COUNT = 0
    create_thread @DG_SYS2
        
    repeat
    wait 0
    until $DIALOG_END == 1
    
    ///////////////////////////////////////////////////////////
    
    camera.SetPosition(345.133026 -110.999908 1086.395508,0.0,0.0,0.0)
    camera.PointAt(344.275635 -110.494049 1086.300781,1)
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY517"
    $DIALOG_COUNT = 0
    create_thread @DG_SYS2
        
    repeat
    wait 0
    until $DIALOG_END == 1
    
    ///////////////////////////////////////////////////////////
    
    camera.SetPosition(277.452606 1.365161 1114.602417,0.0,0.0,0.0)
    camera.PointAt(277.594971 0.549267 1114.041992,1)
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY518"
    $DIALOG_COUNT = 0
    create_thread @DG_SYS2
        
    repeat
    wait 0
    until $DIALOG_END == 1
    
    ///////////////////////////////////////////////////////////
    
    camera.SetPosition(267.505127 -68.996246 1112.663940,0.0,0.0,0.0)
    camera.PointAt(267.351624 -68.087112 1112.276733,1)
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY519"
    $DIALOG_COUNT = 0
    create_thread @DG_SYS2
        
    repeat
    wait 0
    until $DIALOG_END == 1
    
    ///////////////////////////////////////////////////////////
    
    camera.SetPosition(281.875427 -87.724007 1059.384521,0.0,0.0,0.0)
    camera.PointAt(281.602325 -88.681862 1059.473511,1)
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY520"
    v$ST_DIALOG[1] = "STRY521"
    $DIALOG_COUNT = 1
    create_thread @DG_SYS2
        
    repeat
    wait 0
    until $DIALOG_END == 1
    
    /////////////////////Плавное затухание/////////////////////
//
//    $MUSIC_FADE_NUMBER += 1
//    if
//    $MUSIC_FADE_NUMBER > 4
//        then
//        $MUSIC_FADE_NUMBER = 0 
//        end    
//            
//    0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_MISSION // (int)
//    $MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = 0.0
//            
//    $MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 2000
//    $MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 0  
//    $MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
//    create_thread @MUS_FAD
    2504: SET_AUDIO_STREAM_VOLUME_WITH_TRANSITION $MUSIC_MISSION volume 0.0 time 2000
    
    ///////////////////////////////////////////////////////////
    
    fade 0 2000
    wait 2000
    audiostream.Release($MUSIC_MISSION)
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY522"
    $DIALOG_COUNT = 0
    create_thread @DG_SYS2
    
    repeat
    wait 0
    0924: enable_screen_darkness 1 with_value 255
    fade 1 1
    until $DIALOG_END == 1
    
    0924: enable_screen_darkness 1 with_value 255
    fade 0 0
    wait 500
    0924: enable_screen_darkness 0 with_value -1        
    
    $HP_REGEN_OFF = 1
    
    0A8C: write_memory 0x969178 size 1 value 0 virtual_protect 0
    0555: remove_weapon 38 from_actor PLAYER_ACTOR
    $ALLOW_AMMO_LIMIT = 1
    $ALLOW_HUNGER = 1
    $ALLOW_BLEEDING = 1
    $FEATHERBPCK_FLAG = 0
    $FP_ON = 1
    
    0AF0: 0@ = get_int_from_ini_file "saves\ZACM.set" section "SCR" key "USHER_MISS4_CHECKPOINT"
    if 
    0@ < 2
    then
    0AF1: write_int 2 to_ini_file "saves\ZACM.set" section "SCR" key "USHER_MISS4_CHECKPOINT"
    end
    
    wait 2000        
    
    //048F: actor PLAYER_ACTOR remove_weapons - НАХУЯ?
    
    :USHSER4_INSTAJUMP_AFTER_NIGHTMARE
    
    select_interior 1
    0860: link_actor PLAYER_ACTOR to_interior 1
    04F9: set_sky_color 1 fade 0 
    
    00C0: set_current_time 18 0
    0E6A: make_nop 0x052CF53 size 6 //Выключаем обновление часов
    0E6A: make_nop 0x053BFC2 size 5 //Выключаем обновление погоды
    HIDE_HUD_CLOCK = 1 
    
    FP_ACTIVATE_SCRIPTED = 1
    $MUTATION_ACTIVE = -1
    CURRENT_USHER_TUTORIAL_NUM = 0
    PLAYER_DONT_HAVE_BACKPACK = 1
    SURVIVAL_STARTED_FULLY_FLAG = 1
    0A8C: write_memory 0x0C402C6 size 1 value 0 virtual_protect 0 //CPostEffects__m_bFog
    
    0169: set_fade_color_RGB 0 0 0
    
    cinema.Widescreen(0)
    BLACK_POLOSKI_ON = 0
    cinema.Radar(1)
        
    0992: set_player PLAYER_CHAR weapons_scrollable 0
    
    actor.PutAtNoOffset(PLAYER_ACTOR,2637.058350 222.546219 53.753574)
    actor.Angle(PLAYER_ACTOR) = 57.987625
    camera.Restore_WithJumpCut()
    
    repeat
    wait 0  
    Animation.Load("crack") 
    until Animation.Available("crack")
    
    Animation.PerfromA(PLAYER_ACTOR, "crckidle1", "crack", 4.0, 0, 0, 0, 0, 999999)
    
    $MUSIC_MISSION = Audiostream.Load3d("audio\sounds\music\usher_music\MISS4\theme8.ogg")
    Audiostream.SetPosition($MUSIC_MISSION, 2625.860107 225.733429 54.711285) //ZXY (old, XYZ new)
    Audiostream.Loop($MUSIC_MISSION, 1)
    Audiostream.Volume($MUSIC_MISSION) = $MUSIC_VOLUME
    Audiostream.PerformAction($MUSIC_MISSION,PLAY)  
    
    USHER4_3D_ZMB_SND1 = Audiostream.Load3d("audio\sounds\zombie_voice_gen.ogg")
    Audiostream.SetPosition(USHER4_3D_ZMB_SND1, 2639.067139 223.587738 54.764793) //ZXY (old, XYZ new)
    Audiostream.Loop(USHER4_3D_ZMB_SND1, 1)
    Audiostream.Volume(USHER4_3D_ZMB_SND1) = $SOUNDS_VOLUME
    Audiostream.PerformAction(USHER4_3D_ZMB_SND1,PLAY)
    
    USHER4_3D_ZMB_SND2 = Audiostream.Load3d("audio\sounds\zombie_voice_gen2.ogg")
    Audiostream.SetPosition(USHER4_3D_ZMB_SND2, 2621.354004 223.363586 54.602402) //ZXY (old, XYZ new)
    Audiostream.Loop(USHER4_3D_ZMB_SND2, 1)
    Audiostream.Volume(USHER4_3D_ZMB_SND2) = $SOUNDS_VOLUME
    Audiostream.PerformAction(USHER4_3D_ZMB_SND2,PLAY)
    
    USHER4_3D_ZMB_SND3 = Audiostream.Load3d("audio\sounds\zombie_voice_gen3.ogg")
    Audiostream.SetPosition(USHER4_3D_ZMB_SND3, 2626.828369 211.100235 54.655556) //ZXY (old, XYZ new)
    Audiostream.Loop(USHER4_3D_ZMB_SND3, 1)
    Audiostream.Volume(USHER4_3D_ZMB_SND3) = $SOUNDS_VOLUME
    Audiostream.PerformAction(USHER4_3D_ZMB_SND3,PLAY)
    
    USHER4_3D_ZMB_SND4 = Audiostream.Load3d("audio\sounds\zombie_voice_gen4.ogg")
    Audiostream.SetPosition(USHER4_3D_ZMB_SND4, 2638.070068 215.844849 55.048016) //ZXY (old, XYZ new)
    Audiostream.Loop(USHER4_3D_ZMB_SND4, 1)
    Audiostream.Volume(USHER4_3D_ZMB_SND4) = $SOUNDS_VOLUME
    Audiostream.PerformAction(USHER4_3D_ZMB_SND4,PLAY)
    
    $SHIT_FUCK = Audiostream.Load3d("audio\sounds\music\usher_music\MISS4\rope_break.mp3")
    Audiostream.SetPosition($SHIT_FUCK, 2637.058350 222.546219 53.753574) //ZXY (old, XYZ new)
    Audiostream.Loop($SHIT_FUCK, 1)
    Audiostream.Volume($SHIT_FUCK) = $SOUNDS_VOLUME
    Audiostream.PerformAction($SHIT_FUCK,PLAY)
    
    gosub @CREATE_PODONKI_USHER4
    
    wait 500
    0924: enable_screen_darkness 1 with_value 200
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY523"
    v$ST_DIALOG[1] = "STRY524"
    v$ST_DIALOG[2] = "STRY525"
    v$ST_DIALOG[3] = "STRY526"
    v$ST_DIALOG[4] = "STRY527"
    v$ST_DIALOG[5] = "STR527"
    v$ST_DIALOG[6] = "STR528"
    v$ST_DIALOG[7] = "STR529"
    v$ST_DIALOG[8] = "STR530"
    v$ST_DIALOG[9] = "STRY528"
    v$ST_DIALOG[10] = "STY528"
    v$ST_DIALOG[11] = "STRY529"
    $DIALOG_COUNT = 11
    create_thread @DG_SYS2                                
    
    fade 1 2000
    $HUD_REMOVE = 0
    
    repeat
    wait 0
    
    Audiostream.Volume($MUSIC_MISSION) = $MUSIC_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND1) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND2) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND3) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND4) = $SOUNDS_VOLUME
    
    if
    not actor.Dead(PLAYER_ACTOR)
    jf @USHER4_FAILED_PLAYER_DIED
    if and
    $CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
    not BASE_TEAMMATE_AGRED == 1
    jf @USHER4_FAILED_AGRO
    if
    803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
    jf @USHER4_FAILED_LDEAD
    
    until $DIALOG_END == 1
    
    0E96: clear_char_primary_tasks PLAYER_ACTOR
    0E97: clear_char_secondary_tasks PLAYER_ACTOR
    Audiostream.PerformAction($SHIT_FUCK,STOP)
    wait 250
    04EB: AS_actor PLAYER_ACTOR crouch 1    
            
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STY529"
    v$ST_DIALOG[1] = "STRY530"
    $DIALOG_COUNT = 1
    $DIALOG_NOT_SKIP = 1
    create_thread @DG_SYS2  
    
    repeat
    wait 0
    
    Audiostream.Volume($MUSIC_MISSION) = $MUSIC_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND1) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND2) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND3) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND4) = $SOUNDS_VOLUME
    
    if
    not actor.Dead(PLAYER_ACTOR)
    jf @USHER4_FAILED_PLAYER_DIED
    if and
    $CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
    not BASE_TEAMMATE_AGRED == 1
    jf @USHER4_FAILED_AGRO
    if
    803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
    jf @USHER4_FAILED_LDEAD
    
    until $DIALOG_END == 1
    
    create_thread @ERNIE1
    player.CanMove(PLAYER_CHAR,true)
    
    repeat
    wait 0
    
    Audiostream.Volume($MUSIC_MISSION) = $MUSIC_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND1) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND2) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND3) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND4) = $SOUNDS_VOLUME
    
    if
    not actor.Dead(PLAYER_ACTOR)
    jf @USHER4_FAILED_PLAYER_DIED
    if and
    $CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
    not BASE_TEAMMATE_AGRED == 1
    jf @USHER4_FAILED_AGRO
    if
    803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
    jf @USHER4_FAILED_LDEAD
    
    0E44: get_char_kill_target_char USHER4_ERNIE store_to 2@
    if or
    actor.Animation(USHER4_ERNIE) == "lkup_loop"
    0E46: is_char_using_gun USHER4_ERNIE
    07D6:   2@ == PLAYER_ACTOR // @ == $ (int)
    actor.Dead(USHER4_ERNIE)
        then 
        break
        end  
    
    until false
        
    v$OBJECTIVE = "STRB97"
    MISSION_MARKER = marker.CreateAboveActor(USHER4_ERNIE)
    
    repeat
    wait 0
    
    Audiostream.Volume($MUSIC_MISSION) = $MUSIC_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND1) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND2) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND3) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND4) = $SOUNDS_VOLUME
    
    if
    not actor.Dead(PLAYER_ACTOR)
    jf @USHER4_FAILED_PLAYER_DIED
    if and
    $CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
    not BASE_TEAMMATE_AGRED == 1
    jf @USHER4_FAILED_AGRO
    if
    803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
    jf @USHER4_FAILED_LDEAD
    
    until actor.Dead(USHER4_ERNIE)
        
    v$OBJECTIVE = "DUMMY"
    marker.Disable(MISSION_MARKER)
    
    0781: get_weapon_with_ID 73 model_to 0@

    while not model.Available(0@)
    wait 0
    model.Load(0@)
    mload
    end
    
    Actor.GiveWeaponAndAmmo(PLAYER_ACTOR, 73, 12)
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY532"
    $DIALOG_COUNT = 0
    $DIALOG_NOT_SKIP = 1
    create_thread @DG_SYS2  
    
    repeat
    wait 0
    
    Audiostream.Volume($MUSIC_MISSION) = $MUSIC_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND1) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND2) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND3) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND4) = $SOUNDS_VOLUME
    
    if
    not actor.Dead(PLAYER_ACTOR)
    jf @USHER4_FAILED_PLAYER_DIED
    if and
    $CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
    not BASE_TEAMMATE_AGRED == 1
    jf @USHER4_FAILED_AGRO
    if
    803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
    jf @USHER4_FAILED_LDEAD
    
    until $DIALOG_END == 1        
    
    0@ = 0
    1@ = 0
    2@ = 0
    
    repeat
    wait 0
    
    Audiostream.Volume($MUSIC_MISSION) = $MUSIC_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND1) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND2) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND3) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND4) = $SOUNDS_VOLUME
    
    if and
    0E3D: is_key_just_pressed 69
    $CHEATS_ON == 1
    then
    05BE: AS_actor USHER4_BOXUS die
    05BE: AS_actor USHER4_CLETUS die
    05BE: AS_actor USHER4_BRODY die    
    $END_DIALOG_INST = 1
    wait 0
    end
    
    if
    not actor.Dead(PLAYER_ACTOR)
    jf @USHER4_FAILED_PLAYER_DIED
    if and
    $CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
    not BASE_TEAMMATE_AGRED == 1
    jf @USHER4_FAILED_AGRO
    if
    803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
    jf @USHER4_FAILED_LDEAD
    
    if and
    075C:   marker USHER4_BOXUS_MARKER enabled
    actor.Dead(USHER4_BOXUS)
        then
        marker.Disable(USHER4_BOXUS_MARKER)
        end
        
    if and
    075C:   marker USHER4_CLETUS_MARKER enabled
    actor.Dead(USHER4_CLETUS)
        then
        marker.Disable(USHER4_CLETUS_MARKER)
        end
        
    if and
    075C:   marker USHER4_BRODY_MARKER enabled
    actor.Dead(USHER4_BRODY)
        then
        marker.Disable(USHER4_BRODY_MARKER)
        end                
        
    if and
    1@ == 1
    2@ == 0
    051A:   actor USHER4_CLETUS damaged_by_actor PLAYER_ACTOR
        then
        054E: clear_actor USHER4_CLETUS damage
        0829: actor USHER4_CLETUS perform_animation "crckdeth1" IFP_file "crack" rate 4.0 time 0 and_dies
        2@ = 1
        USHER4_CLETUS_DIED_FLAG = 1
        end 
        
    if and
    1@ == 0
    051A:   actor USHER4_CLETUS damaged_by_actor PLAYER_ACTOR
        then
        Animation.PerfromB(USHER4_CLETUS, "crckidle1", "crack", 4.0, 0, 0, 0, 0, 999999)
        1@ = 1
        054E: clear_actor USHER4_CLETUS damage
        wait 250
        end       
    
    if and
    0@ == 0
    0EEA: locate_char_distance_to_coordinates PLAYER_ACTOR pos 2633.1316 223.3325 53.7536 radius 2.5
        then
        0@ = 1
        05E2: AS_actor USHER4_BOXUS kill_actor PLAYER_ACTOR
        077A: set_actor USHER4_BOXUS acquaintance 4 to_actors_pedtype 0 // see ped.dat
        05E2: AS_actor USHER4_CLETUS kill_actor PLAYER_ACTOR
        077A: set_actor USHER4_CLETUS acquaintance 4 to_actors_pedtype 0 // see ped.dat
        05E2: AS_actor USHER4_BRODY kill_actor PLAYER_ACTOR
        077A: set_actor USHER4_BRODY acquaintance 4 to_actors_pedtype 0 // see ped.dat
        
        $END_DIALOG_INST = 1
        wait 0
        v$ST_DIALOG[0] = "STRY533"
        v$ST_DIALOG[1] = "STRY534"
        $DIALOG_COUNT = 0
        $DIALOG_NOT_SKIP = 1
        create_thread @DG_SYS2 
        
        v$OBJECTIVE = "STRB98"
        USHER4_BOXUS_MARKER = marker.CreateAboveActor(USHER4_BOXUS)
        USHER4_CLETUS_MARKER = marker.CreateAboveActor(USHER4_CLETUS)
        USHER4_BRODY_MARKER = marker.CreateAboveActor(USHER4_BRODY)
        
        end
    
    if and
    actor.Dead(USHER4_BOXUS)    
    actor.Dead(USHER4_BRODY)
        then
        if or
        1@ == 1
        actor.Dead(USHER4_CLETUS)
            then
            
            v$OBJECTIVE = "DUMMY"
            
            if
            actor.Dead(USHER4_CLETUS)
            then
            USHER4_CLETUS_DIED_FLAG = 1
            end
            
            break
            end
        end
    
    until false        
    
    if
    USHER4_CLETUS_DIED_FLAG == 0
    then    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY535"
    $DIALOG_COUNT = 0
    $DIALOG_NOT_SKIP = 1
    create_thread @DG_SYS2    
    end 
    
    v$OBJECTIVE = "STRB3"
    09A6: enable_interior_radar_blips 1 
    28@ = Pickup.Create(6549, 3, 2624.2195, 225.3936, 53.7536)
    03DC: MISSION_MARKER = create_marker_above_pickup 28@ 
    
    repeat
    wait 0
    
    Audiostream.Volume($MUSIC_MISSION) = $MUSIC_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND1) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND2) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND3) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND4) = $SOUNDS_VOLUME
    
    if and
    actor.Dead(USHER4_CLETUS)
    USHER4_CLETUS_DIED_FLAG == 0
    then
    054E: clear_actor USHER4_CLETUS damage
    0829: actor USHER4_CLETUS perform_animation "crckdeth1" IFP_file "crack" rate 4.0 time 0 and_dies
    USHER4_CLETUS_DIED_FLAG = 1
    end
    
    if and
    0E3D: is_key_just_pressed 69
    $CHEATS_ON == 1
    then
    break
    $END_DIALOG_INST = 1
    wait 0
    end
    
    if
    not actor.Dead(PLAYER_ACTOR)
    jf @USHER4_FAILED_PLAYER_DIED
    if and
    $CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
    not BASE_TEAMMATE_AGRED == 1
    jf @USHER4_FAILED_AGRO
    if
    803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
    jf @USHER4_FAILED_LDEAD
    
    until pickup.Picked_up(28@)
    
    //GET BACK THAT FUCKING MOLOTOK IBO NE4EM ZOMBI PIZDIT!
    
    0470: 2@ = actor PLAYER_ACTOR current_weapon
    
    0781: get_weapon_with_ID 10 model_to 1@

    while not model.Available(1@)
    wait 0
    model.Load(1@)
    mload
    end
        
    actor.GiveWeaponAndAmmo(PLAYER_ACTOR,10,1)
    
    01B9: set_actor PLAYER_ACTOR armed_weapon_to 2@
    
    v$OBJECTIVE = "DUMMY"
        
    pickup.Destroy(28@)
    Marker.Disable(MISSION_MARKER)
    PLAYER_DONT_HAVE_BACKPACK = 0
    PLAYER_NO_ITEMS_FLAG = 0
    wait 0
    create_thread @PED_BKP PLAYER_ACTOR 371
    $HEAL += 1
    $KANISTRA_FUEL += 15.0
    $REPAIR_KIT += 1
    $JIMMY += 1
    0992: set_player PLAYER_CHAR weapons_scrollable 1
    
    if
    USHER4_NEED_TO_RETURN_PICKUPS == 1
    then
    gosub @PLAYER_GET_BACK_ALL_DROPPED_WEPS
    end
    
    0A8C: write_memory 0x045780A size 4 value 22643727 virtual_protect 1
    0A8C: write_memory 0x045780E size 2 value 0 virtual_protect 1
    wait 250
    0A8C: write_memory 0x045780A size 4 value 88809 virtual_protect 1
    0A8C: write_memory 0x045780E size 2 value 36864 virtual_protect 1
    
    v$OBJECTIVE = "STRB99"
    018A: MISSION_CHECKPOINT = create_checkpoint_at 2625.958008 225.254364 53.753574
    03BC: MISSION_SPHERE = create_sphere_at 2625.958008 225.254364 53.753574 radius 1.0
    
    repeat
    wait 0
    
    Audiostream.Volume($MUSIC_MISSION) = $MUSIC_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND1) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND2) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND3) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND4) = $SOUNDS_VOLUME
    
    if and
    actor.Dead(USHER4_CLETUS)
    USHER4_CLETUS_DIED_FLAG == 0
    then
    054E: clear_actor USHER4_CLETUS damage
    0829: actor USHER4_CLETUS perform_animation "crckdeth1" IFP_file "crack" rate 4.0 time 0 and_dies
    USHER4_CLETUS_DIED_FLAG = 1
    end
    
    if and
    0E3D: is_key_just_pressed 69
    $CHEATS_ON == 1
    then
    actor.PutAtNoOffset(PLAYER_ACTOR,2625.958008 225.254364 53.753574)
    camera.Restore_WithJumpCut()
    create_thread @3D_REFR
    $END_DIALOG_INST = 1
    wait 0
    end
    
    if
    not actor.Dead(PLAYER_ACTOR)
    jf @USHER4_FAILED_PLAYER_DIED
    if and
    $CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
    not BASE_TEAMMATE_AGRED == 1
    jf @USHER4_FAILED_AGRO
    if
    803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
    jf @USHER4_FAILED_LDEAD
    
    until 0EEA: locate_char_distance_to_coordinates PLAYER_ACTOR pos 2625.958008 225.254364 53.753574 radius 1.0
    
    v$OBJECTIVE = "DUMMY"
    03BD: destroy_sphere MISSION_SPHERE
    marker.Disable(MISSION_CHECKPOINT)
    
    audiostream.Release($MUSIC_MISSION)    
    
    if
    USHER4_CLETUS_DIED_FLAG == 0
    then
    v$OBJECTIVE = "STRB100"
    MISSION_MARKER = marker.CreateAboveActor(USHER4_CLETUS)
    07E0: set_marker MISSION_MARKER type_to 1   
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY536"
    v$ST_DIALOG[1] = "STRY537"
    $DIALOG_COUNT = 1
    $DIALOG_NOT_SKIP = 1
    create_thread @DG_SYS2
    
    repeat
    wait 0 
    
    Audiostream.Volume(USHER4_3D_ZMB_SND1) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND2) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND3) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND4) = $SOUNDS_VOLUME
    
    if
    not actor.Dead(PLAYER_ACTOR)
    jf @USHER4_FAILED_PLAYER_DIED
    if and
    $CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
    not BASE_TEAMMATE_AGRED == 1
    jf @USHER4_FAILED_AGRO
    if
    803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
    jf @USHER4_FAILED_LDEAD
    
    if
    actor.Dead(USHER4_CLETUS)
    then
    054E: clear_actor USHER4_CLETUS damage
    0829: actor USHER4_CLETUS perform_animation "crckdeth1" IFP_file "crack" rate 4.0 time 0 and_dies
    USHER4_CLETUS_DIED_FLAG = 1
    jump to @USHER4_DOPROC_FAILED
    end
    
    until $DIALOG_END == 1
    
    repeat
    wait 0
    
    Audiostream.Volume(USHER4_3D_ZMB_SND1) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND2) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND3) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND4) = $SOUNDS_VOLUME
    
    if
    not actor.Dead(PLAYER_ACTOR)
    jf @USHER4_FAILED_PLAYER_DIED
    if and
    $CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
    not BASE_TEAMMATE_AGRED == 1
    jf @USHER4_FAILED_AGRO
    if
    803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
    jf @USHER4_FAILED_LDEAD
    
    if
    actor.Dead(USHER4_CLETUS)
    then
    054E: clear_actor USHER4_CLETUS damage
    0829: actor USHER4_CLETUS perform_animation "crckdeth1" IFP_file "crack" rate 4.0 time 0 and_dies
    USHER4_CLETUS_DIED_FLAG = 1
    jump to @USHER4_DOPROC_FAILED
    end
    
    until 051A:   actor USHER4_CLETUS damaged_by_actor PLAYER_ACTOR
    
    054E: clear_actor USHER4_CLETUS damage 
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY538"
    v$ST_DIALOG[1] = "STRY539"
    v$ST_DIALOG[2] = "STRY540" 
    $DIALOG_COUNT = 2
    $DIALOG_NOT_SKIP = 1
    create_thread @DG_SYS2
    
    repeat
    wait 0
    
    Audiostream.Volume(USHER4_3D_ZMB_SND1) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND2) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND3) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND4) = $SOUNDS_VOLUME
    
    if
    not actor.Dead(PLAYER_ACTOR)
    jf @USHER4_FAILED_PLAYER_DIED
    if and
    $CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
    not BASE_TEAMMATE_AGRED == 1
    jf @USHER4_FAILED_AGRO
    if
    803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
    jf @USHER4_FAILED_LDEAD
    
    if
    actor.Dead(USHER4_CLETUS)
    then
    054E: clear_actor USHER4_CLETUS damage
    0829: actor USHER4_CLETUS perform_animation "crckdeth1" IFP_file "crack" rate 4.0 time 0 and_dies
    USHER4_CLETUS_DIED_FLAG = 1
    jump to @USHER4_DOPROC_FAILED
    end
    
    until $DIALOG_END == 1
    
    v$OBJECTIVE = "STRB101"
    
    repeat
    wait 0
    
    Audiostream.Volume(USHER4_3D_ZMB_SND1) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND2) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND3) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND4) = $SOUNDS_VOLUME
    
    if
    not actor.Dead(PLAYER_ACTOR)
    jf @USHER4_FAILED_PLAYER_DIED
    if and
    $CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
    not BASE_TEAMMATE_AGRED == 1
    jf @USHER4_FAILED_AGRO
    if
    803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
    jf @USHER4_FAILED_LDEAD
    
    if
    actor.Dead(USHER4_CLETUS)
    then
    054E: clear_actor USHER4_CLETUS damage
    0829: actor USHER4_CLETUS perform_animation "crckdeth1" IFP_file "crack" rate 4.0 time 0 and_dies
    USHER4_CLETUS_DIED_FLAG = 1
    jump to @USHER4_DOPROC_FAILED
    end
    
    until 051A:   actor USHER4_CLETUS damaged_by_actor PLAYER_ACTOR
    
    054E: clear_actor USHER4_CLETUS damage 
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY541"
    v$ST_DIALOG[1] = "STRY542"
    v$ST_DIALOG[2] = "STR542" 
    $DIALOG_COUNT = 2
    $DIALOG_NOT_SKIP = 1
    create_thread @DG_SYS2
    
    repeat
    wait 0
    
    Audiostream.Volume(USHER4_3D_ZMB_SND1) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND2) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND3) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND4) = $SOUNDS_VOLUME
    
    if
    not actor.Dead(PLAYER_ACTOR)
    jf @USHER4_FAILED_PLAYER_DIED
    if and
    $CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
    not BASE_TEAMMATE_AGRED == 1
    jf @USHER4_FAILED_AGRO
    if
    803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
    jf @USHER4_FAILED_LDEAD
    
    if
    actor.Dead(USHER4_CLETUS)
    then
    054E: clear_actor USHER4_CLETUS damage
    0829: actor USHER4_CLETUS perform_animation "crckdeth1" IFP_file "crack" rate 4.0 time 0 and_dies
    USHER4_CLETUS_DIED_FLAG = 1
    jump to @USHER4_DOPROC_FAILED
    end
    
    until $DIALOG_END == 1
    
    v$OBJECTIVE = "STRB102"
    
    repeat
    wait 0
    
    Audiostream.Volume(USHER4_3D_ZMB_SND1) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND2) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND3) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND4) = $SOUNDS_VOLUME
    
    if
    not actor.Dead(PLAYER_ACTOR)
    jf @USHER4_FAILED_PLAYER_DIED
    if and
    $CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
    not BASE_TEAMMATE_AGRED == 1
    jf @USHER4_FAILED_AGRO
    if
    803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
    jf @USHER4_FAILED_LDEAD
    
    if
    actor.Dead(USHER4_CLETUS)
    then
    054E: clear_actor USHER4_CLETUS damage
    0829: actor USHER4_CLETUS perform_animation "crckdeth1" IFP_file "crack" rate 4.0 time 0 and_dies
    USHER4_CLETUS_DIED_FLAG = 1
    jump to @USHER4_DOPROC_FAILED
    end
    
    until 051A:   actor USHER4_CLETUS damaged_by_actor PLAYER_ACTOR
    
    054E: clear_actor USHER4_CLETUS damage 
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STR543"
    v$ST_DIALOG[1] = "STY544"
    v$ST_DIALOG[2] = "STRY543" 
    v$ST_DIALOG[3] = "STRY544"
    $DIALOG_COUNT = 3
    $DIALOG_NOT_SKIP = 1
    create_thread @DG_SYS2
    
    repeat
    wait 0
    
    Audiostream.Volume(USHER4_3D_ZMB_SND1) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND2) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND3) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND4) = $SOUNDS_VOLUME
    
    if
    not actor.Dead(PLAYER_ACTOR)
    jf @USHER4_FAILED_PLAYER_DIED
    if and
    $CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
    not BASE_TEAMMATE_AGRED == 1
    jf @USHER4_FAILED_AGRO
    if
    803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
    jf @USHER4_FAILED_LDEAD
    
    if
    actor.Dead(USHER4_CLETUS)
    then
    054E: clear_actor USHER4_CLETUS damage
    0829: actor USHER4_CLETUS perform_animation "crckdeth1" IFP_file "crack" rate 4.0 time 0 and_dies
    USHER4_CLETUS_DIED_FLAG = 1
    jump to @USHER4_DOPROC_FAILED
    end
    
    until $DIALOG_END == 1 
    
    v$OBJECTIVE = "STRB103"
    
    repeat
    wait 0
    
    Audiostream.Volume(USHER4_3D_ZMB_SND1) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND2) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND3) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND4) = $SOUNDS_VOLUME
    
    if
    not actor.Dead(PLAYER_ACTOR)
    jf @USHER4_FAILED_PLAYER_DIED
    if and
    $CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
    not BASE_TEAMMATE_AGRED == 1
    jf @USHER4_FAILED_AGRO
    if
    803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
    jf @USHER4_FAILED_LDEAD
    
    if
    actor.Dead(USHER4_CLETUS)
    then
    054E: clear_actor USHER4_CLETUS damage
    0829: actor USHER4_CLETUS perform_animation "crckdeth1" IFP_file "crack" rate 4.0 time 0 and_dies
    USHER4_CLETUS_DIED_FLAG = 1
    jump to @USHER4_DOPROC_FAILED
    end
    
    until 051A:   actor USHER4_CLETUS damaged_by_actor PLAYER_ACTOR
    
    054E: clear_actor USHER4_CLETUS damage
    
    0829: actor USHER4_CLETUS perform_animation "crckdeth1" IFP_file "crack" rate 4.0 time 0 and_dies
    
    v$OBJECTIVE = "DUMMY"
    USHER4_CLETUS_DIED_FLAG = 0        
     
    end
    
    :USHER4_DOPROC_FAILED     
    
    v$OBJECTIVE = "STRB104"
    018A: MISSION_CHECKPOINT = create_checkpoint_at 2626.7358 217.2077 53.7536
    03BC: MISSION_SPHERE = create_sphere_at 2626.7358 217.2077 53.7536 radius 1.0
    
    repeat
    wait 0
    
    Audiostream.Volume(USHER4_3D_ZMB_SND1) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND2) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND3) = $SOUNDS_VOLUME
    Audiostream.Volume(USHER4_3D_ZMB_SND4) = $SOUNDS_VOLUME
    
    if and
    0E3D: is_key_just_pressed 69
    $CHEATS_ON == 1
    then
    actor.PutAtNoOffset(PLAYER_ACTOR,2626.7358 217.2077 53.7536)
    camera.Restore_WithJumpCut()
    create_thread @3D_REFR
    $END_DIALOG_INST = 1
    wait 0
    end
    
    if
    not actor.Dead(PLAYER_ACTOR)
    jf @USHER4_FAILED_PLAYER_DIED
    if and
    $CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
    not BASE_TEAMMATE_AGRED == 1
    jf @USHER4_FAILED_AGRO
    if
    803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
    jf @USHER4_FAILED_LDEAD
    
    until 0EEA: locate_char_distance_to_coordinates PLAYER_ACTOR pos 2626.7358 217.2077 53.7536 radius 1.0
    
    v$OBJECTIVE = "DUMMY"
    03BD: destroy_sphere MISSION_SPHERE
    marker.Disable(MISSION_CHECKPOINT)           
    
    fade 0 500
    player.CanMove(PLAYER_CHAR,false)
    $HUD_REMOVE = 1
    wait 500
    
    0AF0: 0@ = get_int_from_ini_file "saves\ZACM.set" section "SCR" key "USHER_MISS4_CHECKPOINT"
    if 
    0@ < 3
    then
    0AF1: write_int 3 to_ini_file "saves\ZACM.set" section "SCR" key "USHER_MISS4_CHECKPOINT"
    0AF1: write_int USHER4_CLETUS_DIED_FLAG to_ini_file "saves\ZACM.set" section "SCR" key "USHER_MISS4_CLETUS_DIED"
    $SAVE_CAR_MODEL[LATEST_CAR_SLOT_USED] = 15593
    end
    
    actor.DestroyInstantly(USHER4_ERNIE)
    actor.DestroyInstantly(USHER4_BOXUS)
    actor.DestroyInstantly(USHER4_CLETUS)
    actor.DestroyInstantly(USHER4_BRODY)
    audiostream.Release(USHER4_3D_ZMB_SND1)
    audiostream.Release(USHER4_3D_ZMB_SND2)
    audiostream.Release(USHER4_3D_ZMB_SND3)
    audiostream.Release(USHER4_3D_ZMB_SND4) 
    
    0924: enable_screen_darkness 0 with_value -1
    
    :USHER4_INSTAJUMP_TO_OUTHOUSE_PART                        
    
    select_interior 0
    0860: link_actor PLAYER_ACTOR to_interior 0
    04FA: reset_sky_colors_with_fade 0 
    
    actor.PutAtNoOffset(PLAYER_ACTOR,2627.322998 227.348328 59.889698)
    actor.Angle(PLAYER_ACTOR) = 0.0
    camera.Restore_WithJumpCut()
    
    :CAR_CREATE_USHER4_GLENSHIT
    if
    model.Available(#GLENSHIT)
    then
    
    //0674: set_car_model #GLENSHIT numberplate "MT2WH0L3"    
    USHER4_GLENSHIT = Car.Create(#GLENSHIT, 2618.567383, 214.640030, 59.210266)
    car.Angle(USHER4_GLENSHIT) = 356.315247
    0229: set_car USHER4_GLENSHIT primary_color_to 3 secondary_color_to 0
        
    if
    model.Available(#GLENSHIT)
    then
    //model.Destroy(#GLENSHIT)
    end
        
    else
    model.Load(#GLENSHIT)
    mload
    wait 0
    jump to @CAR_CREATE_USHER4_GLENSHIT
    end    
        
    /////////////////////////////////////////
    
    while not model.Available(#MALE01)
    wait 0
    model.Load(#MALE01)
    mload
    end
    
    USHER4_GLENSHIT_ACTOR = actor.CreateAsPassenger(26,#MALE01,USHER4_GLENSHIT,0)
    actor.Health(USHER4_GLENSHIT_ACTOR) = 9999
    actor.SetImmunities(USHER4_GLENSHIT_ACTOR,1,1,1,1,1)
    0337: set_actor USHER4_GLENSHIT_ACTOR visibility 0
    039E: set_actor USHER4_GLENSHIT_ACTOR locked 1 while_in_car
    0E0B: mark_char_as_needed USHER4_GLENSHIT_ACTOR
        
    0A97: 11@ = car USHER4_GLENSHIT struct 
    11@ += 9 
    0A8D: 12@ = read_memory 11@ size 1 virtual_protect 0 
    08BD: set 12@ bit 2 
    0A8C: write_memory 11@ size 1 value 12@ virtual_protect 0 
    0A97: 11@ = car USHER4_GLENSHIT struct 
    11@ += 4 
    0A8D: 12@ = read_memory 11@ size 1 virtual_protect 0 
    08BD: set 12@ bit 1 
    0A8C: write_memory 11@ size 1 value 12@ virtual_protect 0 
    24@ = 25.0 
    0A97: 22@ = car USHER4_GLENSHIT struct 
    0A8E: 23@ = 22@ + 5 // int 
    0A8C: write_memory 23@ size 4 value 24@ virtual_protect 0 
    08C3: clear 12@ bit 1 
    08C3: clear 12@ bit 2 
    0A97: 11@ = car USHER4_GLENSHIT struct 
    11@ += 18 
    0A8D: 12@ = read_memory 11@ size 1 virtual_protect 0 
    08BD: set 12@ bit 2 
    0A8C: write_memory 11@ size 1 value 12@ virtual_protect 0 
    08C3: clear 12@ bit 2
    car.Health(USHER4_GLENSHIT) = 700
    
    /////////////////////////////////////////
    
    032B: 0@ = create_weapon_pickup #CHNSAW type 15 ammo 1 at 2688.543701 231.876389 57.059517
    
    $ZOMBIE_SPAWN_ON_COORD = 1  
    $ZOMBIE_COORD_MAX = 9
    ZOMBIES_NOTSPAWN = 0 
    $ZOMBIES_COUNT = 20
    $ZOMBIES_ALWAYS_VISIBLE = 1 
            
    $ZOMBIE_X[0] = 2623.7422
    $ZOMBIE_Y[0] = 236.3438
    $ZOMBIE_Z[0] = 58.6686
            
    $ZOMBIE_X[1] = 2631.9158
    $ZOMBIE_Y[1] = 234.1369
    $ZOMBIE_Z[1] = 58.5876
            
    $ZOMBIE_X[2] = 2636.7263
    $ZOMBIE_Y[2] = 225.308
    $ZOMBIE_Z[2] = 59.3277
            
    $ZOMBIE_X[3] = 2636.6301
    $ZOMBIE_Y[3] = 214.0617
    $ZOMBIE_Z[3] = 59.6816
            
    $ZOMBIE_X[4] = 2629.0952
    $ZOMBIE_Y[4] = 204.8459
    $ZOMBIE_Z[4] = 58.9352
            
    $ZOMBIE_X[5] = 2617.3787
    $ZOMBIE_Y[5] = 206.6218
    $ZOMBIE_Z[5] = 58.6276
            
    $ZOMBIE_X[6] = 2611.8113
    $ZOMBIE_Y[6] = 214.938
    $ZOMBIE_Z[6] = 59.5341
            
    $ZOMBIE_X[7] = 2612.3433
    $ZOMBIE_Y[7] = 228.8465
    $ZOMBIE_Z[7] = 59.5087
            
    $ZOMBIE_X[8] = 2616.6021
    $ZOMBIE_Y[8] = 234.4804
    $ZOMBIE_Z[8] = 59.1195
    
    $SAVESTATUS = 0
    
    repeat
    wait 0
    until $ZOMBIE_SPAWNED_COUNT >= 18
    
    wait 500
    $ZOMBIE_SPAWN_ON_COORD = 0
    ZOMBIES_NOTSPAWN = 1
    
    fade 1 500
    player.CanMove(PLAYER_CHAR,true)
    $HUD_REMOVE = 0
    wait 500
    
    $MUSIC_MISSION = Audiostream.Load("audio\sounds\music\usher_music\MISS4\theme9.mp3")
    Audiostream.PerformAction($MUSIC_MISSION, PLAY)
    Audiostream.Loop($MUSIC_MISSION, 1)
    Audiostream.Volume($MUSIC_MISSION) = VERO_TIPA_VOLUME
    
    /////////////////////Плавное нарастание/////////////////////
//    
//    $MUSIC_FADE_NUMBER += 1
//    if
//    $MUSIC_FADE_NUMBER > 4
//        then
//        $MUSIC_FADE_NUMBER = 0 
//        end    
//    
//    0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_MISSION // (int) 
//    0086: $MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = $MUSIC_VOLUME // (float) 
//    
//    $MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 1000
//    $MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 1  
//    $MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
//    create_thread @MUS_FAD
//    
//    wait 1 
    250A: SET_AUDIO_STREAM_TYPE $MUSIC_MISSION type 2 
    2504: SET_AUDIO_STREAM_VOLUME_WITH_TRANSITION $MUSIC_MISSION volume $MUSIC_VOLUME time 1000
    
    ////////////////////////////////////////////////////////
    
    v$OBJECTIVE = "STRB17"
    
    $ZOMBIES_ALWAYS_VISIBLE = 0
    
    repeat
    wait 0
    
    if
    0EEA: locate_char_distance_to_coordinates PLAYER_ACTOR pos 2618.567383 214.640030 59.210266 radius 160.0
    jf @USHER4_FAILED_WALK2
    
    if and
    0E3D: is_key_just_pressed 69
    $CHEATS_ON == 1
    then
    
    for 0@ = 0 to 19
    if
    056D:   actor $ZOMBIE[0@] defined
        then
        05BE: AS_actor $ZOMBIE[0@] die
        end
    end
    
    end
    
    if
    not actor.Dead(PLAYER_ACTOR)
    jf @USHER4_FAILED_PLAYER_DIED
    if and
    $CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
    not BASE_TEAMMATE_AGRED == 1
    jf @USHER4_FAILED_AGRO
    if
    803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
    jf @USHER4_FAILED_LDEAD
    
    until $ZOMBIE_SPAWNED_COUNT == 0
    
    if
    USHER4_CLETUS_DIED_FLAG == 1
    then
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STR544" 
    $DIALOG_COUNT = 0
    $DIALOG_NOT_SKIP = 1
    create_thread @DG_SYS2 
    v$OBJECTIVE = "STB105"            
    else
    v$OBJECTIVE = "STRB105"            
    018A: MISSION_CHECKPOINT = create_checkpoint_at 2675.927002 210.455215 59.072762
    03BC: MISSION_SPHERE = create_sphere_at 2675.927002 210.455215 59.072762 radius 1.0            
    end     
    
    repeat
    wait 0
    
    if
    0EEA: locate_char_distance_to_coordinates PLAYER_ACTOR pos 2618.567383 214.640030 59.210266 radius 160.0
    jf @USHER4_FAILED_WALK2   
    
    if and
    0E3D: is_key_just_pressed 69
    $CHEATS_ON == 1
    then
    actor.PutAtNoOffset(PLAYER_ACTOR,2675.927002 210.455215 59.072762)
    camera.Restore_WithJumpCut()
    create_thread @3D_REFR
    $END_DIALOG_INST = 1
    wait 0
    end    
    
    if
    not actor.Dead(PLAYER_ACTOR)
    jf @USHER4_FAILED_PLAYER_DIED
    if and
    $CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
    not BASE_TEAMMATE_AGRED == 1
    jf @USHER4_FAILED_AGRO
    if
    803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
    jf @USHER4_FAILED_LDEAD
    
    until 0EEA: locate_char_distance_to_coordinates PLAYER_ACTOR pos 2675.927002 210.455215 59.072762 radius 1.0
    
    v$OBJECTIVE = "DUMMY"
    03BD: destroy_sphere MISSION_SPHERE
    marker.Disable(MISSION_CHECKPOINT)
    
    fade 0 500
    player.CanMove(PLAYER_CHAR,false)
    $HUD_REMOVE = 1
    wait 500
    
    select_interior 1
    0860: link_actor PLAYER_ACTOR to_interior 1
    04F9: set_sky_color 1 fade 0 
    
    actor.PutAtNoOffset(PLAYER_ACTOR,2680.875977 210.939529 53.731319)
    actor.Angle(PLAYER_ACTOR) = 90.0
    camera.Restore_WithJumpCut()   
    
    ///////////////////////////////////////////////////////////
    
    while not model.Available(3142)
    wait 0
    model.Load(3142)
    mload
    end
    
    USHER4_VERONICA = actor.Create(26,3142,2680.102783, 203.726608, 53.723888)
    actor.Angle(USHER4_VERONICA) = 12.906308
    0860: link_actor USHER4_VERONICA to_interior 1
         
    0D10: set_actor USHER4_VERONICA alpha 255 // IF and SET        
    
    actor.Health(USHER4_VERONICA) = 250
    
    0D10: set_actor USHER4_VERONICA alpha 255 // IF and SET
    09F4: set_actor USHER4_VERONICA ignore_height_difference_following_nodes $Z_IGNORE_HEIGHT     
    Actor.SetWalkStyle(USHER4_VERONICA, "SURV1")
    0446: set_actor USHER4_VERONICA dismemberment_possible 0
    060B: set_actor USHER4_VERONICA decision_maker_to $DEC_PEOPLE
    07DD: set_actor USHER4_VERONICA attack_rate 50 // previously known as temper_to
    081A: set_actor USHER4_VERONICA weapon_skill_to 2  
    060F: set_actor USHER4_VERONICA melee_accuracy_to 999.0
    0946: set_actor USHER4_VERONICA actions_uninterupted_by_weapon_fire 1
    
    if
    UNITED_MAP == 0
    then
    04D8: set_actor USHER4_VERONICA drowns_in_water 0 
    end
    
    09B5: set_actor USHER4_VERONICA signal_after_kill 0  
    0A96: 0@ = actor USHER4_VERONICA struct
    0A8E: 0@ = 0@ + 1376
    0A8C: write_memory 0@ size 4 value $SURVIVORS_ROTATE_SPEED virtual_protect 1
    
    08AF: set_actor USHER4_VERONICA max_health_to 250
    Actor.WeaponAccuracy(USHER4_VERONICA) = $SURV_ACCURACY
    
    05C5: AS_actor USHER4_VERONICA cower 999999 ms
    
    ///////////////////////////////////////////////////////////
    
    while not model.Available(1199)
    wait 0
    model.Load(1199)
    mload
    end
    
    USHER4_ANGIE = actor.Create(26,1199,2679.235596, 205.898773, 53.723888)
    actor.Angle(USHER4_ANGIE) = 180.0
    0860: link_actor USHER4_ANGIE to_interior 1
    
    actor.SetImmunities(USHER4_ANGIE,1,1,1,1,1) //только попробуй это убрать, грязный ублюдок!!!
         
    0D10: set_actor USHER4_ANGIE alpha 255 // IF and SET        
    
    actor.Health(USHER4_ANGIE) = 100
    
    0D10: set_actor USHER4_ANGIE alpha 255 // IF and SET
    09F4: set_actor USHER4_ANGIE ignore_height_difference_following_nodes $Z_IGNORE_HEIGHT     
    Actor.SetWalkStyle(USHER4_ANGIE, "SURV1")
    0446: set_actor USHER4_ANGIE dismemberment_possible 0
    060B: set_actor USHER4_ANGIE decision_maker_to $DEC_PEOPLE
    07DD: set_actor USHER4_ANGIE attack_rate 50 // previously known as temper_to
    081A: set_actor USHER4_ANGIE weapon_skill_to 2  
    060F: set_actor USHER4_ANGIE melee_accuracy_to 999.0
    0946: set_actor USHER4_ANGIE actions_uninterupted_by_weapon_fire 1
    
    if
    UNITED_MAP == 0
    then
    04D8: set_actor USHER4_ANGIE drowns_in_water 0 
    end
    
    09B5: set_actor USHER4_ANGIE signal_after_kill 0  
    0A96: 0@ = actor USHER4_ANGIE struct
    0A8E: 0@ = 0@ + 1376
    0A8C: write_memory 0@ size 4 value $SURVIVORS_ROTATE_SPEED virtual_protect 1
    
    08AF: set_actor USHER4_ANGIE max_health_to 100
    Actor.WeaponAccuracy(USHER4_ANGIE) = $SURV_ACCURACY
    
    05C5: AS_actor USHER4_ANGIE cower 999999 ms
    
    fade 1 500
    create_thread @3D_REFR
    player.CanMove(PLAYER_CHAR,true)
    $HUD_REMOVE = 0
    wait 500   
    
    wait 1500
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY545"
    v$ST_DIALOG[1] = "STRY546"
    v$ST_DIALOG[2] = "STRY547" 
    $DIALOG_COUNT = 2
    $DIALOG_NOT_SKIP = 1
    create_thread @DG_SYS2     
    
    repeat
    wait 0        
    
    if
    not actor.Dead(USHER4_VERONICA)
    jf @USHER4_FAILED_ANGIE_BADTOUGHT      
    
    if
    not actor.Dead(PLAYER_ACTOR)
    jf @USHER4_FAILED_PLAYER_DIED
    if
    not actor.Dead(USHER4_ANGIE)
    jf @USHER4_FAILED_ANGIE_DIED
    if and
    $CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
    not BASE_TEAMMATE_AGRED == 1
    jf @USHER4_FAILED_AGRO
    if
    803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
    jf @USHER4_FAILED_LDEAD
                
    until $DIALOG_END == 1 
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY548"
    $DIALOG_COUNT = 0
    $DIALOG_NOT_SKIP = 1
    create_thread @DG_SYS2
    
    05D3: AS_actor USHER4_ANGIE goto_point 2678.930664 210.721848 53.786018 mode 4 time 9000 ms // versionA     
    
    repeat
    wait 0
    
    if
    not actor.Dead(USHER4_VERONICA)
    jf @USHER4_FAILED_ANGIE_BADTOUGHT      
    
    if
    not actor.Dead(PLAYER_ACTOR)
    jf @USHER4_FAILED_PLAYER_DIED
    if
    not actor.Dead(USHER4_ANGIE)
    jf @USHER4_FAILED_ANGIE_DIED
    if and
    $CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
    not BASE_TEAMMATE_AGRED == 1
    jf @USHER4_FAILED_AGRO
    if
    803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
    jf @USHER4_FAILED_LDEAD
     
    until $DIALOG_END == 1     
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY549"
    v$ST_DIALOG[1] = "STRY550"
    v$ST_DIALOG[2] = "STRY551" 
    $DIALOG_COUNT = 2
    $DIALOG_NOT_SKIP = 1
    create_thread @DG_SYS2     
    
    repeat
    wait 0
    
    if
    0E45: frame_mod 30
    then
    0A1D: AS_actor USHER4_MARJORI rotate_to_and_look_at_actor PLAYER_ACTOR
    end    
    
    if
    not actor.Dead(USHER4_VERONICA)
    jf @USHER4_FAILED_ANGIE_BADTOUGHT   
    
    if and
    0E3D: is_key_just_pressed 69
    $CHEATS_ON == 1
    then
    break
    $END_DIALOG_INST = 1
    wait 0
    end     
    
    if
    not actor.Dead(PLAYER_ACTOR)
    jf @USHER4_FAILED_PLAYER_DIED
    if
    not actor.Dead(USHER4_ANGIE)
    jf @USHER4_FAILED_ANGIE_DIED
    if and
    $CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
    not BASE_TEAMMATE_AGRED == 1
    jf @USHER4_FAILED_AGRO
    if
    803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
    jf @USHER4_FAILED_LDEAD
              
    until $DIALOG_END == 1 
    
    05D3: AS_actor USHER4_ANGIE goto_point 2681.3601 210.9914 53.7239 mode 4 time 9000 ms // versionA
    wait 1000
    
    repeat
    wait 0
    
    if
    not actor.Dead(USHER4_VERONICA)
    jf @USHER4_FAILED_ANGIE_BADTOUGHT
    
    if and
    0E3D: is_key_just_pressed 69
    $CHEATS_ON == 1
    then
    break
    $END_DIALOG_INST = 1
    wait 0
    end
    
    if
    not actor.Dead(PLAYER_ACTOR)
    jf @USHER4_FAILED_PLAYER_DIED
    if
    not actor.Dead(USHER4_ANGIE)
    jf @USHER4_FAILED_ANGIE_DIED
    if and
    $CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
    not BASE_TEAMMATE_AGRED == 1
    jf @USHER4_FAILED_AGRO
    if
    803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
    jf @USHER4_FAILED_LDEAD
    
    until 02A0:   actor USHER4_ANGIE stopped
    
    0337: set_actor USHER4_ANGIE visibility 0
    0619: enable_actor USHER4_ANGIE collision_detection 0
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY552"
    v$ST_DIALOG[1] = "STRY553" 
    $DIALOG_COUNT = 1
    $DIALOG_NOT_SKIP = 1
    create_thread @DG_SYS2     
    
    repeat
    wait 0        
    
    if
    not actor.Dead(PLAYER_ACTOR)
    jf @USHER4_FAILED_PLAYER_DIED
    if
    not actor.Dead(USHER4_ANGIE)
    jf @USHER4_FAILED_ANGIE_DIED
    if and
    $CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
    not BASE_TEAMMATE_AGRED == 1
    jf @USHER4_FAILED_AGRO
    if
    803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
    jf @USHER4_FAILED_LDEAD
              
    until $DIALOG_END == 1
    
    v$OBJECTIVE = "STRB106"
    MISSION_MARKER = marker.CreateAboveActor(USHER4_VERONICA)
    
    repeat
    wait 0  
    Animation.Load("ON_LOOKERS") 
    until Animation.Available("ON_LOOKERS")
    
    0605: actor USHER4_VERONICA perform_animation "panic_hide" IFP "ON_LOOKERS" framedelta 4.0 loop 1 lockX 0 lockY 0 lockF 0 time 9999999
    
    repeat
    wait 0
    
    if and
    0E3D: is_key_just_pressed 69
    $CHEATS_ON == 1
    then
    05BE: AS_actor USHER4_VERONICA die
    $END_DIALOG_INST = 1
    wait 0
    end
    
    if
    not actor.Dead(PLAYER_ACTOR)
    jf @USHER4_FAILED_PLAYER_DIED
    if
    not actor.Dead(USHER4_ANGIE)
    jf @USHER4_FAILED_ANGIE_DIED
    if and
    $CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
    not BASE_TEAMMATE_AGRED == 1
    jf @USHER4_FAILED_AGRO
    if
    803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
    jf @USHER4_FAILED_LDEAD
    
    if and
    0E47: is_char_fighting PLAYER_ACTOR
    051A:   actor USHER4_VERONICA damaged_by_actor PLAYER_ACTOR
    $DIALOG_END == 1
        then
        054E: clear_actor USHER4_VERONICA damage                
        
        $END_DIALOG_INST = 1
        wait 0
        random_int 0@ 554 557
        0AD3: v$ST_DIALOG[0] = format "STRY%d" 0@
        $DIALOG_COUNT = 0
        $DIALOG_NOT_SKIP = 1
        create_thread @DG_SYS2
        
        end
    
    until actor.Dead(USHER4_VERONICA)
    
    v$OBJECTIVE = "DUMMY"
    marker.Disable(MISSION_MARKER)
    
    if
    8E46: not is_char_using_gun PLAYER_ACTOR
    then
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY557"
    $DIALOG_COUNT = 0
    $DIALOG_NOT_SKIP = 1
    create_thread @DG_SYS2
    end
    
    v$OBJECTIVE = "STRB107"    
    018A: MISSION_CHECKPOINT = create_checkpoint_at 2681.0315 210.9518 53.7239
    03BC: MISSION_SPHERE = create_sphere_at 2681.0315 210.9518 53.7239 radius 1.0
    
    repeat
    wait 0
    
    if and
    0E3D: is_key_just_pressed 69
    $CHEATS_ON == 1
    then
    actor.PutAtNoOffset(PLAYER_ACTOR,2681.0315 210.9518 53.7239)
    camera.Restore_WithJumpCut()
    create_thread @3D_REFR
    $END_DIALOG_INST = 1
    wait 0
    end
    
    if
    not actor.Dead(PLAYER_ACTOR)
    jf @USHER4_FAILED_PLAYER_DIED
    if
    not actor.Dead(USHER4_ANGIE)
    jf @USHER4_FAILED_ANGIE_DIED
    if and
    $CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
    not BASE_TEAMMATE_AGRED == 1
    jf @USHER4_FAILED_AGRO
    if
    803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
    jf @USHER4_FAILED_LDEAD
    
    until 0EEA: locate_char_distance_to_coordinates PLAYER_ACTOR pos 2681.0315 210.9518 53.7239 radius 1.0
    
    v$OBJECTIVE = "DUMMY"
    03BD: destroy_sphere MISSION_SPHERE
    marker.Disable(MISSION_CHECKPOINT)   
    
    /////////////////////Плавное затухание/////////////////////
//
//    $MUSIC_FADE_NUMBER += 1
//    if
//    $MUSIC_FADE_NUMBER > 4
//        then
//        $MUSIC_FADE_NUMBER = 0 
//        end    
//            
//    0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_MISSION // (int)
//    $MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = 0.0
//            
//    $MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 500
//    $MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 0  
//    $MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
//    create_thread @MUS_FAD
    2504: SET_AUDIO_STREAM_VOLUME_WITH_TRANSITION $MUSIC_MISSION volume 0.0 time 500
    
    ///////////////////////////////////////////////////////////        
    
    fade 0 500
    player.CanMove(PLAYER_CHAR,false)
    $HUD_REMOVE = 1
    wait 500
    audiostream.Release($MUSIC_MISSION)
    
    0631: put_actor USHER4_ANGIE in_group PLAYER_GROUP
    0337: set_actor USHER4_ANGIE visibility 1
    0619: enable_actor USHER4_ANGIE collision_detection 1
    actor.DestroyInstantly(USHER4_VERONICA)
    
    wait 500
    
    select_interior 0
    0860: link_actor PLAYER_ACTOR to_interior 0
    0860: link_actor USHER4_ANGIE to_interior 0
    04FA: reset_sky_colors_with_fade 0
    
    $MUSIC_MISSION = Audiostream.Load("audio\sounds\music\usher_music\MISS4\theme10.mp3")
    Audiostream.PerformAction($MUSIC_MISSION, PLAY)
    Audiostream.Loop($MUSIC_MISSION, 1)
    Audiostream.Volume($MUSIC_MISSION) = VERO_TIPA_VOLUME
    
    /////////////////////Плавное нарастание/////////////////////
//    
//    $MUSIC_FADE_NUMBER += 1
//    if
//    $MUSIC_FADE_NUMBER > 4
//        then
//        $MUSIC_FADE_NUMBER = 0 
//        end    
//    
//    0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_MISSION // (int) 
//    0086: $MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = $MUSIC_VOLUME // (float) 
//    
//    $MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 1000
//    $MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 1  
//    $MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
//    create_thread @MUS_FAD
//    
//    wait 1 
    250A: SET_AUDIO_STREAM_TYPE $MUSIC_MISSION type 2 
    2504: SET_AUDIO_STREAM_VOLUME_WITH_TRANSITION $MUSIC_MISSION volume $MUSIC_VOLUME time 1000
    
    ////////////////////////////////////////////////////////         
    
    actor.PutAtNoOffset(PLAYER_ACTOR,2675.913086 210.639236 59.072762)
    actor.Angle(PLAYER_ACTOR) = 21.854944
    camera.Restore_WithJumpCut()
    
    wait 500
    fade 1 500
    player.CanMove(PLAYER_CHAR,true)
    $HUD_REMOVE = 0
    wait 500
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY558"
    v$ST_DIALOG[1] = "STRY559" 
    $DIALOG_COUNT = 1  
    create_thread @DG_SYS2     
    
    repeat
    wait 0
    
    if
    0EEA: locate_char_distance_to_coordinates PLAYER_ACTOR pos 2618.567383 214.640030 59.210266 radius 160.0
    jf @USHER4_FAILED_WALK2         
    
    if
    not actor.Dead(PLAYER_ACTOR)
    jf @USHER4_FAILED_PLAYER_DIED
    if
    not actor.Dead(USHER4_ANGIE)
    jf @USHER4_FAILED_ANGIE_DIED
    if and
    $CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
    not BASE_TEAMMATE_AGRED == 1
    jf @USHER4_FAILED_AGRO
    if
    803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
    jf @USHER4_FAILED_LDEAD
    if
    not car.Wrecked(SUPPLY_QUEST_TRUCK)
    jf @USHER4_FAILED_CAR_WRECKED
             
    until $DIALOG_END == 1
    
    v$OBJECTIVE = "STRB108"    
    MISSION_MARKER = marker.CreateAboveCar(SUPPLY_QUEST_TRUCK)
    07E0: set_marker MISSION_MARKER type_to 1
    
    repeat
    wait 0
    
    if
    0EEA: locate_char_distance_to_coordinates PLAYER_ACTOR pos 2618.567383 214.640030 59.210266 radius 160.0
    jf @USHER4_FAILED_WALK2
       
    
    if and
    0E3E: is_button_just_pressed 0 button 17
    $CHEATS_ON == 1
    then
    $END_DIALOG_INST = 1
    wait 0
    036A: put_actor PLAYER_ACTOR in_car SUPPLY_QUEST_TRUCK
    0430: put_actor USHER4_ANGIE into_car SUPPLY_QUEST_TRUCK passenger_seat 2
    camera.Restore_WithJumpCut() 
    break
    end  
    
    if
    not actor.Dead(PLAYER_ACTOR)
    jf @USHER4_FAILED_PLAYER_DIED
    if
    not actor.Dead(USHER4_ANGIE)
    jf @USHER4_FAILED_ANGIE_DIED
    if and
    $CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
    not BASE_TEAMMATE_AGRED == 1
    jf @USHER4_FAILED_AGRO
    if
    803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
    jf @USHER4_FAILED_LDEAD
    if
    not car.Wrecked(SUPPLY_QUEST_TRUCK)
    jf @USHER4_FAILED_CAR_WRECKED    
    
    if and
    actor.InCar(PLAYER_ACTOR,SUPPLY_QUEST_TRUCK)
    actor.InCar(USHER4_ANGIE,SUPPLY_QUEST_TRUCK)
        then  
        break
        end
    
    until false 
    
    v$OBJECTIVE = "DUMMY"
    marker.Disable(MISSION_MARKER)
    
    06C9: remove_actor USHER4_ANGIE from_group   
    
    v$OBJECTIVE = "STRB109"    
    018A: MISSION_CHECKPOINT = create_checkpoint_at 278.280029 -55.989563 1.578127
    03BC: MISSION_SPHERE = create_sphere_at 278.280029 -55.989563 1.578127 radius 2.0
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY560"
    v$ST_DIALOG[1] = "STRY561"
    v$ST_DIALOG[2] = "STRY562"
    v$ST_DIALOG[3] = "STRY563" 
    $DIALOG_COUNT = 3
    create_thread @DG_SYS2  
    
    0@ = 0
    
    ZOMBIES_NOTSPAWN = 0
    car.RemoveReferences(SUPPLY_QUEST_TRUCK)
    
    repeat
    wait 0 
    
    ///////////////////////////////////////////////////

    if and
    056E:   car USHER4_GLENSHIT defined
    not USHER4_VICTORIA_GOT_BACK_FLAG == 1
    then
            
    if
    not car.Wrecked(USHER4_GLENSHIT)
    jf @USHER4_FAILED_CAR_WRECKED
            
    if
    not actor.InCar(PLAYER_ACTOR,USHER4_GLENSHIT)
        then
        03BD: destroy_sphere MISSION_SPHERE
        marker.Disable(MISSION_CHECKPOINT)         
        gosub @USHER4_GET_BACK_IN_CAR2
        v$OBJECTIVE = "STRB109"    
        018A: MISSION_CHECKPOINT = create_checkpoint_at 278.280029 -55.989563 1.578127
        03BC: MISSION_SPHERE = create_sphere_at 278.280029 -55.989563 1.578127 radius 2.0  
        end
    else
    jump to @USHER4_FAILED_CAR_WRECKED
    end
            
    ///////////////////////////////////////////////////
    
    if and
    0E3E: is_button_just_pressed 0 button 17
    $CHEATS_ON == 1
    then
    actor.PutAtNoOffset(PLAYER_ACTOR,277.8444, -55.7489, 1.18)
    camera.Restore_WithJumpCut()
    create_thread @3D_REFR
    $END_DIALOG_INST = 1
    wait 0
    end  
    
    if
    not actor.Dead(PLAYER_ACTOR)
    jf @USHER4_FAILED_PLAYER_DIED
    if
    not actor.Dead(USHER4_ANGIE)
    jf @USHER4_FAILED_ANGIE_DIED
    if and
    $CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
    not BASE_TEAMMATE_AGRED == 1
    jf @USHER4_FAILED_AGRO
    if
    803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
    jf @USHER4_FAILED_LDEAD
    if
    not car.Wrecked(SUPPLY_QUEST_TRUCK)
    jf @USHER4_FAILED_CAR_WRECKED
    
    if and
    0EEA: locate_char_distance_to_coordinates PLAYER_ACTOR pos 267.804291 -54.703377 2.777212 radius 30.0
    0@ == 0
        then
        0@ = 1        
        $END_DIALOG_INST = 1
        wait 0
        v$ST_DIALOG[0] = "STRY564"
        $DIALOG_COUNT = 0
        create_thread @DG_SYS2                    
        end
    
    until 0EEA: locate_char_distance_to_coordinates PLAYER_ACTOR pos 278.280029 -55.989563 1.578127 radius 2.0                
    
    v$OBJECTIVE = "DUMMY"
    03BD: destroy_sphere MISSION_SPHERE
    marker.Disable(MISSION_CHECKPOINT)
    
    player.CanMove(0,false)
    0221: set_player PLAYER_CHAR apply_brakes_to_car 1
    
    repeat
    wait 0
    until 01C1:   car SUPPLY_QUEST_TRUCK stopped
    
    0221: set_player PLAYER_CHAR apply_brakes_to_car 0
    
    fade 0 250
    $HUD_REMOVE = 1
    wait 250
    
    $SAVESTATUS = 1
    
    wait 500
    
    fade 1 250
    $HUD_REMOVE = 0
    wait 250
    
    actor.DestroyInstantly(USHER4_GLENSHIT_ACTOR)
    068B: set_car SUPPLY_QUEST_TRUCK all_disembark
    
    repeat
    wait 0
        
    if and
    not actor.InCar(PLAYER_ACTOR,SUPPLY_QUEST_TRUCK)
    not actor.InCar(USHER4_ANGIE,SUPPLY_QUEST_TRUCK)
        then
        break
        end
    
    until false
    
    player.CanMove(0,true)
    0850: AS_actor USHER4_ANGIE follow_actor PLAYER_ACTOR
    
    v$OBJECTIVE = "STRB110"    
    018A: MISSION_CHECKPOINT = create_checkpoint_at 266.239410 -55.930531 2.777212
    03BC: MISSION_SPHERE = create_sphere_at 266.239410 -55.930531 2.777212 radius 1.0
    
    repeat
    wait 0        
    
    if
    not actor.Dead(PLAYER_ACTOR)
    jf @USHER4_FAILED_PLAYER_DIED
    if
    not actor.Dead(USHER4_ANGIE)
    jf @USHER4_FAILED_ANGIE_DIED
    if and
    $CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
    not BASE_TEAMMATE_AGRED == 1
    jf @USHER4_FAILED_AGRO
    if
    803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
    jf @USHER4_FAILED_LDEAD
    if
    not car.Wrecked(SUPPLY_QUEST_TRUCK)
    jf @USHER4_FAILED_CAR_WRECKED
     
    until 0EEA: locate_char_distance_to_coordinates PLAYER_ACTOR pos 266.239410 -55.930531 2.777212 radius 1.0
    
    03BD: destroy_sphere MISSION_SPHERE
    marker.Disable(MISSION_CHECKPOINT)        
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY565"
    v$ST_DIALOG[1] = "STRY566"
    v$ST_DIALOG[2] = "STRY567"
    v$ST_DIALOG[3] = "STRY568"
    v$ST_DIALOG[4] = "STRY569"
    v$ST_DIALOG[5] = "STRY570" 
    $DIALOG_COUNT = 5
    create_thread @DG_SYS2
    
    repeat
    wait 0         
    
    if
    not actor.Dead(PLAYER_ACTOR)
    jf @USHER4_FAILED_PLAYER_DIED
    if
    not actor.Dead(USHER4_ANGIE)
    jf @USHER4_FAILED_ANGIE_DIED
    if and
    $CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
    not BASE_TEAMMATE_AGRED == 1
    jf @USHER4_FAILED_AGRO
    if
    803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
    jf @USHER4_FAILED_LDEAD
    if
    not car.Wrecked(SUPPLY_QUEST_TRUCK)
    jf @USHER4_FAILED_CAR_WRECKED
             
    until $DIALOG_END == 1
    
    v$OBJECTIVE = "DUMMY"
    
    06C9: remove_actor USHER4_ANGIE from_group
    0687: clear_actor USHER4_ANGIE task
    05CA: AS_actor USHER4_ANGIE enter_car $USED_CAR[LATEST_CAR_SLOT_USED] passenger_seat 2 time 25000
    
    repeat
    wait 0
    until actor.InCar(USHER4_ANGIE,$USED_CAR[LATEST_CAR_SLOT_USED])
    
    ////////////////////Плавное затухание/////////////////////
//
//    $MUSIC_FADE_NUMBER += 1
//    if
//    $MUSIC_FADE_NUMBER > 4
//        then
//        $MUSIC_FADE_NUMBER = 0 
//        end    
//            
//    0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_MISSION // (int)
//    $MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = 0.0
//            
//    $MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 500
//    $MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 0  
//    $MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
//    create_thread @MUS_FAD
    2504: SET_AUDIO_STREAM_VOLUME_WITH_TRANSITION $MUSIC_MISSION volume 0.0 time 500    
    
    ///////////////////////////////////////////////////////////        
    
    fade 0 500
    player.CanMove(PLAYER_CHAR,false)
    $HUD_REMOVE = 1
    wait 500
    audiostream.Release($MUSIC_MISSION)
    
    0AF0: 0@ = get_int_from_ini_file "saves\ZACM.set" section "SCR" key "USHER_MISS4_CHECKPOINT"
    if 
    0@ < 4
    then
    0AF1: write_int 4 to_ini_file "saves\ZACM.set" section "SCR" key "USHER_MISS4_CHECKPOINT"
    end
    
    :USHER4_INSTAJUMP_TO_MARJFIGHT_PART
    
    $SAVESTATUS = 1 
    
    0776: create_objects_in_object_group "marjlam1"
    select_interior 1
    0860: link_actor PLAYER_ACTOR to_interior 1
    04F9: set_sky_color 1 fade 0 
    
    actor.PutAtNoOffset(PLAYER_ACTOR,263.294556 -67.267525 -2.976563)
    actor.Angle(PLAYER_ACTOR) = 0.8891
    camera.Restore_WithJumpCut()
    
    wait 500        
    
    while true
    wait 0
    $END_FADING_MUSIC_FAST = 1
    
    if and
    $MUSIC_FADE_ENDED[0] == 1
    $MUSIC_FADE_ENDED[1] == 1
    $MUSIC_FADE_ENDED[2] == 1
    $MUSIC_FADE_ENDED[3] == 1
    $MUSIC_FADE_ENDED[4] == 1
    then
    $END_FADING_MUSIC_FAST = 0
    break
    end
    
    end
    
    $MUSIC_MISSION = Audiostream.Load("audio\sounds\music\usher_music\MISS4\theme11.mp3")
    Audiostream.PerformAction($MUSIC_MISSION, PLAY)
    Audiostream.Loop($MUSIC_MISSION, 1)
    Audiostream.Volume($MUSIC_MISSION) = VERO_TIPA_VOLUME
    
    /////////////////////Плавное нарастание/////////////////////
//    
//    $MUSIC_FADE_NUMBER += 1
//    if
//    $MUSIC_FADE_NUMBER > 4
//        then
//        $MUSIC_FADE_NUMBER = 0 
//        end    
//    
//    0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_MISSION // (int) 
//    0086: $MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = $MUSIC_VOLUME // (float) 
//    
//    $MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 1000
//    $MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 1  
//    $MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
//    create_thread @MUS_FAD
//    
//    wait 1 
    250A: SET_AUDIO_STREAM_TYPE $MUSIC_MISSION type 2 
    2504: SET_AUDIO_STREAM_VOLUME_WITH_TRANSITION $MUSIC_MISSION volume $MUSIC_VOLUME time 1000
    
    ////////////////////////////////////////////////////////
    
    USHER4_MISHKA_OBJECT = object.Init(18894,271.147, -52.9137, -3.17)
    0453: set_object USHER4_MISHKA_OBJECT XY_rotation 190.0 180.0 angle 0.0
    
    fade 1 500
    create_thread @3D_REFR
    $HUD_REMOVE = 0
    player.CanMove(PLAYER_CHAR,true)
    wait 500 
    
    v$OBJECTIVE = "STRB111"  
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY571"
    $DIALOG_COUNT = 0
    create_thread @DG_SYS2           
    
    repeat
    wait 0        
    
    if
    not actor.Dead(PLAYER_ACTOR)
    jf @USHER4_FAILED_PLAYER_DIED
    if
    not actor.Dead(USHER4_ANGIE)
    jf @USHER4_FAILED_ANGIE_DIED
    if and
    $CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
    not BASE_TEAMMATE_AGRED == 1
    jf @USHER4_FAILED_AGRO
    if
    803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
    jf @USHER4_FAILED_LDEAD
     
    until 0EEA: locate_char_distance_to_coordinates PLAYER_ACTOR pos 263.295135 -58.227207 -2.976563 radius 1.75   
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY572"
    v$ST_DIALOG[1] = "STRY573"
    $DIALOG_COUNT = 1
    create_thread @DG_SYS2
    
    repeat
    wait 0        
    
    if
    not actor.Dead(PLAYER_ACTOR)
    jf @USHER4_FAILED_PLAYER_DIED
    if
    not actor.Dead(USHER4_ANGIE)
    jf @USHER4_FAILED_ANGIE_DIED
    if and
    $CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
    not BASE_TEAMMATE_AGRED == 1
    jf @USHER4_FAILED_AGRO
    if
    803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
    jf @USHER4_FAILED_LDEAD
     
    until 0EEA: locate_char_distance_to_coordinates PLAYER_ACTOR pos 270.920715 -55.280167 -2.969053 radius 1.0   
    
    player.CanMove(0,false)
    05D4: AS_actor PLAYER_ACTOR rotate_angle 270.5166
    wait 500
    camera.Restore_WithJumpCut()
    05C8: AS_actor PLAYER_ACTOR look_around
    
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////

    while not model.Available(1198)
    wait 0
    model.Load(1198)
    mload
    end
    
    USHER4_MARJORI = actor.Create(26,1198,263.179504, -60.404694, -3.976563)
    actor.Angle(USHER4_MARJORI) = 348.994293
    0860: link_actor USHER4_MARJORI to_interior 1
         
    0D10: set_actor USHER4_MARJORI alpha 255 // IF and SET
        
    create_thread @PED_BKP USHER4_MARJORI 371
    create_thread @ANT_PRE USHER4_MARJORI
    
    actor.Health(USHER4_MARJORI) = 2000
    
    0D10: set_actor USHER4_MARJORI alpha 255 // IF and SET
    09F4: set_actor USHER4_MARJORI ignore_height_difference_following_nodes $Z_IGNORE_HEIGHT     
    Actor.SetWalkStyle(USHER4_MARJORI, "SURV1")
    0446: set_actor USHER4_MARJORI dismemberment_possible 0
    060B: set_actor USHER4_MARJORI decision_maker_to $DEC_PEOPLE
    07DD: set_actor USHER4_MARJORI attack_rate 50 // previously known as temper_to
    081A: set_actor USHER4_MARJORI weapon_skill_to 2  
    060F: set_actor USHER4_MARJORI melee_accuracy_to 150.0
    0946: set_actor USHER4_MARJORI actions_uninterupted_by_weapon_fire 1
    0856: set_actor USHER4_MARJORI enable_crouch 0
    
    if
    UNITED_MAP == 0
    then
    04D8: set_actor USHER4_MARJORI drowns_in_water 0 
    end
    
    09B5: set_actor USHER4_MARJORI signal_after_kill 0  
    0A96: 0@ = actor USHER4_MARJORI struct
    0A8E: 0@ = 0@ + 1376
    0A8C: write_memory 0@ size 4 value $SURVIVORS_ROTATE_SPEED virtual_protect 1
    
    08AF: set_actor USHER4_MARJORI max_health_to 2000
    Actor.WeaponAccuracy(USHER4_MARJORI) = $SURV_ACCURACY    
    
    $SHIT_FUCK = Audiostream.Load3d("audio\sounds\music\usher_music\MISS4\marjdoor.mp3")      
    Audiostream.SetPosition($SHIT_FUCK, 264.9849, -64.245, -2.9766) //ZXY (old, XYZ new)
    Audiostream.Loop($SHIT_FUCK, 0)
    Audiostream.Volume($SHIT_FUCK) = $SOUNDS_VOLUME
    Audiostream.PerformAction($SHIT_FUCK,PLAY)    
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY574"
    v$ST_DIALOG[1] = "STRY575"
    $DIALOG_COUNT = 1
    create_thread @DG_SYS2
    
    repeat
    wait 0
    until $DIALOG_END == 1
    
    0687: clear_actor PLAYER_ACTOR task                
    
    05D3: AS_actor USHER4_MARJORI goto_point 264.772339 -55.880951 -2.976563 mode 7 time 10000 ms // versionA
    
    repeat
    wait 0
    until 02A0:   actor USHER4_MARJORI stopped
    
    040D: unload_wav 4
    
    ////////////////////Плавное затухание/////////////////////
//
//    $MUSIC_FADE_NUMBER += 1
//    if
//    $MUSIC_FADE_NUMBER > 4
//        then
//        $MUSIC_FADE_NUMBER = 0 
//        end    
//            
//    0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_MISSION // (int)
//    $MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = 0.0
//            
//    $MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 250
//    $MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 0  
//    $MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
//    create_thread @MUS_FAD
    2504: SET_AUDIO_STREAM_VOLUME_WITH_TRANSITION $MUSIC_MISSION volume 0.0 time 250
    wait 250
    audiostream.Release($MUSIC_MISSION)
    
    ///////////////////////////////////////////////////////////
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY576"
    $DIALOG_COUNT = 0
    create_thread @DG_SYS2        
    
    0781: get_weapon_with_ID 71 model_to 1@

    while not model.Available(1@)
    wait 0
    model.Load(1@)
    mload
    end
    
    actor.GiveWeaponAndAmmo(USHER4_MARJORI,71,99999)
    
    actor.WeaponAccuracy(USHER4_MARJORI) = 0
    
    0635: AS_actor USHER4_MARJORI aim_at_actor PLAYER_ACTOR 999999 ms
    
    repeat
    wait 0
    until $DIALOG_END == 1
    
    fade 0 500
    $HUD_REMOVE = 1
    wait 500
    
    cinema.Widescreen(1)
    BLACK_POLOSKI_ON = 1
    
    if
    $FP_ACTIVATED == 1
    then
    repeat
    wait 0
    until $FP_ACTIVATED == 0
    end        
    
    camera.SetPosition(273.917358 -52.336929 -2.006929,0.0,0.0,0.0)
    camera.PointAt(273.018494 -52.765236 -2.099688,2)
    
    fade 1 500
    wait 500
    
    $MUSIC_MISSION = Audiostream.Load("audio\sounds\music\usher_music\MISS4\theme12.mp3")
    Audiostream.PerformAction($MUSIC_MISSION, PLAY)
    Audiostream.Loop($MUSIC_MISSION, 1)
    Audiostream.Volume($MUSIC_MISSION) = VERO_TIPA_VOLUME
    
    /////////////////////Плавное нарастание/////////////////////
//    
//    $MUSIC_FADE_NUMBER += 1
//    if
//    $MUSIC_FADE_NUMBER > 4
//        then
//        $MUSIC_FADE_NUMBER = 0 
//        end    
//    
//    0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_MISSION // (int) 
//    0086: $MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = $MUSIC_VOLUME // (float) 
//    
//    $MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 1000
//    $MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 1  
//    $MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
//    create_thread @MUS_FAD
//    
//    wait 1 
    250A: SET_AUDIO_STREAM_TYPE $MUSIC_MISSION type 2 
    2504: SET_AUDIO_STREAM_VOLUME_WITH_TRANSITION $MUSIC_MISSION volume $MUSIC_VOLUME time 1000
    
    ////////////////////////////////////////////////////////        

    0615: define_AS_pack_begin 0@
    0A1D: AS_actor -1 rotate_to_and_look_at_actor USHER4_MARJORI
    05C4: AS_actor -1 hands_up 999999 ms
    0616: define_AS_pack_end 0@
    0618: assign_actor PLAYER_ACTOR to_AS_pack 0@
    061B: remove_references_to_AS_pack 0@
    
    wait 1500
    
    0668: AS_actor USHER4_MARJORI rotate_and_shoot_at 273.4171 -56.0456 -1.9766 2000 ms
    wait 250
        
    0673: AS_actor PLAYER_ACTOR dive_to_offset 0.0 -90.0 time_on_ground 0 ms    
    wait 2500
    0A1D: AS_actor PLAYER_ACTOR rotate_to_and_look_at_actor USHER4_MARJORI
    
    camera.SetPosition(270.279083 -53.351921 -2.707211,0.0,0.0,0.0)
    camera.PointAt(269.766754 -54.207249 -2.784283,1)
    0460: set_camera_transverse_delay 1.0 time 3000        
                  
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY577"
    v$ST_DIALOG[1] = "STRY578"
    v$ST_DIALOG[2] = "STRY579"
    v$ST_DIALOG[3] = "STRY580"
    v$ST_DIALOG[4] = "STRY581"
    v$ST_DIALOG[5] = "STRY582"
    v$ST_DIALOG[6] = "STRY583"
    v$ST_DIALOG[7] = "STRY584"
    v$ST_DIALOG[8] = "STRY585"
    v$ST_DIALOG[9] = "STRY586"
    v$ST_DIALOG[10] = "STRY587"
    v$ST_DIALOG[11] = "STRY588"
    v$ST_DIALOG[12] = "STRY589"
    v$ST_DIALOG[13] = "STRY590"
    0084: $DIALOG_ACTOR[0] = PLAYER_ACTOR // (int)
    0084: $DIALOG_ACTOR[1] = USHER4_MARJORI // (int)
    0084: $DIALOG_ACTOR[2] = USHER4_MARJORI // (int)
    0084: $DIALOG_ACTOR[3] = PLAYER_ACTOR // (int)
    0084: $DIALOG_ACTOR[4] = USHER4_MARJORI // (int)
    0084: $DIALOG_ACTOR[5] = USHER4_MARJORI // (int)
    0084: $DIALOG_ACTOR[6] = PLAYER_ACTOR // (int)
    0084: $DIALOG_ACTOR[7] = USHER4_MARJORI // (int)
    0084: $DIALOG_ACTOR[8] = PLAYER_ACTOR // (int)
    0084: $DIALOG_ACTOR[9] = USHER4_MARJORI // (int)
    0084: $DIALOG_ACTOR[10] = PLAYER_ACTOR // (int)
    0084: $DIALOG_ACTOR[11] = USHER4_MARJORI // (int)
    0084: $DIALOG_ACTOR[12] = USHER4_MARJORI // (int)
    0084: $DIALOG_ACTOR[13] = PLAYER_ACTOR // (int)
    $DIALOG_COUNT = 13
    $DIALOG_NOT_ANIMS_FLAG = 1
    create_thread @DG_SYS
    
    repeat
    wait 0
    
    TEMPVAR_INT = 30
    008D: TEMPVAR_INT = integer TEMPVAR_INT to_float
    0069: TEMPVAR_INT *= GENERAL_FPS_TIMER_DIVIDER2 // (float)
    008C: TEMPVAR_INT = float TEMPVAR_INT to_integer
    if and
    0E45: frame_mod TEMPVAR_INT
    0E4D: random_percent 25
    then
    07A5: AS_actor USHER4_MARJORI attack_actor PLAYER_ACTOR time 1000
    end
    
    until $DIALOG_END == 1
    
    camera.SetPosition(267.307892 -54.756397 -3.082992,0.0,0.0,0.0)
    camera.PointAt(266.432739 -55.239666 -3.059361,1)
    0460: set_camera_transverse_delay 1.0 time 500
    wait 500
                                                     
    0605: actor USHER4_MARJORI perform_animation "python_fire" IFP "python" framedelta 4.0 loop 0 lockX 0 lockY 0 lockF 0 time -1
    wait 430
    $SHIT_FUCK = Audiostream.Load3d("audio\sounds\music\usher_music\MISS4\failed_shot.mp3")      
    Audiostream.SetPosition($SHIT_FUCK, 264.772339, -55.880951, -2.976563) //ZXY (old, XYZ new)
    Audiostream.Loop($SHIT_FUCK, 0)
    Audiostream.Volume($SHIT_FUCK) = $SOUNDS_VOLUME
    Audiostream.PerformAction($SHIT_FUCK,PLAY) 
    wait 430
    0605: actor USHER4_MARJORI perform_animation "python_fire" IFP "python" framedelta 4.0 loop 0 lockX 0 lockY 0 lockF 0 time -1                
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY591"    
    0084: $DIALOG_ACTOR[0] = USHER4_MARJORI // (int)
    $DIALOG_COUNT = 0    
    $DIALOG_NOT_ANIMS_FLAG = 1
    create_thread @DG_SYS
    
    repeat
    wait 0
    until $DIALOG_END == 1
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY592"    
    0084: $DIALOG_ACTOR[0] = USHER4_MARJORI // (int)
    $DIALOG_COUNT = 0    
    $DIALOG_NOT_ANIMS_FLAG = 1
    create_thread @DG_SYS
    
    0555: remove_weapon 71 from_actor USHER4_MARJORI
    
    0781: get_weapon_with_ID 11 model_to 1@

    while not model.Available(1@)
    wait 0
    model.Load(1@)
    mload
    end
    
    actor.GiveWeaponAndAmmo(USHER4_MARJORI,11,1)
    
    wait 500        
    
    repeat
    wait 0    
    until $DIALOG_END == 1        
    
    Actor.SetWalkStyle(USHER4_MARJORI, "surv5")
    
    0615: define_AS_pack_begin 0@
    05D3: AS_actor -1 goto_point 270.9331 -54.7466 -2.9691 mode 7 time 10000 ms // versionA
    05E2: AS_actor -1 kill_actor PLAYER_ACTOR
    0616: define_AS_pack_end 0@
    0618: assign_actor USHER4_MARJORI to_AS_pack 0@
    061B: remove_references_to_AS_pack 0@
        
    077A: set_actor USHER4_MARJORI acquaintance 4 to_actors_pedtype 0 // see ped.dat
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY593"
    0084: $DIALOG_ACTOR[0] = USHER4_MARJORI // (int)
    $DIALOG_COUNT = 0    
    $DIALOG_NOT_ANIMS_FLAG = 1
    create_thread @DG_SYS2
    
    fade 0 250    
    wait 250
    
    camera.Restore_WithJumpCut()
    cinema.Widescreen(0)
    BLACK_POLOSKI_ON = 0
        
    fade 1 250
    player.CanMove(0,true)    
    $HUD_REMOVE = 0
    wait 250    
    
    v$OBJECTIVE = "STRB113"    
    MISSION_MARKER = marker.CreateAboveActor(USHER4_MARJORI)
    
    repeat
    wait 0
    
    if and
    0AB0:   key_pressed $KEY_USE
    $CHEATS_ON == 1
    then 
    05BE: AS_actor USHER4_MARJORI die 
    end
    
    if
    not actor.Dead(PLAYER_ACTOR)
    jf @USHER4_FAILED_PLAYER_DIED
    if
    not actor.Dead(USHER4_ANGIE)
    jf @USHER4_FAILED_ANGIE_DIED
    if and
    $CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
    not BASE_TEAMMATE_AGRED == 1
    jf @USHER4_FAILED_AGRO
    if
    803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
    jf @USHER4_FAILED_LDEAD
    if
    $SAVE_CAR_CREATED[LATEST_CAR_SLOT_USED] == 1
    jf @USHER4_FAILED_CAR_WRECKED
    
    ///////////////////////////////////

    TEMPVAR_INT = 180
    008D: TEMPVAR_INT = integer TEMPVAR_INT to_float
    0069: TEMPVAR_INT *= GENERAL_FPS_TIMER_DIVIDER2 // (float)
    008C: TEMPVAR_INT = float TEMPVAR_INT to_integer
    if
    0E45: frame_mod TEMPVAR_INT
    then
    
    if
    056D:   actor USHER4_MARJORI defined
        then
        if and
        not actor.Dead(USHER4_MARJORI)
        0364:   actor USHER4_MARJORI spotted_actor PLAYER_ACTOR
            then
            actor.SetImmunities(USHER4_MARJORI,1,1,1,1,1)
            0ED9: set_char_ignore_damage_anims USHER4_MARJORI 1
            random_int 1@ 0 2
            06E3: AS_actor USHER4_MARJORI roll_sideways 1@
            end
        end
    
    end
    
    TEMPVAR_INT = 240
    008D: TEMPVAR_INT = integer TEMPVAR_INT to_float
    0069: TEMPVAR_INT *= GENERAL_FPS_TIMER_DIVIDER2 // (float)
    008C: TEMPVAR_INT = float TEMPVAR_INT to_integer
    if
    0E45: frame_mod TEMPVAR_INT
    then
    
    if
    056D:   actor USHER4_MARJORI defined
        then
        if
        not actor.Dead(USHER4_MARJORI)
            then
            actor.SetImmunities(USHER4_MARJORI,0,0,0,0,0)
            0ED9: set_char_ignore_damage_anims USHER4_MARJORI 1
            0687: clear_actor USHER4_MARJORI task
            0792: disembark_instantly_actor USHER4_MARJORI        
            05E2: AS_actor USHER4_MARJORI kill_actor PLAYER_ACTOR        
            Actor.SetWalkStyle(USHER4_MARJORI, "SURV5")
            end
        end
    
    end
    
    ///////////////////////////////////
    
    until actor.Dead(USHER4_MARJORI)
    
    v$OBJECTIVE = "DUMMY" 
    marker.Disable(MISSION_MARKER)
    
    ////////////////////Плавное затухание/////////////////////
//
//    $MUSIC_FADE_NUMBER += 1
//    if
//    $MUSIC_FADE_NUMBER > 4
//        then
//        $MUSIC_FADE_NUMBER = 0 
//        end    
//            
//    0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_MISSION // (int)
//    $MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = 0.0
//            
//    $MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 250
//    $MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 0  
//    $MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
//    create_thread @MUS_FAD
    2504: SET_AUDIO_STREAM_VOLUME_WITH_TRANSITION $MUSIC_MISSION volume 0.0 time 250
    wait 250
    audiostream.Release($MUSIC_MISSION)
    
    ///////////////////////////////////////////////////////////
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY594"
    v$ST_DIALOG[1] = "STRY595"
    v$ST_DIALOG[2] = "STRY596"
    v$ST_DIALOG[3] = "STRY597"
    v$ST_DIALOG[4] = "STRY598"
    $DIALOG_COUNT = 4
    $DIALOG_NOT_SKIP = 1
    create_thread @DG_SYS2     
    
    repeat
    wait 0
    until $DIALOG_END == 1
    
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////
    
    v$OBJECTIVE = "STRB114"
    
    repeat
    wait 0
    until 0471:   actor PLAYER_ACTOR near_object_in_rectangle USHER4_MISHKA_OBJECT radius 5.0 5.0 sphere 0
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY599"
    $DIALOG_COUNT = 0
    create_thread @DG_SYS2
    
    repeat
    wait 0
    until $DIALOG_END == 1
    
    0188: MISSION_MARKER = create_marker_above_object USHER4_MISHKA_OBJECT
    
    repeat
    wait 0
    
    if and
    0471:   actor PLAYER_ACTOR near_object_in_rectangle USHER4_MISHKA_OBJECT radius 1.0 1.0 sphere 0
    02A0:   actor PLAYER_ACTOR stopped
    then
    break
    end  
    
    until false  
    
    ///////////////////////////////////////////////////////////////////////////////////////

    v$OBJECTIVE = "DUMMY"
    marker.Disable(MISSION_MARKER)
    
    0470: 9@ = actor PLAYER_ACTOR current_weapon
    06AB: set_actor PLAYER_ACTOR all_weapons_hidden 1
    0992: set_player PLAYER_CHAR weapons_scrollable 0 
    
    while not animation.Available("BOMBER")
    wait 0
    animation.Load("BOMBER")
    end
    
    32@ = 0
    
    03CF: load_wav OLDWAV_WARDROBE_20802 as 4 
    
    while 83D0: not  wav 4 loaded 
    wait 0
    03CF: load_wav OLDWAV_WARDROBE_20802 as 4 
    end
     
    0949: link_wav 4 to_actor PLAYER_ACTOR
    03D1: play_wav 4
    
    0605: actor PLAYER_ACTOR perform_animation "BOM_PLANT" IFP "BOMBER" framedelta 4.0 loop 0 lockX 0 lockY 0 lockF 0 time -1 
    
    while 83D2:   wav 4 ended 
    wait 0
    end
    
    040D: unload_wav 4 
    04EF: release_animation "BOMBER"
    
    0992: set_player PLAYER_CHAR weapons_scrollable 1
    06AB: set_actor PLAYER_ACTOR all_weapons_hidden 0
    
    01B9: set_actor PLAYER_ACTOR armed_weapon_to 9@

    ///////////////////////////////////////////////////////////////////////////////////////
    
    object.Destroy(USHER4_MISHKA_OBJECT)
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY600"
    $DIALOG_COUNT = 0
    create_thread @DG_SYS2
    
    repeat
    wait 0
    until $DIALOG_END == 1
    
    v$OBJECTIVE = "STRB116"    
    018A: MISSION_CHECKPOINT = create_checkpoint_at 263.311432 -67.631081 -2.976563
    03BC: MISSION_SPHERE = create_sphere_at 263.311432 -67.631081 -2.976563 radius 1.0
    
    repeat
    wait 0        
    
    if
    not actor.Dead(PLAYER_ACTOR)
    jf @USHER4_FAILED_PLAYER_DIED
    if
    not actor.Dead(USHER4_ANGIE)
    jf @USHER4_FAILED_ANGIE_DIED
    if and
    $CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
    not BASE_TEAMMATE_AGRED == 1
    jf @USHER4_FAILED_AGRO
    if
    803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
    jf @USHER4_FAILED_LDEAD
     
    until 0EEA: locate_char_distance_to_coordinates PLAYER_ACTOR pos 263.311432 -67.631081 -2.976563 radius 1.0
    
    03BD: destroy_sphere MISSION_SPHERE
    marker.Disable(MISSION_CHECKPOINT) 
    
    fade 0 500
    player.CanMove(0,false)
    $HUD_REMOVE = 1
    wait 500
    
    $SAVESTATUS = 0
    
    select_interior 0
    0860: link_actor PLAYER_ACTOR to_interior 0
    04FA: reset_sky_colors_with_fade 0
    
    0AF0: 0@ = get_int_from_ini_file "saves\ZACM.set" section "SCR" key "USHER_MISS4_CHECKPOINT"
    if 
    0@ < 5
    then
    0AF1: write_int 5 to_ini_file "saves\ZACM.set" section "SCR" key "USHER_MISS4_CHECKPOINT"
    end 
    
    :USHER4_INSTAJUMP_TO_AFTERFIGHT_PART
    
    actor.PutAtNoOffset(PLAYER_ACTOR,267.6448, -55.2649, 2.7772)
    actor.Angle(PLAYER_ACTOR) = 179.6469
    camera.Restore_WithJumpCut()
    
    00C0: set_current_time 20 0
    0E6A: make_nop 0x052CF53 size 6 //Выключаем обновление часов
    0E6A: make_nop 0x053BFC2 size 5 //Выключаем обновление погоды
    HIDE_HUD_CLOCK = 1
    
    wait 500
    fade 1 500
    create_thread @3D_REFR
    player.CanMove(0,true)
    $HUD_REMOVE = 0
    wait 500       
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY601"
    $DIALOG_COUNT = 0
    create_thread @DG_SYS2
    
    repeat
    wait 0
    until $DIALOG_END == 1 
    
    v$OBJECTIVE = "STRB117"
    
    MISSION_MARKER = marker.CreateAboveCar($USED_CAR[LATEST_CAR_SLOT_USED])
    07E0: set_marker MISSION_MARKER type_to 1
    
    //////////////////////////////////////////////////////////////////////////////////
    
    repeat
    wait 0
    
    if
    0EEA: locate_char_distance_to_coordinates PLAYER_ACTOR pos 266.239410 -55.930531 2.777212 radius 120.0
    jf @USHER4_FAILED_WALK2 
    
    if
    not actor.Dead(PLAYER_ACTOR)
    jf @USHER4_FAILED_PLAYER_DIED
    if
    not actor.Dead(USHER4_ANGIE)
    jf @USHER4_FAILED_ANGIE_DIED
    if and
    $CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
    not BASE_TEAMMATE_AGRED == 1
    jf @USHER4_FAILED_AGRO
    if
    803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
    jf @USHER4_FAILED_LDEAD
    if
    $SAVE_CAR_CREATED[LATEST_CAR_SLOT_USED] == 1
    jf @USHER4_FAILED_CAR_WRECKED
    
    if and
    0E3E: is_button_just_pressed 0 button 17
    $CHEATS_ON == 1
    then
    $END_DIALOG_INST = 1
    wait 0
    036A: put_actor PLAYER_ACTOR in_car $USED_CAR[LATEST_CAR_SLOT_USED]
    camera.Restore_WithJumpCut() 
    break
    end
    
    if
    actor.InCar(PLAYER_ACTOR,$USED_CAR[LATEST_CAR_SLOT_USED])
        then
        break
        end
    
    until false 
    
    marker.Disable(MISSION_MARKER)
    v$OBJECTIVE = "STRB118"
    018A: MISSION_CHECKPOINT = create_checkpoint_at 2174.415527 -2265.320313 13.5469
    USHER_STORY_CREATE_NICOLS_FLAG = 1
    
    ////////////////////////////////////////////////////////
    
    $MUSIC_MISSION = Audiostream.Load("audio\sounds\music\usher_music\MISS4\theme13.mp3")
    Audiostream.PerformAction($MUSIC_MISSION, PLAY)
    Audiostream.Loop($MUSIC_MISSION, 1)
    Audiostream.Volume($MUSIC_MISSION) = VERO_TIPA_VOLUME
    
    /////////////////////Плавное нарастание/////////////////////
//    
//    $MUSIC_FADE_NUMBER += 1
//    if
//    $MUSIC_FADE_NUMBER > 4
//        then
//        $MUSIC_FADE_NUMBER = 0 
//        end    
//    
//    0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_MISSION // (int) 
//    0086: $MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = $MUSIC_VOLUME // (float) 
//    
//    $MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 1000
//    $MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 1  
//    $MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
//    create_thread @MUS_FAD
//    
//    wait 1 
    250A: SET_AUDIO_STREAM_TYPE $MUSIC_MISSION type 2 
    2504: SET_AUDIO_STREAM_VOLUME_WITH_TRANSITION $MUSIC_MISSION volume $MUSIC_VOLUME time 1000
    
    ////////////////////////////////////////////////////////   
    
    $END_DIALOG_INST = 1
    wait 0
    v$ST_DIALOG[0] = "STRY602"
    v$ST_DIALOG[1] = "STRY603"
    v$ST_DIALOG[2] = "STRY604"
    v$ST_DIALOG[3] = "STRY605"
    v$ST_DIALOG[4] = "STRY606"
    $DIALOG_COUNT = 4
    $DIALOG_NOT_SKIP = 1
    create_thread @DG_SYS2
    
    repeat
    wait 0    
    
    if
    not actor.Dead(PLAYER_ACTOR)
    jf @USHER4_FAILED_PLAYER_DIED
    if
    not actor.Dead(USHER4_ANGIE)
    jf @USHER4_FAILED_ANGIE_DIED
    if and
    $CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
    not BASE_TEAMMATE_AGRED == 1
    jf @USHER4_FAILED_AGRO
    if
    803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
    jf @USHER4_FAILED_LDEAD
    if
    $SAVE_CAR_CREATED[LATEST_CAR_SLOT_USED] == 1
    jf @USHER4_FAILED_CAR_WRECKED
    
    ///////////////////////////////////////////////////
    
    if and
    056E:   car $USED_CAR[LATEST_CAR_SLOT_USED] defined
    not USHER4_VICTORIA_GOT_BACK_FLAG == 1
    then
    
    if
    not car.Wrecked($USED_CAR[LATEST_CAR_SLOT_USED])
    jf @USHER4_FAILED_CAR_WRECKED
    
    if
    not actor.InCar(PLAYER_ACTOR,$USED_CAR[LATEST_CAR_SLOT_USED])
        then
        marker.Disable(MISSION_CHECKPOINT)         
        gosub @USHER4_GET_BACK_IN_CAR
        v$OBJECTIVE = "STRB118"
        018A: MISSION_CHECKPOINT = create_checkpoint_at 2174.415527 -2265.320313 13.5469    
        end
    else
    jump to @USHER4_FAILED_CAR_WRECKED
    end
    
    ///////////////////////////////////////////////////
    
    if and
    0E3E: is_button_just_pressed 0 button 17
    $CHEATS_ON == 1
    then
    actor.PutAtNoOffset(PLAYER_ACTOR,2174.415527, -2265.320313, 13.5469)
    car.Angle($USED_CAR[LATEST_CAR_SLOT_USED]) = 43.035
    create_thread @3D_REFR
    $END_DIALOG_INST = 1
    wait 0
    break
    end
    
    until 0103:   actor PLAYER_ACTOR in_sphere 2174.415527 -2265.320313 13.5469 radius 2.0 2.0 2.0 sphere 1 stopped_in_car
    
    v$OBJECTIVE = "DUMMY"
    marker.Disable(MISSION_CHECKPOINT)
    player.CanMove(PLAYER_CHAR,false) 
    
    068B: set_car $USED_CAR[LATEST_CAR_SLOT_USED] all_disembark
    
    /////////////////////Плавное затухание/////////////////////
//
//    $MUSIC_FADE_NUMBER += 1
//    if
//    $MUSIC_FADE_NUMBER > 4
//    then
//    $MUSIC_FADE_NUMBER = 0 
//    end
//    
//    0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_MISSION // (int)
//    $MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = 0.0
//    
//    $MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 250
//    $MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 0  
//    $MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
//    create_thread @MUS_FAD        
    2504: SET_AUDIO_STREAM_VOLUME_WITH_TRANSITION $MUSIC_MISSION volume 0.0 time 250
    wait 250
    audiostream.Release($MUSIC_MISSION)

    repeat
    wait 0
    until not actor.InCar(PLAYER_ACTOR,$USED_CAR[LATEST_CAR_SLOT_USED])
    
    ///////////////////////////////////////////////////////////
    
    while true
    wait 0
    $END_FADING_MUSIC_FAST = 1
    
    if and
    $MUSIC_FADE_ENDED[0] == 1
    $MUSIC_FADE_ENDED[1] == 1
    $MUSIC_FADE_ENDED[2] == 1
    $MUSIC_FADE_ENDED[3] == 1
    $MUSIC_FADE_ENDED[4] == 1
    then
    $END_FADING_MUSIC_FAST = 0
    break
    end
    
    end
    
    $MUSIC_MISSION = Audiostream.Load("audio\sounds\music\usher_music\MISS4\theme14.mp3")
    Audiostream.PerformAction($MUSIC_MISSION, PLAY)
    Audiostream.Loop($MUSIC_MISSION, 1)
    Audiostream.Volume($MUSIC_MISSION) = VERO_TIPA_VOLUME
    
    /////////////////////Плавное нарастание/////////////////////
//    
//    $MUSIC_FADE_NUMBER += 1
//    if
//    $MUSIC_FADE_NUMBER > 4
//    then
//    $MUSIC_FADE_NUMBER = 0 
//    end
//    
//    0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_MISSION // (int) 
//    0086: $MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = $MUSIC_VOLUME // (float) 
//    
//    $MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 1000
//    $MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 1  
//    $MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
//    create_thread @MUS_FAD
//    
//    wait 1 
    250A: SET_AUDIO_STREAM_TYPE $MUSIC_MISSION type 2 
    2504: SET_AUDIO_STREAM_VOLUME_WITH_TRANSITION $MUSIC_MISSION volume $MUSIC_VOLUME time 1000
    
    ////////////////////////////////////////////////////////
    
    0850: AS_actor USHER4_ANGIE follow_actor PLAYER_ACTOR
    
    player.CanMove(PLAYER_CHAR,true)
    
    car.DoorStatus($USED_CAR[LATEST_CAR_SLOT_USED],2)
    02D4: car $USED_CAR[LATEST_CAR_SLOT_USED] turn_off_engine
    v$OBJECTIVE = "STRB119"     
    
    repeat
    wait 0
    until 056D:   actor USHER4_NIKOLS defined
    
    actor.PutAtNoOffset(USHER4_NIKOLS,2123.278564, -2275.642090, 20.671875)
    actor.Angle(USHER4_NIKOLS) = 314.394836
    
    //////////////////////////////////////////////////////////////////////////////
    
    repeat
    wait 0
    
    if
    not actor.Dead(PLAYER_ACTOR)
    jf @USHER4_FAILED_PLAYER_DIED
    if
    not actor.Dead(USHER4_ANGIE)
    jf @USHER4_FAILED_ANGIE_DIED
    if and
    $CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
    not BASE_TEAMMATE_AGRED == 1
    jf @USHER4_FAILED_AGRO
    if
    803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
    jf @USHER4_FAILED_LDEAD
    if
    $SAVE_CAR_CREATED[LATEST_CAR_SLOT_USED] == 1
    jf @USHER4_FAILED_CAR_WRECKED  
    
    if and
    0E3E: is_button_just_pressed 0 button 17
    $CHEATS_ON == 1
    then
    actor.PutAtNoOffset(PLAYER_ACTOR,2129.2288, -2278.8098, 20.6643)
    $END_DIALOG_INST = 1
    wait 0
    break
    end
    
    PLAYER_CANT_SPEAK_WITH_LEADER_FLAG = 1    
    
    until 00A4:   actor PLAYER_ACTOR sphere 0 in_cube_cornerA 2121.8728 -2267.6924 20.2734 cornerB 2133.1223 -2289.1956 24.6259
    
    PLAYER_CANT_SPEAK_WITH_LEADER_FLAG = 1
    $END_DIALOG_INST = 1
    wait 0
    
    marker.Disable(MISSION_MARKER)
    //0A96: 0@ = actor PLAYER_ACTOR struct
    //0AA5: call 0x043F1F0 num_params 1 pop 0 0@ //CEntryExit::WarpGangWithPlayer
    if
    0EEA: locate_char_distance_to_coordinates PLAYER_ACTOR pos 2132.6426 -2278.4111 20.6719 radius 5.0
    then
    0362: remove_actor USHER4_ANGIE from_car_and_place_at 2135.0042 -2275.7876 20.6719
    actor.PutAtNoOffset(USHER4_ANGIE,2135.0042, -2275.7876, 20.6719)
    end
    
    if
    0EEA: locate_char_distance_to_coordinates PLAYER_ACTOR pos 2118.8689 -2274.906 20.6719 radius 5.0
    then
    0362: remove_actor USHER4_ANGIE from_car_and_place_at 2117.3757 -2276.3782 20.676
    actor.PutAtNoOffset(USHER4_ANGIE,2117.3757, -2276.3782, 20.676)
    end 
    
    0850: AS_actor USHER4_ANGIE follow_actor PLAYER_ACTOR                                 
    
    v$OBJECTIVE = "DUMMY"
    
    v$ST_DIALOG[0] = "STRY607"
    v$ST_DIALOG[1] = "STRY608"
    v$ST_DIALOG[2] = "STRY609"
    $DIALOG_COUNT = 2
    $DIALOG_NOT_SKIP = 1
    create_thread @DG_SYS2
    
    0A1D: AS_actor USHER4_NIKOLS rotate_to_and_look_at_actor PLAYER_ACTOR
    
    repeat
    wait 0
    
    if
    not actor.Dead(PLAYER_ACTOR)
    jf @USHER4_FAILED_PLAYER_DIED
    if
    not actor.Dead(USHER4_ANGIE)
    jf @USHER4_FAILED_ANGIE_DIED
    if and
    $CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
    not BASE_TEAMMATE_AGRED == 1
    jf @USHER4_FAILED_AGRO
    if
    803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
    jf @USHER4_FAILED_LDEAD
    
    if
    0E45: frame_mod 30
    then
    0A1D: AS_actor USHER4_NIKOLS rotate_to_and_look_at_actor PLAYER_ACTOR
    end
    
    until $DIALOG_END == 1
    
    Audiostream.Release($SHIT_FUCK)        
    
    player.CanMove(PLAYER_CHAR,false)
    fade 0 1000
    $HUD_REMOVE = 1
    wait 1000
    
    actor.DestroyInstantly(USHER4_ANGIE)
    
    01B9: set_actor USHER4_NIKOLS armed_weapon_to 0
    01B9: set_actor PLAYER_ACTOR armed_weapon_to 0    
    
    actor.PutAtNoOffset(PLAYER_ACTOR,2124.6914, -2276.0647, 20.6719)
    actor.Angle(PLAYER_ACTOR) = 70.4935        
    
    cinema.Widescreen(1)
    BLACK_POLOSKI_ON = 1
    
    if
    $FP_ACTIVATED == 1
    then
    repeat
    wait 0
    until $FP_ACTIVATED == 0
    end
    
    camera.SetPosition(2125.537598 -2275.441162 21.340004,0.0,0.0,0.0)
    camera.PointAt(2124.572266 -2275.700928 21.310097,2)
    
    0A1D: AS_actor USHER4_NIKOLS rotate_to_and_look_at_actor PLAYER_ACTOR
    0A1D: AS_actor PLAYER_ACTOR rotate_to_and_look_at_actor USHER4_NIKOLS
    
    wait 1000
    
    fade 1 1000
    wait 1000
    
    v$ST_DIALOG[0] = "STRY610"
    v$ST_DIALOG[1] = "STRY611"
    v$ST_DIALOG[2] = "STRY612"
    v$ST_DIALOG[3] = "STRY613"
    v$ST_DIALOG[4] = "STRY614"
    v$ST_DIALOG[5] = "STRY615"
    v$ST_DIALOG[6] = "STRY616"
    v$ST_DIALOG[7] = "STRY617"
    v$ST_DIALOG[8] = "STRY618"
    v$ST_DIALOG[9] = "STRY619"
    v$ST_DIALOG[10] = "STRY620"
    v$ST_DIALOG[11] = "STRY621"
    0084: $DIALOG_ACTOR[0] = USHER4_NIKOLS // (int)
    0084: $DIALOG_ACTOR[1] = PLAYER_ACTOR // (int)
    0084: $DIALOG_ACTOR[2] = PLAYER_ACTOR // (int)
    0084: $DIALOG_ACTOR[3] = USHER4_NIKOLS // (int)
    0084: $DIALOG_ACTOR[4] = PLAYER_ACTOR // (int)
    0084: $DIALOG_ACTOR[5] = USHER4_NIKOLS // (int)
    0084: $DIALOG_ACTOR[6] = USHER4_NIKOLS // (int)
    0084: $DIALOG_ACTOR[7] = PLAYER_ACTOR // (int)
    0084: $DIALOG_ACTOR[8] = USHER4_NIKOLS // (int)
    0084: $DIALOG_ACTOR[9] = PLAYER_ACTOR // (int)
    0084: $DIALOG_ACTOR[10] = USHER4_NIKOLS // (int)
    0084: $DIALOG_ACTOR[11] = PLAYER_ACTOR // (int)

    $DIALOG_COUNT = 11
    $DIALOG_NOT_ANIMS_FLAG = 0
    create_thread @DG_SYS
    
    repeat
    wait 0
    
    if
    not actor.Dead(PLAYER_ACTOR)
    jf @USHER4_FAILED_PLAYER_DIED
    if and
    $CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
    not BASE_TEAMMATE_AGRED == 1
    jf @USHER4_FAILED_AGRO
    if
    803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
    jf @USHER4_FAILED_LDEAD
    
    until $DIALOG_END == 1        
    
    fade 0 1000
    $HUD_REMOVE = 1
    wait 1000
    
    actor.PutAtNoOffset(PLAYER_ACTOR,2133.1814, -2277.8745, 20.6719)
    actor.Angle(PLAYER_ACTOR) = 315.165
    camera.Restore_WithJumpCut()
    cinema.Widescreen(0)
    BLACK_POLOSKI_ON = 0 
    
    PLAYER_CANT_SPEAK_WITH_LEADER_FLAG = 0
    jump to @USHER4_SAVE_PICKUP_MOMENT                                                                                                                                  
                              
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////   
    
    end

until false  

///////////////////////////////ZALUPA ENDS MOMENT///////////////////////////////

:PLAYER_GET_BACK_ALL_DROPPED_WEPS

actor.StorePos(PLAYER_ACTOR,25@,26@,27@)

for 0@ = 0 to 19
if
09D1:   pickup $DROP_PICKUP[0@] created
    then
    0E38: get_pickup_pointer $DROP_PICKUP[0@] store_to 1@
    1@ += 8
    0A8D: 29@ = read_memory 1@ size 4 virtual_protect 0
    0E34: get_pickup_model $DROP_PICKUP[0@] 28@
    
    pickup.Destroy($DROP_PICKUP[0@])
    032B: $DROP_PICKUP[0@] = create_weapon_pickup 28@ type 15 ammo 29@ at 25@ 26@ 27@
    
    end
end

return

///////////////////////////////SAVE PICKUP MOMENT///////////////////////////////   

:USHER4_SAVE_PICKUP_MOMENT

/////////////////////Плавное затухание/////////////////////
//
//$MUSIC_FADE_NUMBER += 1
//if
//$MUSIC_FADE_NUMBER > 4
//then
//$MUSIC_FADE_NUMBER = 0 
//end
//    
//0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_MISSION // (int)
//$MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = 0.0
//    
//$MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 500
//$MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 0  
//$MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
//create_thread @MUS_FAD
2504: SET_AUDIO_STREAM_VOLUME_WITH_TRANSITION $MUSIC_MISSION volume 0.0 time 1000    

fade 0 1000
$HUD_REMOVE = 1
wait 1000

audiostream.Release($MUSIC_MISSION)

actor.PutAtNoOffset(PLAYER_ACTOR,2133.1814, -2277.8745, 20.6719)
actor.Angle(PLAYER_ACTOR) = 315.165
camera.Restore_WithJumpCut()
cinema.Widescreen(0)
BLACK_POLOSKI_ON = 0

player.CanMove(PLAYER_CHAR,true)
fade 1 1000
$HUD_REMOVE = 0
wait 1000

$MUSIC_MISSION = Audiostream.Load("audio\sounds\music\usher_music\MISS4\theme15.mp3")
Audiostream.PerformAction($MUSIC_MISSION, PLAY)
Audiostream.Loop($MUSIC_MISSION, 1)
Audiostream.Volume($MUSIC_MISSION) = VERO_TIPA_VOLUME
    
/////////////////////Плавное нарастание/////////////////////
//    
//$MUSIC_FADE_NUMBER += 1
//if
//$MUSIC_FADE_NUMBER > 4
//then
//$MUSIC_FADE_NUMBER = 0 
//end
//    
//0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_MISSION // (int) 
//0086: $MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = $MUSIC_VOLUME // (float) 
//    
//$MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 1000
//$MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 1  
//$MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
//create_thread @MUS_FAD
//    
//wait 1 
250A: SET_AUDIO_STREAM_TYPE $MUSIC_MISSION type 2 
2504: SET_AUDIO_STREAM_VOLUME_WITH_TRANSITION $MUSIC_MISSION volume $MUSIC_VOLUME time 1000
    
////////////////////////////////////////////////////////

v$OBJECTIVE = "STRB120"

018A: MISSION_CHECKPOINT = create_checkpoint_at 2223.235840 -2285.752197 14.764668
03BC: MISSION_SPHERE = create_sphere_at 2223.235840 -2285.752197 14.764668 radius 1.0

v$ST_DIALOG[0] = "STRY622"
v$ST_DIALOG[1] = "STRY623"
$DIALOG_COUNT = 1
$DIALOG_NOT_SKIP = 1
create_thread @DG_SYS2

gosub @USHER4_TERRY_CREATE

repeat
wait 0 

if and
0E3E: is_button_just_pressed 0 button 17
$CHEATS_ON == 1
then
actor.PutAtNoOffset(PLAYER_ACTOR,2223.235840 -2285.752197 14.764668)
$END_DIALOG_INST = 1
wait 0
end

if
not actor.Dead(PLAYER_ACTOR)
jf @USHER4_FAILED_PLAYER_DIED
if and
$CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
not BASE_TEAMMATE_AGRED == 1
jf @USHER4_FAILED_AGRO
if
803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
jf @USHER4_FAILED_LDEAD

until 0364:   actor PLAYER_ACTOR spotted_actor USHER4_TERRY

03BD: destroy_sphere MISSION_SPHERE
marker.Disable(MISSION_CHECKPOINT)

v$OBJECTIVE = "DUMMY"
player.CanMove(PLAYER_CHAR,false)

fade 0 500
$HUD_REMOVE = 1
wait 500

actor.PutAtNoOffset(PLAYER_ACTOR,2222.6077, -2287.1704, 14.7647)
actor.Angle(PLAYER_ACTOR) = 315.1028

cinema.Widescreen(1)
BLACK_POLOSKI_ON = 1

if
$FP_ACTIVATED == 1
then
repeat
wait 0
until $FP_ACTIVATED == 0
end

camera.SetPosition(2223.075928 -2288.442139 15.694907,0.0,0.0,0.0)
camera.PointAt(2223.131104 -2287.447510 15.607939,2)

wait 250

0615: define_AS_pack_begin 0@
05D3: AS_actor -1 goto_point 2223.4924 -2284.8311 14.7647 mode 7 time 10000 ms // versionA
//05D9: AS_actor -1 run_to_actor PLAYER_ACTOR timelimit 10000 stop_within_radius 5.0
0A1D: AS_actor -1 rotate_to_and_look_at_actor PLAYER_ACTOR
0616: define_AS_pack_end 0@
0618: assign_actor USHER4_TERRY to_AS_pack 0@
061B: remove_references_to_AS_pack 0@

0615: define_AS_pack_begin 0@
05D3: AS_actor -1 goto_point 2223.1167 -2286.5776 14.7647 mode 7 time 10000 ms // versionA
0A1D: AS_actor -1 rotate_to_and_look_at_actor USHER4_TERRY
0616: define_AS_pack_end 0@
0618: assign_actor PLAYER_ACTOR to_AS_pack 0@
061B: remove_references_to_AS_pack 0@

wait 500

fade 1 500
wait 500

repeat
wait 0
until 02A0:   actor USHER4_TERRY stopped

v$ST_DIALOG[0] = "STRY624"
v$ST_DIALOG[1] = "STRY625"
v$ST_DIALOG[2] = "STRY626"
0084: $DIALOG_ACTOR[0] = USHER4_TERRY // (int)
0084: $DIALOG_ACTOR[1] = PLAYER_ACTOR // (int)
0084: $DIALOG_ACTOR[2] = USHER4_TERRY // (int)

$DIALOG_COUNT = 2
$DIALOG_NOT_ANIMS_FLAG = 0
create_thread @DG_SYS

repeat
wait 0

if
not actor.Dead(PLAYER_ACTOR)
jf @USHER4_FAILED_PLAYER_DIED
if and
$CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
not BASE_TEAMMATE_AGRED == 1
jf @USHER4_FAILED_AGRO
if
803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
jf @USHER4_FAILED_LDEAD

until $DIALOG_END == 1

fade 0 1000
wait 1000

actor.DestroyInstantly(USHER4_TERRY)

BASE_TEAMMATES_DESTORY_FLAG = 1

0629: change_integer_stat 258 to 0
0318: set_latest_mission_passed 'STB95'

0AF1: write_int -1 to_ini_file "saves\ZACM.set" section "SCR" key "USHER_MISS4_CHECKPOINT" 

wait 1000                                             

$ZOMBIE_SPAWN_INT = 0 
$SAVESTATUS = 1
$ZOMBIES_HORDE = 0
$SAVESTATUS_TRUE = 1   
$MIKE_MUTED = 0
ENEX_OFF = 0
$QUEST_CAMP_NUMBER = -1

//Возвращаем обновление часов
0A8C: write_memory 0x052CF53 size 2 value 1534 virtual_protect 1
0A8C: write_memory 0x052CF55 size 2 value 338 virtual_protect 1
0A8C: write_memory 0x052CF57 size 2 value 183 virtual_protect 1
//Возвращаем обновление погоды
0A8C: write_memory 0x053BFC2 size 2 value 35304 virtual_protect 1
0A8C: write_memory 0x053BFC4 size 2 value 7928 virtual_protect 1
0A8C: write_memory 0x053BFC6 size 1 value 0 virtual_protect 1
HIDE_HUD_CLOCK = 0

gosub @UMUSIC_MISSION4_OFF

$ACHIV_NUMBER = 7
FREEMODE_VOICE_START = 7
FREEMODE_VOICE_END = 8
MIKE_VOICE_CANNOT_SKIP_FLAG = 1
create_thread @VOI_SHO

repeat
wait 0
until $ACHIV_SHOW_ENDED == 1

create_thread @TERRYT3

jump @UUDACHNO4 

:UUDACHNO4        
gosub @UPROPUSK_KODA4 
return 

:UKOD_PROVALA4
$ONMISSION = 0 
mission_cleanup 
06D0: enable_emergency_traffic 0 
06D7: enable_train_traffic 0 
096A: enable_flying_helis 0 
099E: enable_police_patrols 0  
0923: enable_air_traffic 0 
08E7: disable_entrance_markers 0    
return 

:UUDALENIE_KODA4    
$ONMISSION = 0 
marker.Disable(MISSION_CHECKPOINT)
marker.Disable(MISSION_MARKER)

wait 0 

if and
GAME_OVER_FLAG == 0
$ACTOR_DEAD == 0
then
fade 0 0
end

mission_cleanup

if and
GAME_OVER_FLAG == 0
$ACTOR_DEAD == 0
then
fade 0 0
end

06D0: enable_emergency_traffic 0 
06D7: enable_train_traffic 0 
096A: enable_flying_helis 0 
099E: enable_police_patrols 0  
0923: enable_air_traffic 0 
08E7: disable_entrance_markers 0    
return

:USHER4_TERRY_CREATE

$TEAMMATES_PED_TYPE = 26

while not model.Available(9199)
wait 0
model.Load(9199)
mload
end

USHER4_TERRY = actor.Create(26,9199,2227.132080, -2277.299316, 14.764668)
actor.Angle(USHER4_TERRY) = 146.460068
     
0D10: set_actor USHER4_TERRY alpha 255 // IF and SET
    
create_thread @PED_BKP USHER4_TERRY 371
create_thread @ANT_PRE USHER4_TERRY

actor.Health(USHER4_TERRY) = 1000

0D10: set_actor USHER4_TERRY alpha 255 // IF and SET
09F4: set_actor USHER4_TERRY ignore_height_difference_following_nodes $Z_IGNORE_HEIGHT     
Actor.SetWalkStyle(USHER4_TERRY, "SURV1")
0446: set_actor USHER4_TERRY dismemberment_possible 0
060B: set_actor USHER4_TERRY decision_maker_to $DEC_PEOPLE
07DD: set_actor USHER4_TERRY attack_rate 50 // previously known as temper_to
081A: set_actor USHER4_TERRY weapon_skill_to 2  
060F: set_actor USHER4_TERRY melee_accuracy_to 999.0
0946: set_actor USHER4_TERRY actions_uninterupted_by_weapon_fire 1

if
UNITED_MAP == 0
then
04D8: set_actor USHER4_TERRY drowns_in_water 0 
end

09B5: set_actor USHER4_TERRY signal_after_kill 0  
0A96: 0@ = actor USHER4_TERRY struct
0A8E: 0@ = 0@ + 1376
0A8C: write_memory 0@ size 4 value $SURVIVORS_ROTATE_SPEED virtual_protect 1

08AF: set_actor USHER4_TERRY max_health_to $SURVIVER_MAX_HEALTH
Actor.WeaponAccuracy(USHER4_TERRY) = $SURV_ACCURACY

return

:USHER4_FAILED_WALK
text.ClearAll()
BLACK_POLOSKI_ON = 1
$MUSIC_TURN_OFF_FLAG = 1
v$FAILED_TEXT = "MSFL104"
create_thread @GMV_OVR
return

:UMUSIC_MISSION4_OFF

/////////////////////Плавное затухание/////////////////////
//
//$MUSIC_FADE_NUMBER += 1
//if
//$MUSIC_FADE_NUMBER > 4
//    then
//    $MUSIC_FADE_NUMBER = 0 
//    end    
//
//0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_MISSION // (int)
//$MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = 0.0
//
//$MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 700
//$MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 0  
//$MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
//create_thread @MUS_FAD
//
//wait 1
//
//while $MUSIC_FADE_ENDED[$MUSIC_FADE_NUMBER] == 0
//wait 0
//end
2504: SET_AUDIO_STREAM_VOLUME_WITH_TRANSITION $MUSIC_MISSION volume 0.0 time 700
wait 700
audiostream.Release($MUSIC_MISSION)

//////////////////////////////////////////////////////////

return

:USHER4_GET_BACK_IN_CAR
$DIALOG_PAUSE = 1
v$OBJECTIVE = "STRB37"
    
MISSION_CHECKPOINT = marker.CreateAboveCar($USED_CAR[LATEST_CAR_SLOT_USED])
07E0: set_marker MISSION_CHECKPOINT type_to 1
    
///////////////////////////////////////////////////////////////////
    
while true
wait 0

if
not actor.Dead(PLAYER_ACTOR)
jf @USHER4_GET_BACK_IN_CAR_FAILED_OTHER_REASON
if and
$CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
not BASE_TEAMMATE_AGRED == 1
jf @USHER4_GET_BACK_IN_CAR_FAILED_OTHER_REASON
if
803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
jf @USHER4_GET_BACK_IN_CAR_FAILED_OTHER_REASON
if
$SAVE_CAR_CREATED[LATEST_CAR_SLOT_USED] == 1
jf @USHER4_GET_BACK_IN_CAR_FAILED_OTHER_REASON
    
if and
056E:   car $USED_CAR[LATEST_CAR_SLOT_USED] defined
not car.Wrecked($USED_CAR[LATEST_CAR_SLOT_USED])
    then
    if
    actor.InCar(PLAYER_ACTOR,$USED_CAR[LATEST_CAR_SLOT_USED])   
        then
        :USHER4_GET_BACK_IN_CAR_FAILED_OTHER_REASON
        marker.Disable(MISSION_CHECKPOINT)
        USHER4_VICTORIA_GOT_BACK_FLAG = 0            
        $DIALOG_PAUSE = 0
        return
        end
    else
    USHER4_VICTORIA_GOT_BACK_FLAG = 1
    return
    end
    
end
    
///////////////////////////////////////////////////////////////////

:USHER4_GET_BACK_IN_CAR2
$DIALOG_PAUSE = 1
v$OBJECTIVE = "STRB37"
    
MISSION_CHECKPOINT = marker.CreateAboveCar(USHER4_GLENSHIT)
07E0: set_marker MISSION_CHECKPOINT type_to 1
    
///////////////////////////////////////////////////////////////////
    
while true
wait 0

if
not actor.Dead(PLAYER_ACTOR)
jf @USHER4_GET_BACK_IN_CAR_FAILED_OTHER_REASON2
if and
$CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
not BASE_TEAMMATE_AGRED == 1
jf @USHER4_GET_BACK_IN_CAR_FAILED_OTHER_REASON2
if
803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
jf @USHER4_GET_BACK_IN_CAR_FAILED_OTHER_REASON2
if
$SAVE_CAR_CREATED[LATEST_CAR_SLOT_USED] == 1
jf @USHER4_GET_BACK_IN_CAR_FAILED_OTHER_REASON2
    
if and
056E:   car USHER4_GLENSHIT defined
not car.Wrecked(USHER4_GLENSHIT)
    then
    if
    actor.InCar(PLAYER_ACTOR,USHER4_GLENSHIT)   
        then
        :USHER4_GET_BACK_IN_CAR_FAILED_OTHER_REASON2
        marker.Disable(MISSION_CHECKPOINT)
        USHER4_VICTORIA_GOT_BACK_FLAG = 0            
        $DIALOG_PAUSE = 0
        return
        end
    else
    USHER4_VICTORIA_GOT_BACK_FLAG = 1
    return
    end
    
end
    
///////////////////////////////////////////////////////////////////

:USHER4_FAILED_CAR_WRECKED
text.ClearAll()
BLACK_POLOSKI_ON = 1
$MUSIC_TURN_OFF_FLAG = 1
v$FAILED_TEXT = "MSFL103"
create_thread @GMV_OVR
return

:USHER4_FAILED_WALK2
text.ClearAll()
BLACK_POLOSKI_ON = 1
$MUSIC_TURN_OFF_FLAG = 1
v$FAILED_TEXT = "MS_FL7"
create_thread @GMV_OVR
return

:USHER4_HIDE_WEPS
$NOTSPAWN_ETC = 1
06AB: set_actor PLAYER_ACTOR all_weapons_hidden 1
0992: set_player PLAYER_CHAR weapons_scrollable 0
return

:USHER4_FAILED_AGRO
text.ClearAll()
BLACK_POLOSKI_ON = 1
$MUSIC_TURN_OFF_FLAG = 1
v$FAILED_TEXT = "MS_FL5"
create_thread @GMV_OVR
mission_cleanup    
return

:USHER4_FAILED_LDEAD
text.ClearAll()
BLACK_POLOSKI_ON = 1
$MUSIC_TURN_OFF_FLAG = 1
v$FAILED_TEXT = "MS_FL43"
create_thread @GMV_OVR
mission_cleanup    
return

:USHER4_FAILED_PLAYER_DIED
text.ClearAll()
BLACK_POLOSKI_ON = 1
$MUSIC_TURN_OFF_FLAG = 1
v$FAILED_TEXT = "MS_FL80"
create_thread @GMV_OVR
return

:USHER4_FAILED_TERRY_DEAD
text.ClearAll()
BLACK_POLOSKI_ON = 1
$MUSIC_TURN_OFF_FLAG = 1
v$FAILED_TEXT = "MS_FL99"
create_thread @GMV_OVR
return

:USHER4_FAILED_ANGIE_DIED
text.ClearAll()
BLACK_POLOSKI_ON = 1
$MUSIC_TURN_OFF_FLAG = 1
v$FAILED_TEXT = "MSFL117"
create_thread @GMV_OVR
return


:USHER4_FAILED_ANGIE_BADTOUGHT
text.ClearAll()
BLACK_POLOSKI_ON = 1
$MUSIC_TURN_OFF_FLAG = 1
v$FAILED_TEXT = "MSFL118"
create_thread @GMV_OVR
return

:USHER4_CREATE_VICTORIA
if
model.Available(15590)
then

0674: set_car_model 15590 numberplate "MT2WH0L3"    
USHER4_VICTORIA = Car.Create(15590, 2174.415527, -2265.320313, 13.308066)
car.Angle(USHER4_VICTORIA) = 45.0
    
if
model.Available(15590)
then
//model.Destroy(15590)
end
    
else
model.Load(15590)
mload
wait 0
jump to @USHER4_CREATE_VICTORIA
end    
    
/////////////////////////////////////////

008A: $USED_CAR[0] = USHER4_VICTORIA // (int)
$CAR_ENTERED[0] = 1
$CAR_MARKER_CREATED[0] = 0
$CAR_HINT_FLAG[0] = 0
$SAVE_CAR_CREATED[0] = 1
$SAVE_CAR_MODEL[0] = car.Model(USHER4_VICTORIA)
CAR_AUTOSAVED_EVER_FLAG = 1
LATEST_CAR_SLOT_USED = 0

03ED: set_car USHER4_VICTORIA disable_flipped_explosion_when_empty 1              
            
////////////////////////////////////////////////////////////////
0A97: 11@ = car USHER4_VICTORIA struct 
11@ += 9 
0A8D: 12@ = read_memory 11@ size 1 virtual_protect 0 
08BD: set 12@ bit 2 
0A8C: write_memory 11@ size 1 value 12@ virtual_protect 0 
0A97: 11@ = car USHER4_VICTORIA struct 
11@ += 4 
0A8D: 12@ = read_memory 11@ size 1 virtual_protect 0 
08BD: set 12@ bit 1 
0A8C: write_memory 11@ size 1 value 12@ virtual_protect 0 
24@ = 25.0 
0A97: 22@ = car USHER4_VICTORIA struct 
0A8E: 23@ = 22@ + 5 // int 
0A8C: write_memory 23@ size 4 value 24@ virtual_protect 0 
08C3: clear 12@ bit 1 
08C3: clear 12@ bit 2 
0A97: 11@ = car USHER4_VICTORIA struct 
11@ += 18 
0A8D: 12@ = read_memory 11@ size 1 virtual_protect 0 
08BD: set 12@ bit 2 
0A8C: write_memory 11@ size 1 value 12@ virtual_protect 0 
08C3: clear 12@ bit 2
//////////////////////////////////////////////////////////////// 

car.LockInCurrentPosition(USHER4_VICTORIA,false) 

if
0E08: is_car_script_controlled USHER4_VICTORIA
then
car.RemoveReferences(USHER4_VICTORIA)
end          

return

:CREATE_PODONKI_USHER4

////////////////////////////////////////////////////////////////////////////////////////////////////////////

while not model.Available(3140)
wait 0
model.Load(3140)
mload
end

USHER4_ERNIE = actor.Create(26,3140,2630.3643, 223.4543, 53.7536)
actor.Angle(USHER4_ERNIE) = 267.7571
0860: link_actor USHER4_ERNIE to_interior 1
 
0D10: set_actor USHER4_ERNIE alpha 255 // IF and SET

create_thread @PED_BKP USHER4_ERNIE 371
create_thread @ANT_PRE USHER4_ERNIE

actor.Health(USHER4_ERNIE) = 100

0D10: set_actor USHER4_ERNIE alpha 255 // IF and SET
09F4: set_actor USHER4_ERNIE ignore_height_difference_following_nodes $Z_IGNORE_HEIGHT 
Actor.SetWalkStyle(USHER4_ERNIE, "SURV1")
0446: set_actor USHER4_ERNIE dismemberment_possible 0
060B: set_actor USHER4_ERNIE decision_maker_to $DEC_PEOPLE
07DD: set_actor USHER4_ERNIE attack_rate 50 // previously known as temper_to
081A: set_actor USHER4_ERNIE weapon_skill_to 2  
060F: set_actor USHER4_ERNIE melee_accuracy_to 999.0
0946: set_actor USHER4_ERNIE actions_uninterupted_by_weapon_fire 1
087E: set_actor USHER4_ERNIE weapon_droppable 0

if
UNITED_MAP == 0
then
04D8: set_actor USHER4_ERNIE drowns_in_water 0 
end

09B5: set_actor USHER4_ERNIE signal_after_kill 0  
0A96: 0@ = actor USHER4_ERNIE struct
0A8E: 0@ = 0@ + 1376
0A8C: write_memory 0@ size 4 value $SURVIVORS_ROTATE_SPEED virtual_protect 1

08AF: set_actor USHER4_ERNIE max_health_to 100
Actor.WeaponAccuracy(USHER4_ERNIE) = $SURV_ACCURACY

0781: get_weapon_with_ID 73 model_to 0@

while not model.Available(0@)
wait 0
model.Load(0@)
mload
end

Actor.GiveWeaponAndAmmo(USHER4_ERNIE, 73, 99999)

////////////////////////////////////////////////////////////////////////////////////////////////////////////

while not model.Available(3141)
wait 0
model.Load(3141)
mload
end

USHER4_BOXUS = actor.Create(26,3141,2628.246094, 223.214203, 53.753574)
actor.Angle(USHER4_BOXUS) = 273.865051
0860: link_actor USHER4_BOXUS to_interior 1
 
0D10: set_actor USHER4_BOXUS alpha 255 // IF and SET

create_thread @PED_BKP USHER4_BOXUS 371
create_thread @ANT_PRE USHER4_BOXUS

actor.Health(USHER4_BOXUS) = 1000

0D10: set_actor USHER4_BOXUS alpha 255 // IF and SET
09F4: set_actor USHER4_BOXUS ignore_height_difference_following_nodes $Z_IGNORE_HEIGHT 
Actor.SetWalkStyle(USHER4_BOXUS, "SURV1")
0446: set_actor USHER4_BOXUS dismemberment_possible 0
060B: set_actor USHER4_BOXUS decision_maker_to $DEC_PEOPLE
07DD: set_actor USHER4_BOXUS attack_rate 50 // previously known as temper_to
081A: set_actor USHER4_BOXUS weapon_skill_to 2  
060F: set_actor USHER4_BOXUS melee_accuracy_to 999.0
0946: set_actor USHER4_BOXUS actions_uninterupted_by_weapon_fire 1
087E: set_actor USHER4_BOXUS weapon_droppable 0

if
UNITED_MAP == 0
then
04D8: set_actor USHER4_BOXUS drowns_in_water 0 
end

09B5: set_actor USHER4_BOXUS signal_after_kill 0  
0A96: 0@ = actor USHER4_BOXUS struct
0A8E: 0@ = 0@ + 1376
0A8C: write_memory 0@ size 4 value $SURVIVORS_ROTATE_SPEED virtual_protect 1

08AF: set_actor USHER4_BOXUS max_health_to $SURVIVER_MAX_HEALTH
Actor.WeaponAccuracy(USHER4_BOXUS) = $SURV_ACCURACY

07FE: set_actor USHER4_BOXUS fighting_style_to 26 moves 6

////////////////////////////////////////////////////////////////////////////////////////////////////////////

while not model.Available(3138)
wait 0
model.Load(3138)
mload
end

USHER4_CLETUS = actor.Create(26,3138,2624.460205, 218.382477, 53.753574)
actor.Angle(USHER4_CLETUS) = 306.866699
0860: link_actor USHER4_CLETUS to_interior 1
 
0D10: set_actor USHER4_CLETUS alpha 255 // IF and SET

create_thread @PED_BKP USHER4_CLETUS 371
create_thread @ANT_PRE USHER4_CLETUS

actor.Health(USHER4_CLETUS) = 3000

0D10: set_actor USHER4_CLETUS alpha 255 // IF and SET
09F4: set_actor USHER4_CLETUS ignore_height_difference_following_nodes $Z_IGNORE_HEIGHT 
Actor.SetWalkStyle(USHER4_CLETUS, "SURV1")
0446: set_actor USHER4_CLETUS dismemberment_possible 0
060B: set_actor USHER4_CLETUS decision_maker_to $DEC_PEOPLE
07DD: set_actor USHER4_CLETUS attack_rate 50 // previously known as temper_to
081A: set_actor USHER4_CLETUS weapon_skill_to 2  
060F: set_actor USHER4_CLETUS melee_accuracy_to 999.0
0946: set_actor USHER4_CLETUS actions_uninterupted_by_weapon_fire 1
087E: set_actor USHER4_CLETUS weapon_droppable 0

if
UNITED_MAP == 0
then
04D8: set_actor USHER4_CLETUS drowns_in_water 0 
end

09B5: set_actor USHER4_CLETUS signal_after_kill 0  
0A96: 0@ = actor USHER4_CLETUS struct
0A8E: 0@ = 0@ + 1376
0A8C: write_memory 0@ size 4 value $SURVIVORS_ROTATE_SPEED virtual_protect 1

08AF: set_actor USHER4_CLETUS max_health_to 3000
Actor.WeaponAccuracy(USHER4_CLETUS) = 25   

0781: get_weapon_with_ID 33 model_to 0@

while not model.Available(0@)
wait 0
model.Load(0@)
mload
end

Actor.GiveWeaponAndAmmo(USHER4_CLETUS, 33, 99999) 

////////////////////////////////////////////////////////////////////////////////////////////////////////////

while not model.Available(3139)
wait 0
model.Load(3139)
mload
end

USHER4_BRODY = actor.Create(26,3139,2624.579102, 225.677032, 53.753574)
actor.Angle(USHER4_BRODY) = 258.720551
0860: link_actor USHER4_BRODY to_interior 1
 
0D10: set_actor USHER4_BRODY alpha 255 // IF and SET

create_thread @PED_BKP USHER4_BRODY 371
create_thread @ANT_PRE USHER4_BRODY

actor.Health(USHER4_BRODY) = 1000

0D10: set_actor USHER4_BRODY alpha 255 // IF and SET
09F4: set_actor USHER4_BRODY ignore_height_difference_following_nodes $Z_IGNORE_HEIGHT 
Actor.SetWalkStyle(USHER4_BRODY, "SURV1")
0446: set_actor USHER4_BRODY dismemberment_possible 0
060B: set_actor USHER4_BRODY decision_maker_to $DEC_PEOPLE
07DD: set_actor USHER4_BRODY attack_rate 50 // previously known as temper_to
081A: set_actor USHER4_BRODY weapon_skill_to 2  
060F: set_actor USHER4_BRODY melee_accuracy_to 999.0
0946: set_actor USHER4_BRODY actions_uninterupted_by_weapon_fire 1
087E: set_actor USHER4_BRODY weapon_droppable 0

if
UNITED_MAP == 0
then
04D8: set_actor USHER4_BRODY drowns_in_water 0 
end

09B5: set_actor USHER4_BRODY signal_after_kill 0  
0A96: 0@ = actor USHER4_BRODY struct
0A8E: 0@ = 0@ + 1376
0A8C: write_memory 0@ size 4 value $SURVIVORS_ROTATE_SPEED virtual_protect 1

08AF: set_actor USHER4_BRODY max_health_to $SURVIVER_MAX_HEALTH
Actor.WeaponAccuracy(USHER4_BRODY) = 20   

0781: get_weapon_with_ID 24 model_to 0@

while not model.Available(0@)
wait 0
model.Load(0@)
mload
end

Actor.GiveWeaponAndAmmo(USHER4_BRODY, 24, 99999) 

////////////////////////////////////////////////////////////////////////////////////////////////////////////

return                 