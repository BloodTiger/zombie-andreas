const
USHER2_VICTORIA = 299@  
USHER2_TERRY = $SURVIVER[0]
USHER2_NIKOLS = $ARMY69_2[28]
USHER2_NIKOLS_SMOKE_FLAG = 301@
USHER2_NIKOLS_SMOKE_OBJECT = 302@
USHER2_NIKOLS_SMOKE_OBJECT2 = 303@
USHER2_NIKOLS_SMOKE_PARTICLE = 304@
USHER2_NIKOLS_CAR = 305@
USHER2_DELTA_CAR = 306@
USHER2_DELTA_BOEC1 = $SWAT[1]
USHER2_DELTA_BOEC2 = $SWAT[2]
USHER2_DELTA_BOEC3 = $SWAT[3]
USHER2_DELTA_BOEC4 = $SWAT[4]
USHER2_DELTA_GROUP = 307@
USHER2_HUNTER_PHRASE = 308@
USHER2_CHARGER_PHRASE = 309@
USHER2_SAVE_PICKUP = 310@
USHER2_SAVE_PICKUP_MARKER = 311@
USHER2_DELTA_CAR_DROVE_FLAG = 312@
USHER2_MISS_CHECKPOINT_NUM = 313@
USHER2_VICTORIA_GOT_BACK_FLAG = 314@
end                  
                          
:USHS2
thread 'USHS2'
gosub @UKOD_MISSII2 
if 
wasted_or_busted 
jf @UPROPUSK_KODA2 
gosub @UKOD_PROVALA2 

:UPROPUSK_KODA2        
gosub @UUDALENIE_KODA2
end_thread

:UKOD_MISSII2
increment_mission_attempts 

cinema.Radar(1)
cinema.Widescreen(1)
BLACK_POLOSKI_ON = 1
0A48: enable_menu_access_in_widescreen_mode 0
0629: change_integer_stat 258 to 111
0459: end_thread_named 'ARMY_SP'
0459: end_thread_named 'BNDT_SP'
0459: end_thread_named 'FRMR_SP'
0459: end_thread_named 'SWAT_SP'
0459: end_thread_named 'C_MENU'

0AF1: write_int 1 to_ini_file "saves/ZACM.set" section "SCR" key "USHER_TUT_COMPLETED"

MAIN_QUEST_MUSIC_FLAG = 1
057E: set_radar_grey 0
SURVIVAL_STARTED_FULLY_FLAG = 1
CAMP_DONT_SAY_HELLO_FLAG = 1
USHER_STORY_FEATRUES_LOCKED = 2
USHER_STORY_CREATE_NICOLS_FLAG = 1
$TIME_LOCK_OFF = 1
$WEATHER_LOCK_OFF_FLAG = 1
0459: end_thread_named 'WTH_LCK'
0459: end_thread_named 'TIM_LCK'
BLACK_POLOSKI_ON = 0
CANT_CAPTURE_SHIT = 2

actor.PutAtNoOffset(PLAYER_ACTOR,2231.8127, -2284.1846, 14.3751)
actor.Angle(PLAYER_ACTOR) = 135.0173
camera.Restore_WithJumpCut()
create_thread @3D_REFR
gosub @USHER2_HIDE_WEPS

CAMP_DONT_SAY_HELLO_FLAG = 0
$CAMP_SPOTTED_FLAG = 1
$CAMP_SPOTTED_FLAG_SAVE = 0

32@ = 0
repeat
wait 0
00C0: set_current_time 6 0
fade 0 0
$SAVESTATUS = 1
03F0: enable_text_draw 1
038E: draw_box_position 320.0 224.0 size 640.0 448.0 RGBA 0 0 0 255
until 32@ > 3100

while true
wait 0
$END_FADING_MUSIC_FAST = 1

if and
$MUSIC_FADE_ENDED[0] == 1
$MUSIC_FADE_ENDED[1] == 1
$MUSIC_FADE_ENDED[2] == 1
$MUSIC_FADE_ENDED[3] == 1
$MUSIC_FADE_ENDED[4] == 1
then
$END_FADING_MUSIC_FAST = 0
break
end

end     

$SOUND_OFF_1 = 0  
$ONMISSION = 1 
$HUD_REMOVE = 1
$SAVESTATUS = 1   
$INT_ZMB_NOT = 1
$NOTSPAWN_ETC = 1
$SPECIAL_INFECTED_NOT_SPAWN_FLAG = 1
ZOMBIES_NOTSPAWN = 1
$ZOMBIES_COUNT = 20
$QUEST_CAMP_NUMBER = 6

ENEX_OFF = 1
PLAYER_DONT_HAVE_BACKPACK = 1

$SPECIAL_INFECTED_NOT_SPAWN_FLAG = 1
INT_ZOMBIE_OFF_FADING_AND_SHIT_FLAG = 0

$SATIETY_LEVEL = 200.0

$DONT_CHANGE_MONTH_FLAG = 1
wait 100
0A8C: write_memory 0x00B70154 size 1 value 18 virtual_protect 0 //Day
0A8C: write_memory 0x00B70155 size 1 value 9 virtual_protect 0 //Month
wait 100
$DONT_CHANGE_MONTH_FLAG = 0

if and
$CHEATS_ON == 1
0AB0:   key_pressed 48
then //Удаление всех скипов
0AF1: write_int -1 to_ini_file "saves\ZACM.set" section "SCR" key "USHER_MISS2_CHECKPOINT" 
end

if and
$CHEATS_ON == 1
0AB0:   key_pressed 49
then //Скип где мы сразу в тачке с Терри
0AF1: write_int 1 to_ini_file "saves\ZACM.set" section "SCR" key "USHER_MISS2_CHECKPOINT" 
end

if and
$CHEATS_ON == 1
0AB0:   key_pressed 50
then //Скип где мы на месте вызова
0AF1: write_int 2 to_ini_file "saves\ZACM.set" section "SCR" key "USHER_MISS2_CHECKPOINT" 
end

if and
$CHEATS_ON == 1
0AB0:   key_pressed 51
then //Скип ДЛЯ РУКОЖОПЫХ ДОЛБОЕБОВ, БЛЯТЬ!
0AF1: write_int 3 to_ini_file "saves\ZACM.set" section "SCR" key "USHER_MISS2_CHECKPOINT" 
end

0AF0: USHER2_MISS_CHECKPOINT_NUM = get_int_from_ini_file "saves\ZACM.set" section "SCR" key "USHER_MISS2_CHECKPOINT"

if
USHER2_MISS_CHECKPOINT_NUM < 1
then

if
not $CHEATS_ON == 1
then

06D1: v$BNS_TXT = "STRB1D" // v$ = string
$PORTRAIT_RELOAD_FLAG = 0
create_thread @DLC_TXT

repeat
wait 0
until $PORTRAIT_RELOAD_FLAG == 1

end

$MUSIC_MISSION = Audiostream.Load("audio\sounds\music\usher_music\MISS2\theme1.wav")
Audiostream.PerformAction($MUSIC_MISSION, PLAY)
Audiostream.Loop($MUSIC_MISSION, 1)
Audiostream.Volume($MUSIC_MISSION) = 0.0

/////////////////////Плавное нарастание/////////////////////

$MUSIC_FADE_NUMBER += 1
if
$MUSIC_FADE_NUMBER > 4
    then
    $MUSIC_FADE_NUMBER = 0 
    end    

0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_MISSION // (int) 
0086: $MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = $MUSIC_VOLUME // (float) 

$MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 1000
$MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 1  
$MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
create_thread @MUS_FAD

wait 1 

////////////////////////////////////////////////////////

end

$SAVESTATUS = 0 

repeat
wait 0
until 056D:   actor USHER2_NIKOLS defined

0084: CHAR_TO_DEL_BACKPACK = USHER2_NIKOLS // (int)
01B9: set_actor USHER2_NIKOLS armed_weapon_to 0 
actor.PutAtNoOffset(USHER2_NIKOLS,2116.426025, -2277.298340, 20.675962)
actor.Angle(USHER2_NIKOLS) = 196.394836
gosub @USHER2_TERRY_ACTOR_CREATE

player.CanMove(PLAYER_CHAR,true)
cinema.Widescreen(0)
BLACK_POLOSKI_ON = 0

if
LATEST_CAR_SLOT_USED == -1
then
gosub @USHER2_CREATE_VICTORIA
create_thread @C_MENU 1
SUPPLY_QUEST_TRUCK = -1
end

$CAR_SAVE_BANKA_COUNT[LATEST_CAR_SLOT_USED] = 2
$CAR_SAVE_HEAL_COUNT[LATEST_CAR_SLOT_USED] = 2
$CAR_SAVE_BINT_COUNT[LATEST_CAR_SLOT_USED] = 2
$CAR_SAVE_RADIO_COUNT[LATEST_CAR_SLOT_USED] = 1
0AD3: 4@s = format "CR%d" LATEST_CAR_SLOT_USED
0AF1: write_int 88 to_ini_file "data\survival.set" section 4@s key "WEP_SLOT1_ID"
0AF1: write_int 120 to_ini_file "data\survival.set" section 4@s key "WEP_SLOT1_AMMO"
0AF1: write_int 18 to_ini_file "data\survival.set" section 4@s key "WEP_SLOT2_ID"
0AF1: write_int 5 to_ini_file "data\survival.set" section 4@s key "WEP_SLOT2_AMMO"
$RADIO = 0

repeat
wait 0
gosub @USHER2_HIDE_WEPS
until 056E:   car $USED_CAR[LATEST_CAR_SLOT_USED] defined

Text.ShowStyled('STRB43', 3000, 2)

if
USHER2_MISS_CHECKPOINT_NUM < 1
then
fade 1 250
$HUD_REMOVE = 0
wait 250
//jump to @USHER2_JUMP_STRAIGHT_TO_MECHA_PART
//jump to @USHER2_JUMP_STRAIGHT_TO_TERRY_PART_PRE

v$ST_DIALOG[0] = "STRY129"
v$ST_DIALOG[1] = "STRY130"
$DIALOG_COUNT = 1
$DIALOG_NOT_SKIP = 1
create_thread @DG_SYS2
else
jump to @USHER2_JUMP_STRAIGHT_TO_TERRY_PART_PRE
end

repeat
wait 0

if
not actor.Dead(PLAYER_ACTOR)
jf @USHER2_FAILED_PLAYER_DIED
if and
$CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
not BASE_TEAMMATE_AGRED == 1
jf @USHER2_FAILED_AGRO
if
803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
jf @USHER2_FAILED_LDEAD
if 
not actor.Dead(USHER2_TERRY) 
jf @USHER2_FAILED_TERRY_DEAD
if
$SAVE_CAR_CREATED[LATEST_CAR_SLOT_USED] == 1
jf @USHER2_FAILED_CAR_WRECKED

gosub @USHER2_HIDE_WEPS 

if and
0E3E: is_button_just_pressed 0 button 17
$CHEATS_ON == 1
then
$END_DIALOG_INST = 1
wait 0 
break
end

until $DIALOG_END == 1

v$OBJECTIVE = "STRB3"
09A6: enable_interior_radar_blips 1 
28@ = Pickup.Create(6549, 3, $CAMP_SAVE_X[6], $CAMP_SAVE_Y[6], $CAMP_SAVE_Z[6])
03DC: MISSION_MARKER = create_marker_above_pickup 28@

repeat
wait 0

//0AD1: show_formatted_text_highpriority "$PREPARING_TEXT_OFF %d PLAYER_DONT_HAVE_BACKPACK %d SAVE_PRE_TP_TEAMMATES_FLAG %d" time 2000 $PREPARING_TEXT_OFF PLAYER_DONT_HAVE_BACKPACK SAVE_PRE_TP_TEAMMATES_FLAG

gosub @USHER2_HIDE_WEPS

if
not actor.Dead(PLAYER_ACTOR)
jf @USHER2_FAILED_PLAYER_DIED
if and
$CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
not BASE_TEAMMATE_AGRED == 1
jf @USHER2_FAILED_AGRO
if
803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
jf @USHER2_FAILED_LDEAD
if 
not actor.Dead(USHER2_TERRY) 
jf @USHER2_FAILED_TERRY_DEAD
if
$SAVE_CAR_CREATED[LATEST_CAR_SLOT_USED] == 1
jf @USHER2_FAILED_CAR_WRECKED

if and
0E3E: is_button_just_pressed 0 button 17
$CHEATS_ON == 1
then
//actor.PutAtNoOffset(PLAYER_ACTOR,985.4669, -1609.2203, 7.3406)
//$END_DIALOG_INST = 1
wait 0
break
end

until pickup.Picked_up(28@)

:USHER2_JUMP_STRAIGHT_TO_TERRY_PART_PRE
pickup.Destroy(28@)
Marker.Disable(MISSION_MARKER)
$PREPARING_TEXT_OFF = 0
PLAYER_NO_ITEMS_FLAG = 0
PLAYER_DONT_HAVE_BACKPACK = 0
create_thread @PED_BKP PLAYER_ACTOR 371

if
8491: not  actor PLAYER_ACTOR has_weapon 151
then

0781: get_weapon_with_ID 151 model_to 0@

while not model.Available(0@)
wait 0
model.Load(0@)
mload
end

actor.GiveWeaponAndAmmo(PLAYER_ACTOR,151,1)
01B9: set_actor PLAYER_ACTOR armed_weapon_to 0

end

06AB: set_actor PLAYER_ACTOR all_weapons_hidden 0
0992: set_player PLAYER_CHAR weapons_scrollable 1

v$OBJECTIVE = "STRB46"
CURRENT_USHER_TUTORIAL_NUM = 4

if
$PLAYER_LEVEL < 2
    then
    $PLAYER_XP += 1500
    4@ = 151
    gosub @ST_MIKE_CHECK_LOADED_WEP_MODEL_FOR_PLAYER
    actor.GiveWeaponAndAmmo(PLAYER_ACTOR,151,1)
    4@ = 10
    gosub @ST_MIKE_CHECK_LOADED_WEP_MODEL_FOR_PLAYER
    actor.GiveWeaponAndAmmo(PLAYER_ACTOR,10,1)
    01B9: set_actor PLAYER_ACTOR armed_weapon_to 0    
    end 
    
if
USHER2_MISS_CHECKPOINT_NUM >= 1
then
0337: set_actor USHER2_TERRY visibility 1
0619: enable_actor USHER2_TERRY collision_detection 1
$KANISTRA = 1
$KANISTRA_FUEL += 15.0
$PANEL_OPEN = 0
//0EBB: pass_time 120
create_thread @PASSTM 120
jump to @USHER2_TERRY_PART_222
end          

repeat
wait 0

gosub @USHER2_HIDE_WEPS
gosub @USHER2_NICOLS_SMOKE_SYSTEM

if
not actor.Dead(PLAYER_ACTOR)
jf @USHER2_FAILED_PLAYER_DIED
if and
$CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
not BASE_TEAMMATE_AGRED == 1
jf @USHER2_FAILED_AGRO
if
803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
jf @USHER2_FAILED_LDEAD
if 
not actor.Dead(USHER2_TERRY) 
jf @USHER2_FAILED_TERRY_DEAD
if
$SAVE_CAR_CREATED[LATEST_CAR_SLOT_USED] == 1
jf @USHER2_FAILED_CAR_WRECKED

if
0A4B:   controls_set_to_joystick
    then
    text.ShowH('STRB44B',10,1)
    else
    text.ShowH('STRB44',10,1)
    end

until CURRENT_USHER_TUTORIAL_NUM == 0

v$OBJECTIVE = "DUMMY"
v$ST_DIALOG[0] = "STRY131"
$DIALOG_COUNT = 0
$DIALOG_NOT_SKIP = 1
create_thread @DG_SYS2

repeat
wait 0 

gosub @USHER2_HIDE_WEPS
gosub @USHER2_NICOLS_SMOKE_SYSTEM

if
not actor.Dead(PLAYER_ACTOR)
jf @USHER2_FAILED_PLAYER_DIED
if and
$CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
not BASE_TEAMMATE_AGRED == 1
jf @USHER2_FAILED_AGRO
if
803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
jf @USHER2_FAILED_LDEAD
if 
not actor.Dead(USHER2_TERRY) 
jf @USHER2_FAILED_TERRY_DEAD
if
$SAVE_CAR_CREATED[LATEST_CAR_SLOT_USED] == 1
jf @USHER2_FAILED_CAR_WRECKED

if and
0E3E: is_button_just_pressed 0 button 17
$CHEATS_ON == 1
then
$END_DIALOG_INST = 1
wait 0 
break
end

until $DIALOG_END == 1

v$OBJECTIVE = "STRB48"

repeat
wait 0

gosub @USHER2_NICOLS_SMOKE_SYSTEM

if
not actor.Dead(PLAYER_ACTOR)
jf @USHER2_FAILED_PLAYER_DIED
if and
$CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
not BASE_TEAMMATE_AGRED == 1
jf @USHER2_FAILED_AGRO
if
803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
jf @USHER2_FAILED_LDEAD
if 
not actor.Dead(USHER2_TERRY) 
jf @USHER2_FAILED_TERRY_DEAD
if
$SAVE_CAR_CREATED[LATEST_CAR_SLOT_USED] == 1
jf @USHER2_FAILED_CAR_WRECKED
                             
if and
0E3E: is_button_just_pressed 0 button 17
$CHEATS_ON == 1
then
actor.PutAtNoOffset(PLAYER_ACTOR,2131.2751 -2279.6379 20.308066)
$END_DIALOG_INST = 1
wait 0
fade 0 500
$HUD_REMOVE = 1
wait 500
break
end

if
00EC:   actor PLAYER_ACTOR sphere 0 near_point 2121.328369 -2280.205811 radius 5.0 5.0
    then
    
    v$OBJECTIVE = "DUMMY"    
    
    v$ST_DIALOG[0] = "STRY132"
    $DIALOG_COUNT = 0
    $DIALOG_NOT_SKIP = 1
    create_thread @DG_SYS2
    
    05BF: AS_actor USHER2_NIKOLS look_at_actor PLAYER_ACTOR 9999999 ms
    05BF: AS_actor PLAYER_ACTOR look_at_actor USHER2_NIKOLS 9999999 ms
    
    repeat
    wait 0 
    
    if and
    0E3E: is_button_just_pressed 0 button 17
    $CHEATS_ON == 1
    then
    $END_DIALOG_INST = 1
    wait 0 
    break
    end
    
    until $DIALOG_END == 1
    
    if
    USHER2_NIKOLS_SMOKE_FLAG > 0
    then
    0605: actor USHER2_NIKOLS perform_animation "M_smk_out" IFP "SMOKING" framedelta 4.0 loop 0 lockX 0 lockY 0 lockF 0 time -1    
    wait 3000
    0687: clear_actor USHER2_NIKOLS task
    01B9: set_actor USHER2_NIKOLS armed_weapon_to 0
    
    if
    03CA:   object USHER2_NIKOLS_SMOKE_OBJECT exists
    then
    object.Destroy(USHER2_NIKOLS_SMOKE_OBJECT)
    end
    
    if
    03CA:   object USHER2_NIKOLS_SMOKE_OBJECT2 exists
    then
    object.Destroy(USHER2_NIKOLS_SMOKE_OBJECT2)
    end
    
    end
    
    v$ST_DIALOG[0] = "STRY133"
    v$ST_DIALOG[1] = "STRY134"
    $DIALOG_COUNT = 1
    $DIALOG_NOT_SKIP = 1
    create_thread @DG_SYS2
    
    repeat
    wait 0
    
    if
    0E45: frame_mod 15
    then
    0A1D: AS_actor USHER2_NIKOLS rotate_to_and_look_at_actor PLAYER_ACTOR
    end 
    
    if and
    0E3E: is_button_just_pressed 0 button 17
    $CHEATS_ON == 1
    then
    $END_DIALOG_INST = 1
    wait 0 
    break
    end
    
    until $DIALOG_END == 1
    
    0615: define_AS_pack_begin 0@
    05D3: AS_actor -1 goto_point 2118.208740 -2275.645508 20.675962 mode 4 time 10000 ms // versionA
    05D3: AS_actor -1 goto_point 2122.405029 -2271.250244 20.671875 mode 4 time 10000 ms // versionA
    05D4: AS_actor -1 rotate_angle 216.076233
    0616: define_AS_pack_end 0@
    0618: assign_actor USHER2_NIKOLS to_AS_pack 0@
    061B: remove_references_to_AS_pack 0@           
    
    repeat
    wait 0
    until 00EF:   actor USHER2_NIKOLS sphere 0 near_point 2122.405029 -2271.250244 radius 2.0 2.0 stopped
    
    fade 0 500
    $HUD_REMOVE = 1
    wait 500            
    break
    end 
    
if
00EC:   actor PLAYER_ACTOR sphere 0 near_point 2131.2751 -2279.6379 radius 5.0 5.0
    then
    
    v$OBJECTIVE = "DUMMY"
    
    v$ST_DIALOG[0] = "STRY135"
    $DIALOG_COUNT = 0
    $DIALOG_NOT_SKIP = 1
    create_thread @DG_SYS2
    
    repeat
    wait 0    
          
    if and
    0E3E: is_button_just_pressed 0 button 17
    $CHEATS_ON == 1
    then
    $END_DIALOG_INST = 1
    wait 0 
    break
    end
    
    until $DIALOG_END == 1
    
    0615: define_AS_pack_begin 0@
    05D3: AS_actor -1 goto_point 2118.208740 -2275.645508 20.675962 mode 4 time 10000 ms // versionA
    05D3: AS_actor -1 goto_point 2122.405029 -2271.250244 20.671875 mode 4 time 10000 ms // versionA
    05D4: AS_actor -1 rotate_angle 216.076233
    0616: define_AS_pack_end 0@
    0618: assign_actor USHER2_NIKOLS to_AS_pack 0@
    061B: remove_references_to_AS_pack 0@
    
    repeat
    wait 0
    until 0364:   actor PLAYER_ACTOR spotted_actor USHER2_NIKOLS    
    
    v$ST_DIALOG[0] = "STRY132"
    v$ST_DIALOG[1] = "STRY133"
    v$ST_DIALOG[2] = "STRY134"
    $DIALOG_COUNT = 2
    $DIALOG_NOT_SKIP = 1
    create_thread @DG_SYS2
    
    05BF: AS_actor USHER2_NIKOLS look_at_actor PLAYER_ACTOR 9999999 ms
    05BF: AS_actor PLAYER_ACTOR look_at_actor USHER2_NIKOLS 9999999 ms
    
    repeat
    wait 0    
    
    if and
    0E3E: is_button_just_pressed 0 button 17
    $CHEATS_ON == 1
    then
    $END_DIALOG_INST = 1
    wait 0 
    break
    end
    
    until $DIALOG_END == 1      
    
    repeat
    wait 0
    until 00EF:   actor USHER2_NIKOLS sphere 0 near_point 2122.405029 -2271.250244 radius 2.0 2.0 stopped
    
    fade 0 500
    $HUD_REMOVE = 1
    wait 500
    
    break
    end       
                                                              
until false

v$OBJECTIVE = "DUMMY"
player.CanMove(PLAYER_CHAR,false) 
cinema.Widescreen(1)
BLACK_POLOSKI_ON = 1
wait 1000     

0936: set_camera 2123.741943 -2275.586426 21.095398 position_to 2123.342041 -2274.140625 21.021057 time 180000 smooth_transition 1
0920: point_camera 2123.473389 -2274.624512 21.046093 transverse_to 2123.073486 -2273.178711 20.971752 time 180000 smooth_transition 1

actor.PutAtNoOffset(USHER2_NIKOLS,2122.405029 -2271.250244 20.671875)
actor.Angle(USHER2_NIKOLS) = 216.076233

06AB: set_actor USHER2_NIKOLS all_weapons_hidden 1
06AB: set_actor PLAYER_ACTOR all_weapons_hidden 1

actor.PutAtNoOffset(PLAYER_ACTOR,2123.7058, -2272.8818, 20.6719)
actor.Angle(PLAYER_ACTOR) = 39.0

v$ST_DIALOG[0] = "STRY136"
v$ST_DIALOG[1] = "STRY137"
v$ST_DIALOG[2] = "STRY138"
v$ST_DIALOG[3] = "STRY139"
v$ST_DIALOG[4] = "STRY140"
v$ST_DIALOG[5] = "STRY141"
v$ST_DIALOG[6] = "STRY142"
v$ST_DIALOG[7] = "STRY143"
v$ST_DIALOG[8] = "STRY144"
v$ST_DIALOG[9] = "STRY145"
v$ST_DIALOG[10] = "STRY146"
v$ST_DIALOG[11] = "STRY147"
v$ST_DIALOG[12] = "STRY148"
0084: $DIALOG_ACTOR[0] = USHER2_NIKOLS // (int)
0084: $DIALOG_ACTOR[1] = PLAYER_ACTOR // (int)
0084: $DIALOG_ACTOR[2] = USHER2_NIKOLS // (int)
0084: $DIALOG_ACTOR[3] = PLAYER_ACTOR // (int)
0084: $DIALOG_ACTOR[4] = USHER2_NIKOLS // (int)
0084: $DIALOG_ACTOR[5] = PLAYER_ACTOR // (int)
0084: $DIALOG_ACTOR[6] = USHER2_NIKOLS // (int)
0084: $DIALOG_ACTOR[7] = PLAYER_ACTOR // (int)
0084: $DIALOG_ACTOR[8] = USHER2_NIKOLS // (int)
0084: $DIALOG_ACTOR[9] = PLAYER_ACTOR // (int)
0084: $DIALOG_ACTOR[10] = USHER2_NIKOLS // (int)
0084: $DIALOG_ACTOR[11] = PLAYER_ACTOR // (int)
0084: $DIALOG_ACTOR[12] = USHER2_NIKOLS // (int)
$DIALOG_COUNT = 12
$DIALOG_NOT_ANIMS_FLAG = 0
create_thread @DG_SYS

fade 1 1000
wait 1000

repeat
wait 0 

if
not actor.Dead(PLAYER_ACTOR)
jf @USHER2_FAILED_PLAYER_DIED
if and
$CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
not BASE_TEAMMATE_AGRED == 1
jf @USHER2_FAILED_AGRO
if
803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
jf @USHER2_FAILED_LDEAD
if 
not actor.Dead(USHER2_TERRY) 
jf @USHER2_FAILED_TERRY_DEAD
if
$SAVE_CAR_CREATED[LATEST_CAR_SLOT_USED] == 1
jf @USHER2_FAILED_CAR_WRECKED

if and
0E3E: is_button_just_pressed 0 button 17
$CHEATS_ON == 1
then
$END_DIALOG_INST = 1
wait 0 
break
end

until $DIALOG_END == 1

0605: actor USHER2_NIKOLS perform_animation "habargive" IFP "CAMERA" framedelta 4.0 loop 0 lockX 0 lockY 0 lockF 0 time -1
05BF: AS_actor USHER2_NIKOLS look_at_actor PLAYER_ACTOR 1170 ms
Audiostream.Volume($PICKUP_ITEM_SOUND) = $SOUNDS_VOLUME 
Audiostream.Loop($PICKUP_ITEM_SOUND, 0)
Audiostream.PerformAction($PICKUP_ITEM_SOUND, PLAY)
$KANISTRA = 1
$KANISTRA_FUEL += 15.0

wait 1000

v$ST_DIALOG[0] = "STRY149"
0084: $DIALOG_ACTOR[0] = USHER2_NIKOLS // (int)
$DIALOG_COUNT = 0
$DIALOG_NOT_ANIMS_FLAG = 0
create_thread @DG_SYS

repeat
wait 0 

if
not actor.Dead(PLAYER_ACTOR)
jf @USHER2_FAILED_PLAYER_DIED
if and
$CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
not BASE_TEAMMATE_AGRED == 1
jf @USHER2_FAILED_AGRO
if
803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
jf @USHER2_FAILED_LDEAD
if 
not actor.Dead(USHER2_TERRY) 
jf @USHER2_FAILED_TERRY_DEAD
if
$SAVE_CAR_CREATED[LATEST_CAR_SLOT_USED] == 1
jf @USHER2_FAILED_CAR_WRECKED

if and
0E3E: is_button_just_pressed 0 button 17
$CHEATS_ON == 1
then
$END_DIALOG_INST = 1
wait 0 
break
end

until $DIALOG_END == 1

fade 0 1000
wait 1000

06AB: set_actor USHER2_NIKOLS all_weapons_hidden 0
06AB: set_actor PLAYER_ACTOR all_weapons_hidden 0

0936: set_camera 2123.741943 -2275.586426 21.095398 position_to 2123.342041 -2274.140625 21.021057 time 1 smooth_transition 1
0920: point_camera 2123.473389 -2274.624512 21.046093 transverse_to 2123.073486 -2273.178711 20.971752 time 1 smooth_transition 1

:USHER2_JUMP_STRAIGHT_TO_MECHA_PART

cinema.Widescreen(0)
BLACK_POLOSKI_ON = 0
camera.Restore_WithJumpCut()
actor.PutAtNoOffset(PLAYER_ACTOR,2134.2273, -2277.3892, 20.6719)
actor.Angle(PLAYER_ACTOR) = 314.3511

fade 1 500
$HUD_REMOVE = 0
wait 500

//////////////////////////////////////////////////////////////////////////

if
SHOW_HINTS_FLAG == 0
then
jump to @FUCKING_SKIP_HINTS2
end

if
$FP_ACTIVATED == 1
then

FP_TURNED_OFF_FOR_CUTSCENE = 1

repeat
wait 0
until $FP_ACTIVATED == 0

wait 250

end

camera.SetPosition(2157.439941 -2297.683594 14.730098,0.0,0.0,0.0)
camera.PointAt(2157.157715 -2296.726563 14.662862,1)

text.ShowH('HINT26',6000,1)

32@ = 0
repeat
wait 0

if
0E3E: is_button_just_pressed 0 button 17
then
text.ClearAll()
break
end

until 32@ > 6000

//wait 6000

//////////////////////////////////////////////////////////////////////////

camera.SetPosition(2150.189697 -2286.208496 15.423433,0.0,0.0,0.0)
camera.PointAt(2151.137939 -2286.322021 15.126602,1)

text.ShowH('HINT27',4000,1)

32@ = 0
repeat
wait 0

if
0E3E: is_button_just_pressed 0 button 17
then
text.ClearAll()
break
end

until 32@ > 4000

//wait 4000

//////////////////////////////////////////////////////////////////////////

camera.SetPosition(2152.938477 -2285.619385 15.035218,0.0,0.0,0.0)
camera.PointAt(2152.228760 -2284.921875 14.936149,1)

text.ShowH('HINT28',3000,1)

32@ = 0
repeat
wait 0

if
0E3E: is_button_just_pressed 0 button 17
then
text.ClearAll()
break
end

until 32@ > 3000

:FUCKING_SKIP_HINTS2
v$OBJECTIVE = "STRB49"
CURRENT_USHER_TUTORIAL_NUM = 5
player.CanMove(PLAYER_CHAR,true) 
camera.Restore_WithJumpCut()
FP_TURNED_OFF_FOR_CUTSCENE = 0

repeat
wait 0

if
not actor.Dead(PLAYER_ACTOR)
jf @USHER2_FAILED_PLAYER_DIED
if and
$CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
not BASE_TEAMMATE_AGRED == 1
jf @USHER2_FAILED_AGRO
if
803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
jf @USHER2_FAILED_LDEAD
if 
not actor.Dead(USHER2_TERRY) 
jf @USHER2_FAILED_TERRY_DEAD
if
$SAVE_CAR_CREATED[LATEST_CAR_SLOT_USED] == 1
jf @USHER2_FAILED_CAR_WRECKED

until 0103:   actor PLAYER_ACTOR in_sphere 2154.413574 -2287.260254 15.020799 radius 4.0 4.0 2.0 sphere 1 stopped_in_car

player.CanMove(PLAYER_CHAR,false)
fade 0 500
$HUD_REMOVE = 0
wait 500

0@ = actor.CurrentCar(PLAYER_ACTOR)
0EB4: set_car_coordinates_simple 0@ position 2154.413574 -2287.260254 15.020799
car.Angle(0@) = 44.953754 
0362: remove_actor PLAYER_ACTOR from_car_and_place_at 2155.2825 -2285.7529 14.7734
actor.Angle(PLAYER_ACTOR) = 315.3055
camera.Restore_WithJumpCut()
wait 500

player.CanMove(PLAYER_CHAR,true)
fade 1 500
$HUD_REMOVE = 0
wait 500    

repeat
wait 0

if
not actor.Dead(PLAYER_ACTOR)
jf @USHER2_FAILED_PLAYER_DIED
if and
$CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
not BASE_TEAMMATE_AGRED == 1
jf @USHER2_FAILED_AGRO
if
803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
jf @USHER2_FAILED_LDEAD
if 
not actor.Dead(USHER2_TERRY) 
jf @USHER2_FAILED_TERRY_DEAD
if
$SAVE_CAR_CREATED[LATEST_CAR_SLOT_USED] == 1
jf @USHER2_FAILED_CAR_WRECKED

until CURRENT_USHER_TUTORIAL_NUM == 0 

:USHER2_JUMP_STRAIGHT_TO_TERRY_PART

v$OBJECTIVE = "STRB50"
0337: set_actor USHER2_TERRY visibility 1
0619: enable_actor USHER2_TERRY collision_detection 1
BOLVANS_DONT_DO_ACTIVITES = 1
0687: clear_actor $ARMY69_2[23] task

while not model.Available(#SNIPER)
wait 0
model.Load(#SNIPER)
mload
end

actor.GiveWeaponAndAmmo($ARMY69_2[23],34,1) 

while not animation.Available("CAR_CHECKS")
wait 0 
animation.Load("CAR_CHECKS")
end 

0605: actor $ARMY69_2[23] perform_animation "car_check" IFP "CAR_CHECKS" framedelta 4.0 loop 1 lockX 0 lockY 0 lockF 0 time -1

repeat
wait 0

if
not actor.Dead(PLAYER_ACTOR)
jf @USHER2_FAILED_PLAYER_DIED
if and
$CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
not BASE_TEAMMATE_AGRED == 1
jf @USHER2_FAILED_AGRO
if
803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
jf @USHER2_FAILED_LDEAD
if 
not actor.Dead(USHER2_TERRY) 
jf @USHER2_FAILED_TERRY_DEAD
if
$SAVE_CAR_CREATED[LATEST_CAR_SLOT_USED] == 1
jf @USHER2_FAILED_CAR_WRECKED

until 0364:   actor PLAYER_ACTOR spotted_actor USHER2_TERRY

v$ST_DIALOG[0] = "STRY153"
$DIALOG_COUNT = 0
$DIALOG_NOT_SKIP = 1
create_thread @DG_SYS2 

v$OBJECTIVE = "STRB51"

repeat
wait 0

if
SHOW_HINTS_FLAG == 1
then
if
0A4B:   controls_set_to_joystick
    then
    text.ShowH('HINT35B',10,1)
    else
    text.ShowH('HINT35',10,1)
    end
end
    
if
0A4B:   controls_set_to_joystick
    then
    if and
    0457:   player 0 aiming_at_actor USHER2_TERRY
    00E1:   player 0 pressed_key 4
        then
        break
        end
    else
    if and
    0457:   player 0 aiming_at_actor USHER2_TERRY
    0AB0:   key_pressed 20
        then
        break
        end
    end    

until false 

v$OBJECTIVE = "DUMMY"
player.CanMove(PLAYER_CHAR,false)

if
$FP_ACTIVATED == 1
then

FP_TURNED_OFF_FOR_CUTSCENE = 1

repeat
wait 0
until $FP_ACTIVATED == 0

end

04C4: store_coords_to $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 from_actor PLAYER_ACTOR with_offset 0.5 -1.3 1.0
015F: set_camera_position $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 rotation 0.0 0.0 0.0
camera.OnPed($ARMY69_2[23],15,2)

v$ST_DIALOG[0] = "STRY154"
$DIALOG_COUNT = 0
create_thread @DG_SYS2 

repeat
wait 0

if
not actor.Dead(PLAYER_ACTOR)
jf @USHER2_FAILED_PLAYER_DIED
if and
$CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
not BASE_TEAMMATE_AGRED == 1
jf @USHER2_FAILED_AGRO
if
803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
jf @USHER2_FAILED_LDEAD
if 
not actor.Dead(USHER2_TERRY) 
jf @USHER2_FAILED_TERRY_DEAD
if
$SAVE_CAR_CREATED[LATEST_CAR_SLOT_USED] == 1
jf @USHER2_FAILED_CAR_WRECKED

if and
0E3E: is_button_just_pressed 0 button 17
$CHEATS_ON == 1
then
$END_DIALOG_INST = 1
wait 0 
break
end

until $DIALOG_END == 1

0A1D: AS_actor USHER2_TERRY rotate_to_and_look_at_actor PLAYER_ACTOR    
camera.OnPed(USHER2_TERRY,15,1)
wait 750

v$ST_DIALOG[0] = "STRY155"
$DIALOG_COUNT = 0
create_thread @DG_SYS2 

repeat
wait 0

if
not actor.Dead(PLAYER_ACTOR)
jf @USHER2_FAILED_PLAYER_DIED
if and
$CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
not BASE_TEAMMATE_AGRED == 1
jf @USHER2_FAILED_AGRO
if
803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
jf @USHER2_FAILED_LDEAD
if 
not actor.Dead(USHER2_TERRY) 
jf @USHER2_FAILED_TERRY_DEAD
if
$SAVE_CAR_CREATED[LATEST_CAR_SLOT_USED] == 1
jf @USHER2_FAILED_CAR_WRECKED

if and
0E3E: is_button_just_pressed 0 button 17
$CHEATS_ON == 1
then
$END_DIALOG_INST = 1
wait 0 
break
end

until $DIALOG_END == 1

0A1D: AS_actor USHER2_TERRY rotate_to_and_look_at_actor $ARMY69_2[23]
camera.OnPed($ARMY69_2[23],15,1)
wait 750

v$ST_DIALOG[0] = "STRY156"
$DIALOG_COUNT = 0
create_thread @DG_SYS2 

repeat
wait 0

if
not actor.Dead(PLAYER_ACTOR)
jf @USHER2_FAILED_PLAYER_DIED
if and
$CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
not BASE_TEAMMATE_AGRED == 1
jf @USHER2_FAILED_AGRO
if
803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
jf @USHER2_FAILED_LDEAD
if 
not actor.Dead(USHER2_TERRY) 
jf @USHER2_FAILED_TERRY_DEAD
if
$SAVE_CAR_CREATED[LATEST_CAR_SLOT_USED] == 1
jf @USHER2_FAILED_CAR_WRECKED

if and
0E3E: is_button_just_pressed 0 button 17
$CHEATS_ON == 1
then
$END_DIALOG_INST = 1
wait 0 
break
end

until $DIALOG_END == 1

camera.OnPed(USHER2_TERRY,15,1)

:USHER2_TERRY_PART_222

0631: put_actor USHER2_TERRY in_group PLAYER_GROUP

if
USHER2_MISS_CHECKPOINT_NUM >= 1
then
jump to @USHER2_TERRY_PART_666
end

v$ST_DIALOG[0] = "STRY157"
$DIALOG_COUNT = 0
create_thread @DG_SYS2 

repeat
wait 0

if
not actor.Dead(PLAYER_ACTOR)
jf @USHER2_FAILED_PLAYER_DIED
if and
$CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
not BASE_TEAMMATE_AGRED == 1
jf @USHER2_FAILED_AGRO
if
803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
jf @USHER2_FAILED_LDEAD
if 
not actor.Dead(USHER2_TERRY) 
jf @USHER2_FAILED_TERRY_DEAD
if
$SAVE_CAR_CREATED[LATEST_CAR_SLOT_USED] == 1
jf @USHER2_FAILED_CAR_WRECKED

if and
0E3E: is_button_just_pressed 0 button 17
$CHEATS_ON == 1
then
$END_DIALOG_INST = 1
wait 0 
break
end

until $DIALOG_END == 1

0605: actor USHER2_TERRY perform_animation "habargive" IFP "CAMERA" framedelta 4.0 loop 0 lockX 0 lockY 0 lockF 0 time -1
05BF: AS_actor USHER2_TERRY look_at_actor PLAYER_ACTOR 1170 ms
Audiostream.Volume($PICKUP_ITEM_SOUND) = $SOUNDS_VOLUME 
Audiostream.Loop($PICKUP_ITEM_SOUND, 0)
Audiostream.PerformAction($PICKUP_ITEM_SOUND, PLAY)
wait 1170

fade 0 250
$HUD_REMOVE = 1
wait 250

////////////////////////////////////////////////////////

0A0E: disable_text_with_style 1

0391: release_textures
0390: load_txd_dictionary 'usher1' 
wait 1
038F: load_texture "terryradio" as 1 // Load dictionary with 0390 first
wait 1

32@ = 0
0@ = 0

 repeat 
wait 0
0@ += 5

if
0@ > 255
then
0@ = 255
end

03F0: enable_text_draw 1
038D: draw_texture 1 position 320.0 224.5 size 640.0 449.0 RGBA 255 255 255 255
03E3: set_texture_to_be_drawn_antialiased 1 
 until 0E3E: is_button_just_pressed 0 17
 
wait 1
03F0: enable_text_draw 0
wait 1
0391: release_textures 

0A0E: disable_text_with_style 0

//////////////////////////////////////////////////////// 

$READING_NOTE_FLAG = 0

cinema.Widescreen(0)
0A48: enable_menu_access_in_widescreen_mode 1   

/////////////////////////////////////////////////////////////////////////////////////

fade 1 250
$HUD_REMOVE = 0
wait 250

v$ST_DIALOG[0] = "STRY158"
v$ST_DIALOG[1] = "STRY159"
$DIALOG_COUNT = 1
create_thread @DG_SYS2

repeat
wait 0

if
not actor.Dead(PLAYER_ACTOR)
jf @USHER2_FAILED_PLAYER_DIED
if and
$CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
not BASE_TEAMMATE_AGRED == 1
jf @USHER2_FAILED_AGRO
if
803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
jf @USHER2_FAILED_LDEAD
if 
not actor.Dead(USHER2_TERRY) 
jf @USHER2_FAILED_TERRY_DEAD
if
$SAVE_CAR_CREATED[LATEST_CAR_SLOT_USED] == 1
jf @USHER2_FAILED_CAR_WRECKED

if and
0E3E: is_button_just_pressed 0 button 17
$CHEATS_ON == 1
then
$END_DIALOG_INST = 1
wait 0 
break
end

until $DIALOG_END == 1

if
$FP_ACTIVATED == 1
then
camera.Restore_WithJumpCut()
else
camera.Restore()
end

player.CanMove(PLAYER_CHAR,true)
FP_TURNED_OFF_FOR_CUTSCENE = 0
v$OBJECTIVE = "STRB52"
MISSION_MARKER = marker.CreateAboveCar($USED_CAR[LATEST_CAR_SLOT_USED])
07E0: set_marker MISSION_MARKER type_to 1

repeat
wait 0

if
not actor.Dead(PLAYER_ACTOR)
jf @USHER2_FAILED_PLAYER_DIED
if and
$CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
not BASE_TEAMMATE_AGRED == 1
jf @USHER2_FAILED_AGRO
if
803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
jf @USHER2_FAILED_LDEAD
if 
not actor.Dead(USHER2_TERRY) 
jf @USHER2_FAILED_TERRY_DEAD
if
$SAVE_CAR_CREATED[LATEST_CAR_SLOT_USED] == 1
jf @USHER2_FAILED_CAR_WRECKED

if and
0E3E: is_button_just_pressed 0 button 17
$CHEATS_ON == 1
then
:USHER2_TERRY_PART_666
$END_DIALOG_INST = 1
wait 0
036A: put_actor PLAYER_ACTOR in_car $USED_CAR[LATEST_CAR_SLOT_USED]
0430: put_actor USHER2_TERRY into_car $USED_CAR[LATEST_CAR_SLOT_USED] passenger_seat 0
camera.Restore_WithJumpCut() 
break
end

if and
actor.InCar(PLAYER_ACTOR,$USED_CAR[LATEST_CAR_SLOT_USED])
actor.InCar(USHER2_TERRY,$USED_CAR[LATEST_CAR_SLOT_USED])
    then
    break
    end

until false

if
USHER2_MISS_CHECKPOINT_NUM < 1
then
0AF1: write_int 1 to_ini_file "saves\ZACM.set" section "SCR" key "USHER_MISS2_CHECKPOINT"
end

v$OBJECTIVE = "DUMMY"
marker.Disable(MISSION_MARKER)

if
USHER2_MISS_CHECKPOINT_NUM < 1
then

/////////////////////Плавное затухание/////////////////////

$MUSIC_FADE_NUMBER += 1
if
$MUSIC_FADE_NUMBER > 4
    then
    $MUSIC_FADE_NUMBER = 0 
    end    

0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_MISSION // (int)
$MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = 0.0

$MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 250
$MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 0  
$MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
create_thread @MUS_FAD

wait 1

while $MUSIC_FADE_ENDED[$MUSIC_FADE_NUMBER] == 0
wait 0
end

end

//////////////////////////////////////////////////////////

if
USHER2_MISS_CHECKPOINT_NUM < 3
then

$MUSIC_MISSION = Audiostream.Load("audio\sounds\music\usher_music\MISS2\theme1b.wav")
Audiostream.PerformAction($MUSIC_MISSION, PLAY)
Audiostream.Loop($MUSIC_MISSION, 1)
Audiostream.Volume($MUSIC_MISSION) = 0.0

/////////////////////Плавное нарастание/////////////////////

$MUSIC_FADE_NUMBER += 1
if
$MUSIC_FADE_NUMBER > 4
    then
    $MUSIC_FADE_NUMBER = 0 
    end    

0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_MISSION // (int) 
0086: $MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = $MUSIC_VOLUME // (float) 

$MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 1000
$MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 1  
$MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
create_thread @MUS_FAD

wait 1 

end

//////////////////////////////////////////////////////// 

v$OBJECTIVE = "STRB53"
018A: MISSION_CHECKPOINT = create_checkpoint_at 315.778076 -567.562195 40.466682

if
USHER2_MISS_CHECKPOINT_NUM >= 1
then

////////////////////////////////////////////////

repeat

if
UNITED_MAP == 1
then
12@ = OFFROAD_WHEEL_ID_UNITED
else
12@ = OFFROAD_WHEEL_ID_SA
end

06E9: load_car_component 12@
mload
wait 1

until 06EA:   car_component 12@ available
    
06E7: 0@ = add_car_component 12@ to_car $USED_CAR[LATEST_CAR_SLOT_USED]
06EB: release_car_component 12@

////////////////////////////////////////////////

end

if
not USHER2_MISS_CHECKPOINT_NUM >= 2
then
v$ST_DIALOG[0] = "STRY160"
v$ST_DIALOG[1] = "STRY161"
v$ST_DIALOG[2] = "STRY162"
v$ST_DIALOG[3] = "STR162"
v$ST_DIALOG[4] = "STR163"
v$ST_DIALOG[5] = "STY163"
$DIALOG_COUNT = 5
$DIALOG_NOT_SKIP = 1
create_thread @DG_SYS2
0@ = 0
else
0@ = 1
jump to @USHER2_SKIP_TO_MOST
end

if
USHER2_MISS_CHECKPOINT_NUM == 1
then    
fade 1 1000
$HUD_REMOVE = 0
end

repeat
wait 0

///////////////////////////////////////////////////

if and
056E:   car $USED_CAR[LATEST_CAR_SLOT_USED] defined
not USHER2_VICTORIA_GOT_BACK_FLAG == 1
then

if
not car.Wrecked($USED_CAR[LATEST_CAR_SLOT_USED])
jf @USHER2_FAILED_CAR_WRECKED

if
not actor.InCar(PLAYER_ACTOR,$USED_CAR[LATEST_CAR_SLOT_USED])
    then
    marker.Disable(MISSION_CHECKPOINT)         
    gosub @USHER2_GET_BACK_IN_CAR
    v$OBJECTIVE = "STRB53"
    018A: MISSION_CHECKPOINT = create_checkpoint_at 315.778076 -567.562195 40.466682       
    end
else
jump to @USHER2_FAILED_CAR_WRECKED
end

///////////////////////////////////////////////////

if
not actor.Dead(PLAYER_ACTOR)
jf @USHER2_FAILED_PLAYER_DIED
if and
$CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
not BASE_TEAMMATE_AGRED == 1
jf @USHER2_FAILED_AGRO
if
803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
jf @USHER2_FAILED_LDEAD
if 
not actor.Dead(USHER2_TERRY) 
jf @USHER2_FAILED_TERRY_DEAD
if
$SAVE_CAR_CREATED[LATEST_CAR_SLOT_USED] == 1
jf @USHER2_FAILED_CAR_WRECKED

if and
0E3E: is_button_just_pressed 0 button 17
$CHEATS_ON == 1
then
:USHER2_SKIP_TO_MOST
actor.PutAtNoOffset(PLAYER_ACTOR,315.778076, -567.562195, 40.466682)
car.Angle($USED_CAR[LATEST_CAR_SLOT_USED]) = 82.716
camera.Restore_WithJumpCut()
create_thread @3D_REFR
$END_DIALOG_INST = 1
wait 0
break
end

if and
//0154:   actor PLAYER_ACTOR in_zone 'RED'  // Easter Basin
0EEA: locate_char_distance_to_coordinates PLAYER_ACTOR pos 315.778076 -567.562195 40.466682 radius 800.0
0@ == 0
    then
    $END_DIALOG_INST = 1
    wait 0
    0@ = 1
    v$ST_DIALOG[0] = "STRY163"
    v$ST_DIALOG[1] = "STRY164"
    v$ST_DIALOG[2] = "STRY165"
    v$ST_DIALOG[3] = "STRY166"
    v$ST_DIALOG[4] = "STRY167"
    v$ST_DIALOG[5] = "STRY168"
    v$ST_DIALOG[6] = "STRY169"
    v$ST_DIALOG[7] = "STRY170"
    $DIALOG_COUNT = 7
    $DIALOG_NOT_SKIP = 1
    create_thread @DG_SYS2
    end

until 0103:   actor PLAYER_ACTOR in_sphere 315.778076 -567.562195 40.466682 radius 2.0 2.0 2.0 sphere 1 stopped_in_car

0AF0: 0@ = get_int_from_ini_file "saves\ZACM.set" section "SCR" key "USHER_MISS2_CHECKPOINT"
if
0@ < 2
then
0AF1: write_int 2 to_ini_file "saves\ZACM.set" section "SCR" key "USHER_MISS2_CHECKPOINT"
end

$END_DIALOG_INST = 1
wait 0
v$OBJECTIVE = "DUMMY"
marker.Disable(MISSION_CHECKPOINT)

if
USHER2_MISS_CHECKPOINT_NUM == 2
then
fade 1 1000
$HUD_REMOVE = 0
$DIALOG_END = 1
else
if
USHER2_MISS_CHECKPOINT_NUM == 3
    then
    $DIALOG_END = 1
    end
end

player.CanMove(PLAYER_CHAR,false)
0221: set_player PLAYER_CHAR apply_brakes_to_car 1

repeat
wait 0
car.SetDriverBehaviour($USED_CAR[LATEST_CAR_SLOT_USED],0)

if
not actor.Dead(PLAYER_ACTOR)
jf @USHER2_FAILED_PLAYER_DIED
if and
$CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
not BASE_TEAMMATE_AGRED == 1
jf @USHER2_FAILED_AGRO
if
803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
jf @USHER2_FAILED_LDEAD
if 
not actor.Dead(USHER2_TERRY) 
jf @USHER2_FAILED_TERRY_DEAD 
if
$SAVE_CAR_CREATED[LATEST_CAR_SLOT_USED] == 1
jf @USHER2_FAILED_CAR_WRECKED

until 01C1:   car $USED_CAR[LATEST_CAR_SLOT_USED] stopped

$DIALOG_NOT_SKIP = 0

repeat
wait 0

car.SetDriverBehaviour($USED_CAR[LATEST_CAR_SLOT_USED],0)

if
not actor.Dead(PLAYER_ACTOR)
jf @USHER2_FAILED_PLAYER_DIED
if and
$CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
not BASE_TEAMMATE_AGRED == 1
jf @USHER2_FAILED_AGRO
if
803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
jf @USHER2_FAILED_LDEAD
if 
not actor.Dead(USHER2_TERRY) 
jf @USHER2_FAILED_TERRY_DEAD 
if
$SAVE_CAR_CREATED[LATEST_CAR_SLOT_USED] == 1
jf @USHER2_FAILED_CAR_WRECKED

until $DIALOG_END == 1

if
USHER2_MISS_CHECKPOINT_NUM == 3
then
0362: remove_actor PLAYER_ACTOR from_car_and_place_at 309.6097 -574.0934 40.0182
actor.Angle(PLAYER_ACTOR) = 277.5135 
0362: remove_actor USHER2_TERRY from_car_and_place_at 305.613 -573.0694 40.9618
CURRENT_USHER_TUTORIAL_NUM = -212121
create_thread @HAB_DRP
$BANKA += 2
$HEAL += 2
$BINT += 2
$RADIO += 1
0AD3: 4@s = format "CR%d" LATEST_CAR_SLOT_USED
0AF1: write_int 0 to_ini_file "data\survival.set" section 4@s key "WEP_SLOT1_ID"
0AF1: write_int 0 to_ini_file "data\survival.set" section 4@s key "WEP_SLOT1_AMMO"
0AF1: write_int 0 to_ini_file "data\survival.set" section 4@s key "WEP_SLOT2_ID"
0AF1: write_int 0 to_ini_file "data\survival.set" section 4@s key "WEP_SLOT2_AMMO"

0781: get_weapon_with_ID 18 model_to 0@

while not model.Available(0@)
wait 0
model.Load(0@)
mload
end

actor.GiveWeaponAndAmmo(PLAYER_ACTOR,18,2)

0781: get_weapon_with_ID 88 model_to 0@

while not model.Available(0@)
wait 0
model.Load(0@)
mload
end

actor.GiveWeaponAndAmmo(PLAYER_ACTOR,88,120)   

end

0221: set_player PLAYER_CHAR apply_brakes_to_car 0
068B: set_car $USED_CAR[LATEST_CAR_SLOT_USED] all_disembark

repeat
wait 0

if
not actor.Dead(PLAYER_ACTOR)
jf @USHER2_FAILED_PLAYER_DIED
if and
$CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
not BASE_TEAMMATE_AGRED == 1
jf @USHER2_FAILED_AGRO
if
803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
jf @USHER2_FAILED_LDEAD
if 
not actor.Dead(USHER2_TERRY) 
jf @USHER2_FAILED_TERRY_DEAD 
if
$SAVE_CAR_CREATED[LATEST_CAR_SLOT_USED] == 1
jf @USHER2_FAILED_CAR_WRECKED

until not actor.InCar(PLAYER_ACTOR,$USED_CAR[LATEST_CAR_SLOT_USED])

car.DoorStatus($USED_CAR[LATEST_CAR_SLOT_USED],2)
02D4: car $USED_CAR[LATEST_CAR_SLOT_USED] turn_off_engine
car.LockInCurrentPosition($USED_CAR[LATEST_CAR_SLOT_USED],true)
player.CanMove(PLAYER_CHAR,true)
$AIRDROP_FLAG = 2      

if
not USHER2_MISS_CHECKPOINT_NUM >= 2
then
v$ST_DIALOG[0] = "STRY171"
v$ST_DIALOG[1] = "STRY172"
v$ST_DIALOG[2] = "STRY173"
$DIALOG_COUNT = 2
$DIALOG_NOT_SKIP = 1
create_thread @DG_SYS2
else
$DIALOG_END = 1 
end

repeat
wait 0

if
not actor.Dead(PLAYER_ACTOR)
jf @USHER2_FAILED_PLAYER_DIED
if and
$CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
not BASE_TEAMMATE_AGRED == 1
jf @USHER2_FAILED_AGRO
if
803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
jf @USHER2_FAILED_LDEAD
if 
not actor.Dead(USHER2_TERRY) 
jf @USHER2_FAILED_TERRY_DEAD 
if
$SAVE_CAR_CREATED[LATEST_CAR_SLOT_USED] == 1
jf @USHER2_FAILED_CAR_WRECKED
if
00FE:   actor PLAYER_ACTOR sphere 0 in_sphere 315.778076 -567.562195 40.466682 radius 120.0 120.0 15.0 
jf @USHER2_FAILED_WALK2

if and
0E3E: is_button_just_pressed 0 button 17
$CHEATS_ON == 1
then
$END_DIALOG_INST = 1
wait 0 
break
end

until $DIALOG_END == 1

if
USHER2_MISS_CHECKPOINT_NUM == 3
    then
    jump to @USHER2_MISS_CHECKPOINT_NUM_SKIP_FOR_DEBILS1 
    end

v$OBJECTIVE = "STRB54"
player.CanMove(PLAYER_CHAR,true)

repeat
wait 0

if
not actor.Dead(PLAYER_ACTOR)
jf @USHER2_FAILED_PLAYER_DIED
if and
$CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
not BASE_TEAMMATE_AGRED == 1
jf @USHER2_FAILED_AGRO
if
803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
jf @USHER2_FAILED_LDEAD
if 
not actor.Dead(USHER2_TERRY) 
jf @USHER2_FAILED_TERRY_DEAD 
if
$SAVE_CAR_CREATED[LATEST_CAR_SLOT_USED] == 1
jf @USHER2_FAILED_CAR_WRECKED
if
00FE:   actor PLAYER_ACTOR sphere 0 in_sphere 315.778076 -567.562195 40.466682 radius 120.0 120.0 15.0 
jf @USHER2_FAILED_WALK2

if and
8A2A: not  text_box 'GAME331' displayed
8A2A: not  text_box 'INV354' displayed 
8A2A: not  text_box 'INV341' displayed
8A2A: not  text_box 'INV341B' displayed
SHOW_HINTS_FLAG == 1  
then
if
0A4B:   controls_set_to_joystick
    then
    text.ShowH('HINT36B',10,1)
    else
    text.ShowH('HINT36',10,1)
    end 
end   

if and
$RADIO >= 1
0491:   actor PLAYER_ACTOR has_weapon 88
0491:   actor PLAYER_ACTOR has_weapon 18
    then
    break
    end    

until false 

v$OBJECTIVE = "STRB55"
CURRENT_USHER_TUTORIAL_NUM = 7
$AIRDROP_FLAG = 0

if
0D49: 0@ = compare_strings v$COMMAND "GAME107" // IF and SET
then
UNPRESS_STAY_IN_CAR = -123
end

repeat
wait 0

if
not actor.Dead(PLAYER_ACTOR)
jf @USHER2_FAILED_PLAYER_DIED
if and
$CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
not BASE_TEAMMATE_AGRED == 1
jf @USHER2_FAILED_AGRO
if
803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
jf @USHER2_FAILED_LDEAD
if 
not actor.Dead(USHER2_TERRY) 
jf @USHER2_FAILED_TERRY_DEAD 
if
$SAVE_CAR_CREATED[LATEST_CAR_SLOT_USED] == 1
jf @USHER2_FAILED_CAR_WRECKED
if
00FE:   actor PLAYER_ACTOR sphere 0 in_sphere 315.778076 -567.562195 40.466682 radius 120.0 120.0 15.0 
jf @USHER2_FAILED_WALK2

if and
not CURRENT_USHER_TUTORIAL_NUM == 8 
8A2A: not  text_box 'GAME331' displayed
8A2A: not  text_box 'INV354' displayed 
8A2A: not  text_box 'INV341' displayed
8A2A: not  text_box 'INV341B' displayed  
8A2A: not  text_box 'INV229' displayed
8A2A: not  text_box 'INV234' displayed
SHOW_HINTS_FLAG == 1 
then
if
0A4B:   controls_set_to_joystick
    then
    text.ShowH('HINT37',10,1)
    else
    text.ShowH('HINT37',10,1)
    end 
end      

until CURRENT_USHER_TUTORIAL_NUM == 9

if
8D49: not 0@ = compare_strings v$COMMAND "GAME106" // IF and SET
then

v$OBJECTIVE = "STRB67"

repeat
wait 0     
015D: set_gamespeed 0.0

if
not actor.Dead(PLAYER_ACTOR)
jf @USHER2_FAILED_PLAYER_DIED
if and
$CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
not BASE_TEAMMATE_AGRED == 1
jf @USHER2_FAILED_AGRO
if
803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
jf @USHER2_FAILED_LDEAD
if 
not actor.Dead(USHER2_TERRY) 
jf @USHER2_FAILED_TERRY_DEAD 
if
$SAVE_CAR_CREATED[LATEST_CAR_SLOT_USED] == 1
jf @USHER2_FAILED_CAR_WRECKED
if
00FE:   actor PLAYER_ACTOR sphere 0 in_sphere 315.778076 -567.562195 40.466682 radius 120.0 120.0 15.0 
jf @USHER2_FAILED_WALK2

if
SHOW_HINTS_FLAG == 1
then
if
0A4B:   controls_set_to_joystick
    then
    text.ShowH('HINT41B',10,1)
    
    if
    0AB0:   key_pressed $KEY_COMMAND_STAY_FOLLOW
    then
    015D: set_gamespeed 1.0
    break
    end
    
    else
    text.ShowH('HINT41',10,1)
    
    if
    0AB0:   key_pressed $KEY_COMMAND_STAY_FOLLOW
        then
        015D: set_gamespeed 1.0
        break
        end
    
    end
else
015D: set_gamespeed 1.0
break
end

until false

end

:USHER2_MISS_CHECKPOINT_NUM_SKIP_FOR_DEBILS1
             
$SPECIAL_INFECTED_NOT_SPAWN_FLAG = 0
$TANK_NOTSPAWN_FLAG = 1
$WITCH_NOTSPAWN_FLAG = 1
SPEC_INF_ONLY_ONE_INSTANSE_SPAWN_FLAG = 1  

if
USHER2_MISS_CHECKPOINT_NUM == 3
    then
    CURRENT_USHER_TUTORIAL_NUM = -212121
    jump to @USHER2_MISS_CHECKPOINT_NUM_SKIP_FOR_DEBILS1BA 
    end

v$OBJECTIVE = "STRB56"

wait 500

v$ST_DIALOG[0] = "STRY174"
v$ST_DIALOG[1] = "STRY175"
$DIALOG_COUNT = 1
$DIALOG_NOT_SKIP = 1
create_thread @DG_SYS2

/////////////////////Плавное затухание/////////////////////

$MUSIC_FADE_NUMBER += 1
if
$MUSIC_FADE_NUMBER > 4
    then
    $MUSIC_FADE_NUMBER = 0 
    end    
        
0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_MISSION // (int)
$MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = 0.0
        
$MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 250
$MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 0  
$MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
create_thread @MUS_FAD

wait 1

while $MUSIC_FADE_ENDED[$MUSIC_FADE_NUMBER] == 0
wait 0
end

:USHER2_MISS_CHECKPOINT_NUM_SKIP_FOR_DEBILS1BA

//////////////////////////////////////////////////////////

$MUSIC_MISSION = Audiostream.Load("audio\sounds\music\usher_music\MISS2\theme2.wav")
Audiostream.PerformAction($MUSIC_MISSION, PLAY)
Audiostream.Loop($MUSIC_MISSION, 1)
Audiostream.Volume($MUSIC_MISSION) = 0.0

/////////////////////Плавное нарастание/////////////////////

$MUSIC_FADE_NUMBER += 1
if
$MUSIC_FADE_NUMBER > 4
    then
    $MUSIC_FADE_NUMBER = 0 
    end    

0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_MISSION // (int) 
0086: $MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = $MUSIC_VOLUME // (float) 

$MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 1000
$MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 1  
$MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
create_thread @MUS_FAD

wait 1 

if
USHER2_MISS_CHECKPOINT_NUM == 3
    then
    jump to @USHER2_MISS_CHECKPOINT_NUM_SKIP_FOR_DEBILS1B 
    end

////////////////////////////////////////////////////////

:USHER2_MISS_CHECKPOINT_NUM_SKIP_FOR_DEBILS1B

$SALVATION_FLAG = 1

$SPAWN_CHARGER_ON_COORD = 1    
$CHARGER_X = 392.6634
$CHARGER_Y = -566.5704
$CHARGER_Z = 41.6066

$SPAWN_HUNTER_ON_COORD = 1    
$HUNTER_X = 204.59
$HUNTER_Y = -549.5907
$HUNTER_Z = 51.3587

32@ = 0
33@ = 0

if
USHER2_MISS_CHECKPOINT_NUM == 3
then
PLAYER_NO_ITEMS_FLAG = 1
wait 100
PLAYER_NO_ITEMS_FLAG = 0
wait 0
create_thread @PED_BKP PLAYER_ACTOR 371
fade 1 1000
$HUD_REMOVE = 0
player.CanMove(PLAYER_CHAR,true)
camera.Restore_WithJumpCut()
wait 1000
end

repeat
wait 0
gosub @USHER2_SPECINF_PHRASES

if
32@ >= 10000
then
if
0E4D: random_percent 15
    then
    $SPAWN_HUNTER_FLAG = 1
    32@ = 0
    else
    32@ = 0
    end
end

if
33@ >= 15000
then
if
0E4D: random_percent 15
    then
    $SPAWN_CHARGER_FLAG = 1
    33@ = 0
    else
    33@ = 0
    end
end 

if
not $AIRDROP_QUEST == -2
jf @USHER2_FAILED_GURZ_SPIZDILI_OR_OTHER

if
not actor.Dead(PLAYER_ACTOR)
jf @USHER2_FAILED_PLAYER_DIED
if and
$CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
not BASE_TEAMMATE_AGRED == 1
jf @USHER2_FAILED_AGRO
if
803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
jf @USHER2_FAILED_LDEAD
if 
not actor.Dead(USHER2_TERRY) 
jf @USHER2_FAILED_TERRY_DEAD 
if
$SAVE_CAR_CREATED[LATEST_CAR_SLOT_USED] == 1
jf @USHER2_FAILED_CAR_WRECKED
if
80A4: not  actor PLAYER_ACTOR sphere 0 in_cube_cornerA 344.3076 -551.4876 0.9204 cornerB 269.9119 -592.1495 24.298
jf @USHER2_FAILED_WALK
if
00FE:   actor PLAYER_ACTOR sphere 0 in_sphere 315.778076 -567.562195 40.466682 radius 120.0 120.0 15.0 
jf @USHER2_FAILED_WALK2  

until CURRENT_USHER_TUTORIAL_NUM == 10

if
USHER2_MISS_CHECKPOINT_NUM < 3
then
0AF1: write_int 3 to_ini_file "saves\ZACM.set" section "SCR" key "USHER_MISS2_CHECKPOINT"
end

if and
8D49: not 0@ = compare_strings v$COMMAND "GAME105" // IF and SET
SHOW_HINTS_FLAG == 1
then

v$OBJECTIVE = "STRB68"

repeat
wait 0     
015D: set_gamespeed 0.0

if
not actor.Dead(PLAYER_ACTOR)
jf @USHER2_FAILED_PLAYER_DIED
if and
$CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
not BASE_TEAMMATE_AGRED == 1
jf @USHER2_FAILED_AGRO
if
803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
jf @USHER2_FAILED_LDEAD
if 
not actor.Dead(USHER2_TERRY) 
jf @USHER2_FAILED_TERRY_DEAD 
if
$SAVE_CAR_CREATED[LATEST_CAR_SLOT_USED] == 1
jf @USHER2_FAILED_CAR_WRECKED

if
SHOW_HINTS_FLAG == 1
then
if
0A4B:   controls_set_to_joystick
    then
    text.ShowH('HINT42B',10,1)
    
    if
    0AB0:   key_pressed $KEY_COMMAND_FOLLOW2
    then
    015D: set_gamespeed 1.0
    break
    end
    
    else
    text.ShowH('HINT42',10,1)
    
    if
    0AB0:   key_pressed $KEY_COMMAND_FOLLOW2
        then
        015D: set_gamespeed 1.0
        break
        end
    
    end
else 
break
end

until false 

end

ZOMBIES_NOTSPAWN = 1
$SALVATION_FLAG = 0

$SPAWN_CHARGER_ON_COORD = 0    
$SPAWN_HUNTER_ON_COORD = 0  

gosub @CAR_CREATE_USHER2_DELTA_CAR
gosub @CAR_CREATE_USHER2_DELTA_BOECI
gosub @CAR_CREATE_USHER2_DELTA_BOECI_SETTINGS

v$OBJECTIVE = "STRB57"

$END_DIALOG_INST = 1
wait 0
v$ST_DIALOG[0] = "STR178"
$DIALOG_COUNT = 0
$DIALOG_NOT_SKIP = 1
create_thread @DG_SYS2

repeat
wait 0

if or
051C:   car USHER2_DELTA_CAR damaged_by_actor PLAYER_ACTOR
051A:   actor USHER2_DELTA_BOEC1 damaged_by_actor PLAYER_ACTOR
051A:   actor USHER2_DELTA_BOEC2 damaged_by_actor PLAYER_ACTOR
051A:   actor USHER2_DELTA_BOEC3 damaged_by_actor PLAYER_ACTOR
051A:   actor USHER2_DELTA_BOEC4 damaged_by_actor PLAYER_ACTOR
then
jump to @USHER2_FAILED_AGRO_MONKE
end

if
not $AIRDROP_QUEST == -2
jf @USHER2_FAILED_GURZ_SPIZDILI_OR_OTHER

if
not actor.Dead(PLAYER_ACTOR)
jf @USHER2_FAILED_PLAYER_DIED
if and
$CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
not BASE_TEAMMATE_AGRED == 1
jf @USHER2_FAILED_AGRO
if
803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
jf @USHER2_FAILED_LDEAD
if 
not actor.Dead(USHER2_TERRY) 
jf @USHER2_FAILED_TERRY_DEAD 
if
$SAVE_CAR_CREATED[LATEST_CAR_SLOT_USED] == 1
jf @USHER2_FAILED_CAR_WRECKED

if and
0E3E: is_button_just_pressed 0 button 17
$CHEATS_ON == 1
then
$END_DIALOG_INST = 1
wait 0
break
end

until $DIALOG_END == 1

repeat
wait 0

if or
051C:   car USHER2_DELTA_CAR damaged_by_actor PLAYER_ACTOR
051A:   actor USHER2_DELTA_BOEC1 damaged_by_actor PLAYER_ACTOR
051A:   actor USHER2_DELTA_BOEC2 damaged_by_actor PLAYER_ACTOR
051A:   actor USHER2_DELTA_BOEC3 damaged_by_actor PLAYER_ACTOR
051A:   actor USHER2_DELTA_BOEC4 damaged_by_actor PLAYER_ACTOR
then
jump to @USHER2_FAILED_AGRO_MONKE
end

if
not $AIRDROP_QUEST == -2
jf @USHER2_FAILED_GURZ_SPIZDILI_OR_OTHER

if
not actor.Dead(PLAYER_ACTOR)
jf @USHER2_FAILED_PLAYER_DIED
if and
$CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
not BASE_TEAMMATE_AGRED == 1
jf @USHER2_FAILED_AGRO
if
803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
jf @USHER2_FAILED_LDEAD
if 
not actor.Dead(USHER2_TERRY) 
jf @USHER2_FAILED_TERRY_DEAD 
if
$SAVE_CAR_CREATED[LATEST_CAR_SLOT_USED] == 1
jf @USHER2_FAILED_CAR_WRECKED

if and
0E3E: is_button_just_pressed 0 button 17
$CHEATS_ON == 1
then
actor.PutAtNoOffset(PLAYER_ACTOR,277.3649 -717.6277 4.2941)
$END_DIALOG_INST = 1
wait 0
break
end

gosub @USHER2_SPECINF_PHRASES

if and
02CA:   car USHER2_DELTA_CAR bounding_sphere_visible
01AD:   car USHER2_DELTA_CAR sphere 0 near_point 285.145966 -709.286072 radius 175.0 175.0
    then
    break
    end 
    
if
00EC:   actor PLAYER_ACTOR sphere 0 near_point 283.990143 -708.870300 radius 55.0 55.0
    then
    break
    end    

until false

/////////////////////Плавное затухание/////////////////////

$MUSIC_FADE_NUMBER += 1
if
$MUSIC_FADE_NUMBER > 4
    then
    $MUSIC_FADE_NUMBER = 0 
    end    
        
0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_MISSION // (int)
$MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = 0.0
        
$MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 250
$MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 0  
$MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
create_thread @MUS_FAD

wait 1

while $MUSIC_FADE_ENDED[$MUSIC_FADE_NUMBER] == 0
wait 0
end

//////////////////////////////////////////////////////////

$MUSIC_MISSION = Audiostream.Load("audio\sounds\music\usher_music\MISS2\theme2b.wav")
Audiostream.PerformAction($MUSIC_MISSION, PLAY)
Audiostream.Loop($MUSIC_MISSION, 0)
Audiostream.Volume($MUSIC_MISSION) = 0.0

/////////////////////Плавное нарастание/////////////////////

$MUSIC_FADE_NUMBER += 1
if
$MUSIC_FADE_NUMBER > 4
    then
    $MUSIC_FADE_NUMBER = 0 
    end    

0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_MISSION // (int) 
0086: $MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = $MUSIC_VOLUME // (float) 

$MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 1000
$MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 1  
$MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
create_thread @MUS_FAD

wait 1 

////////////////////////////////////////////////////////  

$END_DIALOG_INST = 1
wait 0
v$ST_DIALOG[0] = "STRY178"
v$ST_DIALOG[1] = "STRY179"
$DIALOG_COUNT = 1
$DIALOG_NOT_SKIP = 1
create_thread @DG_SYS2 

repeat
wait 0
02E3: 0@ = car USHER2_DELTA_CAR speed

if or
051C:   car USHER2_DELTA_CAR damaged_by_actor PLAYER_ACTOR
051A:   actor USHER2_DELTA_BOEC1 damaged_by_actor PLAYER_ACTOR
051A:   actor USHER2_DELTA_BOEC2 damaged_by_actor PLAYER_ACTOR
051A:   actor USHER2_DELTA_BOEC3 damaged_by_actor PLAYER_ACTOR
051A:   actor USHER2_DELTA_BOEC4 damaged_by_actor PLAYER_ACTOR
then
jump to @USHER2_FAILED_AGRO_MONKE
end

if
not $AIRDROP_QUEST == -2
jf @USHER2_FAILED_GURZ_SPIZDILI_OR_OTHER

if
not actor.Dead(PLAYER_ACTOR)
jf @USHER2_FAILED_PLAYER_DIED
if and
$CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
not BASE_TEAMMATE_AGRED == 1
jf @USHER2_FAILED_AGRO
if
803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
jf @USHER2_FAILED_LDEAD
if 
not actor.Dead(USHER2_TERRY) 
jf @USHER2_FAILED_TERRY_DEAD 
if
$SAVE_CAR_CREATED[LATEST_CAR_SLOT_USED] == 1
jf @USHER2_FAILED_CAR_WRECKED

if and
0E3E: is_button_just_pressed 0 button 17
$CHEATS_ON == 1
then
actor.PutAtNoOffset(PLAYER_ACTOR,277.3649, -717.6277, 4.2941)
$END_DIALOG_INST = 1
wait 0
jump to @HUY_SOSI_ZAEBALO
end

if
00EC:   actor PLAYER_ACTOR sphere 0 near_point 283.990143 -708.870300 radius 15.0 15.0
    then
    
    :HUY_SOSI_ZAEBALO
    
    $SPECIAL_INFECTED_NOT_SPAWN_FLAG = 1
    SPEC_INF_ONLY_ONE_INSTANSE_SPAWN_FLAG = 0
    
    fade 0 250
    $HUD_REMOVE = 1
    wait 250
    $ZOMBIE_REMOVE_FLAG = 1
    $HUNTER_REMOVE_FLAG = 1
    $CHARGER_REMOVE_FLAG = 1 
    
    06FD: set_car USHER2_DELTA_CAR speed_on_path_to 10.0
    
    repeat
    wait 0
    02E3: 0@ = car USHER2_DELTA_CAR speed
    until 0@ <= 1.0
    
    0873: release_path 814
    
    repeat
    wait 0
    car.PutAt(USHER2_DELTA_CAR,295.5406, -748.4655, 5.3458)
    until 0EEB: locate_car_distance_to_coordinates USHER2_DELTA_CAR pos 295.5406 -748.4655 5.3458 radius 2.0
    
    wait 250
    068B: set_car USHER2_DELTA_CAR all_disembark
    
    repeat
    wait 0
              
    if and   
    not actor.InCar(USHER2_DELTA_BOEC1,USHER2_DELTA_CAR)
    not actor.InCar(USHER2_DELTA_BOEC2,USHER2_DELTA_CAR)
    not actor.InCar(USHER2_DELTA_BOEC3,USHER2_DELTA_CAR)
    not actor.InCar(USHER2_DELTA_BOEC4,USHER2_DELTA_CAR)
        then
        break
        end
    
    until false
        
    wait 250
    062F: USHER2_DELTA_GROUP = create_group_type 0
    0630: put_actor USHER2_DELTA_BOEC1 in_group USHER2_DELTA_GROUP as_leader
    07B3: set_group USHER2_DELTA_GROUP give_command 2
    0631: put_actor USHER2_DELTA_BOEC2 in_group USHER2_DELTA_GROUP
    0631: put_actor USHER2_DELTA_BOEC3 in_group USHER2_DELTA_GROUP
    0631: put_actor USHER2_DELTA_BOEC4 in_group USHER2_DELTA_GROUP
    
    jump to @USHER2_LONG_DICK
    
    end

until 0@ <= 1.0

05EC: release_car USHER2_DELTA_CAR from_path
0873: release_path 814
wait 250
068B: set_car USHER2_DELTA_CAR all_disembark
062F: USHER2_DELTA_GROUP = create_group_type 0
0630: put_actor USHER2_DELTA_BOEC1 in_group USHER2_DELTA_GROUP as_leader
07B3: set_group USHER2_DELTA_GROUP give_command 2
0631: put_actor USHER2_DELTA_BOEC2 in_group USHER2_DELTA_GROUP
0631: put_actor USHER2_DELTA_BOEC3 in_group USHER2_DELTA_GROUP
0631: put_actor USHER2_DELTA_BOEC4 in_group USHER2_DELTA_GROUP
05D3: AS_actor USHER2_DELTA_BOEC1 goto_point 274.6767 -714.6959 4.1627 mode 4 time 99999 ms // versionA

repeat
wait 0

if or
051C:   car USHER2_DELTA_CAR damaged_by_actor PLAYER_ACTOR
051A:   actor USHER2_DELTA_BOEC1 damaged_by_actor PLAYER_ACTOR
051A:   actor USHER2_DELTA_BOEC2 damaged_by_actor PLAYER_ACTOR
051A:   actor USHER2_DELTA_BOEC3 damaged_by_actor PLAYER_ACTOR
051A:   actor USHER2_DELTA_BOEC4 damaged_by_actor PLAYER_ACTOR
then
jump to @USHER2_FAILED_AGRO_MONKE
end

if
00EC:   actor USHER2_DELTA_BOEC1 sphere 0 near_point 274.6767 -714.6959 radius 1.0 1.0
    then             
    
    0470: 9@ = actor USHER2_DELTA_BOEC1 current_weapon
    06AB: set_actor USHER2_DELTA_BOEC1 all_weapons_hidden 1
    
    while not animation.Available("BOMBER")
    wait 0
    animation.Load("BOMBER")
    end
    
    32@ = 0
    
    03CF: load_wav 20802 as 4 
    
    while 83D0: not  wav 4 loaded 
    wait 0
    03CF: load_wav 20802 as 4 
    end
     
    0949: link_wav 4 to_actor USHER2_DELTA_BOEC1
    03D1: play_wav 4
    
    0605: actor USHER2_DELTA_BOEC1 perform_animation "BOM_PLANT" IFP "BOMBER" framedelta 4.0 loop 0 lockX 0 lockY 0 lockF 0 time -1 
    
    while 83D2:   wav 4 ended 
    wait 0
    end
    
    040D: unload_wav 4 
    04EF: release_animation "BOMBER"
    
    06AB: set_actor USHER2_DELTA_BOEC1 all_weapons_hidden 0    
    01B9: set_actor USHER2_DELTA_BOEC1 armed_weapon_to 9@
    
    jump to @USHER2_FAILED_SLOYPOK   
    end

until 00EC:   actor PLAYER_ACTOR sphere 0 near_point 283.990143 -708.870300 radius 10.0 10.0

$SPECIAL_INFECTED_NOT_SPAWN_FLAG = 1
SPEC_INF_ONLY_ONE_INSTANSE_SPAWN_FLAG = 0

fade 0 250
$HUD_REMOVE = 1
wait 250
$ZOMBIE_REMOVE_FLAG = 1
$HUNTER_REMOVE_FLAG = 1
$CHARGER_REMOVE_FLAG = 1 

:USHER2_LONG_DICK

player.CanMove(PLAYER_CHAR,false)

cinema.Widescreen(1)
BLACK_POLOSKI_ON = 1

actor.PutAtNoOffset(PLAYER_ACTOR,277.3649, -717.6277, 4.2941)
actor.Angle(PLAYER_ACTOR) = 209.8662

if
$FP_ACTIVATED == 1
then
repeat
wait 0
until $FP_ACTIVATED == 0
end

camera.SetPosition(283.877197 -729.231384 10.828806,0.0,0.0,0.0)
camera.PointAt(283.428955 -728.478210 10.347320,2)
0936: set_camera 273.889923 -710.877686 4.883239 position_to 283.877197 -729.231384 10.828806 time 60000 smooth_transition 1
0920: point_camera 274.357910 -711.746399 4.720994 transverse_to 283.428955 -728.478210 10.347320 time 60000 smooth_transition 1

actor.PutAtNoOffset(USHER2_DELTA_BOEC1,286.6232, -728.2923, 4.743)
actor.Angle(USHER2_DELTA_BOEC1) = 40.9695

06C9: remove_actor USHER2_TERRY from_group

06C9: remove_actor USHER2_DELTA_BOEC1 from_group
06C9: remove_actor USHER2_DELTA_BOEC2 from_group
06C9: remove_actor USHER2_DELTA_BOEC3 from_group
06C9: remove_actor USHER2_DELTA_BOEC4 from_group

0632: release_group USHER2_DELTA_GROUP

0635: AS_actor USHER2_TERRY aim_at_actor USHER2_DELTA_BOEC1 999999 ms
0635: AS_actor PLAYER_ACTOR aim_at_actor USHER2_DELTA_BOEC1 999999 ms

0619: enable_actor USHER2_DELTA_BOEC2 collision_detection 0
0619: enable_actor USHER2_DELTA_BOEC3 collision_detection 0
0619: enable_actor USHER2_DELTA_BOEC4 collision_detection 0
06C2: AS_actor USHER2_DELTA_BOEC1 goto 279.4438 -720.1046 4.3956 mode 6 turn_radius 1.0 stop_radius 1.0 actor PLAYER_ACTOR with_offset 0.0 0.0 0.6
wait 1000
0619: enable_actor USHER2_DELTA_BOEC2 collision_detection 1
0619: enable_actor USHER2_DELTA_BOEC3 collision_detection 1
0619: enable_actor USHER2_DELTA_BOEC4 collision_detection 1
06C2: AS_actor USHER2_DELTA_BOEC2 goto 278.4216 -721.263 4.3451 mode 6 turn_radius 1.0 stop_radius 1.0 actor PLAYER_ACTOR with_offset 0.0 0.0 0.6
wait 500
06C2: AS_actor USHER2_DELTA_BOEC3 goto 280.4966 -718.968 4.4476 mode 6 turn_radius 1.0 stop_radius 1.0 actor USHER2_TERRY with_offset 0.0 0.0 0.6
wait 500
06C2: AS_actor USHER2_DELTA_BOEC4 goto 281.8168 -721.5524 4.5118 mode 6 turn_radius 1.0 stop_radius 1.0 actor USHER2_TERRY with_offset 0.0 0.0 0.6

fade 1 2000
wait 2000

$END_DIALOG_INST = 1
wait 0
v$ST_DIALOG[0] = "STRY180"
v$ST_DIALOG[1] = "STRY181"
v$ST_DIALOG[2] = "STRY182"
v$ST_DIALOG[3] = "STRY183"
v$ST_DIALOG[4] = "STRY184"
v$ST_DIALOG[5] = "STRY185"
v$ST_DIALOG[6] = "STRY186"
v$ST_DIALOG[7] = "STRY187"
v$ST_DIALOG[8] = "STRY188"
v$ST_DIALOG[9] = "STRY189"
v$ST_DIALOG[10] = "STRY190"
v$ST_DIALOG[11] = "STRY191"
v$ST_DIALOG[12] = "STRY192"
v$ST_DIALOG[13] = "STRY193"
v$ST_DIALOG[14] = "STRY194"
v$ST_DIALOG[15] = "STRY195"
v$ST_DIALOG[16] = "STRY196"
v$ST_DIALOG[17] = "STRY197"
v$ST_DIALOG[18] = "STRY198"
$DIALOG_COUNT = 18
$DIALOG_NOT_SKIP = 0
create_thread @DG_SYS2

repeat
wait 0
until 02A0:   actor USHER2_DELTA_BOEC1 stopped

0635: AS_actor USHER2_DELTA_BOEC1 aim_at_actor PLAYER_ACTOR 999999 ms

repeat
wait 0
until $DIALOG_END == 1

0687: clear_actor USHER2_DELTA_BOEC1 task

0615: define_AS_pack_begin 0@
05D3: AS_actor -1 goto_point 276.3195 -714.6705 4.2434 mode 4 time 999999 ms // versionA
05B9: AS_actor -1 stay_idle 250 ms
0605: actor -1 perform_animation "BOM_PLANT" IFP "CAMERA" framedelta 4.0 loop 0 lockX 0 lockY 0 lockF 0 time -1
0616: define_AS_pack_end 0@
0618: assign_actor USHER2_DELTA_BOEC1 to_AS_pack 0@
061B: remove_references_to_AS_pack 0@  

0936: set_camera 273.889923 -710.877686 4.883239 position_to 282.112732 -726.235535 6.169930 time 1 smooth_transition 1
0920: point_camera 274.357910 -711.746399 4.720994 transverse_to 281.655945 -725.397034 5.872912 time 1 smooth_transition 1
camera.OnPed(USHER2_DELTA_BOEC1,15,1)
0687: clear_actor PLAYER_ACTOR task
05BF: AS_actor USHER2_TERRY look_at_actor PLAYER_ACTOR 30000 ms

repeat
wait 0     

if
0E45: frame_mod 15
then
0A1D: AS_actor PLAYER_ACTOR rotate_to_and_look_at_actor USHER2_DELTA_BOEC1
end

until actor.Animation(USHER2_DELTA_BOEC1) == "BOM_PLANT"

05BF: AS_actor PLAYER_ACTOR look_at_actor USHER2_TERRY 30000 ms 
camera.OnPed(USHER2_TERRY,15,1)

repeat
wait 0

if
0E45: frame_mod 15
then
0A1D: AS_actor PLAYER_ACTOR rotate_to_and_look_at_actor USHER2_DELTA_BOEC1
end

until not actor.Animation(USHER2_DELTA_BOEC1) == "BOM_PLANT" 

0647: AS_actor PLAYER_ACTOR clear_look_task
0647: AS_actor USHER2_TERRY clear_look_task

05BF: AS_actor USHER2_TERRY look_at_actor USHER2_DELTA_BOEC1 30000 ms
05BF: AS_actor PLAYER_ACTOR look_at_actor USHER2_DELTA_BOEC1 30000 ms
0687: clear_actor USHER2_TERRY task

camera.OnPed(USHER2_DELTA_BOEC1,15,1)

0A1D: AS_actor USHER2_DELTA_BOEC1 rotate_to_and_look_at_actor PLAYER_ACTOR
wait 750

v$ST_DIALOG[0] = "STRY199"
0084: $DIALOG_ACTOR[0] = USHER2_DELTA_BOEC1 // (int)
$DIALOG_COUNT = 0
$DIALOG_NOT_SKIP = 0
create_thread @DG_SYS 

repeat
wait 0
until $DIALOG_END == 1

0687: clear_actor USHER2_DELTA_BOEC2 task
0687: clear_actor USHER2_DELTA_BOEC3 task
0687: clear_actor USHER2_DELTA_BOEC4 task
05CB: AS_actor USHER2_DELTA_BOEC1 enter_car USHER2_DELTA_CAR as_driver 9999999 ms
05CA: AS_actor USHER2_DELTA_BOEC2 enter_car USHER2_DELTA_CAR passenger_seat 0 time 9999999
05CA: AS_actor USHER2_DELTA_BOEC3 enter_car USHER2_DELTA_CAR passenger_seat 1 time 9999999
05CA: AS_actor USHER2_DELTA_BOEC4 enter_car USHER2_DELTA_CAR passenger_seat 2 time 9999999

fade 0 500
wait 500

cinema.Widescreen(0)
BLACK_POLOSKI_ON = 0
camera.Restore_WithJumpCut()

/////////////////////Плавное затухание/////////////////////

$MUSIC_FADE_NUMBER += 1
if
$MUSIC_FADE_NUMBER > 4
    then
    $MUSIC_FADE_NUMBER = 0 
    end    

0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_MISSION // (int)
$MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = 0.0

$MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 250
$MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 0  
$MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
create_thread @MUS_FAD

wait 1

while $MUSIC_FADE_ENDED[$MUSIC_FADE_NUMBER] == 0
wait 0
end

//////////////////////////////////////////////////////////

$MUSIC_MISSION = Audiostream.Load("audio\sounds\music\usher_music\MISS2\theme3.wav")
Audiostream.PerformAction($MUSIC_MISSION, PLAY)
Audiostream.Loop($MUSIC_MISSION, 1)
Audiostream.Volume($MUSIC_MISSION) = 0.0

/////////////////////Плавное нарастание/////////////////////

$MUSIC_FADE_NUMBER += 1
if
$MUSIC_FADE_NUMBER > 4
    then
    $MUSIC_FADE_NUMBER = 0 
    end    

0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_MISSION // (int) 
0086: $MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = $MUSIC_VOLUME // (float) 

$MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 1000
$MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 1  
$MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
create_thread @MUS_FAD

wait 1 

//////////////////////////////////////////////////////// 

player.CanMove(PLAYER_CHAR,true)
0631: put_actor USHER2_TERRY in_group PLAYER_GROUP

fade 1 500
$HUD_REMOVE = 0
wait 500

CURRENT_USHER_TUTORIAL_NUM = 11

USHER2_DELTA_CAR_DROVE_FLAG = 0

repeat
wait 0

if
not actor.Dead(PLAYER_ACTOR)
jf @USHER2_FAILED_PLAYER_DIED
if and
$CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
not BASE_TEAMMATE_AGRED == 1
jf @USHER2_FAILED_AGRO
if
803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
jf @USHER2_FAILED_LDEAD
if 
not actor.Dead(USHER2_TERRY) 
jf @USHER2_FAILED_TERRY_DEAD 
if
$SAVE_CAR_CREATED[LATEST_CAR_SLOT_USED] == 1
jf @USHER2_FAILED_CAR_WRECKED

if
not $AIRDROP_QUEST == -2
jf @USHER2_FAILED_GURZ_SPIZDILI_OR_OTHER

if or
051C:   car USHER2_DELTA_CAR damaged_by_actor PLAYER_ACTOR
051A:   actor USHER2_DELTA_BOEC1 damaged_by_actor PLAYER_ACTOR
051A:   actor USHER2_DELTA_BOEC2 damaged_by_actor PLAYER_ACTOR
051A:   actor USHER2_DELTA_BOEC3 damaged_by_actor PLAYER_ACTOR
051A:   actor USHER2_DELTA_BOEC4 damaged_by_actor PLAYER_ACTOR
then
jump to @USHER2_FAILED_AGRO_MONKE
end

gosub @DELTA_AFTERMEETING_CONTROL
    
if and
not actor.Animation(PLAYER_ACTOR) == "BOM_PLANT"
SHOW_HINTS_FLAG == 1
then
if
0A4B:   controls_set_to_joystick
    then
    text.ShowH('HINT38B',100,1)
    else
    text.ShowH('HINT38',100,1)
    end  
end       

until CURRENT_USHER_TUTORIAL_NUM == 0

$ZOMBIE_REMOVE_FLAG = 0
$HUNTER_REMOVE_FLAG = 0
$CHARGER_REMOVE_FLAG = 0

random_float EXTRA_WEIGHT 5.0 10.0

v$OBJECTIVE = "STRB52"
MISSION_MARKER = marker.CreateAboveCar($USED_CAR[LATEST_CAR_SLOT_USED])
07E0: set_marker MISSION_MARKER type_to 1
car.LockInCurrentPosition($USED_CAR[LATEST_CAR_SLOT_USED],false)

repeat
wait 0

if
not actor.Dead(PLAYER_ACTOR)
jf @USHER2_FAILED_PLAYER_DIED
if and
$CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
not BASE_TEAMMATE_AGRED == 1
jf @USHER2_FAILED_AGRO
if
803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
jf @USHER2_FAILED_LDEAD
if 
not actor.Dead(USHER2_TERRY) 
jf @USHER2_FAILED_TERRY_DEAD 
if
$SAVE_CAR_CREATED[LATEST_CAR_SLOT_USED] == 1
jf @USHER2_FAILED_CAR_WRECKED

if or
051C:   car USHER2_DELTA_CAR damaged_by_actor PLAYER_ACTOR
051A:   actor USHER2_DELTA_BOEC1 damaged_by_actor PLAYER_ACTOR
051A:   actor USHER2_DELTA_BOEC2 damaged_by_actor PLAYER_ACTOR
051A:   actor USHER2_DELTA_BOEC3 damaged_by_actor PLAYER_ACTOR
051A:   actor USHER2_DELTA_BOEC4 damaged_by_actor PLAYER_ACTOR
then
if
not USHER2_DELTA_CAR_DROVE_FLAG == 2
    then
    jump to @USHER2_FAILED_AGRO_MONKE
    end
end

gosub @DELTA_AFTERMEETING_CONTROL

if and
0E3E: is_button_just_pressed 0 button 17
$CHEATS_ON == 1
then
$END_DIALOG_INST = 1
wait 0
036A: put_actor PLAYER_ACTOR in_car $USED_CAR[LATEST_CAR_SLOT_USED]
0430: put_actor USHER2_TERRY into_car $USED_CAR[LATEST_CAR_SLOT_USED] passenger_seat 0 
break
end

if and
actor.InCar(PLAYER_ACTOR,$USED_CAR[LATEST_CAR_SLOT_USED])
actor.InCar(USHER2_TERRY,$USED_CAR[LATEST_CAR_SLOT_USED])
    then
    break
    end

until false

marker.Disable(MISSION_MARKER)
v$OBJECTIVE = "STRB58"
018A: MISSION_CHECKPOINT = create_checkpoint_at 2174.415527 -2265.320313 13.5469

$END_DIALOG_INST = 1
wait 0
v$ST_DIALOG[0] = "STRY200"
v$ST_DIALOG[1] = "STRY201"
v$ST_DIALOG[2] = "STRY202"
v$ST_DIALOG[3] = "STRY203"
v$ST_DIALOG[4] = "STRY204"
$DIALOG_COUNT = 4
$DIALOG_NOT_SKIP = 1
create_thread @DG_SYS2

repeat
wait 0    

gosub @DELTA_AFTERMEETING_CONTROL

if
not actor.Dead(PLAYER_ACTOR)
jf @USHER2_FAILED_PLAYER_DIED
if and
$CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
not BASE_TEAMMATE_AGRED == 1
jf @USHER2_FAILED_AGRO
if
803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
jf @USHER2_FAILED_LDEAD
if 
not actor.Dead(USHER2_TERRY) 
jf @USHER2_FAILED_TERRY_DEAD 
if
$SAVE_CAR_CREATED[LATEST_CAR_SLOT_USED] == 1
jf @USHER2_FAILED_CAR_WRECKED

///////////////////////////////////////////////////

if and
056E:   car $USED_CAR[LATEST_CAR_SLOT_USED] defined
not USHER2_VICTORIA_GOT_BACK_FLAG == 1
then

if
not car.Wrecked($USED_CAR[LATEST_CAR_SLOT_USED])
jf @USHER2_FAILED_CAR_WRECKED

if
not actor.InCar(PLAYER_ACTOR,$USED_CAR[LATEST_CAR_SLOT_USED])
    then
    marker.Disable(MISSION_CHECKPOINT)         
    gosub @USHER2_GET_BACK_IN_CAR
    v$OBJECTIVE = "STRB58"
    018A: MISSION_CHECKPOINT = create_checkpoint_at 2174.415527 -2265.320313 13.5469    
    end
else
jump to @USHER2_FAILED_CAR_WRECKED
end

///////////////////////////////////////////////////

if and
0E3E: is_button_just_pressed 0 button 17
$CHEATS_ON == 1
then
actor.PutAtNoOffset(PLAYER_ACTOR,2174.415527, -2265.320313, 13.5469)
car.Angle($USED_CAR[LATEST_CAR_SLOT_USED]) = 43.035
create_thread @3D_REFR
$END_DIALOG_INST = 1
wait 0
break
end

until 0103:   actor PLAYER_ACTOR in_sphere 2174.415527 -2265.320313 13.5469 radius 2.0 2.0 2.0 sphere 1 stopped_in_car

v$OBJECTIVE = "DUMMY"
marker.Disable(MISSION_CHECKPOINT)
player.CanMove(PLAYER_CHAR,false)

/////////////////////Плавное затухание/////////////////////

$MUSIC_FADE_NUMBER += 1
if
$MUSIC_FADE_NUMBER > 4
    then
    $MUSIC_FADE_NUMBER = 0 
    end    

0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_MISSION // (int)
$MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = 0.0

$MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 250
$MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 0  
$MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
create_thread @MUS_FAD

wait 1

while $MUSIC_FADE_ENDED[$MUSIC_FADE_NUMBER] == 0
wait 0
end

//////////////////////////////////////////////////////////

$MUSIC_MISSION = Audiostream.Load("audio\sounds\music\usher_music\MISS2\theme4.wav")
Audiostream.PerformAction($MUSIC_MISSION, PLAY)
Audiostream.Loop($MUSIC_MISSION, 1)
Audiostream.Volume($MUSIC_MISSION) = 0.0

/////////////////////Плавное нарастание/////////////////////

$MUSIC_FADE_NUMBER += 1
if
$MUSIC_FADE_NUMBER > 4
    then
    $MUSIC_FADE_NUMBER = 0 
    end    

0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_MISSION // (int) 
0086: $MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = $MUSIC_VOLUME // (float) 

$MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 1000
$MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 1  
$MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
create_thread @MUS_FAD

wait 1 

//////////////////////////////////////////////////////// 

068B: set_car $USED_CAR[LATEST_CAR_SLOT_USED] all_disembark

repeat
wait 0
until not actor.InCar(PLAYER_ACTOR,$USED_CAR[LATEST_CAR_SLOT_USED])

player.CanMove(PLAYER_CHAR,true)

car.DoorStatus($USED_CAR[LATEST_CAR_SLOT_USED],2)
02D4: car $USED_CAR[LATEST_CAR_SLOT_USED] turn_off_engine
v$OBJECTIVE = "STRB59"

repeat
wait 0
until 056D:   actor USHER2_NIKOLS defined

actor.PutAtNoOffset(USHER2_NIKOLS,2123.278564, -2275.642090, 20.671875)
actor.Angle(USHER2_NIKOLS) = 314.394836

$SHIT_FUCK = Audiostream.Load3d("audio\sounds\music\usher_music\MISS2\a_football2.ogg")    
Audiostream.SetPosition($SHIT_FUCK,20.6719, 2126.0645, -2273.7864) //ZXY
Audiostream.Loop($SHIT_FUCK, 0)     
Audiostream.Volume($SHIT_FUCK) = 0.0
Audiostream.PerformAction($SHIT_FUCK, PLAY)

//////////////////////////////////////////////////////////////////////////////

repeat
wait 0

if
not actor.Dead(PLAYER_ACTOR)
jf @USHER2_FAILED_PLAYER_DIED
if and
$CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
not BASE_TEAMMATE_AGRED == 1
jf @USHER2_FAILED_AGRO
if
803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
jf @USHER2_FAILED_LDEAD
if 
not actor.Dead(USHER2_TERRY) 
jf @USHER2_FAILED_TERRY_DEAD 
if
$SAVE_CAR_CREATED[LATEST_CAR_SLOT_USED] == 1
jf @USHER2_FAILED_CAR_WRECKED  

if and
0E3E: is_button_just_pressed 0 button 17
$CHEATS_ON == 1
then
actor.PutAtNoOffset(PLAYER_ACTOR,2129.2288, -2278.8098, 20.6643)
$END_DIALOG_INST = 1
wait 0
break
end

if
0EEA: locate_char_distance_to_coordinates PLAYER_ACTOR pos 2129.2288 -2278.8098 20.6643 radius 30.0
then
Audiostream.Volume($SHIT_FUCK) = $SOUNDS_VOLUME
end

until 00A4:   actor PLAYER_ACTOR sphere 0 in_cube_cornerA 2121.8728 -2267.6924 20.2734 cornerB 2133.1223 -2289.1956 24.6259

$END_DIALOG_INST = 1
wait 0

marker.Disable(MISSION_MARKER)
//0A96: 0@ = actor PLAYER_ACTOR struct
//0AA5: call 0x043F1F0 num_params 1 pop 0 0@ //CEntryExit::WarpGangWithPlayer
if
0EEA: locate_char_distance_to_coordinates PLAYER_ACTOR pos 2132.6426 -2278.4111 20.6719 radius 5.0
then
0362: remove_actor USHER2_TERRY from_car_and_place_at 2135.0042 -2275.7876 20.6719
actor.PutAtNoOffset(USHER2_TERRY,2135.0042, -2275.7876, 20.6719)
end

if
0EEA: locate_char_distance_to_coordinates PLAYER_ACTOR pos 2118.8689 -2274.906 20.6719 radius 5.0
then
0362: remove_actor USHER2_TERRY from_car_and_place_at 2117.3757 -2276.3782 20.676
actor.PutAtNoOffset(USHER2_TERRY,2117.3757, -2276.3782, 20.676)
end
                              
Audiostream.PerformAction($SHIT_FUCK, STOP)
Audiostream.Release($SHIT_FUCK)
$SHIT_FUCK = Audiostream.Load3d("audio\sounds\music\usher_music\MISS1\tv_off.mp3")    
Audiostream.SetPosition($SHIT_FUCK,20.6719, 2126.0645, -2273.7864) //ZXY
Audiostream.Loop($SHIT_FUCK, 0)     
Audiostream.Volume($SHIT_FUCK) = $SOUNDS_VOLUME
Audiostream.PerformAction($SHIT_FUCK, PLAY)

v$OBJECTIVE = "DUMMY"

v$ST_DIALOG[0] = "STRY205"
$DIALOG_COUNT = 0
$DIALOG_NOT_SKIP = 1
create_thread @DG_SYS2

0A1D: AS_actor USHER2_NIKOLS rotate_to_and_look_at_actor PLAYER_ACTOR

repeat
wait 0

if
not actor.Dead(PLAYER_ACTOR)
jf @USHER2_FAILED_PLAYER_DIED
if and
$CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
not BASE_TEAMMATE_AGRED == 1
jf @USHER2_FAILED_AGRO
if
803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
jf @USHER2_FAILED_LDEAD

if
0E45: frame_mod 30
then
0A1D: AS_actor USHER2_NIKOLS rotate_to_and_look_at_actor PLAYER_ACTOR
end

until $DIALOG_END == 1

Audiostream.Release($SHIT_FUCK)

player.CanMove(PLAYER_CHAR,false)
fade 0 1000
$HUD_REMOVE = 1
wait 1000

06C9: remove_actor USHER2_TERRY from_group

01B9: set_actor USHER2_NIKOLS armed_weapon_to 0
01B9: set_actor USHER2_TERRY armed_weapon_to 0
01B9: set_actor PLAYER_ACTOR armed_weapon_to 0

actor.PutAtNoOffset(USHER2_TERRY,2124.7109, -2275.2769, 20.6719)
actor.Angle(USHER2_TERRY) = 99.6942

actor.PutAtNoOffset(PLAYER_ACTOR,2124.6914, -2276.0647, 20.6719)
actor.Angle(PLAYER_ACTOR) = 70.4935

if
$FP_ACTIVATED == 1
then
repeat
wait 0
until $FP_ACTIVATED == 0
end

cinema.Widescreen(1)
BLACK_POLOSKI_ON = 1
camera.SetPosition(2122.559814 -2275.165039 21.453524,0.0,0.0,0.0)
camera.PointAt(2123.521973 -2275.425781 21.374981,2)

0A1D: AS_actor USHER2_TERRY rotate_to_and_look_at_actor USHER2_NIKOLS
0A1D: AS_actor USHER2_NIKOLS rotate_to_and_look_at_actor PLAYER_ACTOR
0A1D: AS_actor PLAYER_ACTOR rotate_to_and_look_at_actor USHER2_NIKOLS

wait 1000

fade 1 1000
wait 1000

v$ST_DIALOG[0] = "STRY206"
v$ST_DIALOG[1] = "STRY207"
v$ST_DIALOG[2] = "STRY208"
v$ST_DIALOG[3] = "STRY209"
v$ST_DIALOG[4] = "STRY210"
v$ST_DIALOG[5] = "STRY211"
v$ST_DIALOG[6] = "STRY212"
v$ST_DIALOG[7] = "STRY213"
0084: $DIALOG_ACTOR[0] = USHER2_TERRY // (int)
0084: $DIALOG_ACTOR[1] = USHER2_NIKOLS // (int)
0084: $DIALOG_ACTOR[2] = PLAYER_ACTOR // (int)
0084: $DIALOG_ACTOR[3] = USHER2_NIKOLS // (int)
0084: $DIALOG_ACTOR[4] = USHER2_TERRY // (int)
0084: $DIALOG_ACTOR[5] = USHER2_NIKOLS // (int)
0084: $DIALOG_ACTOR[6] = PLAYER_ACTOR // (int)
0084: $DIALOG_ACTOR[7] = USHER2_TERRY // (int)
$DIALOG_COUNT = 7
$DIALOG_NOT_ANIMS_FLAG = 0
create_thread @DG_SYS

repeat
wait 0

if
not actor.Dead(PLAYER_ACTOR)
jf @USHER2_FAILED_PLAYER_DIED
if and
$CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
not BASE_TEAMMATE_AGRED == 1
jf @USHER2_FAILED_AGRO
if
803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
jf @USHER2_FAILED_LDEAD

until $DIALOG_END == 1

camera.OnPed(USHER2_TERRY,15,1)

0615: define_AS_pack_begin 0@
05D3: AS_actor -1 goto_point 2129.1362 -2278.3215 20.6643 mode 4 time 10000 ms // versionA
05D3: AS_actor -1 goto_point 2132.4797 -2278.5579 20.6719 mode 4 time 10000 ms // versionA
05D3: AS_actor -1 goto_point 2135.3186 -2275.7051 20.6719 mode 4 time 10000 ms // versionA
0616: define_AS_pack_end 0@
0618: assign_actor USHER2_TERRY to_AS_pack 0@
061B: remove_references_to_AS_pack 0@  
    
repeat
wait 0
until 0EEA: locate_char_distance_to_coordinates USHER2_TERRY pos 2135.3186 -2275.7051 20.6719 radius 2.0

camera.SetPosition(2125.552002 -2275.916748 21.430464,0.0,0.0,0.0)
camera.PointAt(2124.554199 -2275.863281 21.388958,1)

0337: set_actor USHER2_TERRY visibility 0
0619: enable_actor USHER2_TERRY collision_detection 0

0605: actor PLAYER_ACTOR perform_animation "habargive" IFP "CAMERA" framedelta 4.0 loop 0 lockX 0 lockY 0 lockF 0 time -1
05BF: AS_actor PLAYER_ACTOR look_at_actor USHER2_NIKOLS 1170 ms
Audiostream.Volume($DROP_ITEM_SOUND) = $SOUNDS_VOLUME 
Audiostream.Loop($DROP_ITEM_SOUND, 0)
Audiostream.PerformAction($DROP_ITEM_SOUND, PLAY) 
wait 1170
EXTRA_WEIGHT = 0.0

0605: actor USHER2_NIKOLS perform_animation "habargive" IFP "CAMERA" framedelta 4.0 loop 0 lockX 0 lockY 0 lockF 0 time -1
05BF: AS_actor USHER2_NIKOLS look_at_actor PLAYER_ACTOR 1170 ms
Audiostream.Volume($PICKUP_ITEM_SOUND) = $SOUNDS_VOLUME 
Audiostream.Loop($PICKUP_ITEM_SOUND, 0)
Audiostream.PerformAction($PICKUP_ITEM_SOUND, PLAY)
wait 1170

//////////////////////////////////////////////

$BANKA += 1
$HEAL += 2
$KANISTRA = 1
$KANISTRA_FUEL += 10.0
$JIMMY += 3

//////////////////////////////////////////////

04B8: get_weapon_data_from_actor PLAYER_ACTOR slot 5 weapon 1@ ammo 2@ model 3@
if
2@ > 0
then

while not model.Available(3@)
wait 0
model.Load(3@)
mload
end

01B2: give_actor PLAYER_ACTOR weapon 1@ ammo 100 // Load the weapon model before using this
else
//ass
end

//////////////////////////////////////////////

04B8: get_weapon_data_from_actor PLAYER_ACTOR slot 3 weapon 1@ ammo 2@ model 3@
if
2@ > 0
then

while not model.Available(3@)
wait 0
model.Load(3@)
mload
end

01B2: give_actor PLAYER_ACTOR weapon 1@ ammo 44 // Load the weapon model before using this
else
//ass
end

//////////////////////////////////////////////

04B8: get_weapon_data_from_actor PLAYER_ACTOR slot 4 weapon 1@ ammo 2@ model 3@
if
2@ > 0
then

while not model.Available(3@)
wait 0
model.Load(3@)
mload
end

01B2: give_actor PLAYER_ACTOR weapon 1@ ammo 15 // Load the weapon model before using this
else
//ass
end

//////////////////////////////////////////////

04B8: get_weapon_data_from_actor PLAYER_ACTOR slot 6 weapon 1@ ammo 2@ model 3@
if
2@ > 0
then

while not model.Available(3@)
wait 0
model.Load(3@)
mload
end

01B2: give_actor PLAYER_ACTOR weapon 1@ ammo 140 // Load the weapon model before using this
else
//ass
end

//////////////////////////////////////////////

0781: get_weapon_with_ID 16 model_to 0@

while not model.Available(0@)
wait 0
model.Load(0@)
mload
end
 
Actor.GiveWeaponAndAmmo(PLAYER_ACTOR, 16, 3)

//////////////////////////////////////////////

0781: get_weapon_with_ID 18 model_to 0@

while not model.Available(0@)
wait 0
model.Load(0@)
mload
end
 
Actor.GiveWeaponAndAmmo(PLAYER_ACTOR, 18, 2)

//////////////////////////////////////////////

v$ST_DIALOG[0] = "STRY214"
v$ST_DIALOG[1] = "STRY215"
v$ST_DIALOG[2] = "STRY216"
v$ST_DIALOG[3] = "STRY217"
v$ST_DIALOG[4] = "STR217"
v$ST_DIALOG[5] = "STRZ217"
0084: $DIALOG_ACTOR[0] = USHER2_NIKOLS // (int)
0084: $DIALOG_ACTOR[1] = PLAYER_ACTOR // (int)
0084: $DIALOG_ACTOR[2] = USHER2_NIKOLS // (int)
0084: $DIALOG_ACTOR[3] = PLAYER_ACTOR // (int)
0084: $DIALOG_ACTOR[4] = USHER2_NIKOLS // (int)
0084: $DIALOG_ACTOR[5] = PLAYER_ACTOR // (int)
$DIALOG_COUNT = 5
$DIALOG_NOT_ANIMS_FLAG = 0
create_thread @DG_SYS

repeat
wait 0

if
not actor.Dead(PLAYER_ACTOR)
jf @USHER2_FAILED_PLAYER_DIED
if and
$CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
not BASE_TEAMMATE_AGRED == 1
jf @USHER2_FAILED_AGRO
if
803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
jf @USHER2_FAILED_LDEAD

until $DIALOG_END == 1

/////////////////////Плавное затухание/////////////////////

$MUSIC_FADE_NUMBER += 1
if
$MUSIC_FADE_NUMBER > 4
    then
    $MUSIC_FADE_NUMBER = 0 
    end    

0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_MISSION // (int)
$MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = 0.0

$MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 250
$MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 0  
$MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
create_thread @MUS_FAD

wait 1

fade 0 1000
$HUD_REMOVE = 1
wait 1000

actor.PutAtNoOffset(PLAYER_ACTOR,2133.1814, -2277.8745, 20.6719)
actor.Angle(PLAYER_ACTOR) = 315.165
camera.Restore_WithJumpCut()
cinema.Widescreen(0)
BLACK_POLOSKI_ON = 0

while $MUSIC_FADE_ENDED[$MUSIC_FADE_NUMBER] == 0
wait 0
end

//////////////////////////////////////////////////////////

$MUSIC_MISSION = Audiostream.Load("audio\sounds\music\usher_music\MISS2\theme4a.wav")
Audiostream.PerformAction($MUSIC_MISSION, PLAY)
Audiostream.Loop($MUSIC_MISSION, 1)
Audiostream.Volume($MUSIC_MISSION) = 0.0

/////////////////////Плавное нарастание/////////////////////

$MUSIC_FADE_NUMBER += 1
if
$MUSIC_FADE_NUMBER > 4
    then
    $MUSIC_FADE_NUMBER = 0 
    end    

0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_MISSION // (int) 
0086: $MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = $MUSIC_VOLUME // (float) 

$MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 1000
$MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 1  
$MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
create_thread @MUS_FAD

wait 1 

//////////////////////////////////////////////////////// 

player.CanMove(PLAYER_CHAR,true)
fade 1 1000
$HUD_REMOVE = 0
wait 1000

USHER2_SAVE_PICKUP = pickup.Create(#PICKUPSAVE,15,$CAMP_SAVE_X[6], $CAMP_SAVE_Y[6], $CAMP_SAVE_Z[6])
USHER2_SAVE_PICKUP_MARKER = marker.CreateIconWithoutSphere(35,$CAMP_SAVE_X[6], $CAMP_SAVE_Y[6], $CAMP_SAVE_Z[6])

v$OBJECTIVE = "STRB60"

v$ST_DIALOG[0] = "STR218"
$DIALOG_COUNT = 0
$DIALOG_NOT_SKIP = 1
create_thread @DG_SYS2

03DC: MISSION_MARKER = create_marker_above_pickup USHER2_SAVE_PICKUP

repeat
wait 0 

if and
0E3E: is_button_just_pressed 0 button 17
$CHEATS_ON == 1
then
actor.PutAtNoOffset(PLAYER_ACTOR,2231.562012 -2284.314697 14.375132)
$END_DIALOG_INST = 1
wait 0
break
end

if
not actor.Dead(PLAYER_ACTOR)
jf @USHER2_FAILED_PLAYER_DIED
if and
$CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
not BASE_TEAMMATE_AGRED == 1
jf @USHER2_FAILED_AGRO
if
803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
jf @USHER2_FAILED_LDEAD

until pickup.Picked_up(USHER2_SAVE_PICKUP)

v$OBJECTIVE = "DUMMY"
player.CanMove(PLAYER_CHAR,false)

marker.Disable(MISSION_MARKER)
pickup.Destroy(USHER2_SAVE_PICKUP)
marker.Disable(USHER2_SAVE_PICKUP_MARKER)

fade 0 1000
wait 1000

$ACHIV_NUMBER = 3
FREEMODE_VOICE_START = 3
FREEMODE_VOICE_END = 4
MIKE_VOICE_CANNOT_SKIP_FLAG = 1
create_thread @VOI_SHO

repeat
wait 0
until $ACHIV_SHOW_ENDED == 1

BASE_TEAMMATES_DESTORY_FLAG = 1

0629: change_integer_stat 258 to 0
0318: set_latest_mission_passed 'STRB43'

0AF1: write_int -1 to_ini_file "saves\ZACM.set" section "SCR" key "USHER_MISS3_CHECKPOINT" 

wait 1000                                             

$ZOMBIE_SPAWN_INT = 0 
$SAVESTATUS = 1
$ZOMBIES_HORDE = 0
$SAVESTATUS_TRUE = 1   
$MIKE_MUTED = 0
ENEX_OFF = 0
$QUEST_CAMP_NUMBER = -1

gosub @UMUSIC_MISSION2_OFF

create_thread @TERRY_T

jump @UUDACHNO2 

:UUDACHNO2        
gosub @UPROPUSK_KODA2 
return 

:UKOD_PROVALA2
$ONMISSION = 0 
mission_cleanup 
06D0: enable_emergency_traffic 0 
06D7: enable_train_traffic 0 
096A: enable_flying_helis 0 
099E: enable_police_patrols 0  
0923: enable_air_traffic 0 
08E7: disable_entrance_markers 0    
return 

:UUDALENIE_KODA2    
$ONMISSION = 0 
marker.Disable(MISSION_CHECKPOINT)
marker.Disable(MISSION_MARKER)

wait 0 

if and
GAME_OVER_FLAG == 0
$ACTOR_DEAD == 0
then
fade 0 0
end

mission_cleanup

if and
GAME_OVER_FLAG == 0
$ACTOR_DEAD == 0
then
fade 0 0
end

06D0: enable_emergency_traffic 0 
06D7: enable_train_traffic 0 
096A: enable_flying_helis 0 
099E: enable_police_patrols 0  
0923: enable_air_traffic 0 
08E7: disable_entrance_markers 0    
return

:USHER2_FAILED_WALK

/////////////////////Плавное затухание/////////////////////

$MUSIC_FADE_NUMBER += 1
if
$MUSIC_FADE_NUMBER > 4
    then
    $MUSIC_FADE_NUMBER = 0 
    end    
        
0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_ASSHOLE // (int)
$MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = 0.0
        
$MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 250
$MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 0  
$MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
create_thread @MUS_FAD

///////////////////////////////////////////////////////////

text.ClearAll()
BLACK_POLOSKI_ON = 1
$MUSIC_TURN_OFF_FLAG = 1
v$FAILED_TEXT = "MSFL104"
create_thread @GMV_OVR

return

:UMUSIC_MISSION2_OFF

/////////////////////Плавное затухание/////////////////////

$MUSIC_FADE_NUMBER += 1
if
$MUSIC_FADE_NUMBER > 4
    then
    $MUSIC_FADE_NUMBER = 0 
    end    

0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_MISSION // (int)
$MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = 0.0

$MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 700
$MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 0  
$MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
create_thread @MUS_FAD

wait 1

while $MUSIC_FADE_ENDED[$MUSIC_FADE_NUMBER] == 0
wait 0
end

//////////////////////////////////////////////////////////

return

:USHER2_GET_BACK_IN_CAR
$DIALOG_PAUSE = 1
v$OBJECTIVE = "STRB37"
    
MISSION_CHECKPOINT = marker.CreateAboveCar($USED_CAR[LATEST_CAR_SLOT_USED])
07E0: set_marker MISSION_CHECKPOINT type_to 1
    
///////////////////////////////////////////////////////////////////
    
while true
wait 0

if
not actor.Dead(PLAYER_ACTOR)
jf @USHER2_GET_BACK_IN_CAR_FAILED_OTHER_REASON
if and
$CAMP_AGRED_FLAG[$QUEST_CAMP_NUMBER] == 0
not BASE_TEAMMATE_AGRED == 1
jf @USHER2_GET_BACK_IN_CAR_FAILED_OTHER_REASON
if
803A: not  LEADER_DIED_FLAG == $QUEST_CAMP_NUMBER // (int)
jf @USHER2_GET_BACK_IN_CAR_FAILED_OTHER_REASON
if 
not actor.Dead(USHER2_TERRY) 
jf @USHER2_GET_BACK_IN_CAR_FAILED_OTHER_REASON 
if
$SAVE_CAR_CREATED[LATEST_CAR_SLOT_USED] == 1
jf @USHER2_GET_BACK_IN_CAR_FAILED_OTHER_REASON
    
if and
056E:   car $USED_CAR[LATEST_CAR_SLOT_USED] defined
not car.Wrecked($USED_CAR[LATEST_CAR_SLOT_USED])
    then
    if
    actor.InCar(PLAYER_ACTOR,$USED_CAR[LATEST_CAR_SLOT_USED])   
        then
        :USHER2_GET_BACK_IN_CAR_FAILED_OTHER_REASON
        marker.Disable(MISSION_CHECKPOINT)
        USHER2_VICTORIA_GOT_BACK_FLAG = 0            
        $DIALOG_PAUSE = 0
        return
        end
    else
    USHER2_VICTORIA_GOT_BACK_FLAG = 1
    return
    end
    
end
    
///////////////////////////////////////////////////////////////////

:USHER2_FAILED_CAR_WRECKED

/////////////////////Плавное затухание/////////////////////

$MUSIC_FADE_NUMBER += 1
if
$MUSIC_FADE_NUMBER > 4
    then
    $MUSIC_FADE_NUMBER = 0 
    end    
        
0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_ASSHOLE // (int)
$MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = 0.0
        
$MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 250
$MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 0  
$MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
create_thread @MUS_FAD

///////////////////////////////////////////////////////////

text.ClearAll()
BLACK_POLOSKI_ON = 1
$MUSIC_TURN_OFF_FLAG = 1
v$FAILED_TEXT = "MSFL103"
create_thread @GMV_OVR

return

:USHER2_FAILED_WALK2

/////////////////////Плавное затухание/////////////////////

$MUSIC_FADE_NUMBER += 1
if
$MUSIC_FADE_NUMBER > 4
    then
    $MUSIC_FADE_NUMBER = 0 
    end    
        
0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_ASSHOLE // (int)
$MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = 0.0
        
$MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 250
$MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 0  
$MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
create_thread @MUS_FAD

///////////////////////////////////////////////////////////

text.ClearAll()
BLACK_POLOSKI_ON = 1
$MUSIC_TURN_OFF_FLAG = 1
v$FAILED_TEXT = "MS_FL7"
create_thread @GMV_OVR

return

:USHER2_HIDE_WEPS
$NOTSPAWN_ETC = 1
06AB: set_actor PLAYER_ACTOR all_weapons_hidden 1
0992: set_player PLAYER_CHAR weapons_scrollable 0
return

:DELTA_AFTERMEETING_CONTROL

if and
actor.InCar(USHER2_DELTA_BOEC1,USHER2_DELTA_CAR)
actor.InCar(USHER2_DELTA_BOEC2,USHER2_DELTA_CAR)
actor.InCar(USHER2_DELTA_BOEC3,USHER2_DELTA_CAR)
actor.InCar(USHER2_DELTA_BOEC4,USHER2_DELTA_CAR)
USHER2_DELTA_CAR_DROVE_FLAG < 1
    then
    ZOMBIES_NOTSPAWN = 0
    USHER2_DELTA_CAR_DROVE_FLAG = 1
    
    repeat
    wait 0
    07C0: load_path 813
    mload
    until 07C1:   path 813 available
            
    05EB: assign_car USHER2_DELTA_CAR to_path 813
    06FD: set_car USHER2_DELTA_CAR speed_on_path_to 1.05
    
    end
    
if and
USHER2_DELTA_CAR_DROVE_FLAG == 1
not USHER2_DELTA_CAR_DROVE_FLAG == 2
    then
    if and
    0EEB: locate_car_distance_to_coordinates USHER2_DELTA_CAR pos -296.2953 -872.3888 47.1683 radius 50.0
    860E: not  car USHER2_DELTA_CAR assigned_to_path
        then
        0873: release_path 813         
        0338: set_car USHER2_DELTA_CAR visibility 0
        099A: set_car USHER2_DELTA_CAR collision_detection 0
        car.LockInCurrentPosition(USHER2_DELTA_CAR,true)
        USHER2_DELTA_CAR_DROVE_FLAG = 2
        end
    end  
    
return    

:USHER2_FAILED_SLOYPOK

/////////////////////Плавное затухание/////////////////////

$MUSIC_FADE_NUMBER += 1
if
$MUSIC_FADE_NUMBER > 4
    then
    $MUSIC_FADE_NUMBER = 0 
    end    
        
0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_ASSHOLE // (int)
$MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = 0.0
        
$MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 250
$MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 0  
$MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
create_thread @MUS_FAD

///////////////////////////////////////////////////////////

text.ClearAll()
BLACK_POLOSKI_ON = 1
$MUSIC_TURN_OFF_FLAG = 1
v$FAILED_TEXT = "MSFL100"
create_thread @GMV_OVR

return

:USHER2_FAILED_AGRO_MONKE

05E2: AS_actor USHER2_DELTA_BOEC1 kill_actor PLAYER_ACTOR
05E2: AS_actor USHER2_DELTA_BOEC2 kill_actor PLAYER_ACTOR
05E2: AS_actor USHER2_DELTA_BOEC3 kill_actor PLAYER_ACTOR
05E2: AS_actor USHER2_DELTA_BOEC4 kill_actor PLAYER_ACTOR

wait 2000

/////////////////////Плавное затухание/////////////////////

$MUSIC_FADE_NUMBER += 1
if
$MUSIC_FADE_NUMBER > 4
    then
    $MUSIC_FADE_NUMBER = 0 
    end    
        
0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_ASSHOLE // (int)
$MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = 0.0
        
$MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 250
$MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 0  
$MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
create_thread @MUS_FAD

///////////////////////////////////////////////////////////

text.ClearAll()
BLACK_POLOSKI_ON = 1
$MUSIC_TURN_OFF_FLAG = 1
v$FAILED_TEXT = "MSFL102"
create_thread @GMV_OVR
mission_cleanup    
return

:USHER2_FAILED_AGRO

/////////////////////Плавное затухание/////////////////////

$MUSIC_FADE_NUMBER += 1
if
$MUSIC_FADE_NUMBER > 4
    then
    $MUSIC_FADE_NUMBER = 0 
    end    
        
0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_ASSHOLE // (int)
$MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = 0.0
        
$MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 250
$MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 0  
$MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
create_thread @MUS_FAD

///////////////////////////////////////////////////////////

text.ClearAll()
BLACK_POLOSKI_ON = 1
$MUSIC_TURN_OFF_FLAG = 1
v$FAILED_TEXT = "MS_FL5"
create_thread @GMV_OVR
mission_cleanup    
return

:USHER2_FAILED_LDEAD

/////////////////////Плавное затухание/////////////////////

$MUSIC_FADE_NUMBER += 1
if
$MUSIC_FADE_NUMBER > 4
    then
    $MUSIC_FADE_NUMBER = 0 
    end    
        
0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_ASSHOLE // (int)
$MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = 0.0
        
$MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 250
$MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 0  
$MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
create_thread @MUS_FAD

///////////////////////////////////////////////////////////

text.ClearAll()
BLACK_POLOSKI_ON = 1
$MUSIC_TURN_OFF_FLAG = 1
v$FAILED_TEXT = "MS_FL43"
create_thread @GMV_OVR
mission_cleanup    
return

:USHER2_FAILED_PLAYER_DIED

/////////////////////Плавное затухание/////////////////////

$MUSIC_FADE_NUMBER += 1
if
$MUSIC_FADE_NUMBER > 4
    then
    $MUSIC_FADE_NUMBER = 0 
    end    
        
0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_ASSHOLE // (int)
$MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = 0.0
        
$MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 250
$MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 0  
$MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
create_thread @MUS_FAD

///////////////////////////////////////////////////////////

text.ClearAll()
BLACK_POLOSKI_ON = 1
$MUSIC_TURN_OFF_FLAG = 1
v$FAILED_TEXT = "MS_FL80"
create_thread @GMV_OVR

return

:USHER2_FAILED_TERRY_DEAD

/////////////////////Плавное затухание/////////////////////

$MUSIC_FADE_NUMBER += 1
if
$MUSIC_FADE_NUMBER > 4
    then
    $MUSIC_FADE_NUMBER = 0 
    end    
        
0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_ASSHOLE // (int)
$MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = 0.0
        
$MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 250
$MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 0  
$MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
create_thread @MUS_FAD

///////////////////////////////////////////////////////////

text.ClearAll()
BLACK_POLOSKI_ON = 1
$MUSIC_TURN_OFF_FLAG = 1
v$FAILED_TEXT = "MS_FL99"
create_thread @GMV_OVR

return

:USHER2_FAILED_GURZ_SPIZDILI_OR_OTHER

/////////////////////Плавное затухание/////////////////////

$MUSIC_FADE_NUMBER += 1
if
$MUSIC_FADE_NUMBER > 4
    then
    $MUSIC_FADE_NUMBER = 0 
    end    
        
0084: $MUSIC_FADE1[$MUSIC_FADE_NUMBER] = $MUSIC_ASSHOLE // (int)
$MUSIC_FADE_END_VOLUME[$MUSIC_FADE_NUMBER] = 0.0
        
$MUSIC_FADE_TIME[$MUSIC_FADE_NUMBER] = 250
$MUSIC_FADE_FLAG[$MUSIC_FADE_NUMBER] = 0  
$MUSIC_FADE_COUNT[$MUSIC_FADE_NUMBER] = 1 
create_thread @MUS_FAD

///////////////////////////////////////////////////////////

text.ClearAll()
BLACK_POLOSKI_ON = 1
$MUSIC_TURN_OFF_FLAG = 1
v$FAILED_TEXT = "MSFL101"
create_thread @GMV_OVR

return

:USHER2_TERRY_ACTOR_CREATE

$TEAMMATES_PED_TYPE = 26

while not model.Available(9199)
wait 0
model.Load(9199)
mload
end

USHER2_TERRY = actor.Create(26,9199,2234.3022, -2263.0798, 14.7647)
actor.Angle(USHER2_TERRY) = 356.9597
0337: set_actor USHER2_TERRY visibility 0
     
0D10: set_actor USHER2_TERRY alpha 255 // IF and SET
0619: enable_actor USHER2_TERRY collision_detection 0
    
create_thread @PED_BKP USHER2_TERRY 371

0781: get_weapon_with_ID 7 model_to 0@

while not model.Available(0@)
wait 0
model.Load(0@)
mload
end
 
Actor.GiveWeaponAndAmmo($SURVIVER[0], 7, 1)

$SURVIVOR_MELEE_ID[0] = 5
$SURVIVOR_WEP_ID[0] = 88
create_thread @MEL_SRV $SURVIVER[0] 0

0781: get_weapon_with_ID 88 model_to 1@

while not model.Available(1@)
wait 0
model.Load(1@)
mload
end

actor.GiveWeaponAndAmmo(USHER2_TERRY,88,99999)

actor.Health(USHER2_TERRY) = 2000

0D10: set_actor USHER2_TERRY alpha 255 // IF and SET
09F4: set_actor USHER2_TERRY ignore_height_difference_following_nodes $Z_IGNORE_HEIGHT     
Actor.SetWalkStyle(USHER2_TERRY, "SURV1")
0446: set_actor USHER2_TERRY dismemberment_possible 0
060B: set_actor USHER2_TERRY decision_maker_to $DEC_PEOPLE
07DD: set_actor USHER2_TERRY attack_rate 100 // previously known as temper_to
081A: set_actor USHER2_TERRY weapon_skill_to 2  
060F: set_actor USHER2_TERRY melee_accuracy_to 999.0
0946: set_actor USHER2_TERRY actions_uninterupted_by_weapon_fire 1

if
UNITED_MAP == 0
then
04D8: set_actor USHER2_TERRY drowns_in_water 0 
end

09B5: set_actor USHER2_TERRY signal_after_kill 0  
0A96: 0@ = actor USHER2_TERRY struct
0A8E: 0@ = 0@ + 1376
0A8C: write_memory 0@ size 4 value $SURVIVORS_ROTATE_SPEED virtual_protect 1

08AF: set_actor USHER2_TERRY max_health_to 2000
Actor.WeaponAccuracy(USHER2_TERRY) = 90

return

:USHER2_NICOLS_SMOKE_SYSTEM

if and
0364:   actor PLAYER_ACTOR spotted_actor USHER2_NIKOLS
USHER2_NIKOLS_SMOKE_FLAG == 0
then
USHER2_NIKOLS_SMOKE_FLAG = 1

repeat
wait 0
animation.Load("SMOKING")
mload
until animation.Available("SMOKING")
                                                                                                 
0605: actor USHER2_NIKOLS perform_animation "M_smk_in" IFP "SMOKING" framedelta 4.0 loop 0 lockX 0 lockY 0 lockF 0 time -1
wait 0
//0AD1: show_formatted_text_highpriority "SMOKE START" time 1000
end

//Достает сигарету (КУРЕНИЕ - ЗЛО!)
if and
USHER2_NIKOLS_SMOKE_FLAG == 1
actor.Animation(USHER2_NIKOLS) == "M_smk_in"
    then    
    0613: 0@ = actor USHER2_NIKOLS animation "M_smk_in" time
    if
    0@ > 0.075
        then  
        USHER2_NIKOLS_SMOKE_FLAG = 2
//        0AD1: show_formatted_text_highpriority "SIGARETTE OUT" time 1000
        Object.Create(USHER2_NIKOLS_SMOKE_OBJECT, 15174, 0.0, 0.0, 0.0)
        Object.Create(USHER2_NIKOLS_SMOKE_OBJECT2, 15175, 0.0, 0.0, 0.0)
        070A: AS_actor USHER2_NIKOLS attach_to_object USHER2_NIKOLS_SMOKE_OBJECT offset 0.0 0.0 0.0 on_bone 6 16 perform_animation "NULL" IFP_file "NULL" time 0               
        end

    end

//Зажигаем сигарету (КУРЕНИЕ - ЗЛО!)   
if and
USHER2_NIKOLS_SMOKE_FLAG == 2
actor.Animation(USHER2_NIKOLS) == "M_smk_in"
    then
    0613: 0@ = actor USHER2_NIKOLS animation "M_smk_in" time
    if
    0@ > 0.3
        then
        USHER2_NIKOLS_SMOKE_FLAG = 3
        object.Destroy(USHER2_NIKOLS_SMOKE_OBJECT)        
        070A: AS_actor USHER2_NIKOLS attach_to_object USHER2_NIKOLS_SMOKE_OBJECT2 offset 0.0 0.0 0.0 on_bone 6 16 perform_animation "NULL" IFP_file "NULL" time 0
//        0AD1: show_formatted_text_highpriority "SIGARETTE BURN START" time 1000                   
        end
    end

//Пар изо рта (КУРЕНИЕ - ЗЛО!)   
if and
USHER2_NIKOLS_SMOKE_FLAG == 3
actor.Animation(USHER2_NIKOLS) == "M_smk_in"
    then
    0613: 0@ = actor USHER2_NIKOLS animation "M_smk_in" time
    if
    0@ > 0.52
        then
        USHER2_NIKOLS_SMOKE_FLAG = 4
//        0AD1: show_formatted_text_highpriority "SIGARETTE SMOKE FROM ROT START" time 1000
        0669: USHER2_NIKOLS_SMOKE_PARTICLE = attach_particle "EXHALE" to_actor USHER2_NIKOLS with_offset 0.05 0.12 0.0 type 1 
        0883: attach_particle USHER2_NIKOLS_SMOKE_PARTICLE to_actor USHER2_NIKOLS mode 5 
        064C: make_particle USHER2_NIKOLS_SMOKE_PARTICLE visible           
        end
    end
         
//Заходим в луп курения (КУРЕНИЕ - ЗЛО!)   
if and
USHER2_NIKOLS_SMOKE_FLAG == 4
not actor.Animation(USHER2_NIKOLS) == "M_smk_in"
    then
    USHER2_NIKOLS_SMOKE_FLAG = 5
//    0AD1: show_formatted_text_highpriority "SIGARETTE LOOP START" time 1000                  
    0615: define_AS_pack_begin 0@
    0605: actor -1 perform_animation "M_smk_loop" IFP "SMOKING" framedelta 4.0 loop 0 lockX 0 lockY 0 lockF 0 time -1
    0605: actor -1 perform_animation "M_smk_drag" IFP "SMOKING" framedelta 4.0 loop 0 lockX 0 lockY 0 lockF 0 time -1    
    0605: actor -1 perform_animation "M_smk_tap" IFP "SMOKING" framedelta 4.0 loop 0 lockX 0 lockY 0 lockF 0 time -1
    0643: set_AS_pack 0@ loop 1
    0616: define_AS_pack_end 0@    
    0618: assign_actor USHER2_NIKOLS to_AS_pack 0@        
    061B: remove_references_to_AS_pack 0@                   
    end
    
//Пар изо рта (КУРЕНИЕ - ЗЛО!)    
if and
USHER2_NIKOLS_SMOKE_FLAG == 5
actor.Animation(USHER2_NIKOLS) == "M_smk_drag"
    then
    0613: 0@ = actor USHER2_NIKOLS animation "M_smk_drag" time
    if and
    0@ >= 0.6
    0@ <= 0.8
        then
        32@ = 0
//        0AD1: show_formatted_text_highpriority "SIGARETTE SMOKE FROM ROT ANOTHER CREATE" time 1000
        064C: make_particle USHER2_NIKOLS_SMOKE_PARTICLE visible       
        end
    end           
    
return    

:USHER2_CREATE_VICTORIA
if
model.Available(15590)
then

0674: set_car_model 15590 numberplate "MT2WH0L3"    
USHER2_VICTORIA = Car.Create(15590, 2174.415527, -2265.320313, 13.308066)
car.Angle(USHER2_VICTORIA) = 45.0
    
if
model.Available(15590)
then
//model.Destroy(15590)
end
    
else
model.Load(15590)
mload
wait 0
jump to @USHER2_CREATE_VICTORIA
end    
    
/////////////////////////////////////////

008A: $USED_CAR[0] = USHER2_VICTORIA // (int)
$CAR_ENTERED[0] = 1
$CAR_MARKER_CREATED[0] = 0
$CAR_HINT_FLAG[0] = 0
$SAVE_CAR_CREATED[0] = 1
$SAVE_CAR_MODEL[0] = car.Model(USHER2_VICTORIA)
CAR_AUTOSAVED_EVER_FLAG = 1
LATEST_CAR_SLOT_USED = 0

03ED: set_car USHER2_VICTORIA disable_flipped_explosion_when_empty 1              
            
////////////////////////////////////////////////////////////////
0A97: 11@ = car USHER2_VICTORIA struct 
11@ += 9 
0A8D: 12@ = read_memory 11@ size 1 virtual_protect 0 
08BD: set 12@ bit 2 
0A8C: write_memory 11@ size 1 value 12@ virtual_protect 0 
0A97: 11@ = car USHER2_VICTORIA struct 
11@ += 4 
0A8D: 12@ = read_memory 11@ size 1 virtual_protect 0 
08BD: set 12@ bit 1 
0A8C: write_memory 11@ size 1 value 12@ virtual_protect 0 
24@ = 25.0 
0A97: 22@ = car USHER2_VICTORIA struct 
0A8E: 23@ = 22@ + 5 // int 
0A8C: write_memory 23@ size 4 value 24@ virtual_protect 0 
08C3: clear 12@ bit 1 
08C3: clear 12@ bit 2 
0A97: 11@ = car USHER2_VICTORIA struct 
11@ += 18 
0A8D: 12@ = read_memory 11@ size 1 virtual_protect 0 
08BD: set 12@ bit 2 
0A8C: write_memory 11@ size 1 value 12@ virtual_protect 0 
08C3: clear 12@ bit 2
//////////////////////////////////////////////////////////////// 

car.LockInCurrentPosition(USHER2_VICTORIA,false) 

if
0E08: is_car_script_controlled USHER2_VICTORIA
then
car.RemoveReferences(USHER2_VICTORIA)
end          

return

//////////////////////////////////////////////////////// 
    
:CAR_CREATE_USHER2_NIKOLS_CAR
if
model.Available(15591)
then

0674: set_car_model 15591 numberplate "4CT_0_PWR"    
USHER2_NIKOLS_CAR = Car.Create(15591, 2134.4553, -2297.2942, 13.1311)
car.Angle(USHER2_NIKOLS_CAR) = 134.2762
car.SetImmunities(USHER2_NIKOLS_CAR,1,1,1,1,1)
car.LockInCurrentPosition(USHER2_NIKOLS_CAR,true)
    
if
model.Available(15591)
then
//model.Destroy(15591)
end
    
else 
model.Load(15591)
mload
wait 0
jump to @CAR_CREATE_USHER2_NIKOLS_CAR
end    
    
/////////////////////////////////////////
    
0A97: 11@ = car USHER2_NIKOLS_CAR struct 
11@ += 9 
0A8D: 12@ = read_memory 11@ size 1 virtual_protect 0 
08BD: set 12@ bit 2 
0A8C: write_memory 11@ size 1 value 12@ virtual_protect 0 
0A97: 11@ = car USHER2_NIKOLS_CAR struct 
11@ += 4 
0A8D: 12@ = read_memory 11@ size 1 virtual_protect 0 
08BD: set 12@ bit 1 
0A8C: write_memory 11@ size 1 value 12@ virtual_protect 0 
24@ = 0.0 
0A97: 22@ = car USHER2_NIKOLS_CAR struct 
0A8E: 23@ = 22@ + 5 // int 
0A8C: write_memory 23@ size 4 value 24@ virtual_protect 0 
08C3: clear 12@ bit 1 
08C3: clear 12@ bit 2 
0A97: 11@ = car USHER2_NIKOLS_CAR struct 
11@ += 18 
0A8D: 12@ = read_memory 11@ size 1 virtual_protect 0 
08BD: set 12@ bit 2 
0A8C: write_memory 11@ size 1 value 12@ virtual_protect 0 
08C3: clear 12@ bit 2

0229: set_car USHER2_NIKOLS_CAR primary_color_to 3 secondary_color_to 3

return

//////////////////////////////////////////////////////// 
    
:CAR_CREATE_USHER2_DELTA_CAR
if
model.Available(15486)
then

0674: set_car_model 15486 numberplate "ASHWORM11"    
USHER2_DELTA_CAR = Car.Create(15486, 0.0,0.0,0.0)
car.SetImmunities(USHER2_DELTA_CAR,1,1,1,1,1)
car.LockInCurrentPosition(USHER2_DELTA_CAR,true)
car.DoorStatus(USHER2_DELTA_CAR,3)
    
if
model.Available(15486)
then
//model.Destroy(15486)
end
    
else 
model.Load(15486)
mload
wait 0
jump to @CAR_CREATE_USHER2_DELTA_CAR
end    
    
/////////////////////////////////////////
    
0A97: 11@ = car USHER2_DELTA_CAR struct 
11@ += 9 
0A8D: 12@ = read_memory 11@ size 1 virtual_protect 0 
08BD: set 12@ bit 2 
0A8C: write_memory 11@ size 1 value 12@ virtual_protect 0 
0A97: 11@ = car USHER2_DELTA_CAR struct 
11@ += 4 
0A8D: 12@ = read_memory 11@ size 1 virtual_protect 0 
08BD: set 12@ bit 1 
0A8C: write_memory 11@ size 1 value 12@ virtual_protect 0 
24@ = 100.0 
0A97: 22@ = car USHER2_DELTA_CAR struct 
0A8E: 23@ = 22@ + 5 // int 
0A8C: write_memory 23@ size 4 value 24@ virtual_protect 0 
08C3: clear 12@ bit 1 
08C3: clear 12@ bit 2 
0A97: 11@ = car USHER2_DELTA_CAR struct 
11@ += 18 
0A8D: 12@ = read_memory 11@ size 1 virtual_protect 0 
08BD: set 12@ bit 2 
0A8C: write_memory 11@ size 1 value 12@ virtual_protect 0 
08C3: clear 12@ bit 2

0229: set_car USHER2_DELTA_CAR primary_color_to 27 secondary_color_to 27

repeat
wait 0
07C0: load_path 814
mload
until 07C1:   path 814 available
        
05EB: assign_car USHER2_DELTA_CAR to_path 814
if
$EASY_MODE == 1
then
06FD: set_car USHER2_DELTA_CAR speed_on_path_to 0.95
else
06FD: set_car USHER2_DELTA_CAR speed_on_path_to 1.15
end

return

//////////////////////////////////////////////////////// 

:CAR_CREATE_USHER2_DELTA_BOECI

///////////////////////////////////////////////////////////////////

while not model.Available(7393)
wait 0
model.Load(7393)
mload
end

$SWAT[1] = Actor.CreateAsDriver(28, 7393, USHER2_DELTA_CAR)

if
model.Available(7393)
then
//model.Destroy(7393)
end

wait 5

while not model.Available(7393)
wait 0
model.Load(7393)
mload
end

$SWAT[2] = Actor.CreateAsPassenger(28, 7393, USHER2_DELTA_CAR,0)

if
model.Available(7393)
then
//model.Destroy(7393)
end
 
wait 5

while not model.Available(7393)
wait 0
model.Load(7393)
mload
end

$SWAT[3] = Actor.CreateAsPassenger(28, 7393, USHER2_DELTA_CAR,1)

if
model.Available(7393)
then
//model.Destroy(7393)
end

wait 5

while not model.Available(7393)
wait 0
model.Load(7393)
mload
end

$SWAT[4] = Actor.CreateAsPassenger(28, 7393, USHER2_DELTA_CAR,2)

if
model.Available(7393)
then
//model.Destroy(7393)
end

///////////////////////////////////////////////////////////////////

return

:CAR_CREATE_USHER2_DELTA_BOECI_SETTINGS

for 0@ = 1 to 4
create_thread @PED_BKP $SWAT[0@] 371
if
$PEOPLE_ATTACK_PLAYER_FLAG == 1
    then
    0770: set_actor $SWAT[0@] target_priority 1
    else
    0568: set_actor $SWAT[0@] untargetable 1
    end
if
$DEFENSE_CHALLENGE_FLAG == 1
    then
    0568: set_actor $SWAT[0@] untargetable 1
    end    
end

gosub @SWATS_RANDOM_HP
Actor.Health($SWAT[1]) = 0@
gosub @SWATS_RANDOM_HP
Actor.Health($SWAT[2]) = 0@
gosub @SWATS_RANDOM_HP
Actor.Health($SWAT[3]) = 0@
gosub @SWATS_RANDOM_HP
Actor.Health($SWAT[4]) = 0@

Actor.WeaponAccuracy($SWAT[1]) = $SWAT_ACCURACY
Actor.WeaponAccuracy($SWAT[2]) = $SWAT_ACCURACY
Actor.WeaponAccuracy($SWAT[3]) = $SWAT_ACCURACY 
Actor.WeaponAccuracy($SWAT[4]) = $SWAT_ACCURACY

081A: set_actor $SWAT[1] weapon_skill_to FRA_WEAP_SKILL
081A: set_actor $SWAT[2] weapon_skill_to FRA_WEAP_SKILL
081A: set_actor $SWAT[3] weapon_skill_to FRA_WEAP_SKILL
081A: set_actor $SWAT[4] weapon_skill_to FRA_WEAP_SKILL
 
0946: set_actor $SWAT[1] actions_uninterupted_by_weapon_fire ACT_UTIRPD_WEP_FIRE 
0946: set_actor $SWAT[2] actions_uninterupted_by_weapon_fire ACT_UTIRPD_WEP_FIRE 
0946: set_actor $SWAT[3] actions_uninterupted_by_weapon_fire ACT_UTIRPD_WEP_FIRE 
0946: set_actor $SWAT[3] actions_uninterupted_by_weapon_fire ACT_UTIRPD_WEP_FIRE
 
060B: set_actor $SWAT[1] decision_maker_to $DEC_PEOPLE 
060B: set_actor $SWAT[2] decision_maker_to $DEC_PEOPLE 
060B: set_actor $SWAT[3] decision_maker_to $DEC_PEOPLE 
060B: set_actor $SWAT[4] decision_maker_to $DEC_PEOPLE

0648: unknown_actor $SWAT[1] task_set 100.0 // float
0648: unknown_actor $SWAT[2] task_set 100.0 // float
0648: unknown_actor $SWAT[3] task_set 100.0 // float
0648: unknown_actor $SWAT[4] task_set 100.0 // float

09B5: set_actor $SWAT[1] signal_after_kill 0
09B5: set_actor $SWAT[2] signal_after_kill 0
09B5: set_actor $SWAT[3] signal_after_kill 0
09B5: set_actor $SWAT[4] signal_after_kill 0

if
CAMP_RAID_FLAG == 1
then

for 5@ = 1 to 4

if
0E4D: random_percent AMMO_DROP_FROM_RAIDS_CHANCE
then
//ass
else
087E: set_actor $SWAT[5@] weapon_droppable 0
end

end

end
 
0446: set_actor $SWAT[1] dismemberment_possible 0 
0446: set_actor $SWAT[2] dismemberment_possible 0 
0446: set_actor $SWAT[3] dismemberment_possible 0 
0446: set_actor $SWAT[4] dismemberment_possible 0

if
UNITED_MAP == 0
then  
04D8: set_actor $SWAT[1] drowns_in_water 0
04D8: set_actor $SWAT[2] drowns_in_water 0
04D8: set_actor $SWAT[3] drowns_in_water 0
04D8: set_actor $SWAT[4] drowns_in_water 0
0A28: set_actor $SWAT[1] swimming_speed_to 2.3
0A28: set_actor $SWAT[2] swimming_speed_to 2.3
0A28: set_actor $SWAT[3] swimming_speed_to 2.3
0A28: set_actor $SWAT[4] swimming_speed_to 2.3
else
04D8: set_actor $SWAT[1] drowns_in_water 1
04D8: set_actor $SWAT[2] drowns_in_water 1
04D8: set_actor $SWAT[3] drowns_in_water 1
04D8: set_actor $SWAT[4] drowns_in_water 1
end

if
$GAMEMODE_WAR == 0
then
random_int 5@ $PEOPLE_MIN_MONEY $PEOPLE_MAX_MONEY  
03FE: set_actor $SWAT[1] money 5@ 
random_int 5@ $PEOPLE_MIN_MONEY $PEOPLE_MAX_MONEY  
03FE: set_actor $SWAT[2] money 5@ 
random_int 5@ $PEOPLE_MIN_MONEY $PEOPLE_MAX_MONEY  
03FE: set_actor $SWAT[3] money 5@ 
random_int 5@ $PEOPLE_MIN_MONEY $PEOPLE_MAX_MONEY  
03FE: set_actor $SWAT[4] money 5@ 
end

Actor.SetWalkStyle($SWAT[1], "swat")
Actor.SetWalkStyle($SWAT[2], "swat")
Actor.SetWalkStyle($SWAT[3], "swat")
Actor.SetWalkStyle($SWAT[4], "swat")

29@ = 1 
gosub @SWATS_SPAWN1_WEAPON_CHECK 
29@ = 2 
gosub @SWATS_SPAWN1_WEAPON_CHECK 
29@ = 3 
gosub @SWATS_SPAWN1_WEAPON_CHECK 
29@ = 4 
gosub @SWATS_SPAWN1_WEAPON_CHECK

return

:USHER2_SPECINF_PHRASES

if
USHER2_HUNTER_PHRASE == 0
then
if
056D:   actor $HUNTER[0] defined
    then
    if
    0364:   actor USHER2_TERRY spotted_actor $HUNTER[0]
        then
        USHER2_HUNTER_PHRASE = 1
        $END_DIALOG_INST = 1
        wait 0
        v$ST_DIALOG[0] = "STRY177"
        $DIALOG_COUNT = 0
        $DIALOG_NOT_SKIP = 1
        create_thread @DG_SYS2 
        
        if and
        USHER2_CHARGER_PHRASE == 0
        SHOW_HINTS_FLAG == 1
        then
        text.ShowTextBox('HINT54')
        end
        
        end
    end
end

if
USHER2_CHARGER_PHRASE == 0
then
if
056D:   actor $CHARGER[0] defined
    then
    if
    0364:   actor USHER2_TERRY spotted_actor $CHARGER[0]
        then
        USHER2_CHARGER_PHRASE = 1
        $END_DIALOG_INST = 1
        wait 0
        v$ST_DIALOG[0] = "STRY176"
        $DIALOG_COUNT = 0
        $DIALOG_NOT_SKIP = 1
        create_thread @DG_SYS2 
        
        if and
        USHER2_HUNTER_PHRASE == 0
        SHOW_HINTS_FLAG == 1
        then
        text.ShowTextBox('HINT54')
        end
        
        end
    end
end

return